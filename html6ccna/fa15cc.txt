## Part V IPv4 Routing
Часть V Маршрутизация IPv4   
__|__
--|--
|
Part V Review|Часть V Обзор
## Chapter 15 Operating Cisco Routers
Глава 15 Эксплуатация маршрутизаторов Cisco   
__|__
--|--
|
This chapter covers the following exam topics:|В этой главе рассматриваются следующие экзаменационные темы:
###### 1.0 Network Fundamentals
1.0 Основы сети   
###### 1.1 Explain the role and function of network components
1.1 Объясните роль и функции сетевых компонентов   
###### 1.1.a Routers
1.1.a Маршрутизаторы   
###### 1.2 Describe characteristics of network topology architectures
1.2 Описание характеристик архитектур топологии сети   
###### 1.2.e Small office/home office (SOHO)
1.2.e Малый офис / домашний офис (SOHO)   
###### 1.6 Configure and verify IPv4 addressing and subnetting
1.6 Настройка и проверка адресации IPv4 и подсетей   
__|__
--|--
|
Getting an IPv4 network up and working requires some basic steps: installing routers, installing cables, and ordering WAN services.|Для настройки и работы сети IPv4 требуется несколько основных шагов: установка маршрутизаторов, установка кабелей и заказ услуг WAN.
The installation also requires some router configuration because routers often use defaults so that the router does not route IP packets until configuration has been added.|Для установки также требуется некоторая настройка маршрутизатора, поскольку маршрутизаторы часто используют настройки по умолчанию, поэтому маршрутизатор не маршрутизирует IP-пакеты до тех пор, пока конфигурация не будет добавлена.
You will need to configure IPv4 addresses, enable interfaces, and add IP routes—either through static configuration or by enabling some dynamic routing protocol.|Вам потребуется настроить IPv4-адреса, включить интерфейсы и добавить IP-маршруты - либо посредством статической конфигурации, либо путем включения какого-либо протокола динамической маршрутизации.
This chapter focuses on the first steps to creating a small working network: how to install an enterprise-class Cisco router and configure interfaces and IP addresses.|В этой главе рассматриваются первые шаги к созданию небольшой рабочей сети: как установить маршрутизатор Cisco корпоративного класса и настроить интерфейсы и IP-адреса.
|
This chapter breaks the topics into two major headings.|В этой главе темы разбиты на два основных заголовка.
The first discusses the physical installation of an enterprise-class Cisco router.|В первом обсуждается физическая установка маршрутизатора Cisco корпоративного класса.
The second section looks at the commandline interface (CLI) on a Cisco router, which has the same look and feel as the Cisco switch CLI. This section first lists the similarities between a switch and router CLI and then introduces the configuration required to make the router start forwarding IP packets on its interfaces.|Во втором разделе рассматривается интерфейс командной строки (CLI) на маршрутизаторе Cisco, который выглядит так же, как интерфейс командной строки коммутатора Cisco. В этом разделе сначала перечислены сходства между интерфейсом командной строки коммутатора и маршрутизатора, а затем представлена ??конфигурация, необходимая для того, чтобы маршрутизатор начал пересылку IP-пакетов на своих интерфейсах.
### “Do I Know This Already?” Quiz
«Знаю ли я это уже?» Викторина   
__|__
--|--
|
Take the quiz (either here or use the PTP software) if you want to use the score to help you decide how much time to spend on this chapter.|Пройдите тест (здесь или воспользуйтесь программой PTP), если вы хотите использовать оценку, чтобы решить, сколько времени потратить на эту главу.
The letter answers are listed at the bottom of the page following the quiz.|Ответы на письма перечислены внизу страницы после викторины.
Appendix C, found both at the end of the book as well as on the companion website, includes both the answers and explanations.|Приложение C, которое можно найти как в конце книги, так и на сопутствующем веб-сайте, включает как ответы, так и пояснения.
You can also find both answers and explanations in the PTP testing software.|Вы также можете найти ответы и пояснения в программе тестирования PTP.
|
Table 15-1 “Do I Know This Already?” Foundation Topics Section-to-Question Mapping|Таблица 15-1 «Знаю ли я это уже?» Сопоставление разделов с вопросами по основным темам
### Foundation Topics
Основные темы   
### Installing Cisco Routers
Установка маршрутизаторов Cisco   
__|__
--|--
|
Enabling IPv4 Support on Cisco Routers 2–6 CHAPTER 15 1.|Включение поддержки IPv4 на маршрутизаторах Cisco 2–6 ГЛАВА 15 1.
Which of the following installation steps are more likely required on a Cisco router, but not typically required on a Cisco switch? (Choose two answers.)|Какие из следующих шагов установки, скорее всего, требуются на маршрутизаторе Cisco, но обычно не требуются на коммутаторе Cisco? (Выберите два ответа.)
|
a. Connect Ethernet cables b.|а. Подключите кабели Ethernet b.
Connect serial cables c.|Подключите последовательные кабели c.
Connect to the console port d.|Подключитесь к консольному порту d.
Connect the power cable e.|Подключите шнур питания e.
Turn the on/off switch to “on”|Установите переключатель включения / выключения в положение «включено».
|
2. Which of the following commands might you see associated with a router CLI, but not with a switch CLI?|2. Какая из следующих команд может быть связана с интерфейсом командной строки маршрутизатора, но не с интерфейсом командной строки коммутатора?
|
a. The show mac address-table command b.|а. Команда show mac address-table b.
The show ip route command c.|Команда show ip route c.
The show running-config command d.|Команда show running-config d.
The show interfaces status command 3.|Команда show interfaces status 3.
Which answers list a task that could be helpful in making a router interface G0/0 ready to route packets? (Choose two answers.)|В каких ответах перечислены задачи, которые могут быть полезны для подготовки интерфейса маршрутизатора G0 / 0 к маршрутизации пакетов? (Выберите два ответа.)
|
a. Configuring the ip address address mask command in G0/0 configuration mode b.|а. Настройка команды маски IP-адреса и адреса в режиме конфигурации G0 / 0 b.
Configuring the ip address address and ip mask mask commands in G0/0 configuration mode c.|Настройка команд IP-адреса и маски IP-адреса в режиме конфигурации G0 / 0 c.
Configuring the no shutdown command in G0/0 configuration mode d.|Настройка команды no shutdown в режиме конфигурации G0 / 0 d.
Setting the interface description in G0/0 configuration mode 4.|Установка описания интерфейса в режиме конфигурации G0 / 0 4.
The output of the show ip interface brief command on R1 lists interface status codes of “down” and “down” for interface GigabitEthernet 0/0.|В выходных данных команды show ip interfacerief на маршрутизаторе R1 перечислены коды состояния интерфейса «не работает» и «не работает» для интерфейса GigabitEthernet 0/0.
The interface connects to a LAN switch with a UTP straight-through cable.|Интерфейс подключается к коммутатору LAN с помощью прямого кабеля UTP.
Which of the following could be true?|Что из следующего может быть правдой?
|
a. The shutdown command is currently configured for router interface G0/0.|а. Команда выключения в настоящее время настроена для интерфейса маршрутизатора G0 / 0.
|
b. The shutdown command is currently configured for the switch interface on the other end of the cable.|б. Команда выключения в настоящее время настроена для интерфейса коммутатора на другом конце кабеля.
|
c. The router was never configured with an ip address command on the interface.|c. Маршрутизатор никогда не был настроен с помощью команды ip-адреса на интерфейсе.
|
d. The router was configured with the no ip address command.|d. Маршрутизатор был настроен с помощью команды no ip address.
|
5. Which of the following commands do not list the IP address and mask of at least one interface? (Choose two answers.)|5. Какая из следующих команд не отображает IP-адрес и маску хотя бы одного интерфейса? (Выберите два ответа.)
|
a. show running-config b. show protocols type number c. show ip interface brief d. show interfaces e. show version 6.|а. показать текущую конфигурацию b. показать номер типа протокола c. показать краткое описание интерфейса ip d. показать интерфейсы e. показать версию 6.
Which of the following is different on the Cisco switch CLI for a Layer 2 switch as compared with the Cisco router CLI?|Что из следующего отличается в интерфейсе командной строки коммутатора Cisco для коммутатора уровня 2 от интерфейса командной строки маршрутизатора Cisco?
|
a. The commands used to configure simple password checking for the console b.|а. Команды, используемые для настройки простой проверки пароля для консоли b.
The number of IP addresses configured c.|Количество настроенных IP-адресов c.
The configuration of the device’s hostname d.|Конфигурация имени хоста устройства d.
The configuration of an interface description Foundation Topics Installing Cisco Routers Routers collectively provide the main feature of the network layer—the capability to forward packets end to end through a network.|Конфигурация описания интерфейса Основные темы Установка маршрутизаторов Cisco Маршрутизаторы в совокупности обеспечивают основную функцию сетевого уровня - возможность пересылать пакеты из конца в конец по сети.
As introduced in Chapter 3, “Fundamentals of WANs and IP Routing,” routers forward packets by connecting to various physical network links, like Ethernet LAN, Ethernet WAN, and serial WAN links, then using Layer 3 routing logic to choose where to forward each packet.|Как было сказано в главе 3 «Основы глобальных сетей и IP-маршрутизации», маршрутизаторы пересылают пакеты, подключаясь к различным физическим сетевым каналам, таким как Ethernet LAN, Ethernet WAN и последовательные каналы WAN, а затем с помощью логики маршрутизации уровня 3 выбирают, куда пересылать каждый пакет.
As a reminder, Chapter 2, “Fundamentals of Ethernet LANs,” covered the details of making those physical connections to Ethernet networks, while Chapter 3 covered the basics of cabling with WAN links.|Напомним, в главе 2 «Основы локальных сетей Ethernet» были подробно описаны эти физические подключения к сетям Ethernet, а в главе 3 были рассмотрены основы прокладки кабелей с помощью каналов глобальной сети.
|
This section examines some of the details of router installation and cabling, first from the enterprise perspective and then from the perspective of connecting a typical small office/|В этом разделе рассматриваются некоторые детали установки маршрутизатора и кабельной разводки, сначала с точки зрения предприятия, а затем с точки зрения подключения типичного небольшого офиса /
|
home office (SOHO) to an ISP using high-speed Internet.|домашний офис (SOHO) к провайдеру с помощью высокоскоростного Интернета.
#### Installing Enterprise Routers
Установка корпоративных маршрутизаторов   
__|__
--|--
|
A typical enterprise network has a few centralized sites as well as lots of smaller remote sites.|В типичной корпоративной сети есть несколько централизованных сайтов, а также множество более мелких удаленных сайтов.
|
To support devices at each site (the computers, IP phones, printers, and other devices), the network includes at least one LAN switch at each site.|Для поддержки устройств на каждом сайте (компьютеры, IP-телефоны, принтеры и другие устройства) в сети есть как минимум один коммутатор LAN на каждом сайте.
In addition, each site has a router, which connects to the LAN switch and to some WAN link.|Кроме того, у каждого сайта есть маршрутизатор, который подключается к коммутатору LAN и некоторому каналу WAN.
The WAN link provides connectivity from each remote site, back to the central site, and to other sites through the connection to the central site.|Канал WAN обеспечивает возможность подключения с каждого удаленного сайта обратно к центральному сайту и к другим сайтам через соединение с центральным сайтом.
|
Figures 15-1 and 15-2 show a couple of different kinds of network diagrams that might be used to represent an enterprise network.|На рисунках 15-1 и 15-2 показаны несколько различных видов сетевых диаграмм, которые можно использовать для представления корпоративной сети.
The style of Figure 15-1 supports discussions about Layer 3 topics, showing the subnet IDs, masks, and interface IP addresses in shorthand.|Стиль, показанный на рис. 15-1, поддерживает обсуждения тем уровня 3, показывая в сокращенном виде идентификаторы подсети, маски и IP-адреса интерфейсов.
The figure also keeps the physical and data-link details to a minimum with these conventions:|На рисунке также сведены к минимуму физические данные и сведения о канале передачи данных с помощью следующих соглашений:
|
Ethernet LAN: Simple straight lines with one or more LAN switches implied but not shown.|Ethernet LAN: простые прямые линии с одним или несколькими переключателями LAN подразумеваются, но не показаны.
|
Ethernet WAN: Shown as a straight line, often with a cloud over it, with some kind of Ethernet interface identifier shown by the router (in this case, G0/1/0 and G0/0/0, which refers to GigabitEthernet interfaces).|Ethernet WAN: отображается как прямая линия, часто с облаком над ней, с каким-либо идентификатором интерфейса Ethernet, отображаемым маршрутизатором (в данном случае G0 / 1/0 и G0 / 0/0, что относится к интерфейсам GigabitEthernet) .
|
Serial WAN: A line with a crooked part in the middle (a “lightning bolt”) represents a typical point-to-point serial link as introduced in Chapter 3.|Последовательный WAN: линия с изогнутой частью посередине («молния») представляет собой типичный последовательный канал связи точка-точка, как это было описано в главе 3.
|
Figure 15-1 Generic Enterprise Network Diagram In comparison, Figure 15-2 shows more detail about the physical cabling with less detail about the IP subnets and addresses.|Рис. 15-1. Типовая диаграмма корпоративной сети. Для сравнения, на рис. 15-2 показаны более подробные сведения о физических кабелях и менее подробные сведения об IP-подсетях и адресах.
First, if the diagram needs to show physical details in the LAN, the diagram could show the LAN switches and related devices to the outside of the figure.|Во-первых, если на схеме необходимо показать физические детали в локальной сети, на диаграмме могут быть показаны коммутаторы локальной сети и связанные с ними устройства за пределами рисунка.
The router Ethernet interfaces have an RJ-45 connector; just connect the appropriate UTP cable to both the router and the nearby LAN switch.|Интерфейсы Ethernet маршрутизатора имеют разъем RJ-45; просто подключите соответствующий кабель UTP к маршрутизатору и ближайшему коммутатору LAN.
|
Figure 15-2 More Detailed Cabling Diagram for the Same Enterprise Network Next, consider the hardware on the ends of the serial link, in particular where the channel service unit/data service unit (CSU/DSU) hardware resides on each end of the serial link.|Рис. 15-2. Более подробная схема кабельной разводки для той же корпоративной сети. Затем рассмотрим оборудование на концах последовательного канала, в частности, там, где оборудование блока обслуживания канала / блока обслуживания данных (CSU / DSU) находится на каждом конце последовательного канала. ссылка на сайт.
In a real serial link that runs through a service provider, the link terminates at a CSU/DSU. The CSU/DSU can either sit outside the router as a separate device (as shown on the left at router R1) or integrated into the router’s serial interface hardware (as shown on the right).|В реальном последовательном канале, который проходит через поставщика услуг, канал заканчивается в CSU / DSU. CSU / DSU может располагаться вне маршрутизатора как отдельное устройство (как показано слева на маршрутизаторе R1) или быть интегрированным в оборудование последовательного интерфейса маршрутизатора (как показано справа).
|
As for cabling, the service provider will run the cable into the enterprise’s wiring closet and often put an RJ-48 connector (same size as an RJ-45 connector) on the end of the cable.|Что касается кабельной разводки, поставщик услуг проложит кабель в коммутационный шкаф предприятия и часто вставляет разъем RJ-48 (такого же размера, как и разъем RJ-45) на конец кабеля.
|
That cable should connect to the CSU/DSU. With an internal CSU/DSU (as with router R1 in Figure 15-2), the router serial port has an RJ-48 port to which the serial cable should connect.|Этот кабель должен подключаться к CSU / DSU. С внутренним CSU / DSU (как в маршрутизаторе R1 на рис. 15-2) последовательный порт маршрутизатора имеет порт RJ-48, к которому должен подключаться последовательный кабель.
With an external CSU/DSU, the CSU/DSU must be connected to the router’s serial card via a short serial cable.|С внешним CSU / DSU, CSU / DSU должен быть подключен к последовательной карте маршрутизатора с помощью короткого последовательного кабеля.
##### Cisco Integrated Services Routers
Маршрутизаторы с интегрированными сервисами Cisco   
__|__
--|--
|
Product vendors, including Cisco, typically provide several different types of router hardware.|Поставщики продуктов, включая Cisco, обычно предоставляют несколько различных типов оборудования маршрутизатора.
|
Today, routers often do much more work than simply routing packets; in fact, they serve as a device or platform from which to provide many network services.|Сегодня маршрутизаторы часто выполняют гораздо больше работы, чем просто маршрутизация пакетов; фактически, они служат устройством или платформой для предоставления многих сетевых услуг.
Cisco even brands its enterprise routers not just as routers, but as “integrated services routers,” emphasizing the multipurpose nature of the products.|Cisco даже называет свои корпоративные маршрутизаторы не просто маршрутизаторами, а «маршрутизаторами с интегрированными услугами», подчеркивая универсальность продуктов.
|
As an example, consider the networking functions needed at a typical branch office.|В качестве примера рассмотрим сетевые функции, необходимые в типичном филиале.
A typical enterprise branch office needs a router for WAN/LAN connectivity, and a LAN switch to provide a high-performance local network and connectivity into the router and WAN. Many branches also need voice-over-IP (VoIP) services to support IP phones, and several security services as well.|Типичному филиалу предприятия необходим маршрутизатор для подключения к WAN / LAN и коммутатор LAN для обеспечения высокопроизводительной локальной сети и подключения к маршрутизатору и WAN. Многие филиалы также нуждаются в услугах передачи голоса по IP (VoIP) для поддержки IP-телефонов, а также в некоторых службах безопасности.
Plus, it is hard to imagine a site with users that does not have Wi-Fi access today.|К тому же сложно представить себе сайт с пользователями, у которых сегодня нет доступа к Wi-Fi.
|
So, rather than require multiple separate devices at one site, as shown in Figure 15-2, Cisco offers single devices that act as both router and switch and provide other functions as well.|Таким образом, вместо того, чтобы требовать нескольких отдельных устройств на одном сайте, как показано на рис. 15-2, Cisco предлагает отдельные устройства, которые действуют как маршрутизатор и коммутатор, а также предоставляют другие функции.
|
For the sake of learning and understanding the different functions, this book focuses on using a separate switch and separate router, which provides a much cleaner path for learning the basics.|Для изучения и понимания различных функций в этой книге основное внимание уделяется использованию отдельного коммутатора и отдельного маршрутизатора, что обеспечивает более простой путь для изучения основ.
|
Figure 15-3 shows a photo of the Cisco 4321 ISR, with some of the more important features highlighted.|На Рис. 15-3 показана фотография Cisco 4321 ISR с выделенными некоторыми из наиболее важных функций.
The top part of the figure shows a full view of the back of the router.|В верхней части рисунка показан полный вид задней части маршрутизатора.
This model comes with two built-in Gigabit Ethernet interfaces and two modular slots that allow you to add small cards called Network Interface Modules (NIMs).|Эта модель поставляется с двумя встроенными интерфейсами Gigabit Ethernet и двумя модульными слотами, которые позволяют добавлять небольшие карты, называемые модулями сетевого интерфейса (NIM).
The bottom of the figure shows one example NIM (a NIM that provides two serial interfaces).|Внизу рисунка показан один пример NIM (NIM, которая предоставляет два последовательных интерфейса).
The router has other items as well, including both an RJ-45 and USB console port.|В роутере есть и другие элементы, в том числе консольный порт RJ-45 и USB.
|
Figure 15-3 Photos of a Model 4321 Cisco Integrated Services Router (ISR)|Рисунок 15-3 Фотографии маршрутизатора Cisco с интегрированными сервисами (ISR) модели 4321
|
Answers to the “Do I Know This Already?” quiz:|Ответы на вопрос «Знаю ли я это уже?» викторина:
|
1 B, E 2 B 3 A, C 4 C 5 C, E 6 B The figure shows an important feature for using routers to connect to both Ethernet LANs and Ethernet WAN services.|1 B, E 2 B 3 A, C 4 C 5 C, E 6 B На рисунке показана важная функция использования маршрутизаторов для подключения как к локальным сетям Ethernet, так и к службам Ethernet WAN.
Look closely at Figure 15-3’s Gigabit interfaces.|Внимательно посмотрите на гигабитные интерфейсы на Рисунке 15-3.
Gi0/1 refers to interface GigabitEthernet0/1 and is an RJ-45 port that supports UTP cabling only.|Gi0 / 1 относится к интерфейсу GigabitEthernet0 / 1 и является портом RJ-45, который поддерживает только кабели UTP.
However, interface Gi0/0 (short for GigabitEthernet0/0) has some interesting features:|Однако интерфейс Gi0 / 0 (сокращение от GigabitEthernet0 / 0) имеет некоторые интересные особенности:
###### The router has two ports for one interface (Gi0/0).
Маршрутизатор имеет два порта для одного интерфейса (Gi0 / 0).   
###### You can use one or the other at any point in time, but not both.
Вы можете использовать одно или другое в любой момент, но не то и другое одновременно.   
###### One physical port is an RJ-45 port that supports copper cabling (implying that it is used
Один физический порт - это порт RJ-45, который поддерживает медные кабели (подразумевая, что он используется   
__|__
--|--
|
to connect to a LAN).|для подключения к локальной сети).
###### The other Gi0/0 physical port is a Small Form Pluggable (SFP) port that would support various
Другой физический порт Gi0 / 0 - это порт Small Form Pluggable (SFP), который поддерживает различные   
__|__
--|--
|
fiber Ethernet standards, allowing the port to be used for Ethernet WAN purposes.|стандарты оптоволоконного Ethernet, позволяющие использовать порт для сетей Ethernet WAN.
|
Cisco commonly makes one or more of the Ethernet ports on its Enterprise class routers support SFPs so that the engineer can choose an SFP that supports the type of Ethernet cabling provided by the Ethernet WAN service provider.|Cisco обычно делает один или несколько портов Ethernet на своих маршрутизаторах корпоративного класса для поддержки SFP, чтобы инженер мог выбрать SFP, который поддерживает тип кабеля Ethernet, предоставляемый поставщиком услуг Ethernet WAN.
|
NOTE When building a lab network to study for CCNA or CCNP, because your devices will be in the same place, you can create Ethernet WAN links by using the RJ-45 ports and a UTP cable without the need to purchase an SFP for each router.|ПРИМЕЧАНИЕ При создании лабораторной сети для изучения CCNA или CCNP, поскольку ваши устройства будут в одном месте, вы можете создать каналы Ethernet WAN, используя порты RJ-45 и кабель UTP, без необходимости покупать SFP для каждого маршрутизатора. .
##### Physical Installation
Физическая установка   
__|__
--|--
|
Armed with the cabling details in images like Figure 15-2 and the router hardware details in photos like Figure 15-3, you can physically install a router.|Вооружившись деталями кабельной разводки на изображениях, таких как Рисунок 15-2, и деталями оборудования маршрутизатора на фотографиях, таких как Рисунок 15-3, вы можете физически установить маршрутизатор.
To install a router, follow these steps:|Чтобы установить роутер, выполните следующие действия:
|
Step 1.|Шаг 1.
For any Ethernet LAN interface, connect the RJ-45 connector of an appropriate copper Ethernet cable between the RJ-45 Ethernet port on the router and one of the LAN switch ports.|Для любого интерфейса Ethernet LAN подключите разъем RJ-45 соответствующего медного кабеля Ethernet между портом RJ-45 Ethernet на маршрутизаторе и одним из портов коммутатора LAN.
|
Step 2.|Шаг 2.
For any serial WAN ports:|Для любых последовательных портов WAN:
|
A. If using an external CSU/DSU, connect the router’s serial interface to the CSU/DSU and the CSU/DSU to the line from the telco.|A. При использовании внешнего CSU / DSU подключите последовательный интерфейс маршрутизатора к CSU / DSU, а CSU / DSU к линии от телефонной компании.
|
B. If using an internal CSU/DSU, connect the router’s serial interface to the line from the telco.|B. При использовании внутреннего CSU / DSU подключите последовательный интерфейс маршрутизатора к линии от телефонной компании.
|
Step 3.|Шаг 3.
For any Ethernet WAN ports:|Для любых портов Ethernet WAN:
|
A. When ordering the Ethernet WAN service, confirm the required Ethernet standard and SFP type required to connect to the link, and order the SFPs.|A. При заказе услуги Ethernet WAN подтвердите требуемый стандарт Ethernet и тип SFP, необходимые для подключения к каналу, и закажите модули SFP.
|
B. Install the SFPs into the routers, and connect the Ethernet cable for the Ethernet WAN link to the SFP on each end of the link.|B. Установите модули SFP в маршрутизаторы и подключите кабель Ethernet для соединения Ethernet WAN к SFP на каждом конце канала.
|
Step 4.|Шаг 4.
Connect the router’s console port to a PC (as discussed in Chapter 4, “Using the Command-Line Interface”), as needed, to configure the router.|Подключите консольный порт маршрутизатора к ПК (как описано в главе 4 «Использование интерфейса командной строки»), если необходимо, для настройки маршрутизатора.
|
Step 5.|Шаг 5.
Connect a power cable from a power outlet to the power port on the router.|Подключите кабель питания от розетки к разъему питания на маршрутизаторе.
|
Step 6.|Шаг 6.
Power on the router.|Включите роутер.
|
Note that Cisco enterprise routers typically have an on/off switch, while switches do not.|Обратите внимание, что корпоративные маршрутизаторы Cisco обычно имеют переключатель включения / выключения, а коммутаторы - нет.
#### Installing SOHO Routers
Установка маршрутизаторов SOHO   
__|__
--|--
|
The terms enterprise router and small office/home office (SOHO) router act as a pair of contrasting categories for routers, both in terms of how vendors like Cisco provide to the market, and how enterprises use and configure those devices.|Термины корпоративный маршрутизатор и маршрутизатор для малого офиса / домашнего офиса (SOHO) действуют как пара противоположных категорий для маршрутизаторов, как с точки зрения того, как поставщики, такие как Cisco, предоставляют рынку, так и с точки зрения того, как предприятия используют и настраивают эти устройства.
The term enterprise router typically refers to a router that a company would use in a permanent business location, while a SOHO router would reside at an employee’s home or at a small permanent site with just a few people.|Термин корпоративный маршрутизатор обычно относится к маршрутизатору, который компания будет использовать в постоянном офисе, в то время как маршрутизатор SOHO будет находиться в доме сотрудника или на небольшом постоянном объекте с несколькими людьми.
However, as you might guess, the line between a router acting as an enterprise router and a SOHO router is blurry, so use these terms as general categories.|Однако, как вы могли догадаться, грань между маршрутизатором, выступающим в качестве корпоративного маршрутизатора, и маршрутизатором SOHO размыта, поэтому используйте эти термины как общие категории.
|
Even with that general comparison, SOHO routers typically have two features that an enterprise router would be less likely to have:|Даже при таком общем сравнении маршрутизаторы SOHO обычно имеют две функции, которые вряд ли будут иметь корпоративный маршрутизатор:
###### SOHO routers almost always use the Internet and virtual private network (VPN) technology
Маршрутизаторы SOHO почти всегда используют Интернет и технологию виртуальной частной сети (VPN).   
__|__
--|--
|
for their WAN connections to send data back and forth to the rest of the Enterprise.|для их WAN-соединений, чтобы отправлять данные туда и обратно остальной части предприятия.
###### SOHO routers almost always use a multifunction device that does routing, LAN switching,
Маршрутизаторы SOHO почти всегда используют многофункциональное устройство, которое выполняет маршрутизацию, коммутацию LAN,   
__|__
--|--
|
VPN, wireless, and maybe other features.|VPN, беспроводная связь и, возможно, другие функции.
|
For instance, at an enterprise business location, the building may contain enterprise routers, separate Ethernet switches, and separate wireless access points (AP), all connected together.|Например, на территории предприятия, здание может содержать корпоративные маршрутизаторы, отдельные коммутаторы Ethernet и отдельные точки беспроводного доступа (AP), все соединенные вместе.
|
At a permanent business site with four employees and 10 total devices in the network, one SOHO router could provide all those same features in one device.|На постоянной производственной площадке с четырьмя сотрудниками и 10 устройствами в сети один маршрутизатор SOHO может обеспечить все те же функции на одном устройстве.
|
For instance, Figure 15-4 shows a typical SOHO site.|Например, на рис. 15-4 показан типичный объект SOHO.
The three icons that represent a router, switch, and access point actually all exist inside one box; the figure just shows them separately to emphasize the fact that the one SOHO router provides several functions.|Три значка, которые представляют маршрутизатор, коммутатор и точку доступа, фактически находятся внутри одного блока; на рисунке они показаны отдельно, чтобы подчеркнуть тот факт, что один маршрутизатор SOHO обеспечивает несколько функций.
On the left, the SOHO router provides wired and wireless LAN servers, and on the right, it provides WAN access through a cable Internet connection.|Слева маршрутизатор SOHO предоставляет серверы проводной и беспроводной локальной сети, а справа - доступ к глобальной сети через кабельное подключение к Интернету.
|
Figure 15-4 Devices in a SOHO Network with High-Speed CATV Internet Figure 15-4 does not reflect the physical reality of a SOHO router, so Figure 15-5 shows one cabling example.|Рис. 15-4. Устройства в сети SOHO с высокоскоростным кабельным Интернетом. Рисунок 15-4 не отражает физическую реальность маршрутизатора SOHO, поэтому на рис. 15-5 показан один пример кабельной разводки.
The figure shows user devices on the left, connecting to the router via wireless or via Ethernet UTP cabling.|На рисунке слева показаны пользовательские устройства, подключающиеся к маршрутизатору по беспроводной сети или через кабель Ethernet UTP.
On the right in this case, the router uses an external cable modem to connect to the coaxial cable provided by the ISP. Then the router must use a normal UTP Ethernet port to connect a short Ethernet cable between the SOHO router and the cable modem.|В данном случае справа маршрутизатор использует внешний кабельный модем для подключения к коаксиальному кабелю, предоставленному поставщиком Интернет-услуг. Затем маршрутизатор должен использовать обычный порт Ethernet UTP для подключения короткого кабеля Ethernet между маршрутизатором SOHO и кабельным модемом.
|
Figure 15-5 SOHO Network, Using Cable Internet and an Integrated Device|Рисунок 15-5 Сеть SOHO, использование кабельного Интернета и интегрированного устройства
### Enabling IPv4 Support on Cisco Router Interfaces
Включение поддержки IPv4 на интерфейсах маршрутизатора Cisco   
__|__
--|--
|
Routers support a relatively large number of features, with a large number of configuration and EXEC commands to support those features.|Маршрутизаторы поддерживают относительно большое количество функций, с большим количеством конфигураций и команд EXEC для поддержки этих функций.
You will learn about many of these features throughout the rest of this book.|Вы узнаете о многих из этих функций в оставшейся части этой книги.
|
NOTE For perspective, the Cisco router documentation includes a command reference, with an index to every single router command.|ПРИМЕЧАНИЕ. Для удобства в документации маршрутизатора Cisco есть справочник команд с указателем каждой отдельной команды маршрутизатора.
A quick informal count of a recent IOS version listed around 5000 CLI commands.|Быстрый неофициальный подсчет последней версии IOS перечислил около 5000 команд CLI.
|
This second section of the chapter focuses on commands related to router interfaces.|Этот второй раздел главы посвящен командам, связанным с интерфейсами маршрутизатора.
To make routers work—that is, to route IPv4 packets—the interfaces must be configured.|Чтобы маршрутизаторы работали, то есть для маршрутизации пакетов IPv4, интерфейсы должны быть настроены.
This section introduces the most common commands that configure interfaces, make them work, and give the interfaces IP addresses and masks.|В этом разделе представлены наиболее распространенные команды, которые настраивают интерфейсы, заставляют их работать и присваивают интерфейсам IP-адреса и маски.
#### Accessing the Router CLI
Доступ к интерфейсу командной строки маршрутизатора   
__|__
--|--
|
Accessing a router’s command-line interface (CLI) works much like a switch.|Доступ к интерфейсу командной строки маршрутизатора (CLI) работает во многом как коммутатор.
In fact, it works so much like accessing a Cisco switch CLI that this book relies on Chapter 4 instead of repeating the same details here.|Фактически, он работает так же, как доступ к интерфейсу командной строки коммутатора Cisco, что эта книга опирается на главу 4 вместо того, чтобы повторять здесь те же детали.
If the details from Chapter 4 are not fresh in your memory, it might be worthwhile to spend a few minutes briefly reviewing that chapter as well as Chapter 7, “Configuring and Verifying Switch Interfaces,” before reading further.|Если подробности из главы 4 не свежи в вашей памяти, возможно, стоит потратить несколько минут на краткий обзор этой главы, а также главы 7 «Настройка и проверка интерфейсов коммутатора», прежде чем читать дальше.
|
Cisco switches and routers share many of the same CLI navigation features and many of the same configuration commands for management features.|Коммутаторы и маршрутизаторы Cisco используют одни и те же функции навигации CLI и многие из одних и тех же команд конфигурации для функций управления.
The following list mentions the highlights:|В следующем списке перечислены основные моменты:
###### User and Enable (privileged) mode
Пользовательский и активный (привилегированный) режим   
###### Entering and exiting configuration mode, using the configure terminal, end, and exit
Вход и выход из режима конфигурации с помощью терминала настройки, завершение и выход   
__|__
--|--
|
commands and the Ctrl+Z key sequence|команды и последовательность клавиш Ctrl + Z
###### Configuration of console, Telnet (vty), and enable secret passwords
Настройка консоли, Telnet (vty) и включение секретных паролей   
###### Configuration of Secure Shell (SSH) encryption keys and username/password login
Настройка ключей шифрования Secure Shell (SSH) и логина / пароля для входа   
__|__
--|--
|
credentials|полномочия
###### Configuration of the hostname and interface description
Конфигурация имени хоста и описания интерфейса   
###### Configuration of Ethernet interfaces that can negotiate speed using the speed and duplex
Конфигурация интерфейсов Ethernet, которые могут согласовывать скорость с использованием скорости и дуплекса   
__|__
--|--
|
commands|команды
###### Configuration of an interface to be administratively disabled (shutdown) and administratively
Конфигурация интерфейса для административного отключения (выключение) и административного отключения   
__|__
--|--
|
enabled (no shutdown)|включен (без выключения)
###### Navigation through different configuration mode contexts using commands like line
Навигация по различным контекстам режима конфигурации с помощью таких команд, как строка   
__|__
--|--
|
console 0 and interface type number|консоль 0 и номер типа интерфейса
###### CLI help, command editing, and command recall features
Функции справки CLI, редактирования команд и отзыва команд   
###### The meaning and use of the startup-config (in NVRAM), running-config (in RAM), and
Значение и использование конфигурации запуска (в NVRAM), текущей конфигурации (в ОЗУ) и   
__|__
--|--
|
external servers (like TFTP), along with how to use the copy command to copy the configuration files and IOS images At first glance, this list seems to cover most everything you have read so far in this book about the switch CLI. However, a couple of topics do work differently with the router CLI as compared to the switch CLI, as follows:|внешние серверы (например, TFTP), а также то, как использовать команду copy для копирования файлов конфигурации и образов IOS. На первый взгляд, этот список, кажется, охватывает почти все, что вы прочитали в этой книге о CLI коммутатора. Однако несколько тем работают с интерфейсом командной строки маршрутизатора иначе, чем с интерфейсом командной строки коммутатора, а именно:
###### The configuration of IP addresses differs in some ways, with switches using a VLAN
Конфигурация IP-адресов в некоторой степени отличается от коммутаторов, использующих VLAN.   
__|__
--|--
|
interface and routers using an IP address configured on each working interface.|интерфейс и маршрутизаторы, использующие IP-адрес, настроенный для каждого рабочего интерфейса.
###### Many Cisco router models have an auxiliary (Aux) port, intended to be connected to an
Многие модели маршрутизаторов Cisco имеют вспомогательный (Aux) порт, предназначенный для подключения к   
__|__
--|--
|
external modem and phone line to allow remote users to dial in to the router, and access the CLI, by making a phone call.|внешний модем и телефонная линия, чтобы удаленные пользователи могли подключиться к маршрутизатору и получить доступ к интерфейсу командной строки, сделав телефонный звонок.
Cisco switches do not have auxiliary ports.|Коммутаторы Cisco не имеют дополнительных портов.
###### Router IOS defaults to disallow both Telnet and SSH into the router because of the typical
IOS маршрутизатора по умолчанию запрещает подключение Telnet и SSH к маршрутизатору из-за типичного   
__|__
--|--
|
router default setting of transport input none in vty configuration mode. (Cisco Catalyst LAN switches typically default to allow both Telnet and SSH.) Chapter 6, “Configuring Basic Switch Management,” already discussed the various options on this command to enable Telnet (transport input telnet), SSH (transport input ssh), or both (transport input all or transport input telnet ssh).|настройка маршрутизатора по умолчанию для транспортного входа отсутствует в режиме конфигурации VTY. (Коммутаторы Cisco Catalyst LAN обычно по умолчанию разрешают использование Telnet и SSH.) В главе 6 «Настройка базового управления коммутатором» уже обсуждались различные параметры этой команды для включения Telnet (входной транспортный telnet), SSH (транспортный вход ssh) или оба (транспортный ввод всех или транспортный ввод telnet ssh).
|
The router CLI also differs from a switch CLI just because switches and routers do different things.|Интерфейс командной строки маршрутизатора также отличается от интерфейса командной строки коммутатора только потому, что коммутаторы и маршрутизаторы выполняют разные функции.
For example:|Например:
###### Cisco Layer 2 switches support the show mac address-table command, while Cisco routers
Коммутаторы Cisco уровня 2 поддерживают команду show mac address-table, а маршрутизаторы Cisco   
__|__
--|--
|
do not.|не делайте.
###### Cisco routers support the show ip route command, while Cisco Layer 2 switches do not.
Маршрутизаторы Cisco поддерживают команду show ip route, а коммутаторы Cisco уровня 2 - нет.   
###### Cisco Layer 2 switches use the show interfaces status command to list one line of output
Коммутаторы Cisco уровня 2 используют команду show interfaces status для вывода одной строки вывода.   
__|__
--|--
|
per interface (and routers do not), while routers use the show ip interface brief command to list similar information (but switches do not).|на интерфейс (а маршрутизаторы этого не делают), в то время как маршрутизаторы используют команду show ip interface short для вывода аналогичной информации (но коммутаторы этого не делают).
|
Note also that some Cisco devices perform both Layer 2 switching and Layer 3 routing, and those devices support both router and switch commands.|Также обратите внимание, что некоторые устройства Cisco выполняют как коммутацию уровня 2, так и маршрутизацию уровня 3, и эти устройства поддерживают команды как маршрутизатора, так и коммутатора.
Chapter 17, “IP Routing in the LAN,” discusses one such device, a Layer 3 switch, in more detail.|В главе 17 «IP-маршрутизация в локальной сети» более подробно рассматривается одно такое устройство, коммутатор уровня 3.
#### Router Interfaces
Интерфейсы маршрутизатора   
__|__
--|--
|
One minor difference between Cisco switches and routers is that routers support a much wider variety of interfaces.|Одно незначительное различие между коммутаторами и маршрутизаторами Cisco заключается в том, что маршрутизаторы поддерживают гораздо более широкий спектр интерфейсов.
Today, LAN switches support Ethernet LAN interfaces of various speeds.|Сегодня коммутаторы LAN поддерживают интерфейсы Ethernet LAN различной скорости.
Routers support a variety of other types of interfaces, including serial interfaces, cable TV, DSL, 3G/4G wireless, and others not mentioned in this book.|Маршрутизаторы поддерживают множество других типов интерфейсов, включая последовательные интерфейсы, кабельное телевидение, DSL, беспроводную связь 3G / 4G и другие, не упомянутые в этой книге.
|
Most Cisco routers have at least one Ethernet interface of some type.|Большинство маршрутизаторов Cisco имеют по крайней мере один интерфейс Ethernet того или иного типа.
Many of those Ethernet interfaces support multiple speeds and use autonegotiation, so for consistency, the router IOS refers to these interfaces based on the fastest speed.|Многие из этих интерфейсов Ethernet поддерживают несколько скоростей и используют автосогласование, поэтому для единообразия IOS маршрутизатора обращается к этим интерфейсам на основе максимальной скорости.
For example, a 10-Mbpsonly Ethernet interface would be configured with the interface ethernet number configuration command, a 10/100 interface with the interface fastethernet number command, and a 10/100/1000 interface with the interface gigabitethernet number command.|Например, интерфейс Ethernet 10 Мбит / с может быть настроен с помощью команды настройки номера интерфейса Ethernet, интерфейс 10/100 - с помощью команды номера интерфейса fastethernet, а интерфейс 10/100/1000 - с помощью команды номера интерфейса gigabitethernet.
However, when discussing these interfaces all together, engineers would simply call them ethernet interfaces, regardless of the maximum speed.|Однако, обсуждая все эти интерфейсы вместе, инженеры просто называли бы их интерфейсами Ethernet, независимо от максимальной скорости.
|
Some Cisco routers have serial interfaces.|Некоторые маршрутизаторы Cisco имеют последовательные интерфейсы.
As you might recall from Chapter 3, Cisco routers use serial interfaces to connect to a serial link.|Как вы могли вспомнить из главы 3, маршрутизаторы Cisco используют последовательные интерфейсы для подключения к последовательному каналу.
Each point-to-point serial link can then use High-Level Data Link Control (HDLC, the default) or Point-to-Point Protocol (PPP).|Каждый последовательный канал связи точка-точка может затем использовать высокоуровневое управление каналом передачи данных (HDLC, по умолчанию) или протокол точка-точка (PPP).
|
Routers refer to interfaces in many commands, first by the type of interface (Ethernet, Fast Ethernet, Gigabit Ethernet, Serial, and so on) and then with a unique number of that router.|Маршрутизаторы ссылаются на интерфейсы во многих командах, сначала по типу интерфейса (Ethernet, Fast Ethernet, Gigabit Ethernet, Serial и т. Д.), А затем по уникальному номеру этого маршрутизатора.
|
Depending on the router model, the interface numbers might be a single number, two numbers separated by a slash, or three numbers separated by slashes.|В зависимости от модели маршрутизатора номера интерфейсов могут быть одним числом, двумя числами, разделенными косой чертой, или тремя числами, разделенными косой чертой.
For example, all three of the following configuration commands are correct on at least one model of Cisco router:|Например, все три из следующих команд конфигурации верны как минимум на одной модели маршрутизатора Cisco:
|
interface ethernet 0 interface fastethernet 0/1 interface gigabitethernet 0/0 interface gigabitethernet 0/1/0 interface serial 1/0/1 Two of the most common commands to display the interfaces, and their status, are the show ip interface brief and show interfaces commands.|interface ethernet 0 interface fastethernet 0/1 interface gigabitethernet 0/0 interface gigabitethernet 0/1/0 interface serial 1/0/1 Двумя наиболее распространенными командами для отображения интерфейсов и их статуса являются: show ip interface short и show интерфейсы команд.
The first of these commands displays a list with one line per interface, with some basic information, including the interface IP address and interface status.|Первая из этих команд отображает список с одной строкой на интерфейс с некоторой базовой информацией, включая IP-адрес интерфейса и статус интерфейса.
The second command lists the interfaces, but with a large amount of information per interface.|Вторая команда перечисляет интерфейсы, но с большим объемом информации для каждого интерфейса.
Example 15-1 shows a sample of each command.|В примере 15-1 показан образец каждой команды.
The output comes from a 2900-series ISR router, used in many examples in this book; note that it has both a Gi0/0 interface and a Gi0/1/0 interface, showing a case with both two-digit and three-digit interface identifiers.|Выходные данные поступают от маршрутизатора ISR серии 2900, который используется во многих примерах в этой книге; обратите внимание, что он имеет как интерфейс Gi0 / 0, так и интерфейс Gi0 / 1/0, показывая случай как с двухзначными, так и с трехзначными идентификаторами интерфейса.
|
Example 15-1 Listing the Interfaces in a Router Example end.|Пример 15-1. Список интерфейсов в маршрутизаторе. Конец примера.
|
NOTE Commands that refer to router interfaces can be significantly shortened by truncating the words.|ПРИМЕЧАНИЕ. Команды, относящиеся к интерфейсам маршрутизатора, могут быть значительно сокращены путем усечения слов.
For example, sh int gi0/0 or sh int g0/0 can be used instead of show interfaces gigabitethernet 0/0.|Например, sh int gi0 / 0 или sh int g0 / 0 можно использовать вместо show interfaces gigabitethernet 0/0.
In fact, many network engineers, when looking over someone’s shoulder, would say something like “just do a show int G-i-oh-oh command” in this case, rather than speaking the long version of the command.|Фактически, многие сетевые инженеры, глядя через чье-то плечо, в этом случае сказали бы что-то вроде «просто выполните команду show int G-i-oh-oh», вместо того, чтобы произносить длинную версию команды.
|
Also, note that the show interfaces command lists a text interface description on about the third line, if configured.|Также обратите внимание, что команда show interfaces отображает описание текстового интерфейса примерно в третьей строке, если она настроена.
In this case, interface G0/1/0 had been previously configured with the description Link in lab to R3’s G0/0/0 command in interface configuration mode for interface G0/1/0.|В этом случае интерфейс G0 / 1/0 был ранее настроен с описанием Link in lab to R3's G0 / 0/0 command in the interface configuration mode for interface G0 / 1/0.
The description interface subcommand provides an easy way to keep small notes about what router interfaces connect to which neighboring devices, with the show interfaces command listing that information.|Подкоманда description interface предоставляет простой способ сохранять небольшие заметки о том, какие интерфейсы маршрутизатора подключаются к каким соседним устройствам, с помощью команды show interfaces, отображающей эту информацию.
##### Interface Status Codes
Коды состояния интерфейса   
__|__
--|--
|
Each interface has two interface status codes.|Каждый интерфейс имеет два кода состояния интерфейса.
To be usable, the two interface status codes must be in an “up” state.|Для использования два кода состояния интерфейса должны находиться в рабочем состоянии.
The first status code refers essentially to whether Layer 1 is working, and the second status code mainly (but not always) refers to whether the data-link layer protocol is working.|Первый код состояния в основном указывает, работает ли уровень 1, а второй код состояния в основном (но не всегда) указывает, работает ли протокол уровня канала передачи данных.
Table 15-2 summarizes these two status codes.|В таблице 15-2 приведены эти два кода состояния.
|
Table 15-2 Interface Status Codes and Their Meanings Table end.|Таблица 15-2 Коды состояния интерфейсов и их значения Конец таблицы.
|
Several combinations of interface status codes exist, as summarized in Table 15-3.|Существует несколько комбинаций кодов состояния интерфейсов, как показано в Таблице 15-3.
The table lists the status codes in order, from being disabled on purpose by the configuration to a fully working state.|В таблице перечислены коды состояния в порядке от намеренного отключения конфигурацией до полностью рабочего состояния.
|
Table 15-3 Typical Combinations of Interface Status Codes Table end.|Таблица 15-3 Типичные комбинации кодов состояния интерфейсов Конец таблицы.
|
For some examples, look back at Example 15-1’s show ip interface brief command, to the three interfaces in the following list.|В качестве некоторых примеров вернитесь к команде show ip interfacerief в примере 15-1, к трем интерфейсам в следующем списке.
The interfaces in this list each have a different combination of interface status codes; the list details the specific reasons for this status code in the lab used to create this example for the book.|Каждый интерфейс в этом списке имеет различную комбинацию кодов состояния интерфейса; в списке подробно описаны конкретные причины этого кода состояния в лаборатории, использованной для создания этого примера для книги.
|
G0/0: The interface is down/down, in this case because no cable was connected to the interface.|G0 / 0: интерфейс отключен / не работает, в данном случае из-за того, что к интерфейсу не был подключен кабель.
|
G0/1: The interface is administratively down/down, because the configuration includes the shutdown command under the G0/1 interface.|G0 / 1: интерфейс отключен / отключен администратором, поскольку конфигурация включает команду выключения под интерфейсом G0 / 1.
|
S0/0/0: The interface is up/up because a serial cable is installed, is connected to another router in a lab, and is working.|S0 / 0/0: Интерфейс включен / работает, потому что последовательный кабель установлен, подключен к другому маршрутизатору в лаборатории и работает.
##### Router Interface IP Addresses
IP-адреса интерфейса маршрутизатора   
__|__
--|--
|
Cisco enterprise routers require at least some configuration beyond the default configuration before they will do their primary job: routing IP packets.|Для корпоративных маршрутизаторов Cisco требуется по крайней мере некоторая конфигурация помимо конфигурации по умолчанию, прежде чем они будут выполнять свою основную работу: маршрутизацию IP-пакетов.
The following facts tell us that to make a router ready to route IPv4 packets on an interface, you need to enable the interface and assign it an IPv4 address:|Следующие факты говорят нам, что для подготовки маршрутизатора к маршрутизации пакетов IPv4 на интерфейсе вам необходимо включить интерфейс и назначить ему адрес IPv4:
###### Most Cisco router interfaces default to a disabled (shutdown) state and should be enabled
Большинство интерфейсов маршрутизатора Cisco по умолчанию отключены (выключено) и должны быть включены.   
__|__
--|--
|
with the no shutdown interface subcommand.|с помощью подкоманды интерфейса no shutdown.
###### Cisco routers do not route IP packets in or out an interface until an IP address and mask
Маршрутизаторы Cisco не направляют IP-пакеты в интерфейс или исходят из него до тех пор, пока не будет указан IP-адрес и маска.   
__|__
--|--
|
have been configured; by default, no interfaces have an IP address and mask.|были настроены; по умолчанию ни один интерфейс не имеет IP-адреса и маски.
###### Cisco routers attempt to route IP packets for any interfaces that are in an up/up state and
Маршрутизаторы Cisco пытаются маршрутизировать IP-пакеты для любых интерфейсов, которые находятся в активном / активном состоянии и   
__|__
--|--
|
that have an IP address/mask assigned.|которым назначен IP-адрес / маска.
|
To configure the address and mask, simply use the ip address address mask interface subcommand.|Чтобы настроить адрес и маску, просто используйте подкоманду интерфейса маски IP-адреса.
|
Figure 15-6 shows a simple IPv4 network with IPv4 addresses on Router R1, with Example 15-2 showing the matching configuration.|На рис. 15-6 показана простая сеть IPv4 с адресами IPv4 на маршрутизаторе R1, а в примере 15-2 показана соответствующая конфигурация.
|
Figure 15-6 IPv4 Addresses Used in Example 15-2 Example 15-2 Configuring IP Addresses on Cisco Routers Example end.|Рисунок 15-6 Адреса IPv4, используемые в примере 15-2 Пример 15-2 Настройка IP-адресов на маршрутизаторах Cisco Окончание примера.
|
Example 15-3 shows the output of the show protocols command.|В примере 15-3 показаны выходные данные команды show protocol.
This command confirms the state of each of the three R1 interfaces in Figure 15-6 and the IP address and mask configured on those same interfaces.|Эта команда подтверждает состояние каждого из трех интерфейсов R1 на рис. 15-6, а также IP-адрес и маску, настроенные для этих же интерфейсов.
|
Example 15-3 Verifying IP Addresses on Cisco Routers Example end.|Пример 15-3. Проверка IP-адресов на маршрутизаторах Cisco. Пример конец.
|
One of the first actions to take when verifying whether a router is working is to find the interfaces, check the interface status, and check to see whether the correct IP addresses and masks are used.|Одно из первых действий, которое следует предпринять при проверке работы маршрутизатора, - это найти интерфейсы, проверить состояние интерфейса и проверить, используются ли правильные IP-адреса и маски.
Examples 15-1 and 15-3 showed samples of the key show commands, while Table 15-4 summarizes those commands and the types of information they display.|В примерах 15-1 и 15-3 показаны образцы ключевых команд show, а в таблице 15-4 приведены эти команды и типы отображаемой информации.
|
Table 15-4 Key Commands to List Router Interface Status Table end.|Таблица 15-4 Ключевые команды для вывода списка состояний интерфейса маршрутизатора Конец таблицы.
##### Bandwidth and Clock Rate on Serial Interfaces
Пропускная способность и тактовая частота последовательных интерфейсов   
__|__
--|--
|
Cisco has included serial WAN topics in the CCNA exam topic list since its inception in 1998 until the CCNA 200-301 release in the year 2019.|Cisco включила темы последовательных WAN в список тем экзамена CCNA с момента его создания в 1998 году до выпуска CCNA 200-301 в 2019 году.
Because the CCNA 200-301 exam is the first to not mention serial technologies at all, this book includes some examples that show serial links.|Поскольку экзамен CCNA 200-301 является первым, в котором вообще не упоминаются последовательные технологии, в эту книгу включены некоторые примеры, показывающие последовательные связи.
The exam might show them with the expectation that you at least understand basics, such as the fact that two routers can send data over a serial link if the router interfaces on both ends are up/up and the routers have IP addresses in the same subnet.|Экзамен может показать их с ожиданием, что вы хотя бы понимаете основы, такие как тот факт, что два маршрутизатора могут отправлять данные по последовательному каналу, если интерфейсы маршрутизатора на обоих концах подключены / подключены, а маршрутизаторы имеют IP-адреса в одной подсети .
|
However, some of you will want to make serial links work in a lab because you have some serial interface cards in your lab.|Однако некоторые из вас захотят заставить работать последовательные каналы в лаборатории, потому что в вашей лаборатории есть несколько карт последовательного интерфейса.
If so, take the time to look at a few pages in the section titled “Bandwidth and Clock Rate on Serial Interfaces,” in Appendix J, “Topics from Previous Editions,” which shows how to cable and configure a WAN serial link in the lab.|Если это так, найдите время и посмотрите несколько страниц в разделе «Пропускная способность и тактовая частота на последовательных интерфейсах» в Приложении J «Темы из предыдущих выпусков», где показано, как подключить и настроить последовательную связь WAN в лаборатория.
#### Router Auxiliary Port
Дополнительный порт маршрутизатора   
__|__
--|--
|
Both routers and switches have a console port to allow administrative access, but most Cisco routers have an extra physical port called an auxiliary (Aux) port.|И маршрутизаторы, и коммутаторы имеют консольный порт для административного доступа, но большинство маршрутизаторов Cisco имеют дополнительный физический порт, называемый вспомогательным (Aux) портом.
The Aux port typically serves as a means to make a phone call to connect into the router to issue commands from the CLI.|Порт Aux обычно служит средством для выполнения телефонного звонка для подключения к маршрутизатору для выполнения команд из интерфейса командной строки.
|
The Aux port works like the console port, except that the Aux port is typically connected through a cable to an external analog modem, which in turn connects to a phone line.|Порт Aux работает так же, как консольный порт, за исключением того, что порт Aux обычно подключается через кабель к внешнему аналоговому модему, который, в свою очередь, подключается к телефонной линии.
Then, the engineer uses a PC, terminal emulator, and modem to call the remote router.|Затем инженер использует ПК, эмулятор терминала и модем для вызова удаленного маршрутизатора.
After being connected, the engineer can use the terminal emulator to access the router CLI, starting in user mode as usual.|После подключения инженер может использовать эмулятор терминала для доступа к интерфейсу командной строки маршрутизатора, как обычно, начиная с пользовательского режима.
|
Aux ports can be configured beginning with the line aux 0 command to reach aux line configuration mode.|Порты Aux можно настроить, начиная с команды line aux 0, чтобы перейти в режим конфигурации линии aux.
From there, all the commands for the console line, covered mostly in Chapter 6, can be used.|Оттуда можно использовать все команды для строки консоли, описанные в основном в главе 6.
For example, the login and password password subcommands on the aux line could be used to set up simple password checking when a user dials in.|Например, подкоманды входа в систему и пароля и пароля на вспомогательной линии могут использоваться для настройки простой проверки пароля при звонке пользователя.
### Chapter Review
Обзор главы   
__|__
--|--
|
One key to doing well on the exams is to perform repetitive spaced review sessions.|Один из ключей к успешной сдаче экзаменов - повторение повторных сессий с интервалом.
Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.|Просмотрите материал этой главы, используя инструменты из книги или интерактивные инструменты для тех же материалов, которые можно найти на сопутствующем веб-сайте книги.
Refer to the “Your Study Plan” element for more details.|Обратитесь к элементу «Ваш учебный план» для получения более подробной информации.
Table 15-5 outlines the key review elements and where you can find them.|В Таблице 15-5 представлены основные элементы обзора и их местонахождение.
To better track your study progress, record when you completed these activities in the second column.|Чтобы лучше отслеживать свои успехи в учебе, отметьте, когда вы выполнили эти задания, во втором столбце.
|
Table 15-5 Chapter Review Tracking Table end.|Таблица 15-5 Окончание таблицы отслеживания обзора главы.
|
Review All the Key Topics Key Terms You Should Know enterprise router, SOHO router, Integrated Services Router (ISR)|Ознакомьтесь со всеми ключевыми темами. Ключевые термины, которые вы должны знать: корпоративный маршрутизатор, маршрутизатор SOHO, маршрутизатор с интегрированными сервисами (ISR)
|
Command References Tables 15-7 and 15-8 list configuration and verification commands used in this chapter.|Ссылки на команды В таблицах 15-7 и 15-8 перечислены команды настройки и проверки, используемые в этой главе.
As an easy review exercise, cover the left column in a table, read the right column, and try to recall the command without looking.|В качестве простого упражнения на повторение закройте левый столбец таблицы, прочтите правый столбец и попытайтесь вспомнить команду, не глядя.
Then repeat the exercise, covering the right column, and try to recall what the command does.|Затем повторите упражнение, охватывая правый столбец, и попытайтесь вспомнить, что делает команда.
|
Table 15-7 Chapter 15 Configuration Command Reference Table end.|Таблица 15-7 Глава 15 Справочник команд конфигурации Конец таблицы.
|
Table 15-8 Chapter 15 EXEC Command Reference Table end.|Таблица 15-8 Глава 15 Справочник команд EXEC Конец таблицы.
## Chapter 16 Configuring IPv4 Addresses and Static Routes
Глава 16 Настройка адресов IPv4 и статических маршрутов   
__|__
--|--
|
Static Routes This chapter covers the following exam topics:|Статические маршруты В этой главе рассматриваются следующие экзаменационные темы:
###### 1.0 Network Fundamentals
1.0 Основы сети   
###### 1.6 Configure and verify IPv4 addressing and subnetting
1.6 Настройка и проверка адресации IPv4 и подсетей   
###### 3.0 IP Connectivity
3.0 IP-подключение   
###### 3.1 Interpret the components of routing table
3.1 Интерпретация компонентов таблицы маршрутизации   
###### 3.1.a Routing protocol code
3.1.a Код протокола маршрутизации   
###### 3.1.b Prefix
3.1.b Префикс   
###### 3.1.c Network mask
3.1.c Маска сети   
###### 3.1.d Next hop
3.1.d Следующий переход   
###### 3.1.e Administrative distance
3.1.e Административная дистанция   
###### 3.1.f Metric
3.1.f Метрическая система   
###### 3.1.g Gateway of last resort
3.1.g Шлюз последней инстанции   
###### 3.2 Determine how a router makes a forwarding decision by default
3.2 Определите, как маршрутизатор принимает решение о пересылке по умолчанию   
###### 3.2.a Longest match
3.2.Самый длинный матч   
###### 3.2.b Administrative distance
3.2.b Административная дистанция   
###### 3.3 Configure and verify IPv4 and IPv6 static routing
3.3 Настройка и проверка статической маршрутизации IPv4 и IPv6   
###### 3.3.a Default route
3.3.a Маршрут по умолчанию   
###### 3.3.b Network route
3.3.b Сетевой маршрут   
###### 3.3.c Host route
3.3.c Хост-маршрут   
###### 3.3.d Floating static
3.3.d Плавающая статика   
__|__
--|--
|
Routers route IPv4 packets.|Маршрутизаторы маршрутизируют пакеты IPv4.
That simple statement actually carries a lot of hidden meaning.|Это простое утверждение на самом деле несет в себе много скрытого смысла.
|
For routers to route packets, routers follow a routing process.|Для маршрутизаторов для маршрутизации пакетов маршрутизаторы следуют процессу маршрутизации.
That routing process relies on information called IP routes.|Этот процесс маршрутизации основан на информации, называемой IP-маршрутами.
Each IP route lists a destination—an IP network, IP subnet, or some other group of IP addresses.|В каждом IP-маршруте указан пункт назначения - IP-сеть, IP-подсеть или некоторая другая группа IP-адресов.
Each route also lists instructions that tell the router where to forward packets sent to addresses in that IP network or subnet.|Каждый маршрут также содержит инструкции, которые сообщают маршрутизатору, куда пересылать пакеты, отправленные на адреса в этой IP-сети или подсети.
For routers to do a good job of routing packets, routers need to have a detailed, accurate list of IP routes.|Чтобы маршрутизаторы хорошо справлялись с маршрутизацией пакетов, маршрутизаторы должны иметь подробный и точный список IP-маршрутов.
|
Routers use three methods to add IPv4 routes to their IPv4 routing tables.|Маршрутизаторы используют три метода для добавления маршрутов IPv4 в свои таблицы маршрутизации IPv4.
Routers first learn connected routes, which are routes for subnets attached to a router interface.|Маршрутизаторы сначала изучают подключенные маршруты, которые являются маршрутами для подсетей, подключенных к интерфейсу маршрутизатора.
Routers can CHAPTER 16 also use static routes, which are routes created through a configuration command (ip route)|Маршрутизаторы могут также использовать статические маршруты, которые представляют собой маршруты, созданные с помощью команды настройки (ip route).
|
that tells the router what route to put in the IPv4 routing table.|который сообщает маршрутизатору, какой маршрут поместить в таблицу маршрутизации IPv4.
And routers can use a routing protocol, in which routers tell each other about all their known routes, so that all routers can learn and build routes to all networks and subnets.|Кроме того, маршрутизаторы могут использовать протокол маршрутизации, в котором маршрутизаторы сообщают друг другу обо всех своих известных маршрутах, чтобы все маршрутизаторы могли изучать и строить маршруты ко всем сетям и подсетям.
|
This chapter examines IP routing in depth with the most straightforward routes that can be added to a router’s routing table.|В этой главе подробно рассматривается IP-маршрутизация с помощью наиболее простых маршрутов, которые можно добавить в таблицу маршрутизации маршрутизатора.
The router starts with a detailed look at the IP packet routing (forwarding process)—a process that relies on each router having useful IP routes in their routing tables.|Маршрутизатор начинается с подробного рассмотрения маршрутизации IP-пакетов (процесса пересылки) - процесса, который полагается на то, что каждый маршрутизатор имеет полезные IP-маршруты в своих таблицах маршрутизации.
The second section then examines connected routes, which are routes to subnets that exist on the interfaces connected to the local router.|Затем во втором разделе исследуются подключенные маршруты, которые представляют собой маршруты к подсетям, которые существуют на интерфейсах, подключенных к локальному маршрутизатору.
The third section then examines static routes, which are routes the network engineer configures directly.|В третьем разделе исследуются статические маршруты, которые напрямую настраивает сетевой инженер.
The chapter ends with a section that looks more specifically at the IP routing process in a router, how it matches packets to the routing table, and how to interpret all the details in the output of the show ip route command.|Глава заканчивается разделом, в котором более подробно рассматривается процесс IP-маршрутизации в маршрутизаторе, то, как он сопоставляет пакеты с таблицей маршрутизации, и как интерпретировать все подробности в выходных данных команды show ip route.
### “Do I Know This Already?” Quiz
«Знаю ли я это уже?» Викторина   
__|__
--|--
|
Take the quiz (either here or use the PTP software) if you want to use the score to help you decide how much time to spend on this chapter.|Пройдите тест (здесь или воспользуйтесь программой PTP), если вы хотите использовать оценку, чтобы решить, сколько времени потратить на эту главу.
The letter answers are listed at the bottom of the page following the quiz.|Ответы на письма перечислены внизу страницы после викторины.
Appendix C, found both at the end of the book as well as on the companion website, includes both the answers and explanations.|Приложение C, которое можно найти как в конце книги, так и на сопутствующем веб-сайте, включает как ответы, так и пояснения.
You can also find both answers and explanations in the PTP testing software.|Вы также можете найти ответы и пояснения в программе тестирования PTP.
|
Table 16-1 “Do I Know This Already?” Foundation Topics Section-to-Question Mapping|Таблица 16-1 «Знаю ли я это уже?» Сопоставление разделов с вопросами по основным темам
### Foundation Topics
Основные темы   
### IP Routing
IP-маршрутизация   
__|__
--|--
|
Configuring Connected Routes 2 Configuring Static Routes 3–5 IP Forwarding with the Longest Prefix Match 6 1.|Настройка подключенных маршрутов 2 Настройка статических маршрутов 3–5 Пересылка IP с совпадением самого длинного префикса 6 1.
Router R1 lists a route in its routing table.|Маршрутизатор R1 перечисляет маршрут в своей таблице маршрутизации.
Which of the following answers list a fact from a route that the router uses when matching the packet’s destination address?|Какой из следующих ответов перечисляет факт из маршрута, который маршрутизатор использует при сопоставлении адреса назначения пакета?
|
(Choose two answers.)|(Выберите два ответа.)
|
a. Mask b.|а. Маска б.
Next-hop router c.|Маршрутизатор следующего перехода c.
Subnet ID d.|ID подсети d.
Outgoing interface 2.|Исходящий интерфейс 2.
After configuring a working router interface with IP address/mask 10.1.1.100/26, which of the following routes would you expect to see in the output of the show ip route command? (Choose two answers.)|После настройки рабочего интерфейса маршрутизатора с IP-адресом / маской 10.1.1.100/26, какой из следующих маршрутов вы ожидаете увидеть в выходных данных команды show ip route? (Выберите два ответа.)
|
a. A connected route for subnet 10.1.1.64 255.255.255.192 b.|а. Подключенный маршрут для подсети 10.1.1.64 255.255.255.192 b.
A connected route for subnet 10.1.1.0 255.255.255.0 c.|Подключенный маршрут для подсети 10.1.1.0 255.255.255.0 c.
A local route for host 10.1.1.100 255.255.255.192 d.|Локальный маршрут для хоста 10.1.1.100 255.255.255.192 d.
A local route for host 10.1.1.100 255.255.255.255 e.|Локальный маршрут для хоста 10.1.1.100 255.255.255.255 e.
A local route for host 10.1.1.64 255.255.255.255 3.|Локальный маршрут для хоста 10.1.1.64 255.255.255.255 3.
An engineer configures a static IPv4 route on Router R1. Which of the following pieces of information should not be listed as a parameter in the configuration command that creates this static IPv4 route?|Инженер настраивает статический маршрут IPv4 на маршрутизаторе R1. Какая из следующих частей информации не должна быть указана в качестве параметра в команде конфигурации, которая создает этот статический маршрут IPv4?
|
a. The destination subnet’s subnet ID b.|а. ID подсети целевой подсети b.
The next-hop router’s IP address c.|IP-адрес маршрутизатора следующего перехода c.
The next-hop router’s neighboring interface d.|Соседний интерфейс маршрутизатора следующего перехода d.
The subnet mask 4.|Маска подсети 4.
Which of the following commands correctly configures a static route?|Какая из следующих команд правильно настраивает статический маршрут?
|
a. ip route 10.1.3.0 255.255.255.0 10.1.130.253 b. ip route 10.1.3.0 serial 0 c. ip route 10.1.3.0 /24 10.1.130.253 d. ip route 10.1.3.0 /24 serial 0 5.|а. ip route 10.1.3.0 255.255.255.0 10.1.130.253 б. ip route 10.1.3.0 серийный 0 c. ip route 10.1.3.0 / 24 10.1.130.253 г. ip route 10.1.3.0 / 24 серийный 0 5.
A network engineer configures the ip route 10.1.1.0 255.255.255.0 s0/0/0 command on a router and then issues a show ip route command from enable mode.|Сетевой инженер настраивает команду ip route 10.1.1.0 255.255.255.0 s0 / 0/0 на маршрутизаторе, а затем выдает команду show ip route из режима включения.
No routes for subnet 10.1.1.0/24 appear in the output.|В выводе не отображаются маршруты для подсети 10.1.1.0/24.
Which of the following could be true?|Что из следующего может быть правдой?
|
a. The ip route command has incorrect syntax and was rejected in config mode.|а. Команда ip route имеет неправильный синтаксис и была отклонена в режиме конфигурации.
|
b. Interface s0/0/0 is down.|б. Интерфейс s0 / 0/0 не работает.
|
c. The router has no up/up interfaces in Class A network 10.0.0.0.|c. Маршрутизатор не имеет интерфейсов up / up в сети 10.0.0.0 класса A.
|
d. The ip route command is missing a next-hop router IP address.|d. В команде ip route отсутствует IP-адрес маршрутизатора следующего перехода.
|
6. A router lists the following partial output from the show ip route command.|6. Маршрутизатор перечисляет следующие частичные выходные данные команды show ip route.
Out which interface will the router route packets destined to IP address 10.1.15.122?|Через какой интерфейс маршрутизатор будет маршрутизировать пакеты, предназначенные для IP-адреса 10.1.15.122?
###### 10.0.0.0/8 is variably subnetted, 8 subnets, 5 masks
10.0.0.0/8 имеет переменные подсети, 8 подсетей, 5 масок   
__|__
--|--
|
O 10.1.15.100/32 [110/50] via 172.16.25.2, 00:00:04, GigabitEthernet0/0/0 O 10.1.15.64/26 [110/100] via 172.16.25.129, 00:00:09, GigabitEthernet0/1/0 O 10.1.14.0/23 [110/65] via 172.16.24.2, 00:00:04, GigabitEthernet0/2/0 O 10.1.15.96/27 [110/65] via 172.16.24.129, 00:00:09, GigabitEthernet0/3/0 O 0.0.0.0/0 [110/129] via 172.16.25.129, 00:00:09, GigabitEthernet0/0/0 a.|O 10.1.15.100/32 [110/50] через 172.16.25.2, 00:00:04, GigabitEthernet0 / 0/0 O 10.1.15.64/26 [110/100] через 172.16.25.129, 00:00:09, GigabitEthernet0 / 1/0 O 10.1.14.0/23 [110/65] через 172.16.24.2, 00:00:04, GigabitEthernet0 / 2/0 O 10.1.15.96/27 [110/65] через 172.16.24.129, 00:00 : 09, GigabitEthernet0 / 3/0 O 0.0.0.0/0 [110/129] через 172.16.25.129, 00:00:09, GigabitEthernet0 / 0/0 a.
G0/0/0 b.|G0 / 0/0 б.
G0/1/0 c.|G0 / 1/0 с.
G0/2/0 d.|G0 / 2/0 д.
G0/3/0 Foundation Topics IP Routing IP routing—the process of forwarding IP packets—delivers packets across entire TCP/IP networks, from the device that originally builds the IP packet to the device that is supposed to receive the packet.|G0 / 3/0 Основные темы IP-маршрутизация IP-маршрутизация - процесс пересылки IP-пакетов - доставляет пакеты по всем сетям TCP / IP от устройства, которое изначально создает IP-пакет, к устройству, которое должно его получить.
In other words, IP routing delivers IP packets from the sending host to the destination host.|Другими словами, IP-маршрутизация доставляет IP-пакеты от хоста-отправителя к хосту назначения.
|
The complete end-to-end routing process relies on network layer logic on hosts and on routers.|Полный процесс сквозной маршрутизации зависит от логики сетевого уровня на хостах и ??маршрутизаторах.
|
The sending host uses Layer 3 concepts to create an IP packet, forwarding the IP packet to the host’s default gateway (default router).|Передающий хост использует концепции уровня 3 для создания IP-пакета, пересылающего IP-пакет на шлюз хоста по умолчанию (маршрутизатор по умолчанию).
The process requires Layer 3 logic on the routers as well, by which the routers compare the destination address in the packet to their routing tables, to decide where to forward the IP packet next.|Для этого процесса также требуется логика уровня 3 на маршрутизаторах, с помощью которой маршрутизаторы сравнивают адрес назначения в пакете со своими таблицами маршрутизации, чтобы решить, куда пересылать IP-пакет дальше.
|
The routing process also relies on data-link and physical details at each link.|Процесс маршрутизации также зависит от канала передачи данных и физических данных на каждом канале.
IP routing relies on serial WAN links, Ethernet WAN links, Ethernet LANs, wireless LANs, and many other networks that implement data-link and physical layer standards.|IP-маршрутизация основывается на последовательных каналах WAN, каналах Ethernet WAN, локальных сетях Ethernet, беспроводных локальных сетях и многих других сетях, реализующих стандарты каналов передачи данных и физического уровня.
These lower-layer devices and protocols move the IP packets around the TCP/IP network by encapsulating and transmitting the packets inside data-link layer frames.|Эти устройства и протоколы нижнего уровня перемещают IP-пакеты по сети TCP / IP, инкапсулируя и передавая пакеты внутри кадров канального уровня.
|
The previous two paragraphs summarize the key concepts about IP routing as introduced back in Chapter 3, “Fundamentals of WANs and IP Routing.” Next, this section reviews IP routing, while taking the discussion another step or two deeper, taking advantage of the additional depth of knowledge discussed in all the earlier chapters in this book.|В двух предыдущих абзацах обобщены ключевые концепции IP-маршрутизации, представленные в главе 3 «Основы глобальных сетей и IP-маршрутизации». Далее в этом разделе рассматривается IP-маршрутизация, но мы продвигаемся еще на один или два шага глубже, используя преимущества дополнительных знаний, обсуждавшихся во всех предыдущих главах этой книги.
#### IPv4 Routing Process Reference
Справочник по процессу маршрутизации IPv4   
__|__
--|--
|
Because you already saw the basics back in Chapter 3, this section collects the routing process into steps for reference.|Поскольку вы уже познакомились с основами в главе 3, в этом разделе для справки процесс маршрутизации разбит на этапы.
The steps use many specific Ethernet LAN terms discussed in Parts II and III of this book and some IP addressing terms discussed in Part IV. The upcoming descriptions and example then discuss these summaries of routing logic to make sure that each step is clear.|В шагах используется множество конкретных терминов Ethernet LAN, обсуждаемых в частях II и III этой книги, а также некоторые термины IP-адресации, обсуждаемые в части IV. Затем в следующих описаниях и примерах обсуждаются эти краткие сведения о логике маршрутизации, чтобы убедиться, что каждый шаг понятен.
|
The routing process starts with the host that creates the IP packet.|Процесс маршрутизации начинается с хоста, который создает IP-пакет.
First, the host asks the question: Is the destination IP address of this new packet in my local subnet?|Сначала хост задает вопрос: находится ли IP-адрес назначения этого нового пакета в моей локальной подсети?
The host uses its own IP address/mask to determine the range of addresses in the local subnet.|Хост использует свой собственный IP-адрес / маску для определения диапазона адресов в локальной подсети.
Based on its own opinion of the range of addresses in the local subnet, a LAN-based host acts as follows:|Основываясь на собственном мнении о диапазоне адресов в локальной подсети, хост в локальной сети действует следующим образом:
|
Step 1.|Шаг 1.
If the destination is local, send directly:|Если пункт назначения местный, отправьте напрямую:
|
A. Find the destination host’s MAC address.|A. Найдите MAC-адрес целевого хоста.
Use the already-known Address Resolution Protocol (ARP) table entry, or use ARP messages to learn the information.|Используйте уже известную запись в таблице протокола разрешения адресов (ARP) или сообщения ARP для изучения информации.
|
B. Encapsulate the IP packet in a data-link frame, with the destination data-link address of the destination host.|B. Инкапсулируйте IP-пакет во фрейме канала передачи данных с адресом канала передачи данных пункта назначения.
|
Step 2.|Шаг 2.
If the destination is not local, send to the default gateway:|Если пункт назначения не является локальным, отправьте на шлюз по умолчанию:
|
A. Find the default gateway’s MAC address.|A. Найдите MAC-адрес шлюза по умолчанию.
Use the already-known Address Resolution Protocol (ARP) table entry, or use ARP messages to learn the information.|Используйте уже известную запись в таблице протокола разрешения адресов (ARP) или сообщения ARP для изучения информации.
|
B. Encapsulate the IP packet in a data-link frame, with the destination data-link address of the default gateway.|B. Инкапсулируйте IP-пакет во фрейме канала данных с адресом канала передачи данных назначения шлюза по умолчанию.
|
Figure 16-1 summarizes these same concepts.|Рисунок 16-1 суммирует эти же концепции.
In the figure, host A sends a local packet directly to host D.|На рисунке хост A отправляет локальный пакет непосредственно хосту D.
However, for packets to host B, on the other side of a router and therefore in a different subnet, host A sends the packet to its default router (R1). (As a reminder, the terms default gateway and default router are synonyms.).|Однако для пакетов на хост B, на другой стороне маршрутизатора и, следовательно, в другой подсети, хост A отправляет пакет своему маршрутизатору по умолчанию (R1). (Напоминаем, что термины «шлюз по умолчанию» и «маршрутизатор по умолчанию» являются синонимами.)
|
Figure 16-1 Host Routing Logic Summary Routers have a little more routing work to do as compared with hosts.|Рисунок 16-1. Сводка логики маршрутизации хоста. Маршрутизаторам приходится выполнять немного больше работы по маршрутизации, чем хостам.
While the host logic began with an IP packet sitting in memory, a router has some work to do before getting to that point.|Хотя логика хоста началась с IP-пакета, находящегося в памяти, маршрутизатору нужно поработать, прежде чем добраться до этой точки.
With the following five-step summary of a router’s routing logic, the router takes the first two steps just to receive the frame and extract the IP packet, before thinking about the packet’s destination address at Step 3.|В следующем пятиэтапном обзоре логики маршрутизации маршрутизатор выполняет первые два шага только для получения кадра и извлечения IP-пакета, прежде чем думать об адресе назначения пакета на шаге 3.
The steps are as follows:|Шаги следующие:
|
1. For each received data-link frame, choose whether or not to process the frame.|1. Для каждого полученного кадра канала передачи данных выберите, обрабатывать этот кадр или нет.
|
Process it if A.|Обработать, если А.
The frame has no errors (per the data-link trailer Frame Check Sequence [FCS]|В кадре нет ошибок (в соответствии с последовательностью проверки кадра трейлера канала передачи данных [FCS]
|
field).|поле).
|
B. The frame’s destination data-link address is the router’s address (or an appropriate multicast or broadcast address).|Б. Адресом канала передачи данных назначения кадра является адрес маршрутизатора (или соответствующий адрес многоадресной или широковещательной рассылки).
|
2. If choosing to process the frame at Step 1, de-encapsulate the packet from inside the data-link frame.|2. Если вы выбрали обработку кадра на шаге 1, деинкапсулируйте пакет изнутри кадра канала данных.
|
3. Make a routing decision.|3. Примите решение о маршрутизации.
To do so, compare the packet’s destination IP address to the routing table and find the route that matches the destination address.|Для этого сравните IP-адрес пункта назначения пакета с таблицей маршрутизации и найдите маршрут, соответствующий адресу назначения.
This route identifies the outgoing interface of the router and possibly the next-hop router.|Этот маршрут идентифицирует исходящий интерфейс маршрутизатора и, возможно, маршрутизатор следующего перехода.
|
4. Encapsulate the packet into a data-link frame appropriate for the outgoing interface.|4. Инкапсулируйте пакет в кадр канала данных, соответствующий исходящему интерфейсу.
|
When forwarding out LAN interfaces, use ARP as needed to find the next device’s MAC address.|При пересылке интерфейсов LAN используйте ARP по мере необходимости, чтобы найти MAC-адрес следующего устройства.
|
5. Transmit the frame out the outgoing interface, as listed in the matched IP route.|5. Передайте кадр из исходящего интерфейса, как указано в согласованном IP-маршруте.
|
This routing process summary lists many details, but sometimes you can think about the routing process in simpler terms.|В этом обзоре процесса маршрутизации приводится много деталей, но иногда вы можете подумать о процессе маршрутизации в более простых терминах.
For example, leaving out some details, this paraphrase of the step list details the same big concepts:|Например, опуская некоторые детали, этот пересказ списка шагов описывает те же самые важные концепции:
|
The router receives a frame, removes the packet from inside the frame, decides where to forward the packet, puts the packet into another frame, and sends the frame.|Маршрутизатор получает кадр, удаляет пакет изнутри кадра, решает, куда пересылать пакет, помещает пакет в другой кадр и отправляет этот кадр.
|
Answers to the “Do I Know This Already?” quiz:|Ответы на вопрос «Знаю ли я это уже?» викторина:
|
1 A, C 2 A, D 3 C 4 A 5 B 6 D To give you a little more perspective on these steps, Figure 16-2 breaks down the same fivestep routing process as a diagram.|1 A, C 2 A, D 3 C 4 A 5 B 6 D Чтобы дать вам немного больше представления об этих этапах, на рис. 16-2 показан тот же пятишаговый процесс маршрутизации, что и диаграмма.
The figure shows a packet arriving from the left, entering a router Ethernet interface, with an IP destination of host C.|На рисунке показан пакет, поступающий слева, входящий в интерфейс Ethernet маршрутизатора с IP-адресом хоста C.
The figure shows the packet arriving, encapsulated inside an Ethernet frame (both header and trailer).|На рисунке показан приходящий пакет, инкапсулированный внутри кадра Ethernet (заголовок и конец).
|
Figure 16-2 Router Routing Logic Summary Router R1 processes the frame and packet as shown with the numbers in the figure, matching the same five-step process described just before the figure, as follows:|Рис. 16-2 Сводная логика маршрутизации маршрутизатора Маршрутизатор R1 обрабатывает фрейм и пакет, как показано цифрами на рисунке, в соответствии с тем же пятиэтапным процессом, описанным непосредственно перед рисунком, а именно:
|
1. Router R1 notes that the received Ethernet frame passes the FCS check and that the destination Ethernet MAC address is R1’s MAC address, so R1 processes the frame.|1. Маршрутизатор R1 отмечает, что полученный кадр Ethernet проходит проверку FCS и что MAC-адрес Ethernet назначения является MAC-адресом R1, поэтому R1 обрабатывает этот кадр.
|
2. R1 de-encapsulates the IP packet from inside the Ethernet frame’s header and trailer.|2. R1 деинкапсулирует IP-пакет из заголовка и трейлера кадра Ethernet.
|
3. R1 compares the IP packet’s destination IP address to R1’s IP routing table.|3. R1 сравнивает IP-адрес назначения IP-пакета с таблицей IP-маршрутизации маршрутизатора R1.
|
4. R1 encapsulates the IP packet inside a new data-link frame, in this case, inside a High-|4. R1 инкапсулирует IP-пакет в новый фрейм канала передачи данных, в данном случае внутри High-
|
Level Data Link Control (HDLC) header and trailer.|Заголовок и трейлер Level Data Link Control (HDLC).
|
5. R1 transmits the IP packet, inside the new HDLC frame, out the serial link on the right.|5. R1 передает IP-пакет внутри нового кадра HDLC по последовательному каналу справа.
|
NOTE This chapter uses several figures that show an IP packet encapsulated inside a datalink layer frame.|ПРИМЕЧАНИЕ В этой главе используются несколько рисунков, на которых показан IP-пакет, инкапсулированный внутри кадра уровня канала передачи данных.
These figures often show both the data-link header as well as the data-link trailer, with the IP packet in the middle.|На этих рисунках часто показаны как заголовок канала передачи данных, так и его конец, с IP-пакетом посередине.
The IP packets all include the IP header, plus any encapsulated data.|Все IP-пакеты включают заголовок IP, а также любые инкапсулированные данные.
#### An Example of IP Routing
Пример IP-маршрутизации   
__|__
--|--
|
The next several pages walk you through an example that discusses each routing step, in order, through multiple devices.|На следующих нескольких страницах вы рассмотрите пример, в котором описывается каждый этап маршрутизации через несколько устройств.
The example uses a case in which host A (172.16.1.9) sends a packet to host B (172.16.2.9), with host routing logic and the five steps showing how R1 forwards the packet.|В примере используется случай, когда хост A (172.16.1.9) отправляет пакет хосту B (172.16.2.9), с логикой маршрутизации хоста и пятью шагами, показывающими, как R1 пересылает пакет.
|
Figure 16-3 shows a typical IP addressing diagram for an IPv4 network with typical address abbreviations.|На рис. 16-3 показана типичная диаграмма IP-адресации для сети IPv4 с типичными сокращениями адресов.
The diagram can get a little too messy if it lists the full IP address for every router interface.|Схема может стать слишком запутанной, если на ней будет указан полный IP-адрес для каждого интерфейса маршрутизатора.
When possible, these diagrams usually list the subnet and then the last octet or two of the individual IP addresses—just enough so that you know the IP address but with less clutter.|Если возможно, на этих диаграммах обычно указывается подсеть, а затем последний или два октета отдельных IP-адресов - ровно столько, чтобы вы знали IP-адрес, но с меньшим количеством беспорядка.
For example, host A uses IP address 172.16.1.9, taking from subnet 172.16.1.0/24 (in which all addresses begin 172.16.1) and the .9 beside the host A icon.|Например, хост A использует IP-адрес 172.16.1.9, взятый из подсети 172.16.1.0/24 (в которой все адреса начинаются с 172.16.1) и 0,9 рядом со значком хоста A.
As another example, R1 uses address 172.16.1.1 on its LAN interface, 172.16.4.1 on one serial interface, and 172.16.5.1 on an Ethernet WAN interface.|В качестве другого примера R1 использует адрес 172.16.1.1 на своем интерфейсе LAN, 172.16.4.1 на одном последовательном интерфейсе и 172.16.5.1 на интерфейсе Ethernet WAN.
|
Figure 16-3 IPv4 Network Used to Show Five-Step Routing Example Now on to the example, with host A (172.16.1.9) sending a packet to host B (172.16.2.9).|Рисунок 16-3. Сеть IPv4, используемая для демонстрации примера пятиэтапной маршрутизации. Теперь перейдем к примеру с хостом A (172.16.1.9), отправляющим пакет хосту B (172.16.2.9).
##### Host Forwards the IP Packet to the Default Router (Gateway)
Хост перенаправляет IP-пакет на маршрутизатор по умолчанию (шлюз)   
__|__
--|--
|
In this example, host A uses some application that sends data to host B (172.16.2.9).|В этом примере хост A использует какое-то приложение, которое отправляет данные хосту B (172.16.2.9).
After host A has the IP packet sitting in memory, host A’s logic reduces to the following:|После того, как хост A имеет IP-пакет в памяти, логика хоста A сводится к следующему:
###### My IP address/mask is 172.16.1.9/24, so my local subnet contains numbers 172.16.1.0–
My IP address/mask is 172.16.1.9/24, so my local subnet contains numbers 172.16.1.0–   
__|__
--|--
|
172.16.1.255 (including the subnet ID and subnet broadcast address).|172.16.1.255 (including the subnet ID and subnet broadcast address).
###### The destination address is 172.16.2.9, which is clearly not in my local subnet.
Адрес назначения - 172.16.2.9, которого явно нет в моей локальной подсети.   
###### Send the packet to my default gateway, which is set to 172.16.1.1.
Отправьте пакет на мой шлюз по умолчанию, который установлен на 172.16.1.1.   
###### To send the packet, encapsulate it in an Ethernet frame. Make the destination MAC
Чтобы отправить пакет, инкапсулируйте его в кадр Ethernet. Сделайте MAC-адрес назначения   
__|__
--|--
|
address be R1’s G0/0 MAC address (host A’s default gateway).|адрес - это MAC-адрес G0 / 0 маршрутизатора R1 (шлюз по умолчанию хоста A).
|
Figure 16-4 pulls these concepts together, showing the destination IP address and destination MAC address in the frame and packet sent by host A in this case.|Рисунок 16-4 объединяет эти концепции, показывая IP-адрес пункта назначения и MAC-адрес пункта назначения в кадре и пакете, отправленном хостом A в этом случае.
Note that the figure uses a common drawing convention in networking, showing an Ethernet as a few lines, hiding all the detail of the Layer 2 switches.|Обратите внимание, что на рисунке используется стандартное соглашение о рисовании в сети, где Ethernet отображается в виде нескольких линий, скрывая все детали коммутаторов уровня 2.
|
Figure 16-4 Host A Sends Packet to Host B|Рисунок 16-4 Хост A отправляет пакет хосту B
##### Routing Step 1: Decide Whether to Process the Incoming Frame
Шаг маршрутизации 1. Решите, обрабатывать ли входящий кадр   
__|__
--|--
|
Routers receive many frames in an interface, particularly LAN interfaces.|Маршрутизаторы получают много кадров в интерфейсе, особенно в интерфейсах LAN.
However, a router can and should ignore some of those frames.|Однако маршрутизатор может и должен игнорировать некоторые из этих кадров.
So, the first step in the routing process begins with a decision of whether a router should process the frame or silently discard (ignore) the frame.|Итак, первый шаг в процессе маршрутизации начинается с решения, должен ли маршрутизатор обрабатывать фрейм или молча отбросить (проигнорировать) фрейм.
|
First, the router does a simple but important check (Step 1A in the process summary) so that the router ignores all frames that had bit errors during transmission.|Сначала маршрутизатор выполняет простую, но важную проверку (шаг 1A в сводке процесса), чтобы маршрутизатор игнорировал все кадры, в которых были битовые ошибки во время передачи.
The router uses the data-link trailer’s FCS field to check the frame, and if errors occurred in transmission, the router discards the frame. (The router makes no attempt at error recovery; that is, the router does not ask the sender to retransmit the data.)|Маршрутизатор использует поле FCS трейлера канала данных для проверки кадра, и если при передаче произошли ошибки, маршрутизатор отбрасывает кадр. (Маршрутизатор не предпринимает попыток восстановления после ошибок, то есть маршрутизатор не просит отправителя повторно передать данные.)
|
The router also checks the destination data-link address (Step 1B in the summary) to decide whether the frame is intended for the router.|Маршрутизатор также проверяет адрес канала передачи данных назначения (шаг 1B в сводке), чтобы решить, предназначен ли кадр для маршрутизатора.
For example, frames sent to the router’s unicast MAC address for that interface are clearly sent to that router.|Например, кадры, отправленные на одноадресный MAC-адрес маршрутизатора для этого интерфейса, явно отправляются на этот маршрутизатор.
However, a router can actually receive a frame sent to some other unicast MAC address, and routers should ignore these frames.|Однако маршрутизатор может фактически получить кадр, отправленный на другой одноадресный MAC-адрес, и маршрутизаторы должны игнорировать эти кадры.
|
For example, routers will receive some unicast frames sent to other devices in the VLAN just because of how LAN switches work.|Например, маршрутизаторы будут получать некоторые одноадресные кадры, отправленные на другие устройства в VLAN, только из-за того, как работают коммутаторы LAN.
Think back to how LAN switches forward unknown unicast frames—frames for which the switch does not list the destination MAC address in the MAC address table.|Вспомните, как коммутаторы LAN пересылают неизвестные одноадресные кадры - кадры, для которых коммутатор не перечисляет MAC-адрес назначения в таблице MAC-адресов.
The LAN switch floods those frames.|Коммутатор LAN лавинно рассылает эти кадры.
The result?|Результат?
Routers sometimes receive frames destined for some other device, with some other device’s MAC address listed as the destination MAC address.|Маршрутизаторы иногда получают кадры, предназначенные для какого-то другого устройства, при этом MAC-адрес другого устройства указывается как MAC-адрес назначения.
Routers should ignore those frames.|Маршрутизаторы должны игнорировать эти кадры.
|
In this example, host A sends a frame destined for R1’s MAC address.|В этом примере хост A отправляет кадр, предназначенный для MAC-адреса маршрутизатора R1.
So, after the frame is received, and after R1 confirms with the FCS that no errors occurred, R1 confirms that the frame is destined for R1’s MAC address (0200.0101.0101 in this case).|Таким образом, после получения кадра и после того, как R1 подтвердит с помощью FCS, что ошибок не было, R1 подтверждает, что кадр предназначен для MAC-адреса маршрутизатора R1 (в данном случае 0200.0101.0101).
All checks have been passed, so R1 will process the frame, as shown in Figure 16-5. (Note that the large rectangle in the figure represents the internals of Router R1.).|Все проверки пройдены, поэтому R1 обработает кадр, как показано на рисунке 16-5. (Обратите внимание, что большой прямоугольник на рисунке представляет внутреннюю часть маршрутизатора R1.).
|
Figure 16-5 Routing Step 1, on Router R1: Checking FCS and Destination MAC|Рисунок 16-5 Шаг 1 маршрутизации на маршрутизаторе R1: проверка FCS и MAC-адреса назначения
##### Routing Step 2: De-encapsulation of the IP Packet
Шаг маршрутизации 2: деинкапсуляция IP-пакета   
__|__
--|--
|
After the router knows that it ought to process the received frame (per Step 1), the next step is relatively simple: de-encapsulating the packet.|После того, как маршрутизатор узнает, что он должен обработать полученный кадр (на шаге 1), следующий шаг относительно прост: деинкапсуляция пакета.
In router memory, the router no longer needs the original frame’s data-link header and trailer, so the router removes and discards them, leaving the IP packet, as shown in Figure 16-6.|В памяти маршрутизатора маршрутизатору больше не нужны заголовок и трейлер канала передачи данных исходного кадра, поэтому маршрутизатор удаляет и отбрасывает их, оставляя IP-пакет, как показано на рисунке 16-6.
Note that the destination IP address remains unchanged (172.16.2.9).|Обратите внимание, что IP-адрес назначения остается неизменным (172.16.2.9).
|
Figure 16-6 Routing Step 2 on Router R1: De-encapsulating the Packet|Рисунок 16-6 Шаг 2 маршрутизации на маршрутизаторе R1: деинкапсуляция пакета
##### Routing Step 3: Choosing Where to Forward the Packet
Routing Step 3: Choosing Where to Forward the Packet   
__|__
--|--
|
While routing Step 2 required little thought, Step 3 requires the most thought of all the steps.|While routing Step 2 required little thought, Step 3 requires the most thought of all the steps.
At this point, the router needs to make a choice about where to forward the packet next.|At this point, the router needs to make a choice about where to forward the packet next.
That process uses the router’s IP routing table, with some matching logic to compare the packet’s destination address with the table.|That process uses the router’s IP routing table, with some matching logic to compare the packet’s destination address with the table.
|
First, an IP routing table lists multiple routes.|First, an IP routing table lists multiple routes.
Each individual route contains several facts, which in turn can be grouped as shown in Figure 16-7.|Each individual route contains several facts, which in turn can be grouped as shown in Figure 16-7.
Part of each route is used to match the destination address of the packet, while the rest of the route lists forwarding instructions:|Part of each route is used to match the destination address of the packet, while the rest of the route lists forwarding instructions:
|
where to send the packet next.|where to send the packet next.
|
Figure 16-7 Routing Step 3 on Router R1: Matching the Routing Table Focus on the entire routing table for a moment, and notice the fact that it lists five routes.|Figure 16-7 Routing Step 3 on Router R1: Matching the Routing Table Focus on the entire routing table for a moment, and notice the fact that it lists five routes.
|
Earlier, Figure 16-3 showed the entire example network, with five subnets, so R1 has a route for each of the five subnets.|Earlier, Figure 16-3 showed the entire example network, with five subnets, so R1 has a route for each of the five subnets.
|
Next, look at the part of the five routes that Router R1 will use to match packets.|Next, look at the part of the five routes that Router R1 will use to match packets.
To fully define each subnet, each route lists both the subnet ID and the subnet mask.|To fully define each subnet, each route lists both the subnet ID and the subnet mask.
When matching the IP packet’s destination with the routing table, the router looks at the packet’s destination IP address (172.16.2.9) and compares it to the range of addresses defined by each subnet.|When matching the IP packet’s destination with the routing table, the router looks at the packet’s destination IP address (172.16.2.9) and compares it to the range of addresses defined by each subnet.
|
Specifically, the router looks at the subnet and mask information; with a little math, the router can figure out in which of these subnets 172.16.2.9 resides (the route for subnet 172.16.2.0/24).|Specifically, the router looks at the subnet and mask information; with a little math, the router can figure out in which of these subnets 172.16.2.9 resides (the route for subnet 172.16.2.0/24).
|
Finally, look to the right side of the figure, to the forwarding instructions for these five routes.|Finally, look to the right side of the figure, to the forwarding instructions for these five routes.
After the router matches a specific route, the router uses the forwarding information in the route to tell the router where to send the packet next.|After the router matches a specific route, the router uses the forwarding information in the route to tell the router where to send the packet next.
In this case, the router matched the route for subnet 172.16.2.0/24, so R1 will forward the packet out its own interface S0/0/0, to Router R2 next, listed with its next-hop router IP address of 172.16.4.2.|In this case, the router matched the route for subnet 172.16.2.0/24, so R1 will forward the packet out its own interface S0/0/0, to Router R2 next, listed with its next-hop router IP address of 172.16.4.2.
|
NOTE Routes for remote subnets typically list both an outgoing interface and next-hop router IP address.|NOTE Routes for remote subnets typically list both an outgoing interface and next-hop router IP address.
Routes for subnets that connect directly to the router list only the outgoing interface because packets to these destinations do not need to be sent to another router.|Routes for subnets that connect directly to the router list only the outgoing interface because packets to these destinations do not need to be sent to another router.
##### Routing Step 4: Encapsulating the Packet in a New Frame
Шаг 4: инкапсуляция пакета в новый кадр   
__|__
--|--
|
At this point, the router knows how it will forward the packet.|На этом этапе маршрутизатор знает, как он будет пересылать пакет.
However, routers cannot forward a packet without first wrapping a data-link header and trailer around it (encapsulation).|Однако маршрутизаторы не могут пересылать пакет без предварительного обертывания его заголовком и концом канала передачи данных (инкапсуляция).
|
Encapsulating packets for serial links does not require a lot of thought, but the current CCNA 200-301 exam does not require a lot from us.|Инкапсуляция пакетов для последовательных каналов не требует больших усилий, но текущий экзамен CCNA 200-301 не требует от нас многого.
Point-to-point serial WAN links use either HDLC (the default) or PPP as the data-link protocol.|Для двухточечных последовательных каналов WAN в качестве протокола передачи данных используется HDLC (по умолчанию) или PPP.
However, we can ignore any datalink logic, even ignoring data-link addressing, because serial links have only two devices on the link: the sender and the then-obvious receiver; the data-link addressing does not matter.|Однако мы можем игнорировать любую логику канала данных, даже игнорируя адресацию канала передачи данных, потому что последовательные каналы имеют только два устройства на канале: отправитель и очевидный на тот момент получатель; Адресация канала передачи данных не имеет значения.
|
In this example, R1 forwards the packet out S0/0/0, after encapsulating the packet inside an HDLC frame, as shown in Figure 16-8.|В этом примере R1 пересылает пакет из S0 / 0/0 после инкапсуляции пакета внутри кадра HDLC, как показано на рисунке 16-8.
|
Figure 16-8 Routing Step 4 on Router R1: Encapsulating the Packet Note that with some other types of data links, the router has a little more work to do at this routing step.|Рис. 16-8. Шаг 4 маршрутизации на маршрутизаторе R1: инкапсуляция пакета Обратите внимание, что с некоторыми другими типами каналов передачи данных маршрутизатору нужно проделать немного больше работы на этом этапе маршрутизации.
For example, sometimes a router forwards packets out an Ethernet interface.|Например, иногда маршрутизатор пересылает пакеты через интерфейс Ethernet.
|
To encapsulate the IP packet, the router would need to build an Ethernet header, and that Ethernet header’s destination MAC address would need to list the correct value.|Чтобы инкапсулировать IP-пакет, маршрутизатору потребуется создать заголовок Ethernet, и в MAC-адресе назначения этого заголовка Ethernet необходимо указать правильное значение.
|
For example, consider a packet sent by that same PC A (172.16.1.19) in Figure 16-3 but with a destination of PC C (172.16.3.9).|Например, рассмотрим пакет, отправленный тем же самым ПК A (172.16.1.19) на рисунке 16-3, но с местом назначения ПК C (172.16.3.9).
When R1 processes the packet, R1 matches a route that tells R1 to forward the packet out R1’s G0/1/0 Ethernet interface to 172.16.5.3 (R3) next.|Когда R1 обрабатывает пакет, R1 сопоставляет маршрут, который сообщает R1 о необходимости пересылки пакета с интерфейса G0 / 1/0 маршрутизатора R1 на 172.16.5.3 (R3) следующим.
R1 needs to put R3’s MAC address in the header, and to do that, R1 uses its IP ARP table information, as shown in Figure 16-9.|R1 должен поместить MAC-адрес R3 в заголовок, и для этого R1 использует информацию из своей таблицы IP ARP, как показано на рисунке 16-9.
If R1 did not have an ARP table entry for 172.16.5.3, R1 would first have to use ARP to learn the matching MAC address.|Если бы R1 не имел записи таблицы ARP для 172.16.5.3, R1 сначала должен был бы использовать ARP, чтобы узнать соответствующий MAC-адрес.
|
Figure 16-9 Routing Step 4 on Router R1 with a LAN Outgoing Interface|Рисунок 16-9 Шаг 4 маршрутизации на маршрутизаторе R1 с исходящим интерфейсом LAN
##### Routing Step 5: Transmitting the Frame
Шаг 5: передача кадра   
__|__
--|--
|
After the frame has been prepared, the router simply needs to transmit the frame.|После того, как кадр был подготовлен, маршрутизатору просто нужно передать кадр.
The router might have to wait, particularly if other frames are already waiting their turn to exit the interface.|Маршрутизатору, возможно, придется подождать, особенно если другие фреймы уже ожидают своей очереди для выхода из интерфейса.
### Configuring IP Addresses and Connected Routes
Настройка IP-адресов и подключенных маршрутов   
__|__
--|--
|
Cisco routers enable IPv4 routing globally, by default.|Маршрутизаторы Cisco по умолчанию включают глобальную маршрутизацию IPv4.
Then, to make the router be ready to route packets on a particular interface, the interface must be configured with an IP address and the interface must be configured such that it comes up, reaching a “line status up, line protocol up”|Затем, чтобы маршрутизатор был готов маршрутизировать пакеты на конкретном интерфейсе, интерфейс должен быть настроен с IP-адресом, а интерфейс должен быть настроен так, чтобы он появлялся, достигая «состояние линии вверх, протокол линии вверх»
|
state.|штат.
Only at that point can routers route IP packets in and out a particular interface.|Только в этот момент маршрутизаторы могут маршрутизировать IP-пакеты в конкретный интерфейс и исходить из него.
|
After a router can route IP packets out one or more interfaces, the router needs some routes.|После того, как маршрутизатор сможет направлять IP-пакеты через один или несколько интерфейсов, маршрутизатору требуются некоторые маршруты.
|
Routers can add routes to their routing tables through three methods:|Маршрутизаторы могут добавлять маршруты в свои таблицы маршрутизации тремя способами:
|
Connected routes: Added because of the configuration of the ip address interface subcommand on the local router Static routes: Added because of the configuration of the ip route global command on the local router Routing protocols: Added as a function by configuration on all routers, resulting in a process by which routers dynamically tell each other about the network so that they all learn routes This second of three sections discusses several variations on how to configure connected routes, while the next major section discusses static routes.|Подключенные маршруты: добавлены из-за настройки подкоманды интерфейса ip-адреса на локальном маршрутизаторе Статические маршруты: добавлены из-за настройки глобальной команды ip route на локальном маршрутизаторе Протоколы маршрутизации: добавлены как функция путем настройки на всех маршрутизаторах, в результате в процессе, посредством которого маршрутизаторы динамически сообщают друг другу о сети, чтобы все они изучали маршруты. Во втором из трех разделов обсуждаются несколько вариантов настройки подключенных маршрутов, а в следующем основном разделе обсуждаются статические маршруты.
#### Connected Routes and the ip address Command
Connected Routes and the ip address Command   
__|__
--|--
|
A Cisco router automatically adds a route to its routing table for the subnet connected to each interface, assuming that the following two facts are true:|A Cisco router automatically adds a route to its routing table for the subnet connected to each interface, assuming that the following two facts are true:
###### The interface is in a working state. In other words, the interface status in the show
Интерфейс в рабочем состоянии. Другими словами, статус интерфейса в шоу   
__|__
--|--
|
interfaces command lists a line status of up and a protocol status of up.|Команда interfaces отображает состояние линии «Вкл.» и состояние протокола «Вкл.».
###### The interface has an IP address assigned through the ip address interface subcommand.
The interface has an IP address assigned through the ip address interface subcommand.   
__|__
--|--
|
The concept of connected routes is relatively basic.|The concept of connected routes is relatively basic.
The router, of course, needs to know the subnet number connected to each of its interfaces, so the router can route packets to that subnet.|The router, of course, needs to know the subnet number connected to each of its interfaces, so the router can route packets to that subnet.
The router does the math, taking the interface IP address and mask and calculating the subnet ID. However, the router only needs that route when the interface is up and working, so the router includes a connected route in the routing table only when the interface is working.|The router does the math, taking the interface IP address and mask and calculating the subnet ID. However, the router only needs that route when the interface is up and working, so the router includes a connected route in the routing table only when the interface is working.
|
Example 16-1 shows the connected routes on Router R1 in Figure 16-10.|Example 16-1 shows the connected routes on Router R1 in Figure 16-10.
The first part of the example shows the configuration of IP addresses on all three of R1’s interfaces.|The first part of the example shows the configuration of IP addresses on all three of R1’s interfaces.
The end of the example lists the output from the show ip route command, which lists these routes with a c as the route code, meaning connected.|The end of the example lists the output from the show ip route command, which lists these routes with a c as the route code, meaning connected.
|
Figure 16-10 Sample Network to Show Connected Routes Example 16-1 Connected and Local Routes on Router R1 Example end.|Figure 16-10 Sample Network to Show Connected Routes Example 16-1 Connected and Local Routes on Router R1 Example end.
|
Take a moment to look closely at each of the three highlighted routes in the output of show ip route.|Take a moment to look closely at each of the three highlighted routes in the output of show ip route.
Each lists a C in the first column, and each has text that says “directly connected”;|Each lists a C in the first column, and each has text that says “directly connected”;
|
both identify the route as connected to the router.|both identify the route as connected to the router.
The early part of each route lists the matching parameters (subnet ID and mask), as shown in the earlier example in Figure 16-7.|The early part of each route lists the matching parameters (subnet ID and mask), as shown in the earlier example in Figure 16-7.
|
The end of each of these routes lists the outgoing interface.|The end of each of these routes lists the outgoing interface.
|
Note that the router also automatically produces a different kind of route, called a local route.|Note that the router also automatically produces a different kind of route, called a local route.
The local routes define a route for the one specific IP address configured on the router interface.|The local routes define a route for the one specific IP address configured on the router interface.
Each local route has a /32 prefix length, defining a host route, which defines a route just for that one IP address.|Each local route has a /32 prefix length, defining a host route, which defines a route just for that one IP address.
For example, the last local route, for 172.16.5.1/32, defines a route that matches only the IP address of 172.16.5.1.|For example, the last local route, for 172.16.5.1/32, defines a route that matches only the IP address of 172.16.5.1.
Routers use these local routes that list their own local IP addresses to more efficiently forward packets sent to the router itself.|Routers use these local routes that list their own local IP addresses to more efficiently forward packets sent to the router itself.
|
For the CCNA 200-301 exam, note that this example of the show ip route command reveals a few of the specific subitems within exam topic 3.1, with later examples revealing even more details.|For the CCNA 200-301 exam, note that this example of the show ip route command reveals a few of the specific subitems within exam topic 3.1, with later examples revealing even more details.
This section shows details related to the following terms from the exam topics:|This section shows details related to the following terms from the exam topics:
###### Routing Protocol Code: The legend at the top of the show ip route output (about nine
Код протокола маршрутизации: легенда в верхней части выходных данных show ip route (около девяти   
__|__
--|--
|
lines) lists all the routing protocol codes (exam topic 3.1.a).|lines) содержит список всех кодов протоколов маршрутизации (тема экзамена 3.1.a).
This book references the codes for connected routes (C), local (L), static (S), and OSPF (O).|В этой книге приведены коды для подключенных маршрутов (C), локальных (L), статических (S) и OSPF (O).
###### Prefix: The word prefix (exam topic 3.1.b) is just another name for subnet ID.
Prefix: The word prefix (exam topic 3.1.b) is just another name for subnet ID.   
###### Mask: Each route lists a prefix (subnet ID) and network mask (exam topic 3.1.c) in prefix
Mask: Each route lists a prefix (subnet ID) and network mask (exam topic 3.1.c) in prefix   
__|__
--|--
|
format, for example, /24.|format, for example, /24.
#### The ARP Table on a Cisco Router
The ARP Table on a Cisco Router   
__|__
--|--
|
After a router has added these connected routes, the router can route IPv4 packets between those subnets.|After a router has added these connected routes, the router can route IPv4 packets between those subnets.
To do so, the router makes use of its IP ARP table.|To do so, the router makes use of its IP ARP table.
|
The IPv4 ARP table lists the IPv4 address and matching MAC address of hosts connected to the same subnet as the router.|The IPv4 ARP table lists the IPv4 address and matching MAC address of hosts connected to the same subnet as the router.
When forwarding a packet to a host on the same subnet, the router encapsulates the packet, with a destination MAC address as found in the ARP table.|When forwarding a packet to a host on the same subnet, the router encapsulates the packet, with a destination MAC address as found in the ARP table.
|
If the router wants to forward a packet to an IP address on the same subnet as the router but does not find an ARP table entry for that IP address, the router will use ARP messages to learn that device’s MAC address.|If the router wants to forward a packet to an IP address on the same subnet as the router but does not find an ARP table entry for that IP address, the router will use ARP messages to learn that device’s MAC address.
|
Example 16-2 shows R1’s ARP table based on the previous example.|Example 16-2 shows R1’s ARP table based on the previous example.
The output lists R1’s own IP address of 172.16.1.1, with an age of -, meaning that this entry does not time out.|The output lists R1’s own IP address of 172.16.1.1, with an age of -, meaning that this entry does not time out.
Dynamically learned ARP table entries have an upward counter, like the 35-minute value for the ARP table entry for IP address 172.16.1.9.|Dynamically learned ARP table entries have an upward counter, like the 35-minute value for the ARP table entry for IP address 172.16.1.9.
By default, IOS will time out (remove) an ARP table entry after 240 minutes in which the entry is not used. (IOS resets the timer to 0 when an ARP table entry is used.) Note that to experiment in the lab, you might want to empty all dynamic entries (or a single entry for one IP address) using the clear ip arp [ip-address] EXEC command.|By default, IOS will time out (remove) an ARP table entry after 240 minutes in which the entry is not used. (IOS resets the timer to 0 when an ARP table entry is used.) Note that to experiment in the lab, you might want to empty all dynamic entries (or a single entry for one IP address) using the clear ip arp [ip-address] EXEC command.
|
Example 16-2 Displaying a Router’s IP ARP Table Example end.|Example 16-2 Displaying a Router’s IP ARP Table Example end.
|
Thinking about how Router R1 forwards a packet to host A (172.16.1.9), over that final subnet, R1 does the following:|Thinking about how Router R1 forwards a packet to host A (172.16.1.9), over that final subnet, R1 does the following:
|
1. R1 looks in its ARP table for an entry for 172.16.1.9.|1. R1 looks in its ARP table for an entry for 172.16.1.9.
|
2. R1 encapsulates the IP packet in an Ethernet frame, adding destination 0200.3333.3333 to the Ethernet header (as taken from the ARP table).|2. R1 encapsulates the IP packet in an Ethernet frame, adding destination 0200.3333.3333 to the Ethernet header (as taken from the ARP table).
|
3. R1 transmits the frame out interface G0/0.|3. R1 transmits the frame out interface G0/0.
### Configuring Static Routes
Настройка статических маршрутов   
__|__
--|--
|
All routers add connected routes, as discussed in the previous section.|Все маршрутизаторы добавляют подключенные маршруты, как обсуждалось в предыдущем разделе.
Then, most networks use dynamic routing protocols to cause each router to learn the rest of the routes in an internetwork.|Затем в большинстве сетей используются протоколы динамической маршрутизации, чтобы каждый маршрутизатор узнал остальные маршруты в объединенной сети.
Networks use static routes—routes added to a routing table through direct configuration—much less often than dynamic routing.|Сети используют статические маршруты - маршруты, добавленные в таблицу маршрутизации посредством прямой конфигурации - гораздо реже, чем динамическая маршрутизация.
However, static routes can be useful at times, and they happen to be useful learning tools as well.|Однако статические маршруты иногда могут быть полезны, и они также могут быть полезными инструментами обучения.
This next major section in the chapter discusses static routes.|В следующем главном разделе главы обсуждаются статические маршруты.
|
NOTE The CCNA 200-301 exam topic 3.2 breaks IPv4 (and IPv6) static routes into four subtopics: network routes, host routes, floating static routes, and default routes.|ПРИМЕЧАНИЕ В теме 3.2 экзамена CCNA 200-301 статические маршруты IPv4 (и IPv6) разбиты на четыре подтемы: сетевые маршруты, маршруты хоста, плавающие статические маршруты и маршруты по умолчанию.
This section explains all four types as noted in the upcoming headings.|В этом разделе описаны все четыре типа, указанные в следующих заголовках.
#### Static Network Routes
Static Network Routes   
__|__
--|--
|
IOS allows the definition of individual static routes using the ip route global configuration command.|IOS allows the definition of individual static routes using the ip route global configuration command.
Every ip route command defines a destination that can be matched, usually with a subnet ID and mask.|Every ip route command defines a destination that can be matched, usually with a subnet ID and mask.
The command also lists the forwarding instructions, typically listing either the outgoing interface or the next-hop router’s IP address.|The command also lists the forwarding instructions, typically listing either the outgoing interface or the next-hop router’s IP address.
IOS then takes that information and adds that route to the IP routing table.|IOS then takes that information and adds that route to the IP routing table.
|
The static route is considered a network route when the destination listed in the ip route command defines a subnet, or an entire Class A, B, or C network.|The static route is considered a network route when the destination listed in the ip route command defines a subnet, or an entire Class A, B, or C network.
In contrast, a default route matches all destination IP addresses, while a host route matches a single IP address (that is, an address of one host.)|In contrast, a default route matches all destination IP addresses, while a host route matches a single IP address (that is, an address of one host.)
|
As an example of a network route, Figure 16-11 shows a subset of the figure used throughout this chapter so far, with some unrelated details removed.|As an example of a network route, Figure 16-11 shows a subset of the figure used throughout this chapter so far, with some unrelated details removed.
The figure shows only the details related to a static network route on R1, for destination subnet 172.16.2.0/24, which sits on the far right.|The figure shows only the details related to a static network route on R1, for destination subnet 172.16.2.0/24, which sits on the far right.
To create that static network route on R1, R1 will configure the subnet ID and mask, and either R1’s outgoing interface (S0/0/0) or R2 as the next-hop router IP address (172.16.4.2).|To create that static network route on R1, R1 will configure the subnet ID and mask, and either R1’s outgoing interface (S0/0/0) or R2 as the next-hop router IP address (172.16.4.2).
|
Figure 16-11 Static Route Configuration Concept Example 16-3 shows the configuration of a couple of sample static routes.|Figure 16-11 Static Route Configuration Concept Example 16-3 shows the configuration of a couple of sample static routes.
In particular, it shows routes on Router R1 in Figure 16-12, for the two subnets on the right side of the figure.|In particular, it shows routes on Router R1 in Figure 16-12, for the two subnets on the right side of the figure.
|
Figure 16-12 Sample Network Used in Static Route Configuration Examples Example 16-3 Static Routes Added to R1 Example end.|Figure 16-12 Sample Network Used in Static Route Configuration Examples Example 16-3 Static Routes Added to R1 Example end.
|
The two example ip route commands show the two different styles of forwarding instructions.|The two example ip route commands show the two different styles of forwarding instructions.
|
The first command shows subnet 172.16.2.0, mask 255.255.255.0, which sits on a LAN near Router R2. That same first command lists R1’s S0/0/0 interface as the outgoing interface.|The first command shows subnet 172.16.2.0, mask 255.255.255.0, which sits on a LAN near Router R2. That same first command lists R1’s S0/0/0 interface as the outgoing interface.
|
This route basically states: To send packets to the subnet off Router R2, send them out my own local S0/0/0 interface (which happens to connect to R2).|This route basically states: To send packets to the subnet off Router R2, send them out my own local S0/0/0 interface (which happens to connect to R2).
|
The second route has the same kind of logic, except for using different forwarding instructions.|The second route has the same kind of logic, except for using different forwarding instructions.
|
Instead of referencing R1’s outgoing interface, it instead lists the neighboring router’s IP address on the WAN link as the next-hop router.|Instead of referencing R1’s outgoing interface, it instead lists the neighboring router’s IP address on the WAN link as the next-hop router.
This route basically says this: To send packets to the subnet off Router R3, send them to R3—specifically, R3’s WAN IP address next.|This route basically says this: To send packets to the subnet off Router R3, send them to R3—specifically, R3’s WAN IP address next.
|
The routes created by these two ip route commands actually look a little different in the IP routing table compared to each other.|The routes created by these two ip route commands actually look a little different in the IP routing table compared to each other.
Both are static routes.|Both are static routes.
However, the route that used the outgoing interface configuration is also noted as a connected route; this is just a quirk of the output of the show ip route command.|However, the route that used the outgoing interface configuration is also noted as a connected route; this is just a quirk of the output of the show ip route command.
|
Example 16-4 lists these two routes using the show ip route static command.|Example 16-4 lists these two routes using the show ip route static command.
This command lists the details of static routes only, but it also lists a few statistics about all IPv4 routes.|This command lists the details of static routes only, but it also lists a few statistics about all IPv4 routes.
For example, the example shows two lines, for the two static routes configured in Example 16-4, but statistics state that this router has routes for eight subnets.|For example, the example shows two lines, for the two static routes configured in Example 16-4, but statistics state that this router has routes for eight subnets.
|
Example 16-4 Static Routes Added to R1 Example end.|Example 16-4 Static Routes Added to R1 Example end.
|
IOS adds and removes these static routes dynamically over time, based on whether the outgoing interface is working or not.|IOS adds and removes these static routes dynamically over time, based on whether the outgoing interface is working or not.
For example, in this case, if R1’s S0/0/0 interface fails, R1 removes the static route to 172.16.2.0/24 from the IPv4 routing table.|For example, in this case, if R1’s S0/0/0 interface fails, R1 removes the static route to 172.16.2.0/24 from the IPv4 routing table.
Later, when the interface comes up again, IOS adds the route back to the routing table.|Later, when the interface comes up again, IOS adds the route back to the routing table.
|
Note that most sites use a dynamic routing protocol to learn all the routes to remote subnets rather than using static routes.|Note that most sites use a dynamic routing protocol to learn all the routes to remote subnets rather than using static routes.
However, when not using a dynamic routing protocol, the engineer would need to configure static routes to each subnet on each router.|However, when not using a dynamic routing protocol, the engineer would need to configure static routes to each subnet on each router.
For example, if the routers had only the configuration shown in the examples so far, PC A (from Figure 16-12) would not be able to receive packets back from PC B because Router R2 does not have a route for PC A’s subnet.|For example, if the routers had only the configuration shown in the examples so far, PC A (from Figure 16-12) would not be able to receive packets back from PC B because Router R2 does not have a route for PC A’s subnet.
R2 would need static routes for other subnets, as would R3.|R2 would need static routes for other subnets, as would R3.
|
Finally, note that static routes that will send packets out an Ethernet interface—LAN or WAN—should use the next-hop IP address option on the ip address command, as shown in Example 16-4.|Finally, note that static routes that will send packets out an Ethernet interface—LAN or WAN—should use the next-hop IP address option on the ip address command, as shown in Example 16-4.
Routers expect their Ethernet interfaces to be able to reach any number of other IP addresses in the connected subnet.|Routers expect their Ethernet interfaces to be able to reach any number of other IP addresses in the connected subnet.
Referencing the next-hop router identifies the specific device in the connected subnet, while referencing the local router’s outgoing interface does not identify the specific neighboring router.|Referencing the next-hop router identifies the specific device in the connected subnet, while referencing the local router’s outgoing interface does not identify the specific neighboring router.
#### Static Host Routes
Static Host Routes   
__|__
--|--
|
Earlier, this chapter defined a host route as a route to a single host address.|Earlier, this chapter defined a host route as a route to a single host address.
To configure such a static route, the ip route command uses an IP address plus a mask of 255.255.255.255 so that the matching logic matches just that one address.|To configure such a static route, the ip route command uses an IP address plus a mask of 255.255.255.255 so that the matching logic matches just that one address.
|
An engineer might use host routes to direct packets sent to one host over one path, with all other traffic to that host’s subnet over some other path.|An engineer might use host routes to direct packets sent to one host over one path, with all other traffic to that host’s subnet over some other path.
For instance, you could define these two static routes for subnet 10.1.1.0/24 and host 10.1.1.9, with two different next-hop addresses, as follows:|For instance, you could define these two static routes for subnet 10.1.1.0/24 and host 10.1.1.9, with two different next-hop addresses, as follows:
|
ip route 10.1.1.0 255.255.255.0 10.2.2.2 ip route 10.1.1.9 255.255.255.255 10.9.9.9 Note that these two routes overlap: a packet sent to 10.1.1.9 that arrives at the router would match both routes.|ip route 10.1.1.0 255.255.255.0 10.2.2.2 ip route 10.1.1.9 255.255.255.255 10.9.9.9 Note that these two routes overlap: a packet sent to 10.1.1.9 that arrives at the router would match both routes.
When that happens, routers use the most specific route (that is, the route with the longest prefix length).|When that happens, routers use the most specific route (that is, the route with the longest prefix length).
So, a packet sent to 10.1.1.9 would be forwarded to next-hop router 10.9.9.9, and packets sent to other destinations in subnet 10.1.1.0/24 would be sent to next-hop router 10.2.2.2.|So, a packet sent to 10.1.1.9 would be forwarded to next-hop router 10.9.9.9, and packets sent to other destinations in subnet 10.1.1.0/24 would be sent to next-hop router 10.2.2.2.
|
Note that the section “IP Forwarding with the Longest Prefix Match” later in this chapter gets into this topic in more detail.|Note that the section “IP Forwarding with the Longest Prefix Match” later in this chapter gets into this topic in more detail.
#### Floating Static Routes
Floating Static Routes   
__|__
--|--
|
Next, consider the case in which a static route competes with other static routes or routes learned by a routing protocol.|Next, consider the case in which a static route competes with other static routes or routes learned by a routing protocol.
That is, the ip route command defines a route to a subnet, but the router also knows of other static or dynamically learned routes to reach that same subnet.|That is, the ip route command defines a route to a subnet, but the router also knows of other static or dynamically learned routes to reach that same subnet.
In these cases, the router must first decide which routing source has the better administrative distance, with lower being better, and then use the route learned from the better source.|In these cases, the router must first decide which routing source has the better administrative distance, with lower being better, and then use the route learned from the better source.
|
To see how that works, consider the example illustrated in Figure 16-13, which shows a different design than in the previous examples, this time with a branch office with two WAN links: one very fast Gigabit Ethernet link and one rather slow (but cheap) T1. In this design, the network uses Open Shortest Path First Version 2 (OSPFv2) over the primary link, learning a route for subnet 172.16.2.0/24.|To see how that works, consider the example illustrated in Figure 16-13, which shows a different design than in the previous examples, this time with a branch office with two WAN links: one very fast Gigabit Ethernet link and one rather slow (but cheap) T1. In this design, the network uses Open Shortest Path First Version 2 (OSPFv2) over the primary link, learning a route for subnet 172.16.2.0/24.
R1 also defines a static route over the backup link to that exact same subnet, so R1 must choose whether to use the static route or the OSPFlearned route.|R1 also defines a static route over the backup link to that exact same subnet, so R1 must choose whether to use the static route or the OSPFlearned route.
|
Figure 16-13 Using a Floating Static Route to Key Subnet 172.16.2.0/24 By default, IOS considers static routes better than OSPF-learned routes.|Figure 16-13 Using a Floating Static Route to Key Subnet 172.16.2.0/24 By default, IOS considers static routes better than OSPF-learned routes.
By default, IOS gives static routes an administrative distance of 1 and OSPF routes an administrative distance of 110.|By default, IOS gives static routes an administrative distance of 1 and OSPF routes an administrative distance of 110.
Using these defaults in Figure 16-13, R1 would use the T1 to reach subnet 172.16.2.0/24 in this case, which is not the intended design.|Using these defaults in Figure 16-13, R1 would use the T1 to reach subnet 172.16.2.0/24 in this case, which is not the intended design.
Instead, the engineer prefers to use the OSPFlearned routes over the much-faster primary link and use the static route over the backup link only as needed when the primary link fails.|Instead, the engineer prefers to use the OSPFlearned routes over the much-faster primary link and use the static route over the backup link only as needed when the primary link fails.
|
To instead prefer the OSPF routes, the configuration would need to change the administrative distance settings and use what many networkers call a floating static route.|To instead prefer the OSPF routes, the configuration would need to change the administrative distance settings and use what many networkers call a floating static route.
A floating static route floats or moves into and out of the IP routing table depending on whether the better (lower) administrative distance route learned by the routing protocol happens to exist currently.|A floating static route floats or moves into and out of the IP routing table depending on whether the better (lower) administrative distance route learned by the routing protocol happens to exist currently.
Basically, the router ignores the static route during times when the better routing protocol route is known.|Basically, the router ignores the static route during times when the better routing protocol route is known.
|
To implement a floating static route, you need to use a parameter on the ip route command that sets the administrative distance for just that route, making the value larger than the default administrative distance of the routing protocol.|To implement a floating static route, you need to use a parameter on the ip route command that sets the administrative distance for just that route, making the value larger than the default administrative distance of the routing protocol.
For example, the ip route 172.16.2.0 255.255.255.0 172.16.5.3 130 command on R1 would do exactly that—setting the static route’s administrative distance to 130.|For example, the ip route 172.16.2.0 255.255.255.0 172.16.5.3 130 command on R1 would do exactly that—setting the static route’s administrative distance to 130.
As long as the primary link stays up, and OSPF on R1 learns a route for 172.16.2.0/24, with a default administrative distance of 110, R1 ignores the static route.|As long as the primary link stays up, and OSPF on R1 learns a route for 172.16.2.0/24, with a default administrative distance of 110, R1 ignores the static route.
|
Finally, note that while the show ip route command lists the administrative distance of most routes, as the first of two numbers inside two brackets, the show ip route subnet command plainly lists the administrative distance.|Finally, note that while the show ip route command lists the administrative distance of most routes, as the first of two numbers inside two brackets, the show ip route subnet command plainly lists the administrative distance.
Example 16-5 shows a sample, matching this most recent example.|Example 16-5 shows a sample, matching this most recent example.
|
Example 16-5 Displaying the Administrative Distance of the Static Route Example end.|Example 16-5 Displaying the Administrative Distance of the Static Route Example end.
#### Static Default Routes
Статические маршруты по умолчанию   
__|__
--|--
|
When a router tries to route a packet, the router might not match the packet’s destination IP address with any route.|Когда маршрутизатор пытается направить пакет, он может не сопоставить IP-адрес назначения пакета с каким-либо маршрутом.
When that happens, the router normally just discards the packet.|Когда это происходит, маршрутизатор обычно просто отбрасывает пакет.
|
Routers can be configured so that they use either a statically configured or dynamically learned default route.|Маршрутизаторы можно настроить так, чтобы они использовали статически настроенный или динамически полученный маршрут по умолчанию.
The default route matches all packets, so that if a packet does not match any other more specific route in the routing table, the router can at least forward the packet based on the default route.|Маршрут по умолчанию соответствует всем пакетам, поэтому, если пакет не соответствует какому-либо другому более конкретному маршруту в таблице маршрутизации, маршрутизатор может, по крайней мере, переслать пакет на основе маршрута по умолчанию.
|
One classic example in which companies might use static default routes in their enterprise TCP/IP networks is when the company has many remote sites, each with a single, relatively slow WAN connection.|Один классический пример, в котором компании могут использовать статические маршруты по умолчанию в своих корпоративных сетях TCP / IP, - это когда у компании есть много удаленных сайтов, каждый из которых имеет одно относительно медленное соединение WAN.
Each remote site has only one possible physical route to use to send packets to the rest of the network.|У каждого удаленного сайта есть только один возможный физический маршрут, который можно использовать для отправки пакетов в остальную сеть.
So, rather than use a routing protocol, which sends messages over the WAN and uses precious WAN bandwidth, each remote router might use a default route that sends all traffic to the central site, as shown in Figure 16-14.|Таким образом, вместо использования протокола маршрутизации, который отправляет сообщения по глобальной сети и использует драгоценную полосу пропускания глобальной сети, каждый удаленный маршрутизатор может использовать маршрут по умолчанию, который отправляет весь трафик на центральный сайт, как показано на рисунке 16-14.
|
S0/0/1 ....|S0 / 0/1 ....
|
Figure 16-14 Example Use of Static Default Routes at 1000 Low-Speed Remote Sites IOS allows the configuration of a static default route by using special values for the subnet and mask fields in the ip route command: 0.0.0.0 and 0.0.0.0.|Рисунок 16-14 Пример использования статических маршрутов по умолчанию на 1000 низкоскоростных удаленных узлах IOS позволяет настраивать статический маршрут по умолчанию, используя специальные значения для полей подсети и маски в команде ip route: 0.0.0.0 и 0.0.0.0.
For example, the command ip route 0.0.0.0 0.0.0.0 S0/0/1 creates a static default route on Router B1—a route that matches all IP packets—and sends those packets out interface S0/0/1.|Например, команда ip route 0.0.0.0 0.0.0.0 S0 / 0/1 создает статический маршрут по умолчанию на маршрутизаторе B1 - маршрут, который соответствует всем IP-пакетам - и отправляет эти пакеты через интерфейс S0 / 0/1.
|
Example 16-6 shows an example of a static default route, using Router R2 from Figure 16-13.|В примере 16-6 показан пример статического маршрута по умолчанию с использованием маршрутизатора R2 с рисунка 16-13.
Earlier, that figure, along with Example 16-5, showed R1 with static routes to the two subnets on the right side of the figure.|Ранее на этом рисунке вместе с примером 16-5 был показан маршрутизатор R1 со статическими маршрутами к двум подсетям в правой части рисунка.
Example 16-6 completes the configuration of static IP routes by configuring R2, on the right side of Figure 16-13, with a static default route to route packets back to the routers on the left side of the figure.|Пример 16-6 завершает настройку статических IP-маршрутов путем настройки R2 в правой части рисунка 16-13 со статическим маршрутом по умолчанию для маршрутизации пакетов обратно к маршрутизаторам в левой части рисунка.
|
Example 16-6 Adding a Static Default Route on R2 (Figure 16-13)|Пример 16-6 Добавление статического маршрута по умолчанию на R2 (рисунок 16-13)
|
Example end.|Пример конец.
|
The output of the show ip route command lists a few new and interesting facts.|Вывод команды show ip route содержит несколько новых и интересных фактов.
First, it lists the route with a code of S, meaning static, but also with a 1, meaning it is a candidate default route.|Во-первых, он перечисляет маршрут с кодом S, что означает статический, но также и с 1, что означает, что это маршрут-кандидат по умолчанию.
A router can learn about more than one default route, and the router then has to choose which one to use; the 1 means that it is at least a candidate to become the default route.|Маршрутизатор может узнать о нескольких маршрутах по умолчанию, и затем маршрутизатор должен выбрать, какой из них использовать; 1 означает, что это, по крайней мере, кандидат на то, чтобы стать маршрутом по умолчанию.
Just above, the “Gateway of Last Resort” refers to the chosen default route, which in this case is the just-configured static route with outgoing interface S0/0/1.|Чуть выше «шлюз последней надежды» относится к выбранному маршруту по умолчанию, который в данном случае является только что настроенным статическим маршрутом с исходящим интерфейсом S0 / 0/1.
#### Troubleshooting Static Routes
Troubleshooting Static Routes   
__|__
--|--
|
These final few pages about IPv4 static routes examine some issues that can occur with static routes, both reviewing some reasons mentioned over the last few pages, while adding more detail.|These final few pages about IPv4 static routes examine some issues that can occur with static routes, both reviewing some reasons mentioned over the last few pages, while adding more detail.
This topic breaks static route troubleshooting into three perspectives:|This topic breaks static route troubleshooting into three perspectives:
###### The route is in the routing table but is incorrect.
Маршрут указан в таблице маршрутизации, но неверен.   
###### The route is not in the routing table.
Маршрута нет в таблице маршрутизации.   
###### The route is in the routing table and is correct, but the packets do not arrive at the destination
Маршрут указан в таблице маршрутизации и правильный, но пакеты не достигают места назначения.   
__|__
--|--
|
host.|хост.
##### Troubleshooting Incorrect Static Routes That Appear in the IP Routing Table
Troubleshooting Incorrect Static Routes That Appear in the IP Routing Table   
__|__
--|--
|
This first troubleshooting item can be obvious, but it is worth pausing to think about.|This first troubleshooting item can be obvious, but it is worth pausing to think about.
A static route is only as good as the input typed into the ip route command.|A static route is only as good as the input typed into the ip route command.
IOS checks the syntax, and as mentioned earlier, makes a few other checks that this section reviews in the next heading.|IOS checks the syntax, and as mentioned earlier, makes a few other checks that this section reviews in the next heading.
But once those checks are passed, IOS puts the route into the IP routing table, even if the route had poorly chosen parameters.|But once those checks are passed, IOS puts the route into the IP routing table, even if the route had poorly chosen parameters.
|
For instance, the route might use a subnet and mask that implies a different range of addresses than the addresses in the destination subnet.|For instance, the route might use a subnet and mask that implies a different range of addresses than the addresses in the destination subnet.
Or, for a router sitting in the middle of a diagram, the next-hop address might be a router to the left, while the destination subnet is to the right.|Or, for a router sitting in the middle of a diagram, the next-hop address might be a router to the left, while the destination subnet is to the right.
Or the next-hop address could be an IP address in a connected subnet, but it might be a typo and be an address of a PC or even a currently unused IP address.|Or the next-hop address could be an IP address in a connected subnet, but it might be a typo and be an address of a PC or even a currently unused IP address.
|
When you see an exam question that has static routes, and you see them in the output of show ip route, remember to check on these items:|When you see an exam question that has static routes, and you see them in the output of show ip route, remember to check on these items:
###### Is there a subnetting math error in the subnet ID and mask?
Is there a subnetting math error in the subnet ID and mask?   
###### Is the next-hop IP address correct and referencing an IP address on a neighboring router?
Is the next-hop IP address correct and referencing an IP address on a neighboring router?   
###### Does the next-hop IP address identify the correct router?
Does the next-hop IP address identify the correct router?   
###### Is the outgoing interface correct, and referencing an interface on the local router (that is,
Is the outgoing interface correct, and referencing an interface on the local router (that is,   
__|__
--|--
|
the same router where the static route is configured)?|the same router where the static route is configured)?
##### The Static Route Does Not Appear in the IP Routing Table
Статический маршрут не отображается в таблице IP-маршрутизации   
__|__
--|--
|
After configuring an ip route command, IOS might or might not add the route to the IP routing table.|После настройки команды ip route IOS может добавлять или не добавлять маршрут в таблицу IP-маршрутизации.
IOS also considers the following before adding the route to its routing table:|IOS также учитывает следующее перед добавлением маршрута в свою таблицу маршрутизации:
###### For ip route commands that list an outgoing interface, that interface must be in an up/up
Для команд ip route, которые перечисляют исходящий интерфейс, этот интерфейс должен быть в восходящем / восходящем   
__|__
--|--
|
state.|штат.
###### For ip route commands that list a next-hop IP address, the local router must have a route
For ip route commands that list a next-hop IP address, the local router must have a route   
__|__
--|--
|
to reach that next-hop address.|to reach that next-hop address.
|
For example, earlier in Example 16-3, R1’s command ip route 172.16.3.0 255.255.255.0 172.16.5.3 defines a static route.|For example, earlier in Example 16-3, R1’s command ip route 172.16.3.0 255.255.255.0 172.16.5.3 defines a static route.
Before adding the route to the IP routing table, R1 looks for an existing IP route to reach 172.16.5.3.|Before adding the route to the IP routing table, R1 looks for an existing IP route to reach 172.16.5.3.
In that case, R1 will find a connected route for subnet 172.16.5.0/24 as long as its Ethernet WAN link is up.|In that case, R1 will find a connected route for subnet 172.16.5.0/24 as long as its Ethernet WAN link is up.
As a result, R1 adds the static route to subnet 172.16.3.0/24.|As a result, R1 adds the static route to subnet 172.16.3.0/24.
Later, if R1’s G0/1/0 were to fail, R1 would remove its connected route to 172.16.5.0/24 from the IP routing table—an action that would also then cause R1 to remove its static route to 172.16.3.0/24.|Later, if R1’s G0/1/0 were to fail, R1 would remove its connected route to 172.16.5.0/24 from the IP routing table—an action that would also then cause R1 to remove its static route to 172.16.3.0/24.
|
You can configure a static route so that IOS ignores these basic checks, always putting the IP route in the routing table.|You can configure a static route so that IOS ignores these basic checks, always putting the IP route in the routing table.
To do so, just use the permanent keyword on the ip route command.|To do so, just use the permanent keyword on the ip route command.
|
For example, by adding the permanent keyword to the end of the two commands as demonstrated in Example 16-7, R1 would now add these routes, regardless of whether the two WAN links were up.|For example, by adding the permanent keyword to the end of the two commands as demonstrated in Example 16-7, R1 would now add these routes, regardless of whether the two WAN links were up.
|
Example 16-7 Permanently Adding Static Routes to the IP Routing Table (Router R1)|Example 16-7 Permanently Adding Static Routes to the IP Routing Table (Router R1)
|
Example end.|Example end.
|
Note that although the permanent keyword lets the router keep the route in the routing table without checking the outgoing interface or route to the next-hop address, it does not magically fix a broken route.|Note that although the permanent keyword lets the router keep the route in the routing table without checking the outgoing interface or route to the next-hop address, it does not magically fix a broken route.
For example, if the outgoing interface fails, the route will remain in the routing table, but the router cannot forward packets because the outgoing interface is down.|For example, if the outgoing interface fails, the route will remain in the routing table, but the router cannot forward packets because the outgoing interface is down.
##### The Correct Static Route Appears but Works Poorly
The Correct Static Route Appears but Works Poorly   
__|__
--|--
|
This last section is a place to make two points—one mainstream and one point to review a bit of trivia.|This last section is a place to make two points—one mainstream and one point to review a bit of trivia.
|
First, on the mainstream point, the static route can be perfect, but the packets from one host to the next still might not arrive because of other problems.|First, on the mainstream point, the static route can be perfect, but the packets from one host to the next still might not arrive because of other problems.
An incorrect static route is just one of many items to check when you’re troubleshooting problems like “host A cannot connect to server B.” The root cause may be the static route, or it may be something else.|An incorrect static route is just one of many items to check when you’re troubleshooting problems like “host A cannot connect to server B.” The root cause may be the static route, or it may be something else.
|
Chapter 18, “Troubleshooting IPv4 Routing,” goes into some depth about troubleshooting these types of problems.|Chapter 18, “Troubleshooting IPv4 Routing,” goes into some depth about troubleshooting these types of problems.
|
On the more specific point, be wary of any ip route command with the permanent keyword.|On the more specific point, be wary of any ip route command with the permanent keyword.
|
IOS puts these routes in the routing table with no checks for accuracy.|IOS puts these routes in the routing table with no checks for accuracy.
You should check whether the outgoing interface is down and/or whether the router has a route to reach the next-hop address.|You should check whether the outgoing interface is down and/or whether the router has a route to reach the next-hop address.
### IP Forwarding with the Longest Prefix Match
Пересылка IP с самым длинным совпадением префикса   
__|__
--|--
|
A router’s IP routing process requires that the router compare the destination IP address of each packet with the existing contents of that router’s IP routing table.|Процесс IP-маршрутизации маршрутизатора требует, чтобы маршрутизатор сравнивал IP-адрес назначения каждого пакета с существующим содержимым таблицы IP-маршрутизации этого маршрутизатора.
Often, only one route matches a particular destination address.|Часто только один маршрут соответствует конкретному адресу назначения.
When only one route matches the packet’s destination, the action is obvious: forward the packet based on the details listed in that route.|Когда только один маршрут совпадает с местом назначения пакета, действие очевидно: пересылать пакет на основе деталей, перечисленных в этом маршруте.
|
In some cases, a particular destination address matches more than one of the router’s routes.|В некоторых случаях конкретный адрес назначения совпадает с несколькими маршрутами маршрутизатора.
For instance, one route might list subnet 10.1.0.0/16, another 10.1.1.0/25, and another|Например, один маршрут может содержать подсеть 10.1.0.0/16, другой 10.1.1.0/25 и еще один.
###### 10.1.1.1/32. All would match packets sent to IP address 10.1.1.1. Many legitimate router features
10.1.1.1/32. All would match packets sent to IP address 10.1.1.1. Many legitimate router features   
__|__
--|--
|
can cause these multiple routes to appear in a router’s routing table, including|can cause these multiple routes to appear in a router’s routing table, including
###### Static routes
Static routes   
###### Route autosummarization
Route autosummarization   
###### Manual route summarization
Manual route summarization   
__|__
--|--
|
This fourth of four major sections of this chapter explains how a router makes its routing decisions when a packet matches multiple routes.|This fourth of four major sections of this chapter explains how a router makes its routing decisions when a packet matches multiple routes.
When more than one route matches a packet’s destination address, the router uses the “best” route, defined as follows:|When more than one route matches a packet’s destination address, the router uses the “best” route, defined as follows:
|
When a particular destination IP address matches more than one route in a router’s IPv4 routing table, the router uses the most specific route—in other words, the route with the longest prefix length mask.|When a particular destination IP address matches more than one route in a router’s IPv4 routing table, the router uses the most specific route—in other words, the route with the longest prefix length mask.
#### Using show ip route to Find the Best Route
Использование show ip route для поиска лучшего маршрута   
__|__
--|--
|
We humans have a couple of ways to figure out what choice a router makes for choosing the best route.|У людей есть несколько способов выяснить, какой выбор делает маршрутизатор для выбора наилучшего маршрута.
One way uses the show ip route command, plus some subnetting math, to decide the route the router will choose.|В одном случае используется команда show ip route, а также некоторые математические вычисления для определения маршрута, который выберет маршрутизатор.
To let you see how to use this option, Example 16-8 shows a series of overlapping routes, all created with OSPF, so the output lists only OSPF-learned routes.|Чтобы вы могли увидеть, как использовать эту опцию, в примере 16-8 показана серия перекрывающихся маршрутов, все они созданы с помощью OSPF, поэтому в выходных данных перечислены только маршруты, изученные OSPF.
|
Example 16-8 Show ip route Command with Overlapping Routes Example end.|Пример 16-8 Показать команду ip route с перекрывающимися маршрутами Пример end.
|
To predict which of its routes a router will match, two pieces of information are required: the destination IP address of the packet and the contents of the router’s routing table.|Чтобы предсказать, какой из своих маршрутов будет соответствовать маршрутизатору, необходимы две части информации: IP-адрес назначения пакета и содержимое таблицы маршрутизации маршрутизатора.
The subnet ID and mask listed for a route define the range of addresses matched by that route.|Идентификатор подсети и маска, перечисленные для маршрута, определяют диапазон адресов, соответствующих этому маршруту.
With a little subnetting math, a network engineer can find the range of addresses matched by each route.|С помощью небольшой математической подсети сетевой инженер может найти диапазон адресов, соответствующих каждому маршруту.
For instance, Table 16-2 lists the five subnets listed in Example 16-8 and the address ranges implied by each.|Например, в таблице 16-2 перечислены пять подсетей, перечисленных в примере 16-8, и диапазоны адресов, подразумеваемые каждой из них.
|
Table 16-2 Analysis of Address Ranges for the Subnets in Example 16-8 Table end.|Таблица 16-2. Анализ диапазонов адресов для подсетей в примере 16-8. Конец таблицы.
|
NOTE The route listed as 0.0.0.0/0 is the default route.|ПРИМЕЧАНИЕ Маршрут, указанный как 0.0.0.0/0, является маршрутом по умолчанию.
|
As you can see from these ranges, several of the routes’ address ranges overlap.|Как видно из этих диапазонов, несколько диапазонов адресов маршрутов перекрываются.
When matching more than one route, the route with the longer prefix length is used.|При сопоставлении нескольких маршрутов используется маршрут с большей длиной префикса.
That is, a route with /16 is better than a route with /10; a route with a /25 prefix is better than a route with a /20 prefix; and so on.|То есть маршрут с / 16 лучше, чем маршрут с / 10; маршрут с префиксом / 25 лучше, чем маршрут с префиксом / 20; и так далее.
|
For example, a packet sent to 172.16.1.1 actually matches all five routes listed in the routing table in Example 16-8.|Например, пакет, отправленный на 172.16.1.1, фактически соответствует всем пяти маршрутам, перечисленным в таблице маршрутизации в примере 16-8.
The various prefix lengths range from /0 to /32.|Различные длины префиксов находятся в диапазоне от / 0 до / 32.
The longest prefix (largest /P value, meaning the best and most specific route) is /32.|Самый длинный префикс (наибольшее значение / P, означающий лучший и наиболее конкретный маршрут) - / 32.
So, a packet sent to 172.16.1.1 uses the route to 172.16.1.1/32, and not the other routes.|Таким образом, пакет, отправленный на 172.16.1.1, использует маршрут до 172.16.1.1/32, а не другие маршруты.
|
The following list gives some examples of destination IP addresses.|В следующем списке приведены некоторые примеры IP-адресов назначения.
For each address, the list describes the routes from Table 16-2 that the router would match, and which specific route the router would use.|Для каждого адреса в списке описаны маршруты из Таблицы 16-2, которым будет соответствовать маршрутизатор, и какой конкретный маршрут будет использовать маршрутизатор.
|
172.16.1.1: Matches all five routes; the longest prefix is /32, the route to 172.16.1.1/32.|172.16.1.1: соответствует всем пяти маршрутам; самый длинный префикс / 32, путь к 172.16.1.1/32.
|
172.16.1.2: Matches the last four routes; the longest prefix is /24, the route to 172.16.1.0/24.|172.16.1.2: соответствует последним четырем маршрутам; самый длинный префикс / 24, путь к 172.16.1.0/24.
|
172.16.2.3: Matches the last three routes; the longest prefix is /22, the route to 172.16.0.0/22.|172.16.2.3: соответствует трем последним маршрутам; самый длинный префикс / 22, путь к 172.16.0.0/22.
|
172.16.4.3: Matches the last two routes; the longest prefix is /16, the route to 172.16.0.0/16.|172.16.4.3: соответствует двум последним маршрутам; самый длинный префикс / 16, путь к 172.16.0.0/16.
#### Using show ip route address to Find the Best Route
Использование show ip route address для поиска лучшего маршрута   
__|__
--|--
|
A second way to identify the route a router will use, one that does not require any subnetting math, is the show ip route address command.|Второй способ определения маршрута, который будет использовать маршрутизатор, не требующий математических вычислений, - это команда show ip route address.
The last parameter on this command is the IP address of an assumed IP packet.|Последний параметр в этой команде - IP-адрес предполагаемого IP-пакета.
The router replies by listing the route it would use to route a packet sent to that address.|Маршрутизатор отвечает, перечисляя маршрут, который он будет использовать для маршрутизации пакета, отправленного на этот адрес.
|
For example, Example 16-9 lists the output of the show ip route 172.16.4.3 command on the same router used in Example 24-4.|Например, в примере 16-9 перечислены выходные данные команды show ip route 172.16.4.3 на том же маршрутизаторе, который использовался в примере 24-4.
The first line of (highlighted) output lists the matched route: the route to 172.16.0.0/16.|В первой (выделенной) строке выходных данных указан согласованный маршрут: маршрут до 172.16.0.0/16.
The rest of the output lists the details of that particular route, like the outgoing interface of GigabitEthernet0/1/0 and the next-hop router of 172.16.25.129.|Остальные выходные данные содержат подробную информацию об этом конкретном маршруте, например, исходящий интерфейс GigabitEthernet0 / 1/0 и маршрутизатор следующего перехода 172.16.25.129.
|
Example 16-9 Show ip route Command with Overlapping Routes Example end.|Пример 16-9 Показать команду ip route с перекрывающимися маршрутами Пример end.
|
Certainly, if you have an option, just using a command to check what the router actually chooses is a much quicker option than doing the subnetting math.|Конечно, если у вас есть возможность, просто использование команды для проверки того, что на самом деле выбирает маршрутизатор, является гораздо более быстрым вариантом, чем выполнение математических расчетов по подсетям.
#### Interpreting the IP Routing Table
Интерпретация таблицы IP-маршрутизации   
__|__
--|--
|
The show ip route command plays a huge role in verifying and troubleshooting IP routing and addressing.|Команда show ip route играет огромную роль в проверке и устранении неполадок IP-маршрутизации и адресации.
This final topic of the chapter pulls the concepts together in one place for easier reference and study.|В этой последней теме главы все концепции собраны в одном месте для более удобного использования и изучения.
|
Figure 16-15 shows the output of a sample show ip route command.|На рис. 16-15 показаны выходные данные примера команды show ip route.
The figure numbers various parts of the command output for easier reference, with Table 16-3 describing the output noted by each number.|На рисунке нумерации различных частей вывода команды для удобства пользования, а в Таблице 16-3 описываются выходные данные, отмеченные каждым номером.
|
CLOO|CLOO
###### 10.0.0.0/8 is variably subnetted, 13 subnets, 5 masks
10.0.0.0/8 имеет переменные подсети, 13 подсетей, 5 масок   
__|__
--|--
|
4 5 6 7 8 9 1 2 3 10 11|4 5 6 7 8 9 1 2 3 10 11
###### 10.1.3.0/26 is directly connected, GigabitEthernet0/1
10.1.3.0/26 подключен напрямую, GigabitEthernet0 / 1   
###### 10.1.3.3/32 is directly connected, GigabitEthernet0/1
10.1.3.3/32 подключен напрямую, GigabitEthernet0 / 1   
###### 10.1.4.64/26 [110/65] via 10.2.2.10, 14:31:52, Serial0/1/0
10.1.4.64/26 [110/65] через 10.2.2.10, 14:31:52, Serial0 / 1/0   
###### 10.2.2.0/30 [110/128] via 10.2.2.5, 14:31:52, Serial0/0/1
10.2.2.0/30 [110/128] через 10.2.2.5, 14:31:52, Serial0 / 0/1   
__|__
--|--
|
Figure 16-15 show ip route Command Output Reference Table 16-3 Descriptions of the show ip route Command Output Table end.|Рис. 16-15 Справочная таблица выходных данных команды show ip route Таблица 16-3 Описание выходных данных команды show ip route end.
### Chapter Review
Обзор главы   
__|__
--|--
|
One key to doing well on the exams is to perform repetitive spaced review sessions.|Один из ключей к успешной сдаче экзаменов - повторение повторных сессий с интервалом.
Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.|Просмотрите материал этой главы, используя инструменты из книги или интерактивные инструменты для тех же материалов, которые можно найти на сопутствующем веб-сайте книги.
Refer to the “Your Study Plan” element for more details.|Обратитесь к элементу «Ваш учебный план» для получения более подробной информации.
Table 16-4 outlines the key review elements and where you can find them.|В Таблице 16-4 представлены основные элементы обзора и их местонахождение.
To better track your study progress, record when you completed these activities in the second column.|Чтобы лучше отслеживать свои успехи в учебе, отметьте, когда вы выполнили эти задания, во втором столбце.
|
Table 16-4 Chapter Review Tracking Table end.|Таблица 16-4. Конец таблицы отслеживания обзора главы.
|
Review All the Key Topics Key Terms You Should Know ARP table, routing table, next-hop router, outgoing interface, connected route, static route, default route, host route, floating static route, network route, administrative distance Command References Tables 16-6 and 16-7 list configuration and verification commands used in this chapter.|Ознакомьтесь со всеми ключевыми темами Ключевые термины, которые вы должны знать Таблица ARP, таблица маршрутизации, маршрутизатор следующего перехода, исходящий интерфейс, подключенный маршрут, статический маршрут, маршрут по умолчанию, маршрут хоста, плавающий статический маршрут, сетевой маршрут, административное расстояние Справочные таблицы команд 16- 6 и 16-7 перечислены команды настройки и проверки, используемые в этой главе.
As an easy review exercise, cover the left column in a table, read the right column, and try to recall the command without looking.|В качестве простого упражнения на повторение закройте левый столбец таблицы, прочтите правый столбец и попытайтесь вспомнить команду, не глядя.
Then repeat the exercise, covering the right column, and try to recall what the command does.|Затем повторите упражнение, охватывая правый столбец, и попытайтесь вспомнить, что делает команда.
|
Table 16-6 Chapter 16 Configuration Command Reference Table end.|Таблица 16-6 Глава 16 Справочник команд конфигурации Конец таблицы.
|
Table 16-7 Chapter 16 EXEC Command Reference Table end.|Таблица 16-7 Глава 16 Справочник команд EXEC Конец таблицы.
## Chapter 17 IP Routing in the LAN
Chapter 17 IP Routing in the LAN   
__|__
--|--
|
This chapter covers the following exam topics:|This chapter covers the following exam topics:
###### 1.0 Network Fundamentals
1.0 Основы сети   
###### 1.6 Configure and verify IPv4 addressing and subnetting
1.6 Настройка и проверка адресации IPv4 и подсетей   
###### 2.0 Network Access
2.0 Доступ к сети   
###### 2.4 Configure and verify (Layer 2/Layer 3) EtherChannel (LACP)
2.4 Настройка и проверка (уровень 2 / уровень 3) EtherChannel (LACP)   
__|__
--|--
|
The preceding two chapters showed how to configure an IP address and mask on a router interface, making the router ready to route packets to/from the subnet implied by that address/mask combination.|В предыдущих двух главах было показано, как настроить IP-адрес и маску на интерфейсе маршрутизатора, подготовив маршрутизатор к маршрутизации пакетов в / из подсети, подразумеваемой этой комбинацией адреса / маски.
While true and useful, all the examples so far ignored the LAN switches and the possibility of VLANs. In fact, the examples so far show the simplest possible cases: the attached switches as Layer 2 switches, using only one VLAN, with the router configured with one ip address command on its physical interface.|Хотя все примеры верны и полезны, до сих пор игнорировались переключатели LAN и возможность создания сетей VLAN. Фактически, в примерах пока показаны простейшие возможные случаи: подключенные коммутаторы как коммутаторы уровня 2, использующие только одну VLAN, с маршрутизатором, настроенным с помощью одной команды ip-адреса на его физическом интерфейсе.
This chapter takes a detailed look at how to configure routers so that they route packets to/from the subnets that exist on each and every VLAN.|В этой главе подробно рассматривается, как настроить маршрутизаторы так, чтобы они направляли пакеты в / из подсетей, которые существуют в каждой VLAN.
|
Because Layer 2 switches do not forward Layer 2 frames between VLANs, a network must use routers to route IP packets between subnets to allow those devices in different VLANs/|Поскольку коммутаторы уровня 2 не пересылают кадры уровня 2 между VLAN, сеть должна использовать маршрутизаторы для маршрутизации IP-пакетов между подсетями, чтобы эти устройства могли находиться в разных VLAN /
|
subnets to communicate.|подсети для общения.
To review, Ethernet defines the concept of a VLAN, while IP defines the concept of an IP subnet, so a VLAN is not equivalent to a subnet.|Итак, Ethernet определяет концепцию VLAN, тогда как IP определяет концепцию IP-подсети, поэтому VLAN не эквивалентна подсети.
However, the set of devices in one VLAN are typically also in one subnet.|Однако набор устройств в одной VLAN обычно также находится в одной подсети.
By the same reasoning, devices in two different VLANs are normally in two different subnets.|По той же причине устройства в двух разных VLAN обычно находятся в двух разных подсетях.
For two devices in different VLANs to communicate with each other, routers must connect to the subnets that exist on each VLAN, and then the routers forward IP packets between the devices in those subnets.|Чтобы два устройства в разных VLAN могли взаимодействовать друг с другом, маршрутизаторы должны подключаться к подсетям, которые существуют в каждой VLAN, а затем маршрутизаторы пересылают IP-пакеты между устройствами в этих подсетях.
|
This chapter discusses the configuration and verification steps related to three methods of routing between VLANs with three major sections:|В этой главе обсуждаются шаги настройки и проверки, относящиеся к трем методам маршрутизации между VLAN, в трех основных разделах:
###### VLAN Routing with Router 802.1Q Trunks: The first section discusses how to configure
VLAN Routing with Router 802.1Q Trunks: The first section discusses how to configure   
__|__
--|--
|
a router to use VLAN trunking as connected to a Layer 2 switch.|a router to use VLAN trunking as connected to a Layer 2 switch.
The router does the routing, with the switch creating the VLANs. The link between the router and switch use trunking so that the router has an interface connected to each VLAN/subnet.|The router does the routing, with the switch creating the VLANs. The link between the router and switch use trunking so that the router has an interface connected to each VLAN/subnet.
This feature is known as routing over a VLAN trunk and also known as router-on-a-stick (ROAS).|This feature is known as routing over a VLAN trunk and also known as router-on-a-stick (ROAS).
###### VLAN Routing with Layer 3 Switch SVIs: The second section discusses using a LAN
Маршрутизация VLAN с SVI коммутатора уровня 3: во втором разделе обсуждается использование LAN.   
__|__
--|--
|
switch that supports both Layer 2 switching and Layer 3 routing (called a Layer 3 switch or multilayer switch).|коммутатор, который поддерживает как коммутацию уровня 2, так и маршрутизацию уровня 3 (называемый коммутатором уровня 3 или многоуровневым коммутатором).
To route, the Layer 3 switch configuration uses interfaces called switched virtual interfaces (SVI), which are also called VLAN interfaces.|Для маршрутизации конфигурация коммутатора уровня 3 использует интерфейсы, называемые коммутируемыми виртуальными интерфейсами (SVI), которые также называются интерфейсами VLAN.
###### VLAN Routing with Layer 3 Switch Routed Ports: The third major section of the chapter
Маршрутизация VLAN с маршрутизируемыми портами коммутатора уровня 3: Третий важный раздел главы   
__|__
--|--
|
discusses an alternative to SVIs called routed ports, in which the physical switch ports are made to act like interfaces on a router.|обсуждает альтернативу SVI, называемую маршрутизируемыми портами, в которой физические порты коммутатора действуют как интерфейсы на маршрутизаторе.
This third section also introduces the concept of an EtherChannel as used as a routed port in a feature called Layer 3 EtherChannel.|В этом третьем разделе также представлена ??концепция EtherChannel, используемого в качестве маршрутизируемого порта в функции, называемой EtherChannel уровня 3.
|
CHAPTER 17|ГЛАВА 17
### “Do I Know This Already?” Quiz
«Знаю ли я это уже?» Викторина   
__|__
--|--
|
Take the quiz (either here or use the PTP software) if you want to use the score to help you decide how much time to spend on this chapter.|Пройдите тест (здесь или воспользуйтесь программой PTP), если вы хотите использовать оценку, чтобы решить, сколько времени потратить на эту главу.
The letter answers are listed at the bottom of the page following the quiz.|Ответы на письма перечислены внизу страницы после викторины.
Appendix C, found both at the end of the book as well as on the companion website, includes both the answers and explanations.|Приложение C, которое можно найти как в конце книги, так и на сопутствующем веб-сайте, включает как ответы, так и пояснения.
You can also find both answers and explanations in the PTP testing software.|Вы также можете найти ответы и пояснения в программе тестирования PTP.
|
Table 17-1 “Do I Know This Already?” Foundation Topics Section-to-Question Mapping|Таблица 17-1 «Знаю ли я это уже?» Сопоставление разделов с вопросами по основным темам
### Foundation Topics
Foundation Topics   
### VLAN Routing with Router 802.1Q Trunks
VLAN Routing with Router 802.1Q Trunks   
__|__
--|--
|
VLAN Routing with Layer 3 Switch SVIs 3, 4 VLAN Routing with Layer 3 Switch Routed Ports 5, 6 1.|VLAN Routing with Layer 3 Switch SVIs 3, 4 VLAN Routing with Layer 3 Switch Routed Ports 5, 6 1.
Router 1 has a Fast Ethernet interface 0/0 with IP address 10.1.1.1.|Router 1 has a Fast Ethernet interface 0/0 with IP address 10.1.1.1.
The interface is connected to a switch.|The interface is connected to a switch.
This connection is then migrated to use 802.1Q trunking.|This connection is then migrated to use 802.1Q trunking.
Which of the following commands could be part of a valid configuration for Router 1’s Fa0/0 interface? (Choose two answers.)|Which of the following commands could be part of a valid configuration for Router 1’s Fa0/0 interface? (Choose two answers.)
|
a. interface fastethernet 0/0.4 b. dot1q enable c. dot1q enable 4 d. trunking enable e. trunking enable 4 f. encapsulation dot1q 4 2.|a. interface fastethernet 0/0.4 b. dot1q enable c. dot1q enable 4 d. trunking enable e. trunking enable 4 f. encapsulation dot1q 4 2.
Router R1 has a router-on-a-stick (ROAS) configuration with two subinterfaces of interface G0/1: G0/1.1 and G0/1.2.|Router R1 has a router-on-a-stick (ROAS) configuration with two subinterfaces of interface G0/1: G0/1.1 and G0/1.2.
Physical interface G0/1 is currently in a down/down state.|Physical interface G0/1 is currently in a down/down state.
The network engineer then configures a shutdown command when in interface configuration mode for G0/1.1 and a no shutdown command when in interface configuration mode for G0/1.2.|The network engineer then configures a shutdown command when in interface configuration mode for G0/1.1 and a no shutdown command when in interface configuration mode for G0/1.2.
Which answers are correct about the interface state for the subinterfaces? (Choose two answers.)|Which answers are correct about the interface state for the subinterfaces? (Choose two answers.)
|
a. G0/1.1 will be in a down/down state.|a. G0/1.1 will be in a down/down state.
|
b. G0/1.2 will be in a down/down state.|b. G0/1.2 will be in a down/down state.
|
c. G0/1.1 will be in an administratively down state.|c. G0/1.1 will be in an administratively down state.
|
d. G0/1.2 will be in an up/up state.|d. G0/1.2 will be in an up/up state.
|
3. A Layer 3 switch has been configured to route IP packets between VLANs 1, 2, and 3 using SVIs, which connect to subnets 172.20.1.0/25, 172.20.2.0/25, and 172.20.3.0/25, respectively.|3. A Layer 3 switch has been configured to route IP packets between VLANs 1, 2, and 3 using SVIs, which connect to subnets 172.20.1.0/25, 172.20.2.0/25, and 172.20.3.0/25, respectively.
The engineer issues a show ip route connected command on the Layer 3 switch, listing the connected routes.|The engineer issues a show ip route connected command on the Layer 3 switch, listing the connected routes.
Which of the following answers lists a piece of information that should be in at least one of the routes?|Which of the following answers lists a piece of information that should be in at least one of the routes?
|
a. Interface Gigabit Ethernet 0/0.3 b.|a. Interface Gigabit Ethernet 0/0.3 b.
Next-hop router 172.20.2.1 c.|Next-hop router 172.20.2.1 c.
Interface VLAN 2 d.|Interface VLAN 2 d.
Mask 255.255.255.0 4.|Mask 255.255.255.0 4.
An engineer has successfully configured a Layer 3 switch with SVIs for VLANs 2 and 3.|An engineer has successfully configured a Layer 3 switch with SVIs for VLANs 2 and 3.
Hosts in the subnets using VLANs 2 and 3 can ping each other with the Layer 3 switch routing the packets.|Hosts in the subnets using VLANs 2 and 3 can ping each other with the Layer 3 switch routing the packets.
The next week, the network engineer receives a call that those same users can no longer ping each other.|The next week, the network engineer receives a call that those same users can no longer ping each other.
If the problem is with the Layer 3 switching function, which of the following could have caused the problem? (Choose two answers.)|If the problem is with the Layer 3 switching function, which of the following could have caused the problem? (Choose two answers.)
|
a. Six (or more) out of 10 working VLAN 2 access ports failing due to physical problems b.|a. Six (or more) out of 10 working VLAN 2 access ports failing due to physical problems b.
A shutdown command issued from interface VLAN 4 configuration mode c.|A shutdown command issued from interface VLAN 4 configuration mode c.
VTP on the switch removing VLAN 3 from the switch’s VLAN list d.|VTP on the switch removing VLAN 3 from the switch’s VLAN list d.
A shutdown command issued from VLAN 2 configuration mode 5.|A shutdown command issued from VLAN 2 configuration mode 5.
A LAN design uses a Layer 3 EtherChannel between two switches SW1 and SW2, with port-channel interface 1 used on both switches.|A LAN design uses a Layer 3 EtherChannel between two switches SW1 and SW2, with port-channel interface 1 used on both switches.
SW1 uses ports G0/1, G0/2, and G0/3 in the channel.|SW1 uses ports G0/1, G0/2, and G0/3 in the channel.
Which of the following are true about SW1’s configuration to make the channel be able to route IPv4 packets correctly? (Choose two answers.)|Which of the following are true about SW1’s configuration to make the channel be able to route IPv4 packets correctly? (Choose two answers.)
|
a. The ip address command must be on the port-channel 1 interface.|a. The ip address command must be on the port-channel 1 interface.
|
b. The ip address command must be on interface G0/1 (lowest numbered port).|b. The ip address command must be on interface G0/1 (lowest numbered port).
|
c. The port-channel 1 interface must be configured with the no switchport command.|c. The port-channel 1 interface must be configured with the no switchport command.
|
d. Interface G0/1 must be configured with the routedport command.|d. Interface G0/1 must be configured with the routedport command.
|
6. A LAN design uses a Layer 3 EtherChannel between two switches SW1 and SW2, with port-channel interface 1 used on both switches.|6. A LAN design uses a Layer 3 EtherChannel between two switches SW1 and SW2, with port-channel interface 1 used on both switches.
SW1 uses ports G0/1 and G0/2 in the channel.|SW1 uses ports G0/1 and G0/2 in the channel.
However, only interface G0/1 is bundled into the channel and working.|However, only interface G0/1 is bundled into the channel and working.
|
Think about the configuration settings on port G0/2 that could have existed before adding G0/2 to the EtherChannel.|Think about the configuration settings on port G0/2 that could have existed before adding G0/2 to the EtherChannel.
Which answers identify a setting that could prevent IOS from adding G0/2 to the Layer 3 EtherChannel? (Choose two answers.)|Which answers identify a setting that could prevent IOS from adding G0/2 to the Layer 3 EtherChannel? (Choose two answers.)
|
a. A different STP cost (spanning-tree cost value)|a. A different STP cost (spanning-tree cost value)
|
b. A different speed (speed value)|b. A different speed (speed value)
|
c. A default setting for switchport (switchport)|c. A default setting for switchport (switchport)
|
d. A different access VLAN (switchport access vlan vlan-id)|d. A different access VLAN (switchport access vlan vlan-id)
|
Foundation Topics VLAN Routing with Router 802.1Q Trunks Almost all enterprise networks use VLANs. To route IP packets in and out of those VLANs, some devices (either routers or Layer 3 switches) need to have an IP address in each subnet and have a connected route to each of those subnets.|Foundation Topics VLAN Routing with Router 802.1Q Trunks Almost all enterprise networks use VLANs. To route IP packets in and out of those VLANs, some devices (either routers or Layer 3 switches) need to have an IP address in each subnet and have a connected route to each of those subnets.
Then the IP addresses on those routers or Layer 3 switches can serve as the default gateways in those subnets.|Then the IP addresses on those routers or Layer 3 switches can serve as the default gateways in those subnets.
|
This chapter breaks down the LAN routing options into four categories:|This chapter breaks down the LAN routing options into four categories:
###### Use a router, with one router LAN interface and cable connected to the switch for each
Use a router, with one router LAN interface and cable connected to the switch for each   
__|__
--|--
|
and every VLAN (typically not used)|and every VLAN (typically not used)
###### Use a router, with a VLAN trunk connecting to a LAN switch (known as router-on-astick,
Use a router, with a VLAN trunk connecting to a LAN switch (known as router-on-astick,   
__|__
--|--
|
or ROAS)|or ROAS)
###### Use a Layer 3 switch with switched virtual interfaces (SVI)
Use a Layer 3 switch with switched virtual interfaces (SVI)   
###### Use a Layer 3 switch with routed interfaces (which may or may not be Layer 3
Use a Layer 3 switch with routed interfaces (which may or may not be Layer 3   
__|__
--|--
|
EtherChannels)|EtherChannels)
|
Of the items in the list, the first option works, but to be practical, it requires far too many interfaces.|Of the items in the list, the first option works, but to be practical, it requires far too many interfaces.
It is mentioned here only to make the list complete.|It is mentioned here only to make the list complete.
|
As for the other three options, this chapter discusses each in turn as the main focus of one of the three major sections in this chapter.|As for the other three options, this chapter discusses each in turn as the main focus of one of the three major sections in this chapter.
Each feature is used in real networks today, with the choice to use one or the other driven by the design and needs for a particular part of the network.|Each feature is used in real networks today, with the choice to use one or the other driven by the design and needs for a particular part of the network.
Figure 17-1 shows cases in which these options could be used.|Figure 17-1 shows cases in which these options could be used.
|
Figure 17-1 Layer 3 Switching at the Central Site Figure 17-1 shows two switches, labeled A and B, which could act as Layer 3 switches—both with SVIs and routed interfaces.|Figure 17-1 Layer 3 Switching at the Central Site Figure 17-1 shows two switches, labeled A and B, which could act as Layer 3 switches—both with SVIs and routed interfaces.
The figure shows a central site campus LAN on the left, with 12 VLANs. Switches A and B act as Layer 3 switches, combining the functions of a router and a switch, routing between all 12 subnets/VLANs, as well as routing to/from the Core router.|The figure shows a central site campus LAN on the left, with 12 VLANs. Switches A and B act as Layer 3 switches, combining the functions of a router and a switch, routing between all 12 subnets/VLANs, as well as routing to/from the Core router.
Those Layer 3 switches could use SVIs, routed interfaces, or both.|Those Layer 3 switches could use SVIs, routed interfaces, or both.
|
Figure 17-1 also shows a classic case for using a router with a VLAN trunk.|Figure 17-1 also shows a classic case for using a router with a VLAN trunk.
Sites like the remote sites on the right side of the figure may have a WAN-connected router and a LAN switch.|Sites like the remote sites on the right side of the figure may have a WAN-connected router and a LAN switch.
These sites might use ROAS to take advantage of the router’s ability to route over an 802.1Q trunk.|These sites might use ROAS to take advantage of the router’s ability to route over an 802.1Q trunk.
|
Note that Figure 17-1 just shows an example.|Note that Figure 17-1 just shows an example.
The engineer could use Layer 3 switching at each site or routers with VLAN trunking at each site.|The engineer could use Layer 3 switching at each site or routers with VLAN trunking at each site.
#### Configuring ROAS
Configuring ROAS   
__|__
--|--
|
This next topic discusses how routers route packets to subnets associated with VLANs connected to a router 802.1Q trunk.|This next topic discusses how routers route packets to subnets associated with VLANs connected to a router 802.1Q trunk.
That long description can be a bit of a chore to repeat each time someone wants to discuss this feature, so over time, the networking world has instead settled on a shorter and more interesting name for this feature: router-on-a-stick (ROAS).|That long description can be a bit of a chore to repeat each time someone wants to discuss this feature, so over time, the networking world has instead settled on a shorter and more interesting name for this feature: router-on-a-stick (ROAS).
|
ROAS uses router VLAN trunking configuration to give the router a logical router interface connected to each VLAN. Because the router then has an interface connected to each VLAN, the router can also be configured with an IP address in the subnet that exists on each VLAN.|ROAS uses router VLAN trunking configuration to give the router a logical router interface connected to each VLAN. Because the router then has an interface connected to each VLAN, the router can also be configured with an IP address in the subnet that exists on each VLAN.
|
Routers use subinterfaces as the means to have an interface connected to a VLAN. The router needs to have an IP address/mask associated with each VLAN on the trunk.|Routers use subinterfaces as the means to have an interface connected to a VLAN. The router needs to have an IP address/mask associated with each VLAN on the trunk.
However, the router has only one physical interface for the link connected to the trunk.|However, the router has only one physical interface for the link connected to the trunk.
Cisco solves this problem by creating multiple virtual router interfaces, one associated with each VLAN on that trunk (at least for each VLAN that you want the trunk to support).|Cisco solves this problem by creating multiple virtual router interfaces, one associated with each VLAN on that trunk (at least for each VLAN that you want the trunk to support).
Cisco calls these virtual interfaces subinterfaces.|Cisco calls these virtual interfaces subinterfaces.
The configuration can then include an ip address command for each subinterface.|The configuration can then include an ip address command for each subinterface.
|
Figure 17-2 shows the concept with Router B1, one of the branch routers from Figure 17-1.|Figure 17-2 shows the concept with Router B1, one of the branch routers from Figure 17-1.
|
Because this router needs to route between only two VLANs, the figure also shows two subinterfaces, named G0/0.10 and G0/0.20, which create a new place in the configuration where the per-VLAN configuration settings can be made.|Because this router needs to route between only two VLANs, the figure also shows two subinterfaces, named G0/0.10 and G0/0.20, which create a new place in the configuration where the per-VLAN configuration settings can be made.
The router treats frames tagged with VLAN 10 as if they came in or out of G0/0.10 and frames tagged with VLAN 20 as if they came in or out G0/0.20.|The router treats frames tagged with VLAN 10 as if they came in or out of G0/0.10 and frames tagged with VLAN 20 as if they came in or out G0/0.20.
|
Figure 17-2 Subinterfaces on Router B1 In addition, note that most Cisco routers do not attempt to negotiate trunking, so both the router and switch need to manually configure trunking.|Figure 17-2 Subinterfaces on Router B1 In addition, note that most Cisco routers do not attempt to negotiate trunking, so both the router and switch need to manually configure trunking.
This chapter discusses the router side of that trunking configuration; the matching switch interface would need to be configured with the switchport mode trunk command.|This chapter discusses the router side of that trunking configuration; the matching switch interface would need to be configured with the switchport mode trunk command.
|
Answers to the “Do I Know This Already?” quiz:|Answers to the “Do I Know This Already?” quiz:
|
1 A, F 2 B, C 3 C 4 C, D 5 A, C 6 B, C Example 17-1 shows a full example of the 802.1Q trunking configuration required on Router B1 in Figure 17-2.|1 A, F 2 B, C 3 C 4 C, D 5 A, C 6 B, C Example 17-1 shows a full example of the 802.1Q trunking configuration required on Router B1 in Figure 17-2.
More generally, these steps detail how to configure 802.1Q trunking on a router:|More generally, these steps detail how to configure 802.1Q trunking on a router:
|
Step 1.|Step 1.
Use the interface type number.subint command in global configuration mode to create a unique subinterface for each VLAN that needs to be routed.|Use the interface type number.subint command in global configuration mode to create a unique subinterface for each VLAN that needs to be routed.
|
Step 2.|Step 2.
Use the encapsulation dot1q vlan_id command in subinterface configuration mode to enable 802.1Q and associate one specific VLAN with the subinterface.|Use the encapsulation dot1q vlan_id command in subinterface configuration mode to enable 802.1Q and associate one specific VLAN with the subinterface.
|
Step 3.|Step 3.
Use the ip address address mask command in subinterface configuration mode to configure IP settings (address and mask).|Use the ip address address mask command in subinterface configuration mode to configure IP settings (address and mask).
|
Example 17-1 Router Configuration for the 802.1Q Encapsulation Shown in Figure 17-2 Example end.|Example 17-1 Router Configuration for the 802.1Q Encapsulation Shown in Figure 17-2 Example end.
|
First, look at the subinterface numbers.|First, look at the subinterface numbers.
The subinterface number begins with the period, like .10 and .20 in this case.|The subinterface number begins with the period, like .10 and .20 in this case.
These numbers can be any number from 1 up through a very large number (over 4 billion).|These numbers can be any number from 1 up through a very large number (over 4 billion).
The number just needs to be unique among all subinterfaces associated with this one physical interface.|The number just needs to be unique among all subinterfaces associated with this one physical interface.
In fact, the subinterface number does not even have to match the associated VLAN ID. (The encapsulation command, and not the subinterface number, defines the VLAN ID associated with the subinterface.)|In fact, the subinterface number does not even have to match the associated VLAN ID. (The encapsulation command, and not the subinterface number, defines the VLAN ID associated with the subinterface.)
|
NOTE Although not required, most sites do choose to make the subinterface number match the VLAN ID, as shown in Example 17-1, just to avoid confusion.|NOTE Although not required, most sites do choose to make the subinterface number match the VLAN ID, as shown in Example 17-1, just to avoid confusion.
|
Each subinterface configuration lists two subcommands.|Each subinterface configuration lists two subcommands.
One command (encapsulation)|One command (encapsulation)
|
enables trunking and defines the VLAN whose frames are considered to be coming in and out of the subinterface.|enables trunking and defines the VLAN whose frames are considered to be coming in and out of the subinterface.
The ip address command works the same way it does on any other interface.|The ip address command works the same way it does on any other interface.
Note that if the physical Ethernet interface reaches an up/up state, the subinterface should as well, which would then let the router add the connected routes shown at the bottom of the example.|Note that if the physical Ethernet interface reaches an up/up state, the subinterface should as well, which would then let the router add the connected routes shown at the bottom of the example.
|
Now that the router has a working interface, with IPv4 addresses configured, the router can route IPv4 packets on these subinterfaces.|Now that the router has a working interface, with IPv4 addresses configured, the router can route IPv4 packets on these subinterfaces.
That is, the router treats these subinterfaces like Config Checklist any physical interface in terms of adding connected routes, matching those routes, and forwarding packets to/from those connected subnets.|That is, the router treats these subinterfaces like Config Checklist any physical interface in terms of adding connected routes, matching those routes, and forwarding packets to/from those connected subnets.
|
The configuration and use of the native VLAN on the trunk require a little extra thought.|The configuration and use of the native VLAN on the trunk require a little extra thought.
The native VLAN can be configured on a subinterface, or on the physical interface, or ignored as in Example 17-1.|The native VLAN can be configured on a subinterface, or on the physical interface, or ignored as in Example 17-1.
Each 802.1Q trunk has one native VLAN, and if the router needs to route packets for a subnet that exists in the native VLAN, then the router needs some configuration to support that subnet.|Each 802.1Q trunk has one native VLAN, and if the router needs to route packets for a subnet that exists in the native VLAN, then the router needs some configuration to support that subnet.
The two options to define a router interface for the native VLAN are|The two options to define a router interface for the native VLAN are
###### Configure the ip address command on the physical interface, but without an
Configure the ip address command on the physical interface, but without an   
__|__
--|--
|
encapsulation command; the router considers this physical interface to be using the native VLAN.|encapsulation command; the router considers this physical interface to be using the native VLAN.
###### Configure the ip address command on a subinterface and use the encapsulation dot1q
Configure the ip address command on a subinterface and use the encapsulation dot1q   
__|__
--|--
|
vlan-id native subcommand to tell the router both the VLAN ID and the fact that it is the native VLAN.|vlan-id native subcommand to tell the router both the VLAN ID and the fact that it is the native VLAN.
|
Example 17-2 shows both native VLAN configuration options with a small change to the same configuration in Example 17-1.|Example 17-2 shows both native VLAN configuration options with a small change to the same configuration in Example 17-1.
In this case, VLAN 10 becomes the native VLAN. The top part of the example shows the option to configure the router physical interface to use native VLAN 10.|In this case, VLAN 10 becomes the native VLAN. The top part of the example shows the option to configure the router physical interface to use native VLAN 10.
The second half of the example shows how to configure that same native VLAN on a subinterface.|The second half of the example shows how to configure that same native VLAN on a subinterface.
In both cases, the switch configuration also needs to be changed to make VLAN 10 the native VLAN.|In both cases, the switch configuration also needs to be changed to make VLAN 10 the native VLAN.
|
Example 17-2 Router Configuration Using Native VLAN 10 on Router B1 Example end.|Example 17-2 Router Configuration Using Native VLAN 10 on Router B1 Example end.
#### Verifying ROAS
Verifying ROAS   
__|__
--|--
|
Beyond using the show running-config command, ROAS configuration on a router can be best verified with two commands: show ip route [connected] and show vlans.|Beyond using the show running-config command, ROAS configuration on a router can be best verified with two commands: show ip route [connected] and show vlans.
As with any router interface, as long as the interface is in an up/up state and has an IPv4 address configured, IOS will put a connected (and local) route in the IPv4 routing table.|As with any router interface, as long as the interface is in an up/up state and has an IPv4 address configured, IOS will put a connected (and local) route in the IPv4 routing table.
So, a first and obvious check would be to see if all the expected connected routes exist.|So, a first and obvious check would be to see if all the expected connected routes exist.
Example 17-3 lists the connected routes per the configuration shown in Example 17-1.|Example 17-3 lists the connected routes per the configuration shown in Example 17-1.
|
Example 17-3 Connected Routes Based on Example 17-1 Configuration Example end.|Example 17-3 Connected Routes Based on Example 17-1 Configuration Example end.
|
As for interface and subinterface state, note that the ROAS subinterface state does depend to some degree on the physical interface state.|As for interface and subinterface state, note that the ROAS subinterface state does depend to some degree on the physical interface state.
In particular, the subinterface state cannot be better than the state of the matching physical interface.|In particular, the subinterface state cannot be better than the state of the matching physical interface.
For instance, on Router B1 in the examples so far, physical interface G0/0 is in an up/up state, and the subinterfaces are in an up/up state.|For instance, on Router B1 in the examples so far, physical interface G0/0 is in an up/up state, and the subinterfaces are in an up/up state.
But if you unplugged the cable from that port, the physical port would fail to a down/down state, and the subinterfaces would also fail to a down/down state.|But if you unplugged the cable from that port, the physical port would fail to a down/down state, and the subinterfaces would also fail to a down/down state.
Example 17-4 shows another example, with the physical interface being shut down, with the subinterfaces then automatically changed to an administratively down state as a result.|Example 17-4 shows another example, with the physical interface being shut down, with the subinterfaces then automatically changed to an administratively down state as a result.
|
Example 17-4 Subinterface State Tied to Physical Interface State Example end.|Example 17-4 Subinterface State Tied to Physical Interface State Example end.
|
Additionally, the subinterface state can also be enabled and disabled independently from the physical interface, using the no shutdown and shutdown commands in subinterface configuration mode.|Additionally, the subinterface state can also be enabled and disabled independently from the physical interface, using the no shutdown and shutdown commands in subinterface configuration mode.
|
Another useful ROAS verification command, show vlans, spells out which router trunk interfaces use which VLANs, which VLAN is the native VLAN, plus some packet statistics.|Another useful ROAS verification command, show vlans, spells out which router trunk interfaces use which VLANs, which VLAN is the native VLAN, plus some packet statistics.
The fact that the packet counters are increasing can be useful when verifying whether traffic is happening or not.|The fact that the packet counters are increasing can be useful when verifying whether traffic is happening or not.
Example 17-5 shows a sample, based on the Router B1 configuration in Example 17-2 (bottom half), in which native VLAN 10 is configured on subinterface G0/0.10.|Example 17-5 shows a sample, based on the Router B1 configuration in Example 17-2 (bottom half), in which native VLAN 10 is configured on subinterface G0/0.10.
|
Note that the output identifies VLAN 1 associated with the physical interface, VLAN 10 as the native VLAN associated with G0/0.10, and VLAN 20 associated with G0/0.20.|Note that the output identifies VLAN 1 associated with the physical interface, VLAN 10 as the native VLAN associated with G0/0.10, and VLAN 20 associated with G0/0.20.
It also lists the IP addresses assigned to each interface/subinterface.|It also lists the IP addresses assigned to each interface/subinterface.
|
Example 17-5 Sample show vlans Command to Match Sample Router Trunking Example end.|Example 17-5 Sample show vlans Command to Match Sample Router Trunking Example end.
#### Troubleshooting ROAS
Troubleshooting ROAS   
__|__
--|--
|
The biggest challenge when troubleshooting ROAS has to do with the fact that if you misconfigure only the router or misconfigure only the switch, the other device on the trunk has no way to know that the other side is misconfigured.|The biggest challenge when troubleshooting ROAS has to do with the fact that if you misconfigure only the router or misconfigure only the switch, the other device on the trunk has no way to know that the other side is misconfigured.
That is, if you check the show ip route and show vlans commands on a router, and the output looks like it matches the intended configuration, and the connected routes for the correct subinterfaces show up, routing may still fail because of problems on the attached switch.|That is, if you check the show ip route and show vlans commands on a router, and the output looks like it matches the intended configuration, and the connected routes for the correct subinterfaces show up, routing may still fail because of problems on the attached switch.
So, troubleshooting ROAS often begins with checking the configuration on both the router and switch because there is no status output on either device that tells you where the problem might be.|So, troubleshooting ROAS often begins with checking the configuration on both the router and switch because there is no status output on either device that tells you where the problem might be.
|
First, to check ROAS on the router, you need to start with the intended configuration and ask questions about the configuration:|First, to check ROAS on the router, you need to start with the intended configuration and ask questions about the configuration:
|
1. Is each non-native VLAN configured on the router with an encapsulation dot1q vlan-id command on a subinterface?|1. Is each non-native VLAN configured on the router with an encapsulation dot1q vlan-id command on a subinterface?
|
2. Do those same VLANs exist on the trunk on the neighboring switch (show interfaces trunk), and are they in the allowed list, not VTP pruned, and not STP blocked?|2. Do those same VLANs exist on the trunk on the neighboring switch (show interfaces trunk), and are they in the allowed list, not VTP pruned, and not STP blocked?
|
3. Does each router ROAS subinterface have an IP address/mask configured per the planned configuration?|3. Does each router ROAS subinterface have an IP address/mask configured per the planned configuration?
|
4. If using the native VLAN, is it configured correctly on the router either on a subinterface (with an encapsulation dot1q vlan-id native command) or implied on the physical interface?|4. If using the native VLAN, is it configured correctly on the router either on a subinterface (with an encapsulation dot1q vlan-id native command) or implied on the physical interface?
|
5. Is the same native VLAN configured on the neighboring switch’s trunk in comparison to the native VLAN configured on the router?|5. Is the same native VLAN configured on the neighboring switch’s trunk in comparison to the native VLAN configured on the router?
|
6. Are the router physical or ROAS subinterfaces configured with a shutdown command?|6. Are the router physical or ROAS subinterfaces configured with a shutdown command?
|
For some of these steps, you need to be ready to investigate possible VLAN trunking issues on the LAN switch.|For some of these steps, you need to be ready to investigate possible VLAN trunking issues on the LAN switch.
The reason is that on many Cisco routers, router interfaces do not negotiate trunking.|The reason is that on many Cisco routers, router interfaces do not negotiate trunking.
As a result, ROAS relies on static trunk configuration on both the router and switch.|As a result, ROAS relies on static trunk configuration on both the router and switch.
If the switch has any problems with VLANs or the VLAN trunking configuration on its side of the trunk, the router has no way to realize that the problem exists.|If the switch has any problems with VLANs or the VLAN trunking configuration on its side of the trunk, the router has no way to realize that the problem exists.
|
For example, imagine you configured ROAS on a router just like in Example 17-1 or Example 17-2.|For example, imagine you configured ROAS on a router just like in Example 17-1 or Example 17-2.
However, the switch on the other end of the link had no matching configuration.|However, the switch on the other end of the link had no matching configuration.
For instance, maybe the switch did not even define VLANs 10 and 20.|For instance, maybe the switch did not even define VLANs 10 and 20.
Maybe the switch did not configure trunking on the port connected to the router.|Maybe the switch did not configure trunking on the port connected to the router.
Even with blatant misconfiguration or missing configuration on the switch, the router still shows up/up ROAS interfaces and subinterfaces, IP routes in the output of show ip route, and meaningful configuration information in the output of the show vlans command.|Even with blatant misconfiguration or missing configuration on the switch, the router still shows up/up ROAS interfaces and subinterfaces, IP routes in the output of show ip route, and meaningful configuration information in the output of the show vlans command.
### VLAN Routing with Layer 3 Switch SVIs
VLAN Routing with Layer 3 Switch SVIs   
__|__
--|--
|
Using a router with ROAS to route packets makes sense in some cases, particularly at small remote sites.|Using a router with ROAS to route packets makes sense in some cases, particularly at small remote sites.
In sites with a larger LAN, network designers choose to use Layer 3 switches for most inter-VLAN routing.|In sites with a larger LAN, network designers choose to use Layer 3 switches for most inter-VLAN routing.
|
A Layer 3 switch (also called a multilayer switch) is one device, but it executes logic at two layers: Layer 2 LAN switching and Layer 3 IP routing.|A Layer 3 switch (also called a multilayer switch) is one device, but it executes logic at two layers: Layer 2 LAN switching and Layer 3 IP routing.
The Layer 2 switch function forwards frames inside each VLAN, but it will not forward frames between VLANs. The Layer 3 forwarding (routing) logic forwards IP packets between VLANs.|The Layer 2 switch function forwards frames inside each VLAN, but it will not forward frames between VLANs. The Layer 3 forwarding (routing) logic forwards IP packets between VLANs.
|
Layer 3 switches typically support two configuration options to enable IPv4 routing inside the switch, specifically to enable IPv4 on switch interfaces.|Layer 3 switches typically support two configuration options to enable IPv4 routing inside the switch, specifically to enable IPv4 on switch interfaces.
This section explains one option, an option that uses switched virtual interfaces (SVI). The final major section of the chapter deals with the other option for configuring IPv4 addresses on Layer 3 switches: routed interfaces.|This section explains one option, an option that uses switched virtual interfaces (SVI). The final major section of the chapter deals with the other option for configuring IPv4 addresses on Layer 3 switches: routed interfaces.
#### Configuring Routing Using Switch SVIs
Configuring Routing Using Switch SVIs   
__|__
--|--
|
The configuration of a Layer 3 switch mostly looks like the Layer 2 switching configuration shown back in Parts II and III of this book, with a small bit of configuration added for the Layer 3 functions.|The configuration of a Layer 3 switch mostly looks like the Layer 2 switching configuration shown back in Parts II and III of this book, with a small bit of configuration added for the Layer 3 functions.
The Layer 3 switching function needs a virtual interface connected to each VLAN internal to the switch.|The Layer 3 switching function needs a virtual interface connected to each VLAN internal to the switch.
These VLAN interfaces act like router interfaces, with an IP address and mask.|These VLAN interfaces act like router interfaces, with an IP address and mask.
The Layer 3 switch has an IP routing table, with connected routes off each of these VLAN interfaces. (These interfaces are also referred to as switched virtual interfaces [SVI].)|The Layer 3 switch has an IP routing table, with connected routes off each of these VLAN interfaces. (These interfaces are also referred to as switched virtual interfaces [SVI].)
|
To show the concept of Layer 3 switching with SVIs, the following example uses the same branch office with two VLANs shown in the earlier examples, but now the design will use Layer 3 switching in the LAN switch.|To show the concept of Layer 3 switching with SVIs, the following example uses the same branch office with two VLANs shown in the earlier examples, but now the design will use Layer 3 switching in the LAN switch.
Figure 17-3 shows the design changes and configuration concept for the Layer 3 switch function with a router icon inside the switch, to emphasize that the switch routes the packets.|Figure 17-3 shows the design changes and configuration concept for the Layer 3 switch function with a router icon inside the switch, to emphasize that the switch routes the packets.
|
Figure 17-3 Routing on VLAN Interfaces in a Layer 3 Switch Note that the figure represents the internals of the Layer 3 switch within the box in the middle of the figure.|Figure 17-3 Routing on VLAN Interfaces in a Layer 3 Switch Note that the figure represents the internals of the Layer 3 switch within the box in the middle of the figure.
The branch still has two user VLANs (10 and 20), so the Layer 3 switch needs one VLAN interface for each VLAN. The figure shows a router icon inside the gray box to represent the Layer 3 switching function, with two VLAN interfaces on the right side of that icon.|The branch still has two user VLANs (10 and 20), so the Layer 3 switch needs one VLAN interface for each VLAN. The figure shows a router icon inside the gray box to represent the Layer 3 switching function, with two VLAN interfaces on the right side of that icon.
In addition, the traffic still needs to get to router B1 (a physical router) to access the WAN, so the switch uses a third VLAN (VLAN 30 in this case) for the link to Router B1. The physical link between the Layer 3 switch and router B1 would not be a trunk, but instead be an access link.|In addition, the traffic still needs to get to router B1 (a physical router) to access the WAN, so the switch uses a third VLAN (VLAN 30 in this case) for the link to Router B1. The physical link between the Layer 3 switch and router B1 would not be a trunk, but instead be an access link.
|
The following steps show how to configure Layer 3 switching using SVIs. Note that on some switches, like the 2960 and 2960-XR switches used for the examples in this book, the ability to route IPv4 packets must be enabled first, with a reload of the switch required to enable the feature.|The following steps show how to configure Layer 3 switching using SVIs. Note that on some switches, like the 2960 and 2960-XR switches used for the examples in this book, the ability to route IPv4 packets must be enabled first, with a reload of the switch required to enable the feature.
The steps that occur after the reload would apply to all models of Cisco switches that are capable of doing Layer 3 switching.|The steps that occur after the reload would apply to all models of Cisco switches that are capable of doing Layer 3 switching.
|
Step 1.|Step 1.
Enable IP routing on the switch, as needed:|Enable IP routing on the switch, as needed:
|
A. Use the sdm prefer lanbase-routing command (or similar) in global configuration mode to change the switch forwarding ASIC settings to make space for IPv4 routes at the next reload of the switch.|A. Use the sdm prefer lanbase-routing command (or similar) in global configuration mode to change the switch forwarding ASIC settings to make space for IPv4 routes at the next reload of the switch.
|
B. Use the reload EXEC command in enable mode to reload (reboot) the switch to pick up the new sdm prefer command setting.|B. Use the reload EXEC command in enable mode to reload (reboot) the switch to pick up the new sdm prefer command setting.
|
C. Once reloaded, use the ip routing command in global configuration mode to enable the IPv4 routing function in IOS software and to enable key commands like show ip route.|C. Once reloaded, use the ip routing command in global configuration mode to enable the IPv4 routing function in IOS software and to enable key commands like show ip route.
|
Config Checklist Step 2.|Config Checklist Step 2.
Configure each SVI interface, one per VLAN for which routing should be done by this Layer 3 switch:|Configure each SVI interface, one per VLAN for which routing should be done by this Layer 3 switch:
|
A. Use the interface vlan vlan_id command in global configuration mode to create a VLAN interface and to give the switch’s routing logic a Layer 3 interface connected into the VLAN of the same number.|A. Use the interface vlan vlan_id command in global configuration mode to create a VLAN interface and to give the switch’s routing logic a Layer 3 interface connected into the VLAN of the same number.
|
B. Use the ip address address mask command in VLAN interface configuration mode to configure an IP address and mask on the VLAN interface, enabling IPv4 routing on that VLAN interface.|B. Use the ip address address mask command in VLAN interface configuration mode to configure an IP address and mask on the VLAN interface, enabling IPv4 routing on that VLAN interface.
|
C. (As needed) Use the no shutdown command in interface configuration mode to enable the VLAN interface (if it is currently in a shutdown state).|C. (As needed) Use the no shutdown command in interface configuration mode to enable the VLAN interface (if it is currently in a shutdown state).
|
Example 17-6 shows the configuration to match Figure 17-3.|Example 17-6 shows the configuration to match Figure 17-3.
In this case, switch SW1 has already used the sdm prefer global command to change to a setting that supports IPv4 routing, and the switch has been reloaded.|In this case, switch SW1 has already used the sdm prefer global command to change to a setting that supports IPv4 routing, and the switch has been reloaded.
The example shows the related configuration on all three VLAN interfaces.|The example shows the related configuration on all three VLAN interfaces.
|
Example 17-6 VLAN Interface Configuration for Layer 3 Switching Example end.|Example 17-6 VLAN Interface Configuration for Layer 3 Switching Example end.
#### Verifying Routing with SVIs
Verifying Routing with SVIs   
__|__
--|--
|
With the VLAN configuration shown in the previous section, the switch is ready to route packets between the VLANs as shown in Figure 17-3.|With the VLAN configuration shown in the previous section, the switch is ready to route packets between the VLANs as shown in Figure 17-3.
To support the routing of packets, the switch adds connected IP routes as shown in Example 17-7; note that each route is listed as being connected to a different VLAN interface.|To support the routing of packets, the switch adds connected IP routes as shown in Example 17-7; note that each route is listed as being connected to a different VLAN interface.
|
Example 17-7 Connected Routes on a Layer 3 Switch Example end.|Example 17-7 Connected Routes on a Layer 3 Switch Example end.
|
The switch would also need additional routes to the rest of the network (not shown in the figures in this chapter).|The switch would also need additional routes to the rest of the network (not shown in the figures in this chapter).
The Layer 3 switch could use static routes or a routing protocol, depending on the capabilities of the switch.|The Layer 3 switch could use static routes or a routing protocol, depending on the capabilities of the switch.
For instance, if you then enabled OSPF on the Layer 3 switch, the configuration and verification would work the same as it does on a router, as discussed in Chapter 20, “Implementing OSPF.” The routes that IOS adds to the Layer 3 switch’s IP routing table would list the VLAN interfaces as outgoing interfaces.|For instance, if you then enabled OSPF on the Layer 3 switch, the configuration and verification would work the same as it does on a router, as discussed in Chapter 20, “Implementing OSPF.” The routes that IOS adds to the Layer 3 switch’s IP routing table would list the VLAN interfaces as outgoing interfaces.
|
NOTE Some models of Cisco enterprise switches, based on model, IOS version, and IOS feature set, support different capabilities for IP routing and routing protocols, so for real networks, check the capabilities of the switch model by browsing at Cisco.com.|NOTE Some models of Cisco enterprise switches, based on model, IOS version, and IOS feature set, support different capabilities for IP routing and routing protocols, so for real networks, check the capabilities of the switch model by browsing at Cisco.com.
In particular, check the Cisco Feature Navigator (CFN) tool at http://www.cisco.com/go/cfn.|In particular, check the Cisco Feature Navigator (CFN) tool at http://www.cisco.com/go/cfn.
#### Troubleshooting Routing with SVIs
Troubleshooting Routing with SVIs   
__|__
--|--
|
There are two big topics to investigate when troubleshooting routing over LANs with SVIs.|There are two big topics to investigate when troubleshooting routing over LANs with SVIs.
|
First, you have to make sure the switch has been enabled to support IP routing.|First, you have to make sure the switch has been enabled to support IP routing.
Second, the VLAN associated with each VLAN interface must be known and active on the local switch;|Second, the VLAN associated with each VLAN interface must be known and active on the local switch;
|
otherwise, the VLAN interfaces do not come up.|otherwise, the VLAN interfaces do not come up.
|
First, about enabling IP routing, note that some models of Cisco switches default to enable Layer 3 switching, and some do not.|First, about enabling IP routing, note that some models of Cisco switches default to enable Layer 3 switching, and some do not.
So, to make sure your switch supports Layer 3 routing, look to those first few configuration commands listed in the configuration checklist found in the earlier section “Configuring Routing Using Switch SVIs.” Those commands are sdm prefer (followed by a reload) and then ip routing (after the reload).|So, to make sure your switch supports Layer 3 routing, look to those first few configuration commands listed in the configuration checklist found in the earlier section “Configuring Routing Using Switch SVIs.” Those commands are sdm prefer (followed by a reload) and then ip routing (after the reload).
|
The sdm prefer command changes how the switch forwarding chips allocate memory for different forwarding tables, and changes to those tables require a reload of the switch.|The sdm prefer command changes how the switch forwarding chips allocate memory for different forwarding tables, and changes to those tables require a reload of the switch.
By default, many access switches that support Layer 3 switching still have an SDM default that does not allocate space for an IP routing table.|By default, many access switches that support Layer 3 switching still have an SDM default that does not allocate space for an IP routing table.
Once changed and reloaded, the ip routing command then enables IPv4 routing in IOS software.|Once changed and reloaded, the ip routing command then enables IPv4 routing in IOS software.
Both are necessary before some Cisco switches will act as a Layer 3 switch.|Both are necessary before some Cisco switches will act as a Layer 3 switch.
|
Example 17-8 shows some symptoms on a router for which Layer 3 switching had not yet been enabled by the sdm prefer command.|Example 17-8 shows some symptoms on a router for which Layer 3 switching had not yet been enabled by the sdm prefer command.
As you can see, both the show ip route EXEC command and the ip routing config command are rejected because they do not exist to IOS until the sdm prefer command has been used (followed by a reload of the switch).|As you can see, both the show ip route EXEC command and the ip routing config command are rejected because they do not exist to IOS until the sdm prefer command has been used (followed by a reload of the switch).
|
Example 17-8 Evidence That a Switch Has Not Yet Enabled IPv4 Routing Example end.|Example 17-8 Evidence That a Switch Has Not Yet Enabled IPv4 Routing Example end.
|
The second big area to investigate when troubleshooting SVIs relates to the SVI state, a state that ties to the state of the associated VLANs. Each VLAN interface has a matching VLAN of the same number, and the VLAN interface’s state is tied to the state of the VLAN in certain ways.|The second big area to investigate when troubleshooting SVIs relates to the SVI state, a state that ties to the state of the associated VLANs. Each VLAN interface has a matching VLAN of the same number, and the VLAN interface’s state is tied to the state of the VLAN in certain ways.
In particular, for a VLAN interface to be in an up/up state:|In particular, for a VLAN interface to be in an up/up state:
|
Step 1.|Step 1.
The VLAN must be defined on the local switch (either explicitly or learned with VTP).|The VLAN must be defined on the local switch (either explicitly or learned with VTP).
|
Step 2.|Step 2.
The switch must have at least one up/up interface using the VLAN, either/both:|The switch must have at least one up/up interface using the VLAN, either/both:
|
A. An up/up access interface assigned to that VLAN B.|A. An up/up access interface assigned to that VLAN B.
A trunk interface for which the VLAN is in the allowed list, is STP forwarding, and is not VTP pruned Step 3.|A trunk interface for which the VLAN is in the allowed list, is STP forwarding, and is not VTP pruned Step 3.
The VLAN (not the VLAN interface) must be administratively enabled (that is, not shutdown).|The VLAN (not the VLAN interface) must be administratively enabled (that is, not shutdown).
|
Step 4.|Step 4.
The VLAN interface (not the VLAN) must be administratively enabled (that is, not shutdown).|The VLAN interface (not the VLAN) must be administratively enabled (that is, not shutdown).
|
When working through the steps in the list, keep in mind that the VLAN and the VLAN interface are related but separate ideas, and the configuration items are separate in the CLI.|When working through the steps in the list, keep in mind that the VLAN and the VLAN interface are related but separate ideas, and the configuration items are separate in the CLI.
|
The VLAN interface is a switch’s Layer 3 interface connected to the VLAN. If you want to route packets for the subnets on VLANs 11, 12, and 13, the matching VLAN interfaces must be numbered 11, 12, and 13.|The VLAN interface is a switch’s Layer 3 interface connected to the VLAN. If you want to route packets for the subnets on VLANs 11, 12, and 13, the matching VLAN interfaces must be numbered 11, 12, and 13.
And both the VLANs and the VLAN interfaces can be disabled and enabled with the shutdown and no shutdown commands (as mentioned in Steps 3 and 4 in the previous list), so you have to check for both.|And both the VLANs and the VLAN interfaces can be disabled and enabled with the shutdown and no shutdown commands (as mentioned in Steps 3 and 4 in the previous list), so you have to check for both.
|
Example 17-9 shows three scenarios, each of which leads to one of the VLAN interfaces in the previous configuration example (Figure 17-3, Example 17-6) to fail.|Example 17-9 shows three scenarios, each of which leads to one of the VLAN interfaces in the previous configuration example (Figure 17-3, Example 17-6) to fail.
At the beginning of the example, all three VLAN interfaces are up/up.|At the beginning of the example, all three VLAN interfaces are up/up.
VLANs 10, 20, and 30 each have at least one access interface up and working.|VLANs 10, 20, and 30 each have at least one access interface up and working.
The example works through three scenarios:|The example works through three scenarios:
###### Scenario 1: The last access interface in VLAN 10 is shut down (F0/1), so IOS shuts down
Scenario 1: The last access interface in VLAN 10 is shut down (F0/1), so IOS shuts down   
__|__
--|--
|
the VLAN 10 interface.|the VLAN 10 interface.
###### Scenario 2: VLAN 20 (not VLAN interface 20, but VLAN 20) is deleted, which results in
Scenario 2: VLAN 20 (not VLAN interface 20, but VLAN 20) is deleted, which results in   
__|__
--|--
|
IOS then bringing down (not shutting down) the VLAN 20 interface.|IOS then bringing down (not shutting down) the VLAN 20 interface.
###### Scenario 3: VLAN 30 (not VLAN interface 30, but VLAN 30) is shut down, which results
Scenario 3: VLAN 30 (not VLAN interface 30, but VLAN 30) is shut down, which results   
__|__
--|--
|
in IOS then bringing down (not shutting down) the VLAN 30 interface.|in IOS then bringing down (not shutting down) the VLAN 30 interface.
|
Example 17-9 Three Examples That Cause VLAN Interfaces to Fail Example end.|Example 17-9 Three Examples That Cause VLAN Interfaces to Fail Example end.
|
Note that the example ends with the three VLAN interfaces in an up/down state per the show ip interface brief command.|Note that the example ends with the three VLAN interfaces in an up/down state per the show ip interface brief command.
### VLAN Routing with Layer 3 Switch Routed Ports
VLAN Routing with Layer 3 Switch Routed Ports   
__|__
--|--
|
When Layer 3 switches use SVIs, the physical interfaces on the switches act like they always have: as Layer 2 interfaces.|When Layer 3 switches use SVIs, the physical interfaces on the switches act like they always have: as Layer 2 interfaces.
That is, the physical interfaces receive Ethernet frames.|That is, the physical interfaces receive Ethernet frames.
The switch learns the source MAC address of the frame, and the switch forwards the frame based on the destination MAC address.|The switch learns the source MAC address of the frame, and the switch forwards the frame based on the destination MAC address.
To perform routing, any Ethernet frames destined for any of the SVI interface MAC addresses trigger the processing of the Layer 2 switching logic, resulting in normal routing actions like stripping data-link headers, making a routing decision, and so on.|To perform routing, any Ethernet frames destined for any of the SVI interface MAC addresses trigger the processing of the Layer 2 switching logic, resulting in normal routing actions like stripping data-link headers, making a routing decision, and so on.
|
Alternately, the Layer 3 switch configuration can make a physical port act like a router interface instead of a switch interface.|Alternately, the Layer 3 switch configuration can make a physical port act like a router interface instead of a switch interface.
To do so, the switch configuration makes that port a routed port.|To do so, the switch configuration makes that port a routed port.
On a routed port, the switch does not perform Layer 2 switching logic on that frame.|On a routed port, the switch does not perform Layer 2 switching logic on that frame.
Instead, frames arriving in a routed port trigger the Layer 3 routing logic, including 1.|Instead, frames arriving in a routed port trigger the Layer 3 routing logic, including 1.
Stripping off the incoming frame’s Ethernet data-link header/trailer 2.|Stripping off the incoming frame’s Ethernet data-link header/trailer 2.
Making a Layer 3 forwarding decision by comparing the destination IP address to the IP routing table 3.|Making a Layer 3 forwarding decision by comparing the destination IP address to the IP routing table 3.
Adding a new Ethernet data-link header/trailer to the packet 4.|Adding a new Ethernet data-link header/trailer to the packet 4.
Forwarding the packet, encapsulated in a new frame This third major section of the chapter examines routed interfaces as configured on Cisco Layer 3 switches, but with a particular goal in mind: to also discuss Layer 3 EtherChannels.|Forwarding the packet, encapsulated in a new frame This third major section of the chapter examines routed interfaces as configured on Cisco Layer 3 switches, but with a particular goal in mind: to also discuss Layer 3 EtherChannels.
|
The exam topics do not mention routed interfaces specifically, but the exam topics do mention L3 EtherChannels, meaning Layer 3 EtherChannels.|The exam topics do not mention routed interfaces specifically, but the exam topics do mention L3 EtherChannels, meaning Layer 3 EtherChannels.
|
You might recall that Chapter 10, “RSTP and EtherChannel Configuration,” discussed Layer 2 EtherChannels.|You might recall that Chapter 10, “RSTP and EtherChannel Configuration,” discussed Layer 2 EtherChannels.
Like Layer 2 EtherChannels, Layer 3 EtherChannels also treat multiple links as one link.|Like Layer 2 EtherChannels, Layer 3 EtherChannels also treat multiple links as one link.
Unlike Layer 2 EtherChannels, however, Layer 3 EtherChannels treat the channel as a routed port instead of switched port.|Unlike Layer 2 EtherChannels, however, Layer 3 EtherChannels treat the channel as a routed port instead of switched port.
So this section first looks at routed ports on Cisco Layer 3 switches and then discusses Layer 3 EtherChannels.|So this section first looks at routed ports on Cisco Layer 3 switches and then discusses Layer 3 EtherChannels.
#### Implementing Routed Interfaces on Switches
Implementing Routed Interfaces on Switches   
__|__
--|--
|
When a Layer 3 switch needs a Layer 3 interface connected to a subnet, and only one physical interface connects to that subnet, the network engineer can choose to use a routed port instead of an SVI. Conversely, when the Layer 3 switch needs a Layer 3 interface connected to a subnet, and many physical interfaces on the switch connect to that subnet, an SVI needs to be used. (SVIs forward traffic internally into the VLAN, so that then the Layer 2 logic can forward the frame out any of the ports in the VLAN. Routed ports cannot.)|When a Layer 3 switch needs a Layer 3 interface connected to a subnet, and only one physical interface connects to that subnet, the network engineer can choose to use a routed port instead of an SVI. Conversely, when the Layer 3 switch needs a Layer 3 interface connected to a subnet, and many physical interfaces on the switch connect to that subnet, an SVI needs to be used. (SVIs forward traffic internally into the VLAN, so that then the Layer 2 logic can forward the frame out any of the ports in the VLAN. Routed ports cannot.)
|
To see why, consider the design in Figure 17-4, which repeats the same design from Figure 17-3 (used in the SVI examples).|To see why, consider the design in Figure 17-4, which repeats the same design from Figure 17-3 (used in the SVI examples).
In that design, the gray rectangle on the right represents the switch and its internals.|In that design, the gray rectangle on the right represents the switch and its internals.
On the right of the switch, at least two access ports sit in both VLAN 10 and VLAN 20.|On the right of the switch, at least two access ports sit in both VLAN 10 and VLAN 20.
However, that figure shows a single link from the switch to Router B1. The switch could configure the port as an access port in a separate VLAN, as shown with VLAN 30 in Examples 17-6 and 17-7.|However, that figure shows a single link from the switch to Router B1. The switch could configure the port as an access port in a separate VLAN, as shown with VLAN 30 in Examples 17-6 and 17-7.
However, with only one switch port needed, the switch could configure that link as a routed port, as shown in the figure.|However, with only one switch port needed, the switch could configure that link as a routed port, as shown in the figure.
|
Figure 17-4 Routing on a Routed Interface on a Switch Enabling a switch interface to be a routed interface instead of a switched interface is simple:|Figure 17-4 Routing on a Routed Interface on a Switch Enabling a switch interface to be a routed interface instead of a switched interface is simple:
|
just use the no switchport subcommand on the physical interface.|just use the no switchport subcommand on the physical interface.
Cisco switches capable of being a Layer 3 switch use a default of the switchport command to each switch physical interface.|Cisco switches capable of being a Layer 3 switch use a default of the switchport command to each switch physical interface.
Think about the word switchport for a moment.|Think about the word switchport for a moment.
With that term, Cisco tells the switch to treat the port like it is a port on a switch—that is, a Layer 2 port on a switch.|With that term, Cisco tells the switch to treat the port like it is a port on a switch—that is, a Layer 2 port on a switch.
To make the port stop acting like a switch port and instead act like a router port, use the no switchport command on the interface.|To make the port stop acting like a switch port and instead act like a router port, use the no switchport command on the interface.
|
Once the port is acting as a routed port, think of it like a router interface.|Once the port is acting as a routed port, think of it like a router interface.
That is, configure the IP address on the physical port, as implied in Figure 17-4.|That is, configure the IP address on the physical port, as implied in Figure 17-4.
Example 17-10 shows a completed configuration for the interfaces configured on the switch in Figure 17-4.|Example 17-10 shows a completed configuration for the interfaces configured on the switch in Figure 17-4.
Note that the design uses the exact same IP subnets as the example that showed SVI configuration in Example 17-6, but now, the port connected to subnet 10.1.30.0 has been converted to a routed port.|Note that the design uses the exact same IP subnets as the example that showed SVI configuration in Example 17-6, but now, the port connected to subnet 10.1.30.0 has been converted to a routed port.
All you have to do is add the no switchport command to the physical interface and configure the IP address on the physical interface.|All you have to do is add the no switchport command to the physical interface and configure the IP address on the physical interface.
|
Example 17-10 Configuring Interface G0/1 on Switch SW1 as a Routed Port Example end.|Example 17-10 Configuring Interface G0/1 on Switch SW1 as a Routed Port Example end.
|
Once configured, the routed interface will show up differently in command output in the switch.|Once configured, the routed interface will show up differently in command output in the switch.
In particular, for an interface configured as a routed port with an IP address, like interface GigabitEthernet0/1 in the previous example:|In particular, for an interface configured as a routed port with an IP address, like interface GigabitEthernet0/1 in the previous example:
|
show interfaces: Similar to the same command on a router, the output will display the IP address of the interface. (Conversely, for switch ports, this command does not list an IP address.)|show interfaces: Similar to the same command on a router, the output will display the IP address of the interface. (Conversely, for switch ports, this command does not list an IP address.)
|
show interfaces status: Under the “VLAN” heading, instead of listing the access VLAN or the word trunk, the output lists the word routed, meaning that it is a routed port.|show interfaces status: Under the “VLAN” heading, instead of listing the access VLAN or the word trunk, the output lists the word routed, meaning that it is a routed port.
|
show ip route: Lists the routed port as an outgoing interface in routes.|show ip route: Lists the routed port as an outgoing interface in routes.
|
show interfaces type number switchport: If a routed port, the output is short and confirms that the port is not a switch port. (If the port is a Layer 2 port, this command lists many configuration and status details.)|show interfaces type number switchport: If a routed port, the output is short and confirms that the port is not a switch port. (If the port is a Layer 2 port, this command lists many configuration and status details.)
|
Example 17-11 shows samples of all four of these commands as taken from the switch as configured in Example 17-10.|Example 17-11 shows samples of all four of these commands as taken from the switch as configured in Example 17-10.
|
Example 17-11 Verification Commands for Routed Ports on Switches Example end.|Example 17-11 Verification Commands for Routed Ports on Switches Example end.
|
So, with two options—SVI and routed ports—where should you use each?|So, with two options—SVI and routed ports—where should you use each?
|
For any topologies with a point-to-point link between two devices that do routing, a routed interface works well.|For any topologies with a point-to-point link between two devices that do routing, a routed interface works well.
|
Figure 17-5 shows an example of where to use SVIs and where to use routed ports in a typical core/distribution/access design.|Figure 17-5 shows an example of where to use SVIs and where to use routed ports in a typical core/distribution/access design.
In this design, the core (Core1, Core2) and distribution (D11 through D14) switches perform Layer 3 switching.|In this design, the core (Core1, Core2) and distribution (D11 through D14) switches perform Layer 3 switching.
All the ports that are links directly between the Layer 3 switches can be routed interfaces.|All the ports that are links directly between the Layer 3 switches can be routed interfaces.
For VLANs for which many interfaces (access and trunk) connect to the VLAN, SVIs make sense because the SVIs can send and receive traffic out multiple ports on the same switch.|For VLANs for which many interfaces (access and trunk) connect to the VLAN, SVIs make sense because the SVIs can send and receive traffic out multiple ports on the same switch.
In this design, all the ports on Core1 and Core2 will be routed ports, while the four distribution switches will use some routed ports and some SVIs.|In this design, all the ports on Core1 and Core2 will be routed ports, while the four distribution switches will use some routed ports and some SVIs.
|
Figure 17-5 Using Routed Interfaces for Core and Distribution Layer 3 Links|Figure 17-5 Using Routed Interfaces for Core and Distribution Layer 3 Links
#### Implementing Layer 3 EtherChannels
Implementing Layer 3 EtherChannels   
__|__
--|--
|
So far, this section has stated that routed interfaces can be used with a single point-to-point link between pairs of Layer 3 switches, or between a Layer 3 switch and a router.|So far, this section has stated that routed interfaces can be used with a single point-to-point link between pairs of Layer 3 switches, or between a Layer 3 switch and a router.
However, in most designs, the network engineers use at least two links between each pair of distribution and core switches, as shown in Figure 17-6.|However, in most designs, the network engineers use at least two links between each pair of distribution and core switches, as shown in Figure 17-6.
|
Figure 17-6 Two Links Between Each Distribution and Core Switch While each individual port in the distribution and core could be treated as a separate routed port, it is better to combine each pair of parallel links into a Layer 3 EtherChannel.|Figure 17-6 Two Links Between Each Distribution and Core Switch While each individual port in the distribution and core could be treated as a separate routed port, it is better to combine each pair of parallel links into a Layer 3 EtherChannel.
Without using EtherChannel, you can still make each port on each switch in the center of the figure be a routed port.|Without using EtherChannel, you can still make each port on each switch in the center of the figure be a routed port.
It works.|It works.
However, once you enable a routing protocol but don’t use EtherChannels, each Layer 3 switch will now learn two IP routes with the same neighboring switch as the next hop—one route over one link, another route over the other link.|However, once you enable a routing protocol but don’t use EtherChannels, each Layer 3 switch will now learn two IP routes with the same neighboring switch as the next hop—one route over one link, another route over the other link.
|
Using a Layer 3 EtherChannel makes more sense with multiple parallel links between two switches.|Using a Layer 3 EtherChannel makes more sense with multiple parallel links between two switches.
By doing so, each pair of links acts as one Layer 3 link.|By doing so, each pair of links acts as one Layer 3 link.
So, each pair of switches has one routing protocol neighbor relationship with the neighbor, and not two.|So, each pair of switches has one routing protocol neighbor relationship with the neighbor, and not two.
Each switch learns one route per destination per pair of links, and not two.|Each switch learns one route per destination per pair of links, and not two.
IOS then balances the traffic, often with better balancing than the balancing that occurs with the use of multiple IP routes to the same subnet.|IOS then balances the traffic, often with better balancing than the balancing that occurs with the use of multiple IP routes to the same subnet.
Overall, the Layer 3 EtherChannel approach works much better than leaving each link as a separate routed port and using Layer 3 balancing.|Overall, the Layer 3 EtherChannel approach works much better than leaving each link as a separate routed port and using Layer 3 balancing.
|
Compared to what you have already learned, configuring a Layer 3 EtherChannel takes only a little more work.|Compared to what you have already learned, configuring a Layer 3 EtherChannel takes only a little more work.
Chapter 10 already showed you how to configure an EtherChannel.|Chapter 10 already showed you how to configure an EtherChannel.
This chapter has already shown how to make a port a Layer 3 routed port.|This chapter has already shown how to make a port a Layer 3 routed port.
Next, you have to combine the two ideas by combining both the EtherChannel and routed port configuration.|Next, you have to combine the two ideas by combining both the EtherChannel and routed port configuration.
|
The following checklist shows the steps, assuming a static definition.|The following checklist shows the steps, assuming a static definition.
|
Step 1.|Step 1.
Configure the physical interfaces as follows, in interface configuration mode:|Configure the physical interfaces as follows, in interface configuration mode:
|
A. Add the channel-group number mode on command to add it to the channel.|A. Add the channel-group number mode on command to add it to the channel.
|
Use the same number for all physical interfaces on the same switch, but the number used (the channel-group number) can differ on the two neighboring switches.|Use the same number for all physical interfaces on the same switch, but the number used (the channel-group number) can differ on the two neighboring switches.
|
B. Add the no switchport command to make each physical port a routed port.|B. Add the no switchport command to make each physical port a routed port.
|
Step 2.|Step 2.
Configure the PortChannel interface:|Configure the PortChannel interface:
|
A. Use the interface port-channel number command to move to port-channel configuration mode for the same channel number configured on the physical interfaces.|A. Use the interface port-channel number command to move to port-channel configuration mode for the same channel number configured on the physical interfaces.
|
B. Add the no switchport command to make sure that the port-channel interface acts as a routed port. (IOS may have already added this command.)|B. Add the no switchport command to make sure that the port-channel interface acts as a routed port. (IOS may have already added this command.)
|
C. Use the ip address address mask command to configure the address and mask.|C. Use the ip address address mask command to configure the address and mask.
|
NOTE Cisco uses the term EtherChannel in concepts discussed in this section and then uses the term PortChannel, with command keyword port-channel, when verifying and configuring EtherChannels.|NOTE Cisco uses the term EtherChannel in concepts discussed in this section and then uses the term PortChannel, with command keyword port-channel, when verifying and configuring EtherChannels.
For the purposes of understanding the technology, you may treat these terms as synonyms.|For the purposes of understanding the technology, you may treat these terms as synonyms.
However, it helps to pay close attention to the use of the terms PortChannel and EtherChannel as you work through the examples in this section because IOS uses both.|However, it helps to pay close attention to the use of the terms PortChannel and EtherChannel as you work through the examples in this section because IOS uses both.
|
Example 17-12 shows an example of the configuration for a Layer 3 EtherChannel for switch SW1 in Figure 17-7.|Example 17-12 shows an example of the configuration for a Layer 3 EtherChannel for switch SW1 in Figure 17-7.
The EtherChannel defines port-channel interface 12 and uses subnet|The EtherChannel defines port-channel interface 12 and uses subnet
###### 10.1.12.0/24.
10.1.12.0/24.   
__|__
--|--
|
Figure 17-7 Design Used in EtherChannel Configuration Examples Config Checklist Example 17-12 Layer 3 EtherChannel Configuration on Switch SW1 Example end.|Figure 17-7 Design Used in EtherChannel Configuration Examples Config Checklist Example 17-12 Layer 3 EtherChannel Configuration on Switch SW1 Example end.
|
Of particular importance, note that although the physical interfaces and PortChannel interface are all routed ports, the IP address should be placed on the PortChannel interface only.|Of particular importance, note that although the physical interfaces and PortChannel interface are all routed ports, the IP address should be placed on the PortChannel interface only.
In fact, when the no switchport command is configured on an interface, IOS adds the no ip address command to the interface.|In fact, when the no switchport command is configured on an interface, IOS adds the no ip address command to the interface.
Then configure the IP address on the PortChannel interface only.|Then configure the IP address on the PortChannel interface only.
|
Once configured, the PortChannel interface appears in several commands, as shown in Example 17-13.|Once configured, the PortChannel interface appears in several commands, as shown in Example 17-13.
The commands that list IP addresses and routes refer to the PortChannel interface.|The commands that list IP addresses and routes refer to the PortChannel interface.
Also, note that the show interfaces status command lists the fact that the physical ports and the port-channel 12 interface are all routed ports.|Also, note that the show interfaces status command lists the fact that the physical ports and the port-channel 12 interface are all routed ports.
|
Example 17-13 Verification Commands Listing Interface Port-Channel 12 from Switch Example end.|Example 17-13 Verification Commands Listing Interface Port-Channel 12 from Switch Example end.
|
For a final bit of verification, you can examine the EtherChannel directly with the show etherchannel summary command as listed in Example 17-14.|For a final bit of verification, you can examine the EtherChannel directly with the show etherchannel summary command as listed in Example 17-14.
Note in particular that it lists a flag legend for characters that identify key operational states, such as whether a port is bundled (included) in the PortChannel (P) and whether it is acting as a routed (R) or switched (S) port.|Note in particular that it lists a flag legend for characters that identify key operational states, such as whether a port is bundled (included) in the PortChannel (P) and whether it is acting as a routed (R) or switched (S) port.
|
Example 17-14 Verifying the EtherChannel Example end.|Example 17-14 Verifying the EtherChannel Example end.
#### Troubleshooting Layer 3 EtherChannels
Troubleshooting Layer 3 EtherChannels   
__|__
--|--
|
When you are troubleshooting a Layer 3 EtherChannel, there are two main areas to consider.|When you are troubleshooting a Layer 3 EtherChannel, there are two main areas to consider.
|
First, you need to look at the configuration of the channel-group command, which enables an interface for an EtherChannel.|First, you need to look at the configuration of the channel-group command, which enables an interface for an EtherChannel.
Second, you should check a list of settings that must match on the interfaces for a Layer 3 EtherChannel to work correctly.|Second, you should check a list of settings that must match on the interfaces for a Layer 3 EtherChannel to work correctly.
|
As for the channel-group interface subcommand, this command can enable EtherChannel statically or dynamically.|As for the channel-group interface subcommand, this command can enable EtherChannel statically or dynamically.
If dynamic, this command’s keywords imply either Port Aggregation Protocol (PaGP) or Link Aggregation Control Protocol (LACP) as the protocol to negotiate between the neighboring switches whether they put the link into the EtherChannel.|If dynamic, this command’s keywords imply either Port Aggregation Protocol (PaGP) or Link Aggregation Control Protocol (LACP) as the protocol to negotiate between the neighboring switches whether they put the link into the EtherChannel.
|
If all this sounds vaguely familiar, it is the exact same configuration covered way back in the Chapter 10 section “Configuring Dynamic EtherChannels.” The configuration of the channel-group subcommand is exactly the same, with the same requirements, whether configuring Layer 2 or Layer 3 EtherChannels.|If all this sounds vaguely familiar, it is the exact same configuration covered way back in the Chapter 10 section “Configuring Dynamic EtherChannels.” The configuration of the channel-group subcommand is exactly the same, with the same requirements, whether configuring Layer 2 or Layer 3 EtherChannels.
So, it might be a good time to review those EtherChannel configuration details from Chapter 10.|So, it might be a good time to review those EtherChannel configuration details from Chapter 10.
However, regardless of when you review and master those commands, note that the configuration of the EtherChannel (with the channel-group subcommand) is the same, whether Layer 2 or Layer 3.|However, regardless of when you review and master those commands, note that the configuration of the EtherChannel (with the channel-group subcommand) is the same, whether Layer 2 or Layer 3.
|
Additionally, you must do more than just configure the channel-group command correctly for all the physical ports to be bundled into the EtherChannel.|Additionally, you must do more than just configure the channel-group command correctly for all the physical ports to be bundled into the EtherChannel.
Layer 2 EtherChannels have a longer list of requirements, but Layer 3 EtherChannels also require a few consistency checks between the ports before they can be added to the EtherChannel.|Layer 2 EtherChannels have a longer list of requirements, but Layer 3 EtherChannels also require a few consistency checks between the ports before they can be added to the EtherChannel.
The following is the list of requirements for Layer 3 EtherChannels:|The following is the list of requirements for Layer 3 EtherChannels:
|
no switchport: The PortChannel interface must be configured with the no switchport command, and so must the physical interfaces.|no switchport: The PortChannel interface must be configured with the no switchport command, and so must the physical interfaces.
If a physical interface is not also configured with the no switchport command, it will not become operational in the EtherChannel.|If a physical interface is not also configured with the no switchport command, it will not become operational in the EtherChannel.
|
Speed: The physical ports in the channel must use the same speed.|Speed: The physical ports in the channel must use the same speed.
|
duplex: The physical ports in the channel must use the same duplex.|duplex: The physical ports in the channel must use the same duplex.
### Chapter Review
Chapter Review   
__|__
--|--
|
One key to doing well on the exams is to perform repetitive spaced review sessions.|One key to doing well on the exams is to perform repetitive spaced review sessions.
Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.|Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.
Refer to the “Your Study Plan” element for more details.|Refer to the “Your Study Plan” element for more details.
Table 17-2 outlines the key review elements and where you can find them.|Table 17-2 outlines the key review elements and where you can find them.
To better track your study progress, record when you completed these activities in the second column.|To better track your study progress, record when you completed these activities in the second column.
|
Table 17-2 Chapter Review Tracking Table end.|Table 17-2 Chapter Review Tracking Table end.
|
Review All the Key Topics Key Terms You Should Know router-on-a-stick (ROAS), switched virtual interface (SVI), VLAN interface, Layer 3 EtherChannel (L3 EtherChannel), routed port, Layer 3 switch, multilayer switch, subinterfaces Command References Tables 17-4 and 17-5 list configuration and verification commands used in this chapter.|Review All the Key Topics Key Terms You Should Know router-on-a-stick (ROAS), switched virtual interface (SVI), VLAN interface, Layer 3 EtherChannel (L3 EtherChannel), routed port, Layer 3 switch, multilayer switch, subinterfaces Command References Tables 17-4 and 17-5 list configuration and verification commands used in this chapter.
As an easy review exercise, cover the left column in a table, read the right column, and try to recall the command without looking.|As an easy review exercise, cover the left column in a table, read the right column, and try to recall the command without looking.
Then repeat the exercise, covering the right column, and try to recall what the command does.|Then repeat the exercise, covering the right column, and try to recall what the command does.
|
Table 17-4 Chapter 17 Configuration Command Reference Table end.|Table 17-4 Chapter 17 Configuration Command Reference Table end.
|
Table 17-5 Chapter 17 EXEC Command Reference Table end.|Table 17-5 Chapter 17 EXEC Command Reference Table end.
## Chapter 18 Troubleshooting IPv4 Routing
Chapter 18 Troubleshooting IPv4 Routing   
__|__
--|--
|
This chapter covers the following exam topics:|This chapter covers the following exam topics:
###### 1.0 Network Fundamentals
1.0 Network Fundamentals   
###### 1.6 Configure and verify IPv4 addressing and subnetting
1.6 Configure and verify IPv4 addressing and subnetting   
###### 3.0 IP Connectivity
3.0 IP Connectivity   
###### 3.3 Configure and verify IPv4 and IPv6 static routing
3.3 Configure and verify IPv4 and IPv6 static routing   
###### 3.3.a Default route
3.3.a Default route   
###### 3.3.b Network route
3.3.b Network route   
###### 3.3.c Host route
3.3.c Host route   
###### 3.3.d Floating static
3.3.d Floating static   
__|__
--|--
|
The first three chapters in this part of the book took you from a starting point of understanding IP addressing and subnetting to the details of implementing IP addressing, routing between connected subnets, and configuring static routes.|The first three chapters in this part of the book took you from a starting point of understanding IP addressing and subnetting to the details of implementing IP addressing, routing between connected subnets, and configuring static routes.
All those steps include the idea of configuring a command and seeing a route show up in the IP routing table on that same router.|All those steps include the idea of configuring a command and seeing a route show up in the IP routing table on that same router.
|
This chapter turns our attention to routing from end-to-end across an entire enterprise network.|This chapter turns our attention to routing from end-to-end across an entire enterprise network.
|
How do you troubleshoot an IPv4 network?|How do you troubleshoot an IPv4 network?
How do you verify correct operation, identify root causes, and fix those for various IP routing features?|How do you verify correct operation, identify root causes, and fix those for various IP routing features?
How do you do that in the presence of an IP addressing and subnetting plan, requiring you to apply all that subnetting math from Part IV of this book and the basic address/mask and static route configuration from the other chapters here in Part V?|How do you do that in the presence of an IP addressing and subnetting plan, requiring you to apply all that subnetting math from Part IV of this book and the basic address/mask and static route configuration from the other chapters here in Part V?
This chapter answers some of those questions.|This chapter answers some of those questions.
|
In particular, this chapter focuses on two tools and how to use them: ping and traceroute.|In particular, this chapter focuses on two tools and how to use them: ping and traceroute.
|
Both tools test the IPv4 data plane; that is, the ability of each networking device to route or forward IPv4 packets.|Both tools test the IPv4 data plane; that is, the ability of each networking device to route or forward IPv4 packets.
This chapter devotes a major section each to ping and traceroute.|This chapter devotes a major section each to ping and traceroute.
The chapter then ends with a short discussion of two other router tools that can also be useful for troubleshooting: Telnet and Secure Shell (SSH).|The chapter then ends with a short discussion of two other router tools that can also be useful for troubleshooting: Telnet and Secure Shell (SSH).
### “Do I Know This Already?” Quiz
“Do I Know This Already?” Quiz   
__|__
--|--
|
I put DIKTA quizzes in most of the chapters as a tool to help you decide how to approach reading a chapter.|I put DIKTA quizzes in most of the chapters as a tool to help you decide how to approach reading a chapter.
However, this chapter does not have a DIKTA quiz because I think you should read it regardless of your prior knowledge.|However, this chapter does not have a DIKTA quiz because I think you should read it regardless of your prior knowledge.
As with all chapters in this book, this chapter introduces new concepts, but it also acts as a tool to review and deepen your understanding of IP routing.|As with all chapters in this book, this chapter introduces new concepts, but it also acts as a tool to review and deepen your understanding of IP routing.
I hope you enjoy the perspectives on using ping and traceroute in this chapter.|I hope you enjoy the perspectives on using ping and traceroute in this chapter.
|
CHAPTER 18|CHAPTER 18
### Foundation Topics
Foundation Topics   
### Problem Isolation Using the ping Command
Problem Isolation Using the ping Command   
__|__
--|--
|
Someone sends you an email or text, or a phone message, asking you to look into a user’s network problem.|Someone sends you an email or text, or a phone message, asking you to look into a user’s network problem.
You Secure Shell (SSH) to a router and issue a ping command that works.|You Secure Shell (SSH) to a router and issue a ping command that works.
|
What does that result rule out as a possible reason for the problem?|What does that result rule out as a possible reason for the problem?
What does it rule in as still being a possible root cause?|What does it rule in as still being a possible root cause?
|
Then you issue another ping to another address, and this time the ping fails.|Then you issue another ping to another address, and this time the ping fails.
Again, what does the failure of that ping command tell you?|Again, what does the failure of that ping command tell you?
What parts of IPv4 routing may still be a problem, and what parts do you now know are not a problem?|What parts of IPv4 routing may still be a problem, and what parts do you now know are not a problem?
|
The ping command gives us one of the most common network troubleshooting tools.|The ping command gives us one of the most common network troubleshooting tools.
When the ping command succeeds, it confirms many individual parts of how IP routing works, ruling out some possible causes of the current problem.|When the ping command succeeds, it confirms many individual parts of how IP routing works, ruling out some possible causes of the current problem.
When a ping command fails, it often helps narrow down where in the internetwork the root cause of the problem may be happening, further isolating the problem.|When a ping command fails, it often helps narrow down where in the internetwork the root cause of the problem may be happening, further isolating the problem.
|
This section begins with a brief explanation of how ping works.|This section begins with a brief explanation of how ping works.
It then moves on to some suggestions and analysis of how to use the ping command to isolate problems by removing some items from consideration.|It then moves on to some suggestions and analysis of how to use the ping command to isolate problems by removing some items from consideration.
#### Ping Command Basics
Ping Command Basics   
__|__
--|--
|
The ping command tests connectivity by sending packets to an IP address, expecting the device at that address to send packets back.|The ping command tests connectivity by sending packets to an IP address, expecting the device at that address to send packets back.
The command sends packets that mean “if you receive this packet, and it is addressed to you, send a reply back.” Each time the ping command sends one of these packets and receives the message sent back by the other host, the ping command knows a packet made it from the source host to the destination and back.|The command sends packets that mean “if you receive this packet, and it is addressed to you, send a reply back.” Each time the ping command sends one of these packets and receives the message sent back by the other host, the ping command knows a packet made it from the source host to the destination and back.
|
More formally, the ping command uses the Internet Control Message Protocol (ICMP), specifically the ICMP echo request and ICMP echo reply messages.|More formally, the ping command uses the Internet Control Message Protocol (ICMP), specifically the ICMP echo request and ICMP echo reply messages.
ICMP defines many other messages as well, but these two messages were made specifically for connectivity testing by commands like ping.|ICMP defines many other messages as well, but these two messages were made specifically for connectivity testing by commands like ping.
As a protocol, ICMP does not rely on TCP or UDP, and it does not use any application layer protocol.|As a protocol, ICMP does not rely on TCP or UDP, and it does not use any application layer protocol.
It functions as part of Layer 3, as a control protocol to assist IP by helping manage the IP network functions.|It functions as part of Layer 3, as a control protocol to assist IP by helping manage the IP network functions.
|
Figure 18-1 shows the ICMP messages, with IP headers, in an example.|Figure 18-1 shows the ICMP messages, with IP headers, in an example.
In this case, the user at host A opens a command prompt and issues the ping 172.16.2.101 command, testing connectivity to host B.|In this case, the user at host A opens a command prompt and issues the ping 172.16.2.101 command, testing connectivity to host B.
The command sends one echo request and waits (Step 1); host B receives the messages and sends back an echo reply (Step 2).|The command sends one echo request and waits (Step 1); host B receives the messages and sends back an echo reply (Step 2).
|
Figure 18-1 Concept Behind ping 172.16.2.101 on Host A The ping command is supported on many different devices and many common operating systems.|Figure 18-1 Concept Behind ping 172.16.2.101 on Host A The ping command is supported on many different devices and many common operating systems.
The command has many options: the name or IP address of the destination, how many times the command should send an echo request, how long the command should wait (timeout) for an echo reply, how big to make the packets, and many other options.|The command has many options: the name or IP address of the destination, how many times the command should send an echo request, how long the command should wait (timeout) for an echo reply, how big to make the packets, and many other options.
Example 18-1 shows a sample from host A, with the same command that matches the concept in Figure 18-1: a ping 172.16.2.101 command on host A.|Example 18-1 shows a sample from host A, with the same command that matches the concept in Figure 18-1: a ping 172.16.2.101 command on host A.
|
Example 18-1 Sample Output from Host A’s ping 172.16.2.101 Command Example end.|Example 18-1 Sample Output from Host A’s ping 172.16.2.101 Command Example end.
#### Strategies and Results When Testing with the ping Command
Strategies and Results When Testing with the ping Command   
__|__
--|--
|
Often, the person handling initial calls from users about problems (often called a customer support rep, or CSR) cannot issue ping commands from the user’s device.|Often, the person handling initial calls from users about problems (often called a customer support rep, or CSR) cannot issue ping commands from the user’s device.
In some cases, talking users through typing the right commands and making the right clicks on their machines can be a problem.|In some cases, talking users through typing the right commands and making the right clicks on their machines can be a problem.
Or, the user just might not be available.|Or, the user just might not be available.
As an alternative, using different ping commands from different routers can help isolate the problem.|As an alternative, using different ping commands from different routers can help isolate the problem.
|
The problem with using ping commands from routers, instead of from the host that has the problem, is that no single router ping command can exactly replicate a ping command done from the user’s device.|The problem with using ping commands from routers, instead of from the host that has the problem, is that no single router ping command can exactly replicate a ping command done from the user’s device.
However, each different ping command can help isolate a problem further.|However, each different ping command can help isolate a problem further.
The rest of this section of ping commands discusses troubleshooting IPv4 routing by using various ping commands from the command-line interface (CLI) of a router.|The rest of this section of ping commands discusses troubleshooting IPv4 routing by using various ping commands from the command-line interface (CLI) of a router.
##### Testing Longer Routes from Near the Source of the Problem
Testing Longer Routes from Near the Source of the Problem   
__|__
--|--
|
Most problems begin with some idea like “host X cannot communicate with host Y.” A great first troubleshooting step is to issue a ping command from X for host Y’s IP address.|Most problems begin with some idea like “host X cannot communicate with host Y.” A great first troubleshooting step is to issue a ping command from X for host Y’s IP address.
|
However, assuming the engineer does not have access to host X, the engineer can instead issue the ping from the router nearest X, typically the router acting as host X’s default gateway.|However, assuming the engineer does not have access to host X, the engineer can instead issue the ping from the router nearest X, typically the router acting as host X’s default gateway.
|
For instance, in Figure 18-1, imagine that the user of host A had called IT support with a problem related to sending packets to host B.|For instance, in Figure 18-1, imagine that the user of host A had called IT support with a problem related to sending packets to host B.
A ping 172.16.2.101 command on host A would be a great first troubleshooting step, but the CSR cannot access host A or get in touch with the user of host A.|A ping 172.16.2.101 command on host A would be a great first troubleshooting step, but the CSR cannot access host A or get in touch with the user of host A.
So, the CSR telnets to Router R1 and pings host B from there, as shown in Example 18-2.|So, the CSR telnets to Router R1 and pings host B from there, as shown in Example 18-2.
|
Example 18-2 Router R2 Pings Host B (Two Commands)|Example 18-2 Router R2 Pings Host B (Two Commands)
|
Example end.|Example end.
|
First, take a moment to review the output of the first IOS ping command.|First, take a moment to review the output of the first IOS ping command.
By default, the Cisco IOS ping command sends five echo messages, with a timeout of 2 seconds.|By default, the Cisco IOS ping command sends five echo messages, with a timeout of 2 seconds.
If the command does not receive an echo reply within 2 seconds, the command considers that message to be a failure, and the command lists a period.|If the command does not receive an echo reply within 2 seconds, the command considers that message to be a failure, and the command lists a period.
If a successful reply is received within 2 seconds, the command displays an exclamation point.|If a successful reply is received within 2 seconds, the command displays an exclamation point.
So, in this first command, the first echo reply timed out, whereas the other four received a matching echo reply within 2 seconds.|So, in this first command, the first echo reply timed out, whereas the other four received a matching echo reply within 2 seconds.
|
As a quick aside, the example shows a common and normal behavior with ping commands:|As a quick aside, the example shows a common and normal behavior with ping commands:
|
the first ping command shows one failure to start, but then the rest of the messages work.|the first ping command shows one failure to start, but then the rest of the messages work.
|
This usually happens because some device in the end-to-end route is missing an ARP table entry.|This usually happens because some device in the end-to-end route is missing an ARP table entry.
|
Now think about troubleshooting and what a working ping command tells us about the current behavior of this internetwork.|Now think about troubleshooting and what a working ping command tells us about the current behavior of this internetwork.
First, focus on the big picture for a moment:|First, focus on the big picture for a moment:
###### R1 can send ICMP echo request messages to host B (172.16.2.101).
R1 can send ICMP echo request messages to host B (172.16.2.101).   
###### R1 sends these messages from its outgoing interface’s IP address (by default), 172.16.4.1 in
R1 sends these messages from its outgoing interface’s IP address (by default), 172.16.4.1 in   
__|__
--|--
|
this case.|this case.
###### Host B can send ICMP echo reply messages to R1’s 172.16.4.1 IP address (hosts send echo
Host B can send ICMP echo reply messages to R1’s 172.16.4.1 IP address (hosts send echo   
__|__
--|--
|
reply messages to the IP address from which the echo request was received).|reply messages to the IP address from which the echo request was received).
|
Figure 18-2 shows the packet flow.|Figure 18-2 shows the packet flow.
|
Figure 18-2 Standard ping 172.6.2.101 Command Using the Source Interface IP Address Next, think about IPv4 routing.|Figure 18-2 Standard ping 172.6.2.101 Command Using the Source Interface IP Address Next, think about IPv4 routing.
In the forward direction, R1 must have a route that matches host B’s address (172.16.2.101); this route will be either a static route or one learned with a routing protocol.|In the forward direction, R1 must have a route that matches host B’s address (172.16.2.101); this route will be either a static route or one learned with a routing protocol.
R2 also needs a route for host B’s address, in this case a connected route to B’s subnet (172.16.2.0/24), as shown in the top arrow lines in Figure 18-3.|R2 also needs a route for host B’s address, in this case a connected route to B’s subnet (172.16.2.0/24), as shown in the top arrow lines in Figure 18-3.
|
Figure 18-3 Layer 3 Routes Needed for R1’s Ping 172.16.2.101 to Work The arrow lines on the bottom of Figure 18-3 show the routes needed to forward the ICMP echo reply message back to Router R1’s 172.16.4.1 interface.|Figure 18-3 Layer 3 Routes Needed for R1’s Ping 172.16.2.101 to Work The arrow lines on the bottom of Figure 18-3 show the routes needed to forward the ICMP echo reply message back to Router R1’s 172.16.4.1 interface.
First, host B must have a valid default router setting because 172.16.4.1 sits in a different subnet than host B.|First, host B must have a valid default router setting because 172.16.4.1 sits in a different subnet than host B.
R2 must also have a route that matches destination 172.16.4.1 (in this case, likely to be a connected route).|R2 must also have a route that matches destination 172.16.4.1 (in this case, likely to be a connected route).
|
The working ping commands in Example 18-2 also require the data-link and physical layer details to be working.|The working ping commands in Example 18-2 also require the data-link and physical layer details to be working.
The WAN link must be working: The router interfaces must be up/up, which typically indicates that the link can pass data.|The WAN link must be working: The router interfaces must be up/up, which typically indicates that the link can pass data.
On the LAN, R2’s LAN interface must be in an up/up state.|On the LAN, R2’s LAN interface must be in an up/up state.
In addition, everything discussed about Ethernet LANs must be working because the ping confirmed that the packets went all the way from R1 to host B and back.|In addition, everything discussed about Ethernet LANs must be working because the ping confirmed that the packets went all the way from R1 to host B and back.
In particular|In particular
###### The switch interfaces in use are in a connected (up/up) state.
The switch interfaces in use are in a connected (up/up) state.   
__|__
--|--
|
filter frames sent by R2 or host B.|filter frames sent by R2 or host B.
###### STP has placed the right ports into a forwarding state.
STP has placed the right ports into a forwarding state.   
__|__
--|--
|
The ping 172.16.2.101 command in Example 18-2 also confirms that IP access control lists (ACL) did not filter the ICMP messages.|The ping 172.16.2.101 command in Example 18-2 also confirms that IP access control lists (ACL) did not filter the ICMP messages.
One ACL contains a set of matching rules and actions: some matched packets are filtered (discarded), while others can continue on their path as normal.|One ACL contains a set of matching rules and actions: some matched packets are filtered (discarded), while others can continue on their path as normal.
ACLs can examine packets as they enter or exit a router interface, so Figure 18-4 shows the various locations on routers R1 and R2 where an ACL could have filtered (discarded) the ICMP messages. (Note that an outbound ACL on router R1 would not filter packets created on R1, so there is no rightward-facing arrow over R1.).|ACLs can examine packets as they enter or exit a router interface, so Figure 18-4 shows the various locations on routers R1 and R2 where an ACL could have filtered (discarded) the ICMP messages. (Note that an outbound ACL on router R1 would not filter packets created on R1, so there is no rightward-facing arrow over R1.).
|
Figure 18-4 Locations Where IP ACLs Could Have Filtered the Ping Messages Finally, the working ping 172.16.2.101 command on R1 can also be used to reasonably predict that ARP worked and that switch SW2 learned MAC addresses for its MAC address table.|Figure 18-4 Locations Where IP ACLs Could Have Filtered the Ping Messages Finally, the working ping 172.16.2.101 command on R1 can also be used to reasonably predict that ARP worked and that switch SW2 learned MAC addresses for its MAC address table.
R2 and host B need to know each other’s MAC addresses so that they can encapsulate the IP packet inside an Ethernet frame, which means both must have a matching ARP table entry.|R2 and host B need to know each other’s MAC addresses so that they can encapsulate the IP packet inside an Ethernet frame, which means both must have a matching ARP table entry.
The switch learns the MAC address used by R2 and by host B when it sends the ARP messages or when it sends the frames that hold the IP packets.|The switch learns the MAC address used by R2 and by host B when it sends the ARP messages or when it sends the frames that hold the IP packets.
Figure 18-5 shows the type of information expected in those tables.|Figure 18-5 shows the type of information expected in those tables.
|
Figure 18-5 Router and Host ARP Tables, with the Switch MAC Address Table As you can see from the last few pages, a strategy of using a ping command from near the source of the problem can rule out a lot of possible root causes of any problems between two hosts—assuming the ping command succeeds.|Figure 18-5 Router and Host ARP Tables, with the Switch MAC Address Table As you can see from the last few pages, a strategy of using a ping command from near the source of the problem can rule out a lot of possible root causes of any problems between two hosts—assuming the ping command succeeds.
However, this ping command does not act exactly like the same ping command on the actual host.|However, this ping command does not act exactly like the same ping command on the actual host.
To overcome some of what is missing in the ping command from a nearby router, the next several examples show some strategies for testing other parts of the path between the two hosts that might have a current problem.|To overcome some of what is missing in the ping command from a nearby router, the next several examples show some strategies for testing other parts of the path between the two hosts that might have a current problem.
##### Using Extended Ping to Test the Reverse Route
Using Extended Ping to Test the Reverse Route   
__|__
--|--
|
Pinging from the default router, as discussed in the past few pages, misses an opportunity to test IP routes more fully.|Pinging from the default router, as discussed in the past few pages, misses an opportunity to test IP routes more fully.
In particular, it does not test the reverse route back toward the original host.|In particular, it does not test the reverse route back toward the original host.
|
For instance, referring to the internetwork in Figure 18-2 again, note that the reverse routes do not point to an address in host A’s subnet.|For instance, referring to the internetwork in Figure 18-2 again, note that the reverse routes do not point to an address in host A’s subnet.
When R1 processes the ping 172.16.2.101 command, R1 has to pick a source IP address to use for the echo request, and routers choose the IP address of the outgoing interface.|When R1 processes the ping 172.16.2.101 command, R1 has to pick a source IP address to use for the echo request, and routers choose the IP address of the outgoing interface.
The echo request from R1 to host B flows with source IP address 172.16.4.1 (R1’s G0/0/0 IP address).|The echo request from R1 to host B flows with source IP address 172.16.4.1 (R1’s G0/0/0 IP address).
The echo reply flows back to that same address (172.16.4.1).|The echo reply flows back to that same address (172.16.4.1).
|
A standard ping often does not test the reverse route that you need to test.|A standard ping often does not test the reverse route that you need to test.
In this case, the standard ping 172.16.2.101 command on R1 does not test whether the routers can route back to subnet 172.16.1.0/24, instead testing their routes for subnet172.16.4.0.|In this case, the standard ping 172.16.2.101 command on R1 does not test whether the routers can route back to subnet 172.16.1.0/24, instead testing their routes for subnet172.16.4.0.
A better ping test would test the route back to host A’s subnet; an extended ping from R1 can cause that test to happen.|A better ping test would test the route back to host A’s subnet; an extended ping from R1 can cause that test to happen.
Extended ping allows R1’s ping command to use R1’s LAN IP address from within subnet 172.16.1.0/24.|Extended ping allows R1’s ping command to use R1’s LAN IP address from within subnet 172.16.1.0/24.
Then, the echo reply messages would flow to host A’s subnet, as shown in Figure 18-6.|Then, the echo reply messages would flow to host A’s subnet, as shown in Figure 18-6.
|
Figure 18-6 Extended Ping Command Tests the Route to 172.16.1.51 (Host A)|Figure 18-6 Extended Ping Command Tests the Route to 172.16.1.51 (Host A)
|
The extended ping command does allow the user to type all the parameters on a potentially long command, but it also allows users to simply issue the ping command, press Enter, with IOS then asking the user to answer questions to complete the command, as shown in Example 18-3.|The extended ping command does allow the user to type all the parameters on a potentially long command, but it also allows users to simply issue the ping command, press Enter, with IOS then asking the user to answer questions to complete the command, as shown in Example 18-3.
The example shows the ping command on R1 that matches the logic in Figure 18-6.|The example shows the ping command on R1 that matches the logic in Figure 18-6.
This same command could have been issued from the command line as ping 172.16.2.101 source 172.16.1.1.|This same command could have been issued from the command line as ping 172.16.2.101 source 172.16.1.1.
|
Example 18-3 Testing the Reverse Route Using the Extended Ping Example end.|Example 18-3 Testing the Reverse Route Using the Extended Ping Example end.
|
This particular extended ping command tests the same routes for the echo request going to the right, but it forces a better test of routes pointing back to the left for the ICMP echo reply.|This particular extended ping command tests the same routes for the echo request going to the right, but it forces a better test of routes pointing back to the left for the ICMP echo reply.
For that direction, R2 needs a route that matches address 172.16.1.1, which is likely to be a route for subnet 172.16.1.0/24—the same subnet in which host A resides.|For that direction, R2 needs a route that matches address 172.16.1.1, which is likely to be a route for subnet 172.16.1.0/24—the same subnet in which host A resides.
|
From a troubleshooting perspective, using both standard and extended ping commands can be useful.|From a troubleshooting perspective, using both standard and extended ping commands can be useful.
However, neither can exactly mimic a ping command created on the host itself because the routers cannot send packets with the host’s IP address.|However, neither can exactly mimic a ping command created on the host itself because the routers cannot send packets with the host’s IP address.
For instance, the extended ping in Example 18-3 uses source IP address 172.16.1.1, which is not host A’s IP address.|For instance, the extended ping in Example 18-3 uses source IP address 172.16.1.1, which is not host A’s IP address.
|
As a result, neither the standard or extended ping commands in these two examples so far in this chapter can test for some kinds of problems, such as the following:|As a result, neither the standard or extended ping commands in these two examples so far in this chapter can test for some kinds of problems, such as the following:
###### IP ACLs that discard packets based on host A’s IP address but allow packets that match
IP ACLs that discard packets based on host A’s IP address but allow packets that match   
__|__
--|--
|
the router’s IP address|the router’s IP address
###### LAN switch port security that filters A’s frames (based on A’s MAC address)
LAN switch port security that filters A’s frames (based on A’s MAC address)   
###### IP routes on routers that happen to match host A’s 172.16.1.51 address, with different
IP routes on routers that happen to match host A’s 172.16.1.51 address, with different   
__|__
--|--
|
routes that match R1’s 172.16.1.1 address|routes that match R1’s 172.16.1.1 address
###### Problems with host A’s default router setting
Problems with host A’s default router setting   
__|__
--|--
|
NOTE IP ACLs and LAN switch port security are covered in CCNA 200-301 Official Cert Guide, Volume 2.|NOTE IP ACLs and LAN switch port security are covered in CCNA 200-301 Official Cert Guide, Volume 2.
For now, know that IP ACLs can filter packets on routers, focusing on the Layer 3 and 4 headers.|For now, know that IP ACLs can filter packets on routers, focusing on the Layer 3 and 4 headers.
Port security can be enabled on Layer 2 switches to filter based on source MAC addresses.|Port security can be enabled on Layer 2 switches to filter based on source MAC addresses.
##### Testing LAN Neighbors with Standard Ping
Testing LAN Neighbors with Standard Ping   
__|__
--|--
|
Testing using a ping of another device on the LAN can quickly confirm whether the LAN can pass packets and frames.|Testing using a ping of another device on the LAN can quickly confirm whether the LAN can pass packets and frames.
Specifically, a working ping rules out many possible root causes of a problem.|Specifically, a working ping rules out many possible root causes of a problem.
For instance, Figure 18-7 shows the ICMP messages that occur if R1 issues the command ping 172.16.1.51, pinging host A, which sits on the same VLAN as R1.|For instance, Figure 18-7 shows the ICMP messages that occur if R1 issues the command ping 172.16.1.51, pinging host A, which sits on the same VLAN as R1.
|
Figure 18-7 Standard ping Command Confirms That the LAN Works If the ping works, it confirms the following, which rules out some potential issues:|Figure 18-7 Standard ping Command Confirms That the LAN Works If the ping works, it confirms the following, which rules out some potential issues:
###### The host with address 172.16.1.51 replied.
The host with address 172.16.1.51 replied.   
###### The LAN can pass unicast frames from R1 to host 172.16.1.51 and vice versa.
The LAN can pass unicast frames from R1 to host 172.16.1.51 and vice versa.   
###### You can reasonably assume that the switches learned the MAC addresses of the router
You can reasonably assume that the switches learned the MAC addresses of the router   
__|__
--|--
|
and the host, adding those to the MAC address tables.|and the host, adding those to the MAC address tables.
###### Host A and Router R1 completed the ARP process and list each other in their respective
Host A and Router R1 completed the ARP process and list each other in their respective   
__|__
--|--
|
Address Resolution Protocol (ARP) tables.|Address Resolution Protocol (ARP) tables.
|
The failure of a ping, even with two devices on the same subnet, can point to a variety of problems, like those mentioned in this list.|The failure of a ping, even with two devices on the same subnet, can point to a variety of problems, like those mentioned in this list.
For instance, if the ping 172.16.1.51 on R1 fails (Figure 18-7), that result points to this list of potential root causes:|For instance, if the ping 172.16.1.51 on R1 fails (Figure 18-7), that result points to this list of potential root causes:
###### IP addressing problem: Host A could be statically configured with the wrong IP address.
IP addressing problem: Host A could be statically configured with the wrong IP address.   
###### DHCP problems: If you are using Dynamic Host Configuration Protocol (DHCP), many
DHCP problems: If you are using Dynamic Host Configuration Protocol (DHCP), many   
__|__
--|--
|
problems could exist.|problems could exist.
Chapter 7, “Implementing DHCP” in CCNA 200-301 Official Cert Guide, Volume 2, discusses those possibilities in some depth.|Chapter 7, “Implementing DHCP” in CCNA 200-301 Official Cert Guide, Volume 2, discusses those possibilities in some depth.
###### VLAN trunking problems: The router could be configured for 802.1Q trunking, when the
VLAN trunking problems: The router could be configured for 802.1Q trunking, when the   
__|__
--|--
|
switch is not (or vice versa).|switch is not (or vice versa).
###### LAN problems: A wide variety of issues could exist with the Layer 2 switches, preventing
LAN problems: A wide variety of issues could exist with the Layer 2 switches, preventing   
__|__
--|--
|
any frames from flowing between host A and the router.|any frames from flowing between host A and the router.
|
So, whether the ping works or fails, simply pinging a LAN host from a router can help further isolate the problem.|So, whether the ping works or fails, simply pinging a LAN host from a router can help further isolate the problem.
##### Testing LAN Neighbors with Extended Ping
Testing LAN Neighbors with Extended Ping   
__|__
--|--
|
A standard ping of a LAN host from a router does not test that host’s default router setting.|A standard ping of a LAN host from a router does not test that host’s default router setting.
|
However, an extended ping can test the host’s default router setting.|However, an extended ping can test the host’s default router setting.
Both tests can be useful, especially for problem isolation, because|Both tests can be useful, especially for problem isolation, because
###### If a standard ping of a local LAN host works…
If a standard ping of a local LAN host works…   
###### But an extended ping of the same LAN host fails…
But an extended ping of the same LAN host fails…   
###### The problem likely relates somehow to the host’s default router setting.
The problem likely relates somehow to the host’s default router setting.   
__|__
--|--
|
First, to understand why the standard and extended ping results have different effects, consider first the standard ping 172.16.1.51 command on R1, as shown previously in Figure 18-7.|First, to understand why the standard and extended ping results have different effects, consider first the standard ping 172.16.1.51 command on R1, as shown previously in Figure 18-7.
As a standard ping command, R1 used its LAN interface IP address (172.16.1.1) as the source of the ICMP Echo.|As a standard ping command, R1 used its LAN interface IP address (172.16.1.1) as the source of the ICMP Echo.
So, when the host (A) sent back its ICMP echo reply, host A considered the destination of 172.16.1.1 as being on the same subnet.|So, when the host (A) sent back its ICMP echo reply, host A considered the destination of 172.16.1.1 as being on the same subnet.
Host A’s ICMP echo reply message, sent back to 172.16.1.1, would work even if host A did not have a default router setting at all!|Host A’s ICMP echo reply message, sent back to 172.16.1.1, would work even if host A did not have a default router setting at all!
|
In comparison, Figure 18-8 shows the difference when using an extended ping on Router R1. An extended ping from local Router R1, using R1’s S0/0/0 IP address of 172.16.4.1 as the source of the ICMP echo request, means that host A’s ICMP echo reply will flow to an address in another subnet, which makes host A use its default router setting.|In comparison, Figure 18-8 shows the difference when using an extended ping on Router R1. An extended ping from local Router R1, using R1’s S0/0/0 IP address of 172.16.4.1 as the source of the ICMP echo request, means that host A’s ICMP echo reply will flow to an address in another subnet, which makes host A use its default router setting.
|
The comparison between the previous two figures shows one of the most classic mistakes when troubleshooting networks.|The comparison between the previous two figures shows one of the most classic mistakes when troubleshooting networks.
Sometimes, the temptation is to connect to a router and ping the host on the attached LAN, and it works.|Sometimes, the temptation is to connect to a router and ping the host on the attached LAN, and it works.
So, the engineer moves on, thinking that the network layer issues between the router and host work fine, when the problem still exists with the host’s default router setting.|So, the engineer moves on, thinking that the network layer issues between the router and host work fine, when the problem still exists with the host’s default router setting.
|
Figure 18-8 Extended ping Command Does Test Host A’s Default Router Setting|Figure 18-8 Extended ping Command Does Test Host A’s Default Router Setting
##### Testing WAN Neighbors with Standard Ping
Testing WAN Neighbors with Standard Ping   
__|__
--|--
|
As with a standard ping test across a LAN, a standard ping test between routers over a serial or Ethernet WAN link tests whether the link can pass IPv4 packets.|As with a standard ping test across a LAN, a standard ping test between routers over a serial or Ethernet WAN link tests whether the link can pass IPv4 packets.
With a properly designed IPv4 addressing plan, two routers on the same serial or Ethernet WAN link should have IP addresses in the same subnet.|With a properly designed IPv4 addressing plan, two routers on the same serial or Ethernet WAN link should have IP addresses in the same subnet.
A ping from one router to the IP address of the other router confirms that an IP packet can be sent over the link and back, as shown in the ping 172.16.4.2 command on R1 in Figure 18-9.|A ping from one router to the IP address of the other router confirms that an IP packet can be sent over the link and back, as shown in the ping 172.16.4.2 command on R1 in Figure 18-9.
|
Figure 18-9 Pinging Across a WAN Link A successful ping of the IP address on the other end of an Ethernet WAN link that sits between two routers confirms several specific facts, such as the following:|Figure 18-9 Pinging Across a WAN Link A successful ping of the IP address on the other end of an Ethernet WAN link that sits between two routers confirms several specific facts, such as the following:
###### Both routers’ WAN interfaces are in an up/up state.
Both routers’ WAN interfaces are in an up/up state.   
###### The Layer 1 and 2 features of the link work.
The Layer 1 and 2 features of the link work.   
###### The routers believe that the neighboring router’s IP address is in the same subnet.
The routers believe that the neighboring router’s IP address is in the same subnet.   
###### Inbound ACLs on both routers do not filter the incoming packets, respectively.
Inbound ACLs on both routers do not filter the incoming packets, respectively.   
###### The remote router is configured with the expected IP address (172.16.4.2 in this case).
The remote router is configured with the expected IP address (172.16.4.2 in this case).   
__|__
--|--
|
Testing by pinging the other neighboring router does not test many other features.|Testing by pinging the other neighboring router does not test many other features.
However, although the test is limited in scope, it does let you rule out WAN links as having a Layer 1 or 2 problem, and it rules out some basic Layer 3 addressing problems.|However, although the test is limited in scope, it does let you rule out WAN links as having a Layer 1 or 2 problem, and it rules out some basic Layer 3 addressing problems.
#### Using Ping with Names and with IP Addresses
Using Ping with Names and with IP Addresses   
__|__
--|--
|
All the ping examples so far in this chapter show a ping of an IP address.|All the ping examples so far in this chapter show a ping of an IP address.
However, the ping command can use hostnames, and pinging a hostname allows the network engineer to further test whether the Domain Name System (DNS) process works.|However, the ping command can use hostnames, and pinging a hostname allows the network engineer to further test whether the Domain Name System (DNS) process works.
|
First, most every TCP/IP application today uses hostnames rather than IP addresses to identify the other device.|First, most every TCP/IP application today uses hostnames rather than IP addresses to identify the other device.
No one opens a web browser and types in 72.163.4.185.|No one opens a web browser and types in 72.163.4.185.
Instead, they type in a web address, like www.cisco.com, which includes the hostname www.cisco.com.|Instead, they type in a web address, like www.cisco.com, which includes the hostname www.cisco.com.
|
Then, before a host can send data to a specific IP address, the host must first ask a DNS server to resolve that hostname into the matching IP address.|Then, before a host can send data to a specific IP address, the host must first ask a DNS server to resolve that hostname into the matching IP address.
|
For example, in the small internetwork used for several examples in this chapter, a ping B command on host A tests A’s DNS settings, as shown in Figure 18-10.|For example, in the small internetwork used for several examples in this chapter, a ping B command on host A tests A’s DNS settings, as shown in Figure 18-10.
When host A sees the use of a hostname (B), it first looks in its local DNS name cache to find out whether it has already resolved the name B.|When host A sees the use of a hostname (B), it first looks in its local DNS name cache to find out whether it has already resolved the name B.
If not, host A first asks the DNS to supply (resolve) the name into its matching IP address (Step 1 in the figure).|If not, host A first asks the DNS to supply (resolve) the name into its matching IP address (Step 1 in the figure).
Only then does host A send a packet to 172.16.2.101, host B’s IP address (Step 2).|Only then does host A send a packet to 172.16.2.101, host B’s IP address (Step 2).
|
Figure 18-10 DNS Name Resolution by Host A When troubleshooting, testing from the host by pinging using a hostname can be very helpful.|Figure 18-10 DNS Name Resolution by Host A When troubleshooting, testing from the host by pinging using a hostname can be very helpful.
|
The command, of course, tests the host’s own DNS client settings.|The command, of course, tests the host’s own DNS client settings.
For instance, a classic comparison is to first ping the destination host using the hostname, which requires a DNS request.|For instance, a classic comparison is to first ping the destination host using the hostname, which requires a DNS request.
Then, repeat the same test, but use the destination host’s IP address instead of its name, which does not require the DNS request.|Then, repeat the same test, but use the destination host’s IP address instead of its name, which does not require the DNS request.
If the ping of the hostname fails but the ping of the IP address works, the problem usually has something to do with DNS.|If the ping of the hostname fails but the ping of the IP address works, the problem usually has something to do with DNS.
### Problem Isolation Using the traceroute Command
Problem Isolation Using the traceroute Command   
__|__
--|--
|
Like ping, the traceroute command helps network engineers isolate problems.|Like ping, the traceroute command helps network engineers isolate problems.
Here is a comparison of the two:|Here is a comparison of the two:
###### Both send messages in the network to test connectivity.
Both send messages in the network to test connectivity.   
###### Both rely on other devices to send back a reply.
Both rely on other devices to send back a reply.   
###### Both have wide support on many different operating systems.
Both have wide support on many different operating systems.   
###### Both can use a hostname or an IP address to identify the destination.
Both can use a hostname or an IP address to identify the destination.   
###### On routers, both have a standard and extended version, allowing better testing of the
On routers, both have a standard and extended version, allowing better testing of the   
__|__
--|--
|
reverse route.|reverse route.
|
The biggest differences relate to the more detailed results in the output of the traceroute command and the extra time and effort it takes traceroute to build that output.|The biggest differences relate to the more detailed results in the output of the traceroute command and the extra time and effort it takes traceroute to build that output.
This second major section examines how traceroute works; plus it provides some suggestions on how to use this more detailed information to more quickly isolate IP routing problems.|This second major section examines how traceroute works; plus it provides some suggestions on how to use this more detailed information to more quickly isolate IP routing problems.
#### traceroute Basics
traceroute Basics   
__|__
--|--
|
Imagine some network engineer or CSR starts to troubleshoot some problem.|Imagine some network engineer or CSR starts to troubleshoot some problem.
The engineer pings from the user’s host, pings from a nearby router, and after a few commands, convinces herself that the host can indeed send and receive IP packets.|The engineer pings from the user’s host, pings from a nearby router, and after a few commands, convinces herself that the host can indeed send and receive IP packets.
The problem might not be solved yet, but the problem does not appear to be a network problem.|The problem might not be solved yet, but the problem does not appear to be a network problem.
|
Now imagine the next problem comes along, and this time the ping command fails.|Now imagine the next problem comes along, and this time the ping command fails.
It appears that some problem does exist in the IP network.|It appears that some problem does exist in the IP network.
Where is the problem?|Where is the problem?
Where should the engineer look more closely?|Where should the engineer look more closely?
Although the ping command can prove helpful in isolating the source of the problem, the traceroute command may be a better option.|Although the ping command can prove helpful in isolating the source of the problem, the traceroute command may be a better option.
The traceroute command systematically helps pinpoint routing problems by showing how far a packet goes through an IP network before being discarded.|The traceroute command systematically helps pinpoint routing problems by showing how far a packet goes through an IP network before being discarded.
|
The traceroute command identifies the routers in the path from source host to destination host.|The traceroute command identifies the routers in the path from source host to destination host.
Specifically, it lists the next-hop IP address of each router that would be in each of the individual routes.|Specifically, it lists the next-hop IP address of each router that would be in each of the individual routes.
For instance, a traceroute 172.16.2.101 command on host A in Figure 18-11 would identify an IP address on Router R1, another on Router R2, and then host B, as shown in the figure.|For instance, a traceroute 172.16.2.101 command on host A in Figure 18-11 would identify an IP address on Router R1, another on Router R2, and then host B, as shown in the figure.
Example 18-4, which follows, lists the output of the command, taken from host A.|Example 18-4, which follows, lists the output of the command, taken from host A.
|
Figure 18-11 IP Addresses Identified by a Successful traceroute 172.16.2.101 Command Example 18-4 Output from traceroute 172.16.2.101 on Host A Example end.|Figure 18-11 IP Addresses Identified by a Successful traceroute 172.16.2.101 Command Example 18-4 Output from traceroute 172.16.2.101 on Host A Example end.
##### How the traceroute Command Works
How the traceroute Command Works   
__|__
--|--
|
The traceroute command gathers information by generating packets that trigger error messages from routers; these messages identify the routers, letting the traceroute command list the routers’ IP addresses in the output of the command.|The traceroute command gathers information by generating packets that trigger error messages from routers; these messages identify the routers, letting the traceroute command list the routers’ IP addresses in the output of the command.
That error message is the ICMP Time-to-Live Exceeded (TTL Exceeded) message, originally meant to notify hosts when a packet had been looping around a network.|That error message is the ICMP Time-to-Live Exceeded (TTL Exceeded) message, originally meant to notify hosts when a packet had been looping around a network.
|
Ignoring traceroute for a moment and instead focusing on IP routing, IPv4 routers defeat routing loops in part by discarding looping IP packets.|Ignoring traceroute for a moment and instead focusing on IP routing, IPv4 routers defeat routing loops in part by discarding looping IP packets.
To do so, the IPv4 header holds a field called Time To Live (TTL). The original host that creates the packet sets an initial TTL value.|To do so, the IPv4 header holds a field called Time To Live (TTL). The original host that creates the packet sets an initial TTL value.
Then each router that forwards the packet decrements the TTL value by 1.|Then each router that forwards the packet decrements the TTL value by 1.
When a router decrements the TTL to 0, the router perceives the packet is looping, and the router discards the packet.|When a router decrements the TTL to 0, the router perceives the packet is looping, and the router discards the packet.
The router also notifies the host that sent the discarded packet by sending an ICMP TTL Exceeded message.|The router also notifies the host that sent the discarded packet by sending an ICMP TTL Exceeded message.
|
Now back to traceroute.|Now back to traceroute.
Traceroute sends messages with low TTL values to make the routers send back a TTL Exceeded message.|Traceroute sends messages with low TTL values to make the routers send back a TTL Exceeded message.
Specifically, a traceroute command begins by sending several packets (usually three), each with the header TTL field equal to 1.|Specifically, a traceroute command begins by sending several packets (usually three), each with the header TTL field equal to 1.
When that packet arrives at the next router—host A’s default Router R1 in the example of Figure 18-12—the router decrements TTL to 0 and discards the packet.|When that packet arrives at the next router—host A’s default Router R1 in the example of Figure 18-12—the router decrements TTL to 0 and discards the packet.
The router then sends host A the TTL Exceeded message, which identifies the router’s IP address to the traceroute command.|The router then sends host A the TTL Exceeded message, which identifies the router’s IP address to the traceroute command.
|
Figure 18-12 How traceroute Identifies the First Router in the Route The traceroute command sends several TTL=1 packets, checking them to see whether the TTL Exceeded messages flow from the same router, based on the source IP address of the TTL Exceeded message.|Figure 18-12 How traceroute Identifies the First Router in the Route The traceroute command sends several TTL=1 packets, checking them to see whether the TTL Exceeded messages flow from the same router, based on the source IP address of the TTL Exceeded message.
Assuming the messages come from the same router, the traceroute command lists that IP address as the next line of output on the command.|Assuming the messages come from the same router, the traceroute command lists that IP address as the next line of output on the command.
|
To find all the routers in the path, and finally confirm that packets flow all the way to the destination host, the traceroute command sends a small set of packets with TTL=1, then a small set with TTL=2, then 3, 4, and so on, until the destination host replies.|To find all the routers in the path, and finally confirm that packets flow all the way to the destination host, the traceroute command sends a small set of packets with TTL=1, then a small set with TTL=2, then 3, 4, and so on, until the destination host replies.
Figure 18-13 shows the packet from the second set with TTL=2.|Figure 18-13 shows the packet from the second set with TTL=2.
In this case, one router (R1) actually forwards the packet, while another router (R2) happens to decrement the TTL to 0, causing a TTL Exceeded message to be sent back to host A.|In this case, one router (R1) actually forwards the packet, while another router (R2) happens to decrement the TTL to 0, causing a TTL Exceeded message to be sent back to host A.
|
Figure 18-13 TTL=2 Message Sent by traceroute The figure shows these four steps:|Figure 18-13 TTL=2 Message Sent by traceroute The figure shows these four steps:
|
1. The traceroute command sends a packet from the second set with TTL=2.|1. The traceroute command sends a packet from the second set with TTL=2.
|
2. Router R1 processes the packet and decrements TTL to 1.|2. Router R1 processes the packet and decrements TTL to 1.
R1 forwards the packet.|R1 forwards the packet.
|
3. Router R2 processes the packet and decrements TTL to 0.|3. Router R2 processes the packet and decrements TTL to 0.
R2 discards the packet.|R2 discards the packet.
|
4. R2 notifies the sending host of the discarded packet by sending a TTL Exceeded ICMP message.|4. R2 notifies the sending host of the discarded packet by sending a TTL Exceeded ICMP message.
The source IP address of that message is 172.16.4.2.|The source IP address of that message is 172.16.4.2.
|
Finally, the choice of source IP address to use on the time-exceeded message returned by routers has a big impact on the output of the traceroute command.|Finally, the choice of source IP address to use on the time-exceeded message returned by routers has a big impact on the output of the traceroute command.
Most routers use simpler logic that also makes command output like traceroute more consistent and meaningful.|Most routers use simpler logic that also makes command output like traceroute more consistent and meaningful.
That logic: choose the TTL Exceeded message’s source IP address based on the source interface of the original message that was discarded due to TTL. In the example in Figure 18-13, the original message at Step 2 arrived on R2’s G0/0/1 interface, so at Step 3, R2 uses G0/0/1’s IP address as the source IP address of the TTL Exceeded message, and as the interface out which to send the message.|That logic: choose the TTL Exceeded message’s source IP address based on the source interface of the original message that was discarded due to TTL. In the example in Figure 18-13, the original message at Step 2 arrived on R2’s G0/0/1 interface, so at Step 3, R2 uses G0/0/1’s IP address as the source IP address of the TTL Exceeded message, and as the interface out which to send the message.
##### Standard and Extended traceroute
Standard and Extended traceroute   
__|__
--|--
|
The standard and extended options for the traceroute command give you many of the same options as the ping command.|The standard and extended options for the traceroute command give you many of the same options as the ping command.
For instance, Example 18-5 lists the output of a standard traceroute command on Router R1. Like the standard ping command, a standard traceroute command chooses an IP address based on the outgoing interface for the packet sent by the command.|For instance, Example 18-5 lists the output of a standard traceroute command on Router R1. Like the standard ping command, a standard traceroute command chooses an IP address based on the outgoing interface for the packet sent by the command.
So, in this example, the packets sent by R1 come from source IP address 172.16.4.1, R1’s G0/0/0 IP address.|So, in this example, the packets sent by R1 come from source IP address 172.16.4.1, R1’s G0/0/0 IP address.
|
Example 18-5 Standard traceroute Command on R1 Example end.|Example 18-5 Standard traceroute Command on R1 Example end.
|
The extended traceroute command, as shown in Example 18-6, follows the same basic command structure as the extended ping command.|The extended traceroute command, as shown in Example 18-6, follows the same basic command structure as the extended ping command.
The user can type all the parameters on one command line, but it is much easier to just type traceroute, press Enter, and let IOS prompt for all the parameters, including the source IP address of the packets (172.16.1.1 in this example).|The user can type all the parameters on one command line, but it is much easier to just type traceroute, press Enter, and let IOS prompt for all the parameters, including the source IP address of the packets (172.16.1.1 in this example).
|
Example 18-6 Extended traceroute Command on R1 Example end.|Example 18-6 Extended traceroute Command on R1 Example end.
|
Both the ping and traceroute commands exist on most operating systems, including Cisco IOS. However, some operating systems use a slightly different syntax for traceroute.|Both the ping and traceroute commands exist on most operating systems, including Cisco IOS. However, some operating systems use a slightly different syntax for traceroute.
|
For example, most Windows operating systems support tracert and pathping, and not traceroute.|For example, most Windows operating systems support tracert and pathping, and not traceroute.
Linux and OS X support the traceroute command.|Linux and OS X support the traceroute command.
|
NOTE Host OS traceroute commands usually create ICMP echo requests.|NOTE Host OS traceroute commands usually create ICMP echo requests.
The Cisco IOS traceroute command instead creates IP packets with a UDP header.|The Cisco IOS traceroute command instead creates IP packets with a UDP header.
This bit of information may seem trivial at this point.|This bit of information may seem trivial at this point.
However, note that an ACL may actually filter the traffic from a host’s traceroute messages but not the router traceroute command, or vice versa.|However, note that an ACL may actually filter the traffic from a host’s traceroute messages but not the router traceroute command, or vice versa.
### Telnet and SSH
Telnet and SSH   
__|__
--|--
|
The ping and traceroute commands do give networkers two great tools to begin isolating the cause of an IP routing problem.|The ping and traceroute commands do give networkers two great tools to begin isolating the cause of an IP routing problem.
However, these two commands tell us nothing about the operation state inside the various network devices.|However, these two commands tell us nothing about the operation state inside the various network devices.
Once you begin to get an idea of the kinds of problems and the possible locations of the problems using ping and traceroute, the next step is to look at the status of various router and switch features.|Once you begin to get an idea of the kinds of problems and the possible locations of the problems using ping and traceroute, the next step is to look at the status of various router and switch features.
One way to do that is to use Telnet or Secure Shell (SSH) to log in to the devices.|One way to do that is to use Telnet or Secure Shell (SSH) to log in to the devices.
#### Common Reasons to Use the IOS Telnet and SSH Client
Common Reasons to Use the IOS Telnet and SSH Client   
__|__
--|--
|
Normally, a network engineer would log in to the remote device using a Telnet or SSH client on a PC, tablet, or any other user device.|Normally, a network engineer would log in to the remote device using a Telnet or SSH client on a PC, tablet, or any other user device.
In fact, often, the same software package does both Telnet and SSH. However, in some cases, you may want to take advantage of the Telnet and SSH client built in to IOS on the routers and switches to Telnet/SSH from one Cisco device to the next.|In fact, often, the same software package does both Telnet and SSH. However, in some cases, you may want to take advantage of the Telnet and SSH client built in to IOS on the routers and switches to Telnet/SSH from one Cisco device to the next.
|
To understand why, consider the example shown in Figure 18-14.|To understand why, consider the example shown in Figure 18-14.
The figure shows arrowed lines to three separate IP addresses on three separate Cisco routers.|The figure shows arrowed lines to three separate IP addresses on three separate Cisco routers.
PC1 has attempted to Telnet to each address from a different tab in PC1’s Telnet/SSH client.|PC1 has attempted to Telnet to each address from a different tab in PC1’s Telnet/SSH client.
However, R2 happens to have an error in its routing protocol configuration, so R1, R2, and R3 fail to learn any routes from each other.|However, R2 happens to have an error in its routing protocol configuration, so R1, R2, and R3 fail to learn any routes from each other.
As a result, PC1’s Telnet attempt to both 10.1.2.2 (R2) and 10.1.3.3 (R3) fails.|As a result, PC1’s Telnet attempt to both 10.1.2.2 (R2) and 10.1.3.3 (R3) fails.
|
Figure 18-14 Telnet Works from PC1 to R1 but Not to R2 or R3 In some cases, like this one, a Telnet or SSH login from the network engineer’s device can fail, while you could still find a way to log in using the telnet and ssh commands to use the Telnet and SSH clients on the routers or switches.|Figure 18-14 Telnet Works from PC1 to R1 but Not to R2 or R3 In some cases, like this one, a Telnet or SSH login from the network engineer’s device can fail, while you could still find a way to log in using the telnet and ssh commands to use the Telnet and SSH clients on the routers or switches.
With this particular scenario, all the individual data links work; the problem is with the routing protocol exchanging routes.|With this particular scenario, all the individual data links work; the problem is with the routing protocol exchanging routes.
PC1 can ping R1’s 10.1.1.1 IP address, R1 can ping R2’s 10.1.2.2 address, and R2 can ping R3’s 10.1.3.3 address.|PC1 can ping R1’s 10.1.1.1 IP address, R1 can ping R2’s 10.1.2.2 address, and R2 can ping R3’s 10.1.3.3 address.
Because each link works, and each router can send and receive packets with its neighbor on the shared data link, you could Telnet/SSH to each successive device.|Because each link works, and each router can send and receive packets with its neighbor on the shared data link, you could Telnet/SSH to each successive device.
|
Figure 18-15 shows the idea.|Figure 18-15 shows the idea.
On the left, PC1 begins with either a Telnet/SSH or a console connection into Router R1, as shown on the left.|On the left, PC1 begins with either a Telnet/SSH or a console connection into Router R1, as shown on the left.
Then the user issues the telnet 10.1.2.2 command from R1 to Telnet to R2. Once logged in to R2, the user can issue commands on R2. Then from R2, the user could issue the telnet 10.1.3.3 command to Telnet to R3, from which the user could issue commands on R3.|Then the user issues the telnet 10.1.2.2 command from R1 to Telnet to R2. Once logged in to R2, the user can issue commands on R2. Then from R2, the user could issue the telnet 10.1.3.3 command to Telnet to R3, from which the user could issue commands on R3.
|
Figure 18-15 Successive Telnet Connections: PC1 to R1, R1 to R2, and R2 to R3 The Telnet connections shown in Figure 18-15 work because each Telnet in this case uses source and destination addresses in the same subnet.|Figure 18-15 Successive Telnet Connections: PC1 to R1, R1 to R2, and R2 to R3 The Telnet connections shown in Figure 18-15 work because each Telnet in this case uses source and destination addresses in the same subnet.
For example, R1’s telnet 10.1.2.2 command uses 10.1.2.2 as the destination, of course.|For example, R1’s telnet 10.1.2.2 command uses 10.1.2.2 as the destination, of course.
R1 uses the outgoing interface IP address used to send packets to 10.1.2.2, 10.1.2.1 in this case.|R1 uses the outgoing interface IP address used to send packets to 10.1.2.2, 10.1.2.1 in this case.
Because each of these telnet commands connects to an IP address in a connected subnet, the routing protocol could be completely misconfigured, and you could still Telnet/SSH to each successive device to troubleshoot and fix the problem.|Because each of these telnet commands connects to an IP address in a connected subnet, the routing protocol could be completely misconfigured, and you could still Telnet/SSH to each successive device to troubleshoot and fix the problem.
|
Network engineers also use the IOS Telnet and SSH client just for preference.|Network engineers also use the IOS Telnet and SSH client just for preference.
For instance, if you need to log in to several Cisco devices, you could open several windows and tabs on your PC, and log in from your PC (assuming the network was not having problems).|For instance, if you need to log in to several Cisco devices, you could open several windows and tabs on your PC, and log in from your PC (assuming the network was not having problems).
Or, you could log in from your PC to some nearby Cisco router or switch, and from there Telnet or SSH to other Cisco devices.|Or, you could log in from your PC to some nearby Cisco router or switch, and from there Telnet or SSH to other Cisco devices.
#### IOS Telnet and SSH Examples
IOS Telnet and SSH Examples   
__|__
--|--
|
Using the IOS Telnet client via the telnet host command is pretty simple.|Using the IOS Telnet client via the telnet host command is pretty simple.
Just use the IP address or hostname to identify the host to which you want to connect, and press Enter.|Just use the IP address or hostname to identify the host to which you want to connect, and press Enter.
|
Example 18-7 shows an example based on Figure 18-15, with R1 using Telnet to connect to|Example 18-7 shows an example based on Figure 18-15, with R1 using Telnet to connect to
###### 10.1.2.2 (R2).
10.1.2.2 (R2).   
__|__
--|--
|
Example 18-7 Telnet from R1 to R2 to View Interface Status on R2 Example end.|Example 18-7 Telnet from R1 to R2 to View Interface Status on R2 Example end.
|
Take the time to pay close attention to the command prompts.|Take the time to pay close attention to the command prompts.
The example begins with the user logged in to Router R1, with the R1# command prompt.|The example begins with the user logged in to Router R1, with the R1# command prompt.
After issuing the telnet 10.1.2.2 command, R2 asks the user for both a username and password because Router R2 uses local username authentication, which requires those credentials.|After issuing the telnet 10.1.2.2 command, R2 asks the user for both a username and password because Router R2 uses local username authentication, which requires those credentials.
The show ip interfaces brief command at the end of the output shows Router R2’s interfaces and IP addresses again per Example 18-7 and Figure 18-15.|The show ip interfaces brief command at the end of the output shows Router R2’s interfaces and IP addresses again per Example 18-7 and Figure 18-15.
|
The ssh -l username host command in Example 18-8 follows the same basic ideas as the telnet host command, but with an SSH client.|The ssh -l username host command in Example 18-8 follows the same basic ideas as the telnet host command, but with an SSH client.
The -l flag means that the next parameter is the login username.|The -l flag means that the next parameter is the login username.
In this case, the user begins logged in to Router R1 and then uses the ssh -l wendell 10.1.2.2 command to SSH to Router R2. R2 expects a username/password of wendell/odom, with wendell supplied in the command and odom supplied when R2 prompts the user.|In this case, the user begins logged in to Router R1 and then uses the ssh -l wendell 10.1.2.2 command to SSH to Router R2. R2 expects a username/password of wendell/odom, with wendell supplied in the command and odom supplied when R2 prompts the user.
|
Example 18-8 SSH Client from R1 to R2 to View Interface Status on R2 Example end.|Example 18-8 SSH Client from R1 to R2 to View Interface Status on R2 Example end.
|
When you have finished using the other router, you can log out from your Telnet or SSH connection using the exit or quit command.|When you have finished using the other router, you can log out from your Telnet or SSH connection using the exit or quit command.
|
Finally, note that IOS supports a mechanism to use hotkeys to move between multiple Telnet or SSH sessions from the CLI. Basically, starting at one router, you could telnet or SSH to a router, do some commands, and instead of using the exit command to end your connection, you could keep the connection open while still moving back to the command prompt of the original router.|Finally, note that IOS supports a mechanism to use hotkeys to move between multiple Telnet or SSH sessions from the CLI. Basically, starting at one router, you could telnet or SSH to a router, do some commands, and instead of using the exit command to end your connection, you could keep the connection open while still moving back to the command prompt of the original router.
For instance, if starting at Router R1, you could Telnet to R2, R3, and R4, suspending but not exiting those Telnet connections.|For instance, if starting at Router R1, you could Telnet to R2, R3, and R4, suspending but not exiting those Telnet connections.
Then you could easily move between the sessions to issue new commands with a few keystrokes.|Then you could easily move between the sessions to issue new commands with a few keystrokes.
### Chapter Review
Chapter Review   
__|__
--|--
|
One key to doing well on the exams is to perform repetitive spaced review sessions.|One key to doing well on the exams is to perform repetitive spaced review sessions.
Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.|Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.
Refer to the “Your Study Plan” element for more details.|Refer to the “Your Study Plan” element for more details.
Table 18-1 outlines the key review elements and where you can find them.|Table 18-1 outlines the key review elements and where you can find them.
To better track your study progress, record when you completed these activities in the second column.|To better track your study progress, record when you completed these activities in the second column.
|
Table 18-1 Chapter Review Tracking Table end.|Table 18-1 Chapter Review Tracking Table end.
|
Review All the Key Topics Key Terms You Should Know ping, traceroute, ICMP echo request, ICMP echo reply, extended ping, forward route, reverse route, DNS Keep track of your part review progress with the checklist in Table P5-1.|Review All the Key Topics Key Terms You Should Know ping, traceroute, ICMP echo request, ICMP echo reply, extended ping, forward route, reverse route, DNS Keep track of your part review progress with the checklist in Table P5-1.
Details on each task follow the table.|Details on each task follow the table.
|
Table P5-1 Part V Part Review Checklist Activity 1st Date Completed 2nd Date Completed Repeat All DIKTA Questions Answer Part Review Questions Review Key Topics Do Labs Review Videos Repeat All DIKTA Questions For this task, answer the “Do I Know This Already?” questions again for the chapters in this part of the book, using the PTP software.|Table P5-1 Part V Part Review Checklist Activity 1st Date Completed 2nd Date Completed Repeat All DIKTA Questions Answer Part Review Questions Review Key Topics Do Labs Review Videos Repeat All DIKTA Questions For this task, answer the “Do I Know This Already?” questions again for the chapters in this part of the book, using the PTP software.
|
Answer Part Review Questions For this task, use PTP to answer the Part Review questions for this part of the book.|Answer Part Review Questions For this task, use PTP to answer the Part Review questions for this part of the book.
|
Review Key Topics Review all key topics in all chapters in this part, either by browsing the chapters or by using the Key Topics application on the companion website.|Review Key Topics Review all key topics in all chapters in this part, either by browsing the chapters or by using the Key Topics application on the companion website.
|
Labs Depending on your chosen lab tool, here are some suggestions for what to do in lab:|Labs Depending on your chosen lab tool, here are some suggestions for what to do in lab:
|
Pearson Network Simulator: If you use the full Pearson ICND1 or CCNA simulator, focus more on the configuration scenario and troubleshooting scenario labs associated with the topics in this part of the book.|Pearson Network Simulator: If you use the full Pearson ICND1 or CCNA simulator, focus more on the configuration scenario and troubleshooting scenario labs associated with the topics in this part of the book.
These types of labs include a larger set of topics and work well as Part Review activities. (See the Introduction for some details about how to find which labs are about topics in this part of the book.)|These types of labs include a larger set of topics and work well as Part Review activities. (See the Introduction for some details about how to find which labs are about topics in this part of the book.)
|
Blog Config Labs: The author’s blog includes a series of configuration-focused labs that you can do on paper, each in 10–15 minutes.|Blog Config Labs: The author’s blog includes a series of configuration-focused labs that you can do on paper, each in 10–15 minutes.
Review and perform the labs for this part of the book, as found at http://blog.certskills.com.|Review and perform the labs for this part of the book, as found at http://blog.certskills.com.
Then navigate to the Hands-on Config labs.|Then navigate to the Hands-on Config labs.
|
Other: If using other lab tools, here are a few suggestions: Make sure to experiment heavily with IPv4 addressing, static routing, and Layer 3 switching.|Other: If using other lab tools, here are a few suggestions: Make sure to experiment heavily with IPv4 addressing, static routing, and Layer 3 switching.
In each case, test all your routes using ping and traceroute.|In each case, test all your routes using ping and traceroute.
## Part V Review
Part V Review   
__|__
--|--
|
Watch Videos Chapters 15, 17, and 18 each list a video to be found on the companion website, on topics ranging from how to use the router CLI, how to configure ROAS, and how to troubleshoot using Extended ping.|Watch Videos Chapters 15, 17, and 18 each list a video to be found on the companion website, on topics ranging from how to use the router CLI, how to configure ROAS, and how to troubleshoot using Extended ping.
|
Part IV began the story in this book about IP Version 4 (IPv4) addressing.|Part IV began the story in this book about IP Version 4 (IPv4) addressing.
Part V continued that story with how to implement addressing in Cisco routers, along with a variety of methods to route packets between local interfaces.|Part V continued that story with how to implement addressing in Cisco routers, along with a variety of methods to route packets between local interfaces.
But those topics delayed the discussion of one of the most important topics in TCP/IP, namely IP routing protocols.|But those topics delayed the discussion of one of the most important topics in TCP/IP, namely IP routing protocols.
|
Routers use IP routing protocols to learn about the subnets in an internetwork, choose the current best routes to reach each subnet, and to add those routes to each router’s IP routing table.|Routers use IP routing protocols to learn about the subnets in an internetwork, choose the current best routes to reach each subnet, and to add those routes to each router’s IP routing table.
Cisco chose to include one and only one IP routing protocol in the CCNA 200-301 exam: the Open Shortest Path First (OSPF) routing protocol.|Cisco chose to include one and only one IP routing protocol in the CCNA 200-301 exam: the Open Shortest Path First (OSPF) routing protocol.
This entire part focuses on OSPF as an example of how routing protocols work.|This entire part focuses on OSPF as an example of how routing protocols work.
