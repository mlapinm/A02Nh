## Part III Implementing VLANs and STP
Часть III. Реализация сетей VLAN и STP.   
__|__
--|--
|
Part III Review|Часть III Обзор
## Chapter 8 Implementing Ethernet Virtual LANs
Глава 8 Реализация виртуальных локальных сетей Ethernet   
__|__
--|--
|
LANs This chapter covers the following exam topics:|Локальные сети В этой главе рассматриваются следующие экзаменационные темы:
###### 1.0 Network Fundamentals
1.0 Основы сети   
###### 1.13 Describe switching concepts
1.13 Описание концепций переключения   
###### 1.13.a MAC learning and aging
1.13.a Изучение MAC и старение   
###### 1.13.b Frame switching
1.13.b Переключение кадров   
###### 1.13.c Frame flooding
1.13.c Фрейм флуд   
###### 1.13.d MAC address table
1.13.d Таблица MAC-адресов   
###### 2.0 Network Access
2.0 Доступ к сети   
###### 2.1 Configure and verify VLANs (normal range) spanning multiple switches
2.1 Настройка и проверка сетей VLAN (нормальный диапазон), охватывающих несколько коммутаторов   
###### 2.1.a Access ports (data and voice)
2.1.a Порты доступа (данные и голос)   
###### 2.1.b Default VLAN
2.1.b VLAN по умолчанию   
###### 2.1.c Connectivity
2.1.c Связь   
###### 2.2 Configure and verify interswitch connectivity
2.2 Настройка и проверка межкоммутаторного подключения   
###### 2.2.a Trunk ports
2.2.a Магистральные порты   
###### 2.2.b 802.1Q
2.2.b 802.1Q   
###### 2.2.c Native VLAN
2.2.c Собственная VLAN   
__|__
--|--
|
So far in this book, you have learned that Ethernet switches receive Ethernet frames, make decisions, and then forward (switch) those Ethernet frames.|До сих пор из этой книги вы узнали, что коммутаторы Ethernet получают кадры Ethernet, принимают решения, а затем пересылают (переключают) эти кадры Ethernet.
That core logic revolves around MAC addresses, the interface in which the frame arrives, and the interfaces out which the switch forwards the frame.|Эта основная логика вращается вокруг MAC-адресов, интерфейса, в который поступает кадр, и интерфейсов, через которые коммутатор пересылает кадр.
|
While true, that logic omits any consideration of virtual LANs (VLANs).|Хотя это правда, эта логика не учитывает виртуальные локальные сети (VLAN).
VLANs impact the switching logic for each frame because each VLAN acts as a subset of the switch ports in an Ethernet LAN. Switches believe each Ethernet frame to be received in an identifiable VLAN, forwarded based on MAC table entries for that VLAN, and forwarded out ports in that VLAN. This chapter explores those concepts and others related to VLANs.|Сети VLAN влияют на логику коммутации для каждого кадра, поскольку каждая VLAN действует как подмножество портов коммутатора в локальной сети Ethernet. Коммутаторы полагают, что каждый кадр Ethernet принимается в идентифицируемой VLAN, пересылается на основе записей таблицы MAC для этой VLAN и перенаправляется на порты в этой VLAN. В этой главе рассматриваются эти и другие концепции, относящиеся к VLAN.
|
As for the organization of the chapter, the first major section of the chapter explains the core concepts.|Что касается организации главы, первый основной раздел главы объясняет основные концепции.
These concepts include how VLANs work on a single switch, how to use VLAN trunking to create VLANs that span across multiple switches, and how to forward traffic between VLANs using a router.|Эти концепции включают в себя то, как VLAN работают на одном коммутаторе, как использовать транкинг VLAN для создания VLAN, охватывающих несколько коммутаторов, и как пересылать трафик между VLAN с помощью маршрутизатора.
The second major section shows how to configure VLANs and VLAN trunks: how to statically assign interfaces to a VLAN. The final major section discusses some issues that can arise when using VLANs and trunks and how to avoid those issues.|Во втором основном разделе показано, как настроить VLAN и магистрали VLAN: как статически назначить интерфейсы для VLAN. В последнем основном разделе обсуждаются некоторые проблемы, которые могут возникнуть при использовании виртуальных локальных сетей и магистралей, и способы их устранения.
|
CHAPTER 8|ГЛАВА 8
### “Do I Know This Already?” Quiz
«Знаю ли я это уже?» Викторина   
__|__
--|--
|
Take the quiz (either here or use the PTP software) if you want to use the score to help you decide how much time to spend on this chapter.|Пройдите тест (здесь или воспользуйтесь программой PTP), если вы хотите использовать оценку, чтобы решить, сколько времени потратить на эту главу.
The letter answers are listed at the bottom of the page following the quiz.|Ответы на письма перечислены внизу страницы после викторины.
Appendix C, found both at the end of the book as well as on the companion website, includes both the answers and explanations.|Приложение C, которое можно найти как в конце книги, так и на сопутствующем веб-сайте, включает как ответы, так и пояснения.
You can also find both answers and explanations in the PTP testing software.|Вы также можете найти ответы и пояснения в программе тестирования PTP.
|
Table 8-1 “Do I Know This Already?” Foundation Topics Section-to-Question Mapping|Таблица 8-1 «Знаю ли я это уже?» Сопоставление разделов с вопросами по основным темам
### Foundation Topics
Основные темы   
### Virtual LAN Concepts
Концепции виртуальной локальной сети   
__|__
--|--
|
VLAN and VLAN Trunking Configuration and Verification 4–6 Troubleshooting VLANs and VLAN Trunks 7–8 1.|Конфигурация и проверка VLAN и VLAN Trunking 4–6 Устранение неисправностей VLAN и VLAN Trunks 7–8 1.
In a LAN, which of the following terms best equates to the term VLAN?|Какой из следующих терминов лучше всего соответствует термину VLAN в локальной сети?
|
a. Collision domain b.|а. Домен коллизий b.
Broadcast domain c.|Домен вещания c.
Subnet d.|Подсеть d.
Single switch e.|Одиночный переключатель e.
Trunk 2.|Багажник 2.
Imagine a switch with three configured VLANs. How many IP subnets are required, assuming that all hosts in all VLANs want to use TCP/IP?|Представьте себе коммутатор с тремя настроенными сетями VLAN. Сколько IP-подсетей требуется, если предположить, что все хосты во всех VLAN хотят использовать TCP / IP?
|
a. 0 b. 1 c. 2 d. 3 e.|а. 0 б. 1 в. 2 дн. 3 е.
You cannot tell from the information provided.|Вы не можете сказать из предоставленной информации.
|
3. Switch SW1 sends a frame to switch SW2 using 802.1Q trunking.|3. Коммутатор SW1 отправляет кадр коммутатору SW2, используя транкинг 802.1Q.
Which of the answers describes how SW1 changes or adds to the Ethernet frame before forwarding the frame to SW2?|Какой из ответов описывает, как SW1 изменяет или добавляет фрейм Ethernet перед пересылкой фрейма в SW2?
|
a. Inserts a 4-byte header and does change the MAC addresses b.|а. Вставляет 4-байтовый заголовок и меняет MAC-адреса. B.
Inserts a 4-byte header and does not change the MAC addresses c.|Вставляет 4-байтовый заголовок и не изменяет MAC-адреса c.
Encapsulates the original frame behind an entirely new Ethernet header d.|Инкапсулирует исходный кадр за совершенно новым заголовком Ethernet d.
None of the other answers are correct 4.|Все остальные ответы неверны 4.
Imagine that you are told that switch 1 is configured with the dynamic auto parameter for trunking on its Fa0/5 interface, which is connected to switch 2.|Представьте, что вам сообщили, что коммутатор 1 настроен с динамическим параметром auto для транкинга на его интерфейсе Fa0 / 5, который подключен к коммутатору 2.
You have to configure switch 2.|Вам необходимо настроить переключатель 2.
Which of the following settings for trunking could allow trunking to work? (Choose two answers.)|Какие из следующих настроек транкинга могут позволить транкинг работать? (Выберите два ответа.)
|
a. on b. dynamic auto c. dynamic desirable d. access e.|а. на б. динамический авто c. динамический желательно d. доступ e.
None of the other answers are correct.|Все остальные ответы неверны.
|
5. A switch has just arrived from Cisco.|5. Только что прибыл коммутатор от Cisco.
The switch has never been configured with any VLANs, but VTP has been disabled.|Коммутатор никогда не настраивался с какими-либо VLAN, но VTP был отключен.
An engineer configures the vlan 22 and name Hannahs-VLAN commands and then exits configuration mode.|Инженер настраивает команды vlan 22 и name Hannahs-VLAN, а затем выходит из режима конфигурации.
Which of the following are true? (Choose two answers.)|Что из следующего верно? (Выберите два ответа.)
|
a. VLAN 22 is listed in the output of the show vlan brief command.|а. Сеть VLAN 22 указана в выходных данных команды show vlan Short.
|
b. VLAN 22 is listed in the output of the show running-config command.|б. Сеть VLAN 22 указана в выходных данных команды show running-config.
|
c. VLAN 22 is not created by this process.|c. VLAN 22 этим процессом не создается.
|
d. VLAN 22 does not exist in that switch until at least one interface is assigned to that VLAN.|d. VLAN 22 не существует в этом коммутаторе до тех пор, пока для этой VLAN не будет назначен хотя бы один интерфейс.
|
6. Which of the following commands identify switch interfaces as being trunking interfaces:|6. Какие из следующих команд определяют интерфейсы коммутатора как транкинговые интерфейсы:
|
interfaces that currently operate as VLAN trunks? (Choose two answers.)|интерфейсы, которые в настоящее время работают как магистрали VLAN? (Выберите два ответа.)
|
a. show interfaces b. show interfaces switchport c. show interfaces trunk d. show trunks 7.|а. показать интерфейсы b. показать интерфейсы switchport c. показать магистраль интерфейсов d. показать стволы 7.
In a switch that disables VTP, an engineer configures the commands vlan 30 and shutdown vlan 30.|В коммутаторе, отключающем VTP, инженер настраивает команды vlan 30 и shutdown vlan 30.
Which answers should be true about this switch? (Choose two answers.)|Какие ответы должны быть верными об этом переключателе? (Выберите два ответа.)
|
a. The show vlan brief command should list VLAN 30.|а. Команда show vlan Short должна отобразить VLAN 30.
|
b. The show running-config command should list VLAN 30.|б. Команда show running-config должна отобразить VLAN 30.
|
c. The switch should forward frames that arrive in access ports in VLAN 30.|c. Коммутатор должен пересылать кадры, которые поступают в порты доступа в VLAN 30.
|
d. The switch should forward frames that arrive in trunk ports tagged with VLAN 30.|d. Коммутатор должен пересылать кадры, которые поступают в магистральные порты, помеченные VLAN 30.
|
8. The show interfaces g0/1 trunk command provides three lists of VLAN IDs. Which items would limit the VLANs that appear in the first of the three lists of VLANs?|8. Команда транка show interfaces g0 / 1 предоставляет три списка идентификаторов VLAN. Какие элементы будут ограничивать VLAN, которые появляются в первом из трех списков VLAN?
|
a. A shutdown vlan 30 global command b.|а. Глобальная команда выключения vlan 30 b.
A switchport trunk allowed vlan interface subcommand c.|Транк коммутатора разрешил подкоманду интерфейса vlan c.
An STP choice to block on G0/1 d.|Выбор STP для блокировки на G0 / 1 d.
A no vlan 30 global command Foundation Topics Virtual LAN Concepts Before understanding VLANs, you must first have a specific understanding of the definition of a LAN. For example, from one perspective, a LAN includes all the user devices, servers, switches, routers, cables, and wireless access points in one location.|Глобальная команда no vlan 30 Основные темы Основные понятия о виртуальных локальных сетях Прежде чем разбираться в виртуальных локальных сетях, вы должны сначала иметь конкретное понимание определения локальной сети. Например, с одной точки зрения, ЛВС включает в себя все пользовательские устройства, серверы, коммутаторы, маршрутизаторы, кабели и точки беспроводного доступа в одном месте.
However, an alternative narrower definition of a LAN can help in understanding the concept of a virtual LAN:|Однако альтернативное более узкое определение LAN может помочь в понимании концепции виртуальной LAN:
|
A LAN includes all devices in the same broadcast domain.|ЛВС включает все устройства в одном широковещательном домене.
|
A broadcast domain includes the set of all LAN-connected devices, so that when any of the devices sends a broadcast frame, all the other devices get a copy of the frame.|Широковещательный домен включает в себя набор всех устройств, подключенных к локальной сети, так что, когда какое-либо из устройств отправляет широковещательный кадр, все другие устройства получают его копию.
So, from one perspective, you can think of a LAN and a broadcast domain as being basically the same thing.|Итак, с одной точки зрения, вы можете рассматривать локальную сеть и широковещательный домен как одно и то же.
|
Using only default settings, a switch considers all its interfaces to be in the same broadcast domain.|Используя только настройки по умолчанию, коммутатор считает, что все его интерфейсы находятся в одном широковещательном домене.
That is, for one switch, when a broadcast frame entered one switch port, the switch forwards that broadcast frame out all other ports.|То есть для одного коммутатора, когда широковещательный кадр поступает на один порт коммутатора, коммутатор пересылает этот широковещательный кадр на все другие порты.
With that logic, to create two different LAN broadcast domains, you had to buy two different Ethernet LAN switches, as shown in Figure 8-1.|При такой логике для создания двух разных широковещательных доменов LAN вам пришлось купить два разных коммутатора Ethernet LAN, как показано на рис. 8-1.
|
Figure 8-1 Creating Two Broadcast Domains with Two Physical Switches and No VLANs By using two VLANs, a single switch can accomplish the same goals of the design in Figure 8-1—to create two broadcast domains—with a single switch.|Рис. 8-1. Создание двух широковещательных доменов с двумя физическими коммутаторами и без виртуальных локальных сетей. Используя две виртуальные локальные сети, один коммутатор может достичь тех же целей, что и на рисунке 8-1, - создать два широковещательных домена - с одним коммутатором.
With VLANs, a switch can configure some interfaces into one broadcast domain and some into another, creating multiple broadcast domains.|С помощью виртуальных локальных сетей коммутатор может настроить некоторые интерфейсы на один широковещательный домен, а некоторые на другой, создавая несколько широковещательных доменов.
These individual broadcast domains created by the switch are called virtual LANs (VLAN).|Эти отдельные широковещательные домены, созданные коммутатором, называются виртуальными локальными сетями (VLAN).
|
For example, in Figure 8-2, the single switch creates two VLANs, treating the ports in each VLAN as being completely separate.|Например, на рис. 8-2 один коммутатор создает две сети VLAN, обрабатывая порты в каждой VLAN как полностью отдельные.
The switch would never forward a frame sent by Dino (in VLAN 1) over to either Wilma or Betty (in VLAN 2).|Коммутатор никогда не пересылает кадр, отправленный Dino (в VLAN 1), ни Wilma, ни Betty (в VLAN 2).
|
Figure 8-2 Creating Two Broadcast Domains Using One Switch and VLANs Designing campus LANs to use more VLANs, each with a smaller number of devices, often helps improve the LAN in many ways.|Рис. 8-2. Создание двух широковещательных доменов с использованием одного коммутатора и виртуальных локальных сетей. Проектирование кампусных локальных сетей для использования большего количества виртуальных локальных сетей, каждая из которых имеет меньшее количество устройств, часто помогает улучшить локальную сеть во многих отношениях.
For example, a broadcast sent by one host in a VLAN will be received and processed by all the other hosts in the VLAN—but not by hosts in a different VLAN. Limiting the number of hosts that receive a single broadcast frame reduces the number of hosts that waste effort processing unneeded broadcasts.|Например, широковещательная рассылка, отправленная одним хостом в VLAN, будет приниматься и обрабатываться всеми другими хостами в VLAN, но не хостами в другой VLAN. Ограничение количества хостов, получающих один широковещательный фрейм, уменьшает количество хостов, которые тратят усилия на обработку ненужных широковещательных сообщений.
It also reduces security risks because fewer hosts see frames sent by any one host.|Это также снижает риски безопасности, потому что меньшее количество хостов видит кадры, отправленные одним хостом.
These are just a few reasons for separating hosts into different VLANs. The following list summarizes the most common reasons for choosing to create smaller broadcast domains (VLANs):|Это всего лишь несколько причин для разделения хостов на разные VLAN. В следующем списке перечислены наиболее распространенные причины создания небольших широковещательных доменов (VLAN):
###### To reduce CPU overhead on each device, improving host performance, by reducing the
Чтобы уменьшить нагрузку на ЦП на каждом устройстве, повысить производительность хоста за счет уменьшения   
__|__
--|--
|
number of devices that receive each broadcast frame|количество устройств, получающих каждый широковещательный кадр
###### To reduce security risks by reducing the number of hosts that receive copies of frames
Снижение рисков безопасности за счет уменьшения количества хостов, получающих копии фреймов.   
__|__
--|--
|
that the switches flood (broadcasts, multicasts, and unknown unicasts)|что коммутаторы наводняют (широковещательные, многоадресные и неизвестные одноадресные)
###### To improve security for hosts through the application of different security policies per
Для повышения безопасности хостов за счет применения различных политик безопасности на   
__|__
--|--
|
VLAN|VLAN
###### To create more flexible designs that group users by department, or by groups that work
Для создания более гибких дизайнов, группирующих пользователей по отделам или по группам, которые работают   
__|__
--|--
|
together, instead of by physical location|вместе, а не по физическому местонахождению
###### To solve problems more quickly, because the failure domain for many problems is the
Чтобы решать проблемы быстрее, потому что область отказа для многих проблем - это   
__|__
--|--
|
same set of devices as those in the same broadcast domain|тот же набор устройств, что и в том же широковещательном домене
###### To reduce the workload for the Spanning Tree Protocol (STP) by limiting a VLAN to a
Чтобы уменьшить рабочую нагрузку на протокол связующего дерева (STP), ограничив VLAN до   
__|__
--|--
|
single access switch The rest of this chapter looks closely at the mechanics of how VLANs work across multiple Cisco switches, including the required configuration.|единый коммутатор доступа В оставшейся части этой главы подробно рассматривается механизм работы VLAN на нескольких коммутаторах Cisco, включая требуемую конфигурацию.
To that end, the next section examines VLAN trunking, a feature required when installing a VLAN that exists on more than one LAN switch.|С этой целью в следующем разделе исследуется транкинг VLAN, функция, необходимая при установке VLAN, которая существует более чем на одном коммутаторе LAN.
#### Creating Multiswitch VLANs Using Trunking
Создание сетей VLAN с несколькими коммутаторами с использованием транкинга   
__|__
--|--
|
Configuring VLANs on a single switch requires only a little effort: you simply configure each port to tell it the VLAN number to which the port belongs.|Для настройки VLAN на одном коммутаторе требуется совсем немного усилий: вы просто настраиваете каждый порт, чтобы сообщить ему номер VLAN, к которому он принадлежит.
With multiple switches, you have to consider additional concepts about how to forward traffic between the switches.|При использовании нескольких коммутаторов необходимо учитывать дополнительные концепции перенаправления трафика между коммутаторами.
|
When you are using VLANs in networks that have multiple interconnected switches, the switches need to use VLAN trunking on the links between the switches.|Когда вы используете VLAN в сетях, которые имеют несколько взаимосвязанных коммутаторов, коммутаторы должны использовать транкинг VLAN на каналах между коммутаторами.
VLAN trunking causes the switches to use a process called VLAN tagging, by which the sending switch adds another header to the frame before sending it over the trunk.|Транкинг VLAN заставляет коммутаторы использовать процесс, называемый тегированием VLAN, с помощью которого передающий коммутатор добавляет другой заголовок к кадру перед его отправкой по магистрали.
This extra trunking header includes a VLAN identifier (VLAN ID) field so that the sending switch can associate the frame with a particular VLAN ID, and the receiving switch can then know in what VLAN each frame belongs.|Этот дополнительный заголовок транкинга включает поле идентификатора VLAN (VLAN ID), чтобы отправляющий коммутатор мог связать кадр с конкретным идентификатором VLAN, а затем принимающий коммутатор мог знать, к какой VLAN принадлежит каждый кадр.
|
Figure 8-3 shows an example that demonstrates VLANs that exist on multiple switches, but it does not use trunking.|На рис. 8-3 показан пример, демонстрирующий сети VLAN, существующие на нескольких коммутаторах, но не использующие транкинг.
First, the design uses two VLANs: VLAN 10 and VLAN 20.|Во-первых, в проекте используются две VLAN: VLAN 10 и VLAN 20.
Each switch has two ports assigned to each VLAN, so each VLAN exists in both switches.|Каждый коммутатор имеет два порта, назначенных каждой VLAN, поэтому каждая VLAN существует в обоих коммутаторах.
To forward traffic in VLAN 10 between the two switches, the design includes a link between switches, with that link fully inside VLAN 10.|Для пересылки трафика в VLAN 10 между двумя коммутаторами конструкция включает канал между коммутаторами, причем этот канал полностью находится внутри VLAN 10.
Likewise, to support VLAN 20 traffic between switches, the design uses a second link between switches, with that link inside VLAN 20.|Аналогичным образом, для поддержки трафика VLAN 20 между коммутаторами в проекте используется второй канал между коммутаторами, причем этот канал находится внутри VLAN 20.
|
The design in Figure 8-3 functions perfectly.|Дизайн на Рисунке 8-3 работает идеально.
For example, PC11 (in VLAN 10) can send a frame to PC14.|Например, ПК11 (в VLAN 10) может отправить кадр на ПК14.
The frame flows into SW1, over the top link (the one that is in VLAN 10)|Кадр перетекает в SW1 по верхнему каналу (тот, который находится в VLAN 10).
|
and over to SW2.|и перейти к SW2.
|
Figure 8-3 Multiswitch VLAN Without VLAN Trunking The design shown in Figure 8-3 works, but it simply does not scale very well.|Рисунок 8-3 Многокоммутаторная VLAN без транкинга VLAN Конструкция, показанная на Рисунке 8-3, работает, но она просто не очень хорошо масштабируется.
It requires one physical link between switches to support every VLAN. If a design needed 10 or 20 VLANs, you would need 10 or 20 links between switches, and you would use 10 or 20 switch ports (on each switch) for those links.|Для поддержки каждой VLAN требуется одно физическое соединение между коммутаторами. Если для проекта требуется 10 или 20 VLAN, вам потребуется 10 или 20 каналов между коммутаторами, и вы должны использовать 10 или 20 портов коммутатора (на каждом коммутаторе) для этих каналов.
##### VLAN Tagging Concepts
Концепции тегов VLAN   
__|__
--|--
|
VLAN trunking creates one link between switches that supports as many VLANs as you need.|Транкинг VLAN создает одно соединение между коммутаторами, которое поддерживает столько VLAN, сколько вам нужно.
As a VLAN trunk, the switches treat the link as if it were a part of all the VLANs. At the same time, the trunk keeps the VLAN traffic separate, so frames in VLAN 10 would not go to devices in VLAN 20, and vice versa, because each frame is identified by VLAN number as it crosses the trunk.|В качестве магистрали VLAN коммутаторы рассматривают канал так, как если бы он был частью всех VLAN. В то же время магистраль разделяет трафик VLAN, поэтому кадры в VLAN 10 не будут поступать на устройства в VLAN 20, и наоборот, потому что каждый кадр идентифицируется номером VLAN при пересечении магистрали.
Figure 8-4 shows the idea, with a single physical link between the two switches.|На рис. 8-4 показана идея с одной физической связью между двумя коммутаторами.
|
Figure 8-4 Multiswitch VLAN with Trunking The use of trunking allows switches to forward frames from multiple VLANs over a single physical connection by adding a small header to the Ethernet frame.|Рис. 8-4 Многокоммутаторная VLAN с транкингом Использование транкинга позволяет коммутаторам пересылать кадры из нескольких VLAN по одному физическому соединению, добавляя небольшой заголовок к кадру Ethernet.
For example, Figure 8-5 shows PC11 sending a broadcast frame on interface Fa0/1 at Step 1.|Например, на рис. 8-5 показано, что ПК11 отправляет широковещательный кадр по интерфейсу Fa0 / 1 на шаге 1.
To flood the frame, switch SW1 needs to forward the broadcast frame to switch SW2. However, SW1 needs to let SW2 know that the frame is part of VLAN 10, so that after the frame is received, SW2 will flood the frame only into VLAN 10, and not into VLAN 20.|Для лавинной рассылки кадра коммутатор SW1 должен переслать широковещательный кадр коммутатору SW2. Однако SW1 должен сообщить SW2, что фрейм является частью VLAN 10, так что после того, как фрейм будет получен, SW2 направит его только в VLAN 10, а не во VLAN 20.
So, as shown at Step 2, before sending the frame, SW1 adds a VLAN header to the original Ethernet frame, with the VLAN header listing a VLAN ID of 10 in this case.|Итак, как показано на шаге 2, перед отправкой кадра SW1 добавляет заголовок VLAN к исходному кадру Ethernet, причем в этом случае заголовок VLAN содержит идентификатор VLAN, равный 10.
|
Figure 8-5 VLAN Trunking Between Two Switches When SW2 receives the frame, it understands that the frame is in VLAN 10.|Рисунок 8-5 Транкинг VLAN между двумя коммутаторами Когда SW2 получает кадр, он понимает, что кадр находится в VLAN 10.
SW2 then removes the VLAN header, forwarding the original frame out its interfaces in VLAN 10 (Step 3).|Затем SW2 удаляет заголовок VLAN, перенаправляя исходный кадр из своих интерфейсов в VLAN 10 (шаг 3).
|
For another example, consider the case when PC21 (in VLAN 20) sends a broadcast.|В качестве другого примера рассмотрим случай, когда PC21 (в VLAN 20) отправляет широковещательную рассылку.
|
SW1 sends the broadcast out port Fa0/4 (because that port is in VLAN 20) and out Gi0/1 (because it is a trunk, meaning that it supports multiple different VLANs).|SW1 отправляет широковещательный выходной порт Fa0 / 4 (потому что этот порт находится в VLAN 20) и выводит Gi0 / 1 (поскольку это транк, что означает, что он поддерживает несколько разных VLAN).
SW1 adds a trunking header to the frame, listing a VLAN ID of 20.|SW1 добавляет к кадру заголовок транкинга, в котором указан идентификатор VLAN 20.
SW2 strips off the trunking header after determining that the frame is part of VLAN 20, so SW2 knows to forward the frame out only ports Fa0/3 and Fa0/4, because they are in VLAN 20, and not out ports Fa0/1 and Fa0/2, because they are in VLAN 10.|SW2 удаляет заголовок транкинга после определения того, что кадр является частью VLAN 20, поэтому SW2 знает, что следует пересылать кадр только через порты Fa0 / 3 и Fa0 / 4, потому что они находятся в VLAN 20, а не из портов Fa0 / 1 и Fa0 / 2, потому что они находятся в VLAN 10.
##### The 802.1Q and ISL VLAN Trunking Protocols
Протоколы транкинга VLAN 802.1Q и ISL   
__|__
--|--
|
Cisco has supported two different trunking protocols over the years: Inter-Switch Link (ISL)|Cisco поддерживает два разных транкинговых протокола на протяжении многих лет: Inter-Switch Link (ISL)
|
and IEEE 802.1Q.|и IEEE 802.1Q.
Cisco created the ISL years before 802.1Q, in part because the IEEE had not yet defined a VLAN trunking standard.|Cisco создала ISL за несколько лет до 802.1Q, отчасти потому, что IEEE еще не определил стандарт транкинга VLAN.
Today, 802.1Q has become the more popular trunking protocol, with Cisco not even bothering to support ISL in many of its switch models today.|Сегодня 802.1Q стал более популярным протоколом транкинга, и Cisco даже не позаботилась о поддержке ISL во многих своих моделях коммутаторов.
|
While both ISL and 802.1Q tag each frame with the VLAN ID, the details differ. 802.1Q inserts an extra 4-byte 802.1Q VLAN header into the original frame’s Ethernet header, as shown at the top of Figure 8-6.|Хотя и ISL, и 802.1Q помечают каждый кадр идентификатором VLAN, детали различаются. 802.1Q вставляет дополнительный 4-байтовый заголовок 802.1Q VLAN в заголовок Ethernet исходного кадра, как показано в верхней части рисунка 8-6.
As for the fields in the 802.1Q header, only the 12-bit VLAN ID field inside the 802.1Q header matters for topics discussed in this book.|Что касается полей в заголовке 802.1Q, то только 12-битное поле VLAN ID внутри заголовка 802.1Q имеет значение для тем, обсуждаемых в этой книге.
This 12-bit field supports a theoretical maximum of 212 (4096) VLANs, but in practice it supports a maximum of 4094. (Both 802.1Q and ISL use 12 bits to tag the VLAN ID, with two reserved values [0 and 4095].)|Это 12-битное поле поддерживает теоретический максимум 212 (4096) VLAN, но на практике оно поддерживает максимум 4094. (И 802.1Q, и ISL используют 12 бит для маркировки идентификатора VLAN с двумя зарезервированными значениями [0 и 4095] .)
|
Cisco switches break the range of VLAN IDs (1–4094) into two ranges: the normal range and the extended range.|Коммутаторы Cisco разбивают диапазон идентификаторов VLAN (1–4094) на два диапазона: нормальный диапазон и расширенный диапазон.
All switches can use normal-range VLANs with values from 1 to 1005.|Все коммутаторы могут использовать VLAN нормального диапазона со значениями от 1 до 1005.
|
Only some switches can use extended-range VLANs with VLAN IDs from 1006 to 4094.|Только некоторые коммутаторы могут использовать VLAN расширенного диапазона с идентификаторами VLAN от 1006 до 4094.
|
The rules for which switches can use extended-range VLANs depend on the configuration of the VLAN Trunking Protocol (VTP), which is discussed briefly in the section “VLAN Trunking Configuration,” later in this chapter.|Правила, по которым коммутаторы могут использовать VLAN с расширенным диапазоном, зависят от конфигурации протокола VLAN Trunking Protocol (VTP), который кратко обсуждается в разделе «Конфигурация транкинга VLAN» далее в этой главе.
|
802.1Q Dest.|802.1Q Dest.
Address Source Address Tag Type Data FCS Type Priority Flag VLAN ID (12 Bits)|Адрес Источник Адрес Тип тега Данные Тип FCS Флаг приоритета Идентификатор VLAN (12 бит)
|
Figure 8-6 802.1Q Trunking 802.1Q also defines one special VLAN ID on each trunk as the native VLAN (defaulting to use VLAN 1).|Рис. 8-6. Транкинг 802.1Q 802.1Q также определяет один специальный идентификатор VLAN для каждого транка в качестве собственной VLAN (по умолчанию используется VLAN 1).
By definition, 802.1Q simply does not add an 802.1Q header to frames in the native VLAN. When the switch on the other side of the trunk receives a frame that does not have an 802.1Q header, the receiving switch knows that the frame is part of the native VLAN. Note that because of this behavior, both switches must agree on which VLAN is the native VLAN.|По определению 802.1Q просто не добавляет заголовок 802.1Q к кадрам в собственной VLAN. Когда коммутатор на другой стороне магистрали получает кадр, не имеющий заголовка 802.1Q, принимающий коммутатор знает, что кадр является частью собственной VLAN. Обратите внимание, что из-за такого поведения оба коммутатора должны согласовать, какая VLAN является собственной VLAN.
|
The 802.1Q native VLAN provides some interesting functions, mainly to support connections to devices that do not understand trunking.|Собственная VLAN 802.1Q предоставляет некоторые интересные функции, в основном для поддержки подключений к устройствам, которые не поддерживают транкинг.
For example, a Cisco switch could be cabled to a switch that does not understand 802.1Q trunking.|Например, коммутатор Cisco может быть подключен кабелем к коммутатору, который не поддерживает транкинг 802.1Q.
The Cisco switch could send frames in the native VLAN—meaning that the frame has no trunking header—so that the other switch would understand the frame.|Коммутатор Cisco может отправлять кадры в собственной VLAN - это означает, что кадр не имеет транкинг-заголовка, - чтобы другой коммутатор понял кадр.
The native VLAN concept gives switches the capability of at least passing traffic in one VLAN (the native VLAN), which can allow some basic functions, like reachability to telnet into a switch.|Концепция собственной VLAN дает коммутаторам возможность, по крайней мере, передавать трафик в одной VLAN (собственная VLAN), что позволяет использовать некоторые базовые функции, такие как доступность telnet в коммутатор.
#### Forwarding Data Between VLANs
Пересылка данных между VLAN   
__|__
--|--
|
If you create a campus LAN that contains many VLANs, you typically still need all devices to be able to send data to all other devices.|Если вы создаете локальную сеть кампуса, содержащую множество виртуальных локальных сетей, вам, как правило, все равно нужно, чтобы все устройства могли отправлять данные на все другие устройства.
This next topic discusses some concepts about how to route data between those VLANs.|В следующем разделе обсуждаются некоторые концепции маршрутизации данных между этими VLAN.
##### The Need for Routing Between VLANs
Необходимость маршрутизации между VLAN   
__|__
--|--
|
LAN switches that forward data based on Layer 2 logic, as discussed so far in this book, often go by the name Layer 2 switch.|Коммутаторы LAN, которые пересылают данные на основе логики уровня 2, как обсуждалось до сих пор в этой книге, часто называют коммутатором уровня 2.
For example, Chapter 5, “Analyzing Ethernet LAN Switching,” discussed how LAN switches receive Ethernet frames (a Layer 2 concept), look at the destination Ethernet MAC address (a Layer 2 address), and forward the Ethernet frame out some other interface.|Например, в главе 5 «Анализ коммутации Ethernet LAN» обсуждалось, как коммутаторы LAN получают кадры Ethernet (концепция уровня 2), смотрят на MAC-адрес назначения Ethernet (адрес уровня 2) и пересылают кадр Ethernet на какой-либо другой интерфейс. .
All those concepts are defined by Layer 2 protocols, hence the name Layer 2 switch.|Все эти концепции определены протоколами уровня 2, отсюда и название коммутатора уровня 2.
|
Layer 2 switches perform their logic per VLAN. For example, in Figure 8-7, the two PCs on the left sit in VLAN 10, in subnet 10.|Коммутаторы уровня 2 выполняют свою логику для каждой VLAN. Например, на рисунке 8-7 два компьютера слева находятся в сети VLAN 10, в подсети 10.
The two PCs on the right sit in a different VLAN (20), with a different subnet (20).|Два компьютера справа находятся в другой VLAN (20) с другой подсетью (20).
Note that the figure repeats earlier Figure 8-2, but with the switch broken into halves, to emphasize the point that Layer 2 switches will not forward data between two VLANs.|Обратите внимание, что рисунок повторяется ранее, рисунок 8-2, но с коммутатором, разбитым пополам, чтобы подчеркнуть, что коммутаторы уровня 2 не будут пересылать данные между двумя VLAN.
|
As shown in the figure, when configured with some ports in VLAN 10 and others in VLAN 20, the switch acts like two separate switches in which it will forward traffic.|Как показано на рисунке, при настройке некоторых портов в VLAN 10 и других в VLAN 20 коммутатор действует как два отдельных коммутатора, в которых он будет пересылать трафик.
In fact, one goal of VLANs is to separate traffic in one VLAN from another, preventing frames in one VLAN from leaking over to other VLANs. For example, when Dino (in VLAN 10) sends any Ethernet frame, if SW1 is a Layer 2 switch, that switch will not forward the frame to the PCs on the right in VLAN 20.|Фактически, одна из целей VLAN - отделить трафик в одной VLAN от другой, предотвращая утечку кадров из одной VLAN в другие VLAN. Например, когда Dino (в VLAN 10) отправляет любой кадр Ethernet, если SW1 является коммутатором уровня 2, этот коммутатор не будет пересылать кадр на ПК справа в VLAN 20.
|
Figure 8-7 Layer 2 Switch Does Not Route Between the VLANs|Рисунок 8-7 Коммутатор уровня 2 не выполняет маршрутизацию между VLAN
##### Routing Packets Between VLANs with a Router
Маршрутизация пакетов между VLAN с помощью маршрутизатора   
__|__
--|--
|
When including VLANs in a campus LAN design, the devices in a VLAN need to be in the same subnet.|При включении сетей VLAN в проект LAN кампуса устройства в VLAN должны находиться в одной подсети.
Following the same design logic, devices in different VLANs need to be in different subnets.|Следуя одинаковой логике проектирования, устройства в разных VLAN должны находиться в разных подсетях.
|
To forward packets between VLANs, the network must use a device that acts as a router.|Для пересылки пакетов между VLAN сеть должна использовать устройство, которое действует как маршрутизатор.
You can use an actual router, as well as some other switches that can perform some functions like a router.|Вы можете использовать настоящий маршрутизатор, а также некоторые другие коммутаторы, которые могут выполнять некоторые функции, такие как маршрутизатор.
These switches that also perform Layer 3 routing functions go by the name multilayer switch or Layer 3 switch.|Эти коммутаторы, которые также выполняют функции маршрутизации уровня 3, называются многоуровневыми коммутаторами или коммутаторами уровня 3.
This section first discusses how to forward data between VLANs when using Layer 2 switches and ends with a brief discussion of how to use Layer 3 switches.|В этом разделе сначала обсуждается, как пересылать данные между VLAN при использовании коммутаторов уровня 2, а в конце кратко обсуждается, как использовать коммутаторы уровня 3.
|
For example, Figure 8-8 shows a router that can route packets between subnets 10 and 20.|Например, на рисунке 8-8 показан маршрутизатор, который может маршрутизировать пакеты между подсетями 10 и 20.
|
The figure shows the same Layer 2 switch as shown in Figure 8-7, with the same perspective of the switch being split into parts with two different VLANs, and with the same PCs in the same VLANs and subnets.|На рисунке показан тот же коммутатор уровня 2, что и на рисунке 8-7, с той же перспективой разделения коммутатора на части с двумя разными VLAN и с одними и теми же компьютерами в тех же VLAN и подсетях.
Now Router R1 has one LAN physical interface connected to the switch and assigned to VLAN 10, and a second physical interface connected to the switch and assigned to VLAN 20.|Теперь у маршрутизатора R1 есть один физический интерфейс LAN, подключенный к коммутатору и назначенный VLAN 10, а второй физический интерфейс, подключенный к коммутатору и назначенный VLAN 20.
With an interface connected to each subnet, the Layer 2 switch can keep doing its job—forwarding frames inside a VLAN, while the router can do its job—|С интерфейсом, подключенным к каждой подсети, коммутатор уровня 2 может продолжать выполнять свою работу - пересылать кадры внутри VLAN, в то время как маршрутизатор может выполнять свою работу -
|
routing IP packets between the subnets.|маршрутизация IP-пакетов между подсетями.
|
Figure 8-8 Routing Between Two VLANs on Two Physical Interfaces The figure shows an IP packet being routed from Fred, which sits in one VLAN/subnet, to Betty, which sits in the other.|Рисунок 8-8 Маршрутизация между двумя VLAN на двух физических интерфейсах На рисунке показан IP-пакет, маршрутизируемый от Фреда, который находится в одной VLAN / подсети, к Бетти, которая находится в другой.
The Layer 2 switch forwards two different Layer 2 Ethernet frames: one in VLAN 10, from Fred to R1’s F0/0 interface, and the other in VLAN 20, from R1’s F0/1 interface to Betty.|Коммутатор уровня 2 пересылает два разных кадра Ethernet уровня 2: один в VLAN 10 от Фреда к интерфейсу F0 / 0 маршрутизатора R1, а другой - к VLAN 20 от интерфейса F0 / 1 маршрутизатора R1 к Бетти.
From a Layer 3 perspective, Fred sends the IP packet to its default router (R1), and R1 routes the packet out another interface (F0/1) into another subnet where Betty resides.|С точки зрения уровня 3 Фред отправляет IP-пакет своему маршрутизатору по умолчанию (R1), а R1 направляет пакет через другой интерфейс (F0 / 1) в другую подсеть, где проживает Бетти.
|
The design in Figure 8-8 works, but there are several different solutions for routing packets between VLANs. This chapter shows the option of using a separate physical router, with a separate link per VLAN, because it can be the easiest of the options to understand and visualize.|Схема на рис. 8-8 работает, но есть несколько различных решений для маршрутизации пакетов между VLAN. В этой главе показан вариант использования отдельного физического маршрутизатора с отдельной ссылкой для каждой VLAN, поскольку это самый простой для понимания и визуализации вариант.
|
Chapter 17, “IP Routing in the LAN,” works through those other features for routing packets between VLANs.|Глава 17 «IP-маршрутизация в локальной сети» использует эти другие функции для маршрутизации пакетов между сетями VLAN.
### VLAN and VLAN Trunking Configuration and Verification
Конфигурация и проверка VLAN и VLAN Trunking   
__|__
--|--
|
Verification Cisco switches do not require any configuration to work.|Проверка Коммутаторы Cisco не требуют настройки для работы.
You can purchase Cisco switches, install devices with the correct cabling, turn on the switches, and they work.|Вы можете приобрести коммутаторы Cisco, установить устройства с правильной разводкой кабелей, включить коммутаторы, и они будут работать.
You would never need to configure the switch, and it would work fine, even if you interconnected switches, until you needed more than one VLAN. But if you want to use VLANs—and most enterprise networks do—you need to add some configuration.|Вам никогда не потребуется настраивать коммутатор, и он будет работать нормально, даже если вы соедините коммутаторы между собой, пока вам не понадобится более одной VLAN. Но если вы хотите использовать VLAN - а это делает большинство корпоративных сетей - вам нужно добавить некоторую конфигурацию.
|
This chapter separates the VLAN configuration details into two major sections.|В этой главе детали конфигурации VLAN разделены на два основных раздела.
The first section looks at how to configure static access interfaces: switch interfaces configured to be in one VLAN only, therefore not using VLAN trunking.|В первом разделе рассматривается, как настроить статические интерфейсы доступа: интерфейсы коммутатора настроены для работы только в одной VLAN, поэтому не используются транкинг VLAN.
The second part shows how to configure interfaces that do use VLAN trunking.|Во второй части показано, как настроить интерфейсы, которые действительно используют транкинг VLAN.
#### Creating VLANs and Assigning Access VLANs to an Interface
Создание сетей VLAN и назначение сетей доступа VLAN интерфейсу   
__|__
--|--
|
This section shows how to create a VLAN, give the VLAN a name, and assign interfaces to a VLAN. To focus on these basic details, this section shows examples using a single switch, so VLAN trunking is not needed.|В этом разделе показано, как создать VLAN, присвоить этой VLAN имя и назначить интерфейсы для VLAN. Чтобы сосредоточиться на этих основных деталях, в этом разделе показаны примеры использования одного коммутатора, поэтому транкинг VLAN не требуется.
|
For a Cisco switch to forward frames in a particular VLAN, the switch must be configured to believe that the VLAN exists.|Чтобы коммутатор Cisco пересылал кадры в определенной VLAN, коммутатор должен быть настроен так, чтобы полагать, что VLAN существует.
In addition, the switch must have nontrunking interfaces (called access interfaces, or static access interfaces) assigned to the VLAN, and/or trunks that support the VLAN. The configuration steps for access interfaces are as follows:|Кроме того, в коммутаторе должны быть неуправляемые интерфейсы (называемые интерфейсами доступа или статическими интерфейсами доступа), назначенные для VLAN, и / или транки, поддерживающие VLAN. Шаги настройки интерфейсов доступа следующие:
|
Step 1.|Шаг 1.
To configure a new VLAN, follow these steps:|Чтобы настроить новую VLAN, выполните следующие действия:
|
A. From configuration mode, use the vlan vlan-id command in global configuration mode to create the VLAN and to move the user into VLAN configuration mode.|A. В режиме конфигурации используйте команду vlan vlan-id в режиме глобальной конфигурации, чтобы создать VLAN и переместить пользователя в режим конфигурации VLAN.
|
B. (Optional) Use the name name command in VLAN configuration mode to list a name for the VLAN. If not configured, the VLAN name is VLANZZZZ, where ZZZZ is the four-digit decimal VLAN ID.|B. (Необязательно) Используйте команду name name в режиме конфигурации VLAN, чтобы указать имя для VLAN. Если не настроено, имя VLAN - VLANZZZZ, где ZZZZ - четырехзначный десятичный идентификатор VLAN.
|
Step 2.|Шаг 2.
For each access interface, follow these steps:|Для каждого интерфейса доступа выполните следующие действия:
|
A. Use the interface type number command in global configuration mode to move into interface configuration mode for each desired interface.|A. Используйте команду номера типа интерфейса в режиме глобальной конфигурации, чтобы перейти в режим конфигурации интерфейса для каждого желаемого интерфейса.
|
B. Use the switchport access vlan id-number command in interface configuration mode to specify the VLAN number associated with that interface.|B. Используйте команду switchport access vlan id-number в режиме настройки интерфейса, чтобы указать номер VLAN, связанный с этим интерфейсом.
|
C. (Optional) Use the switchport mode access command in interface configuration mode to make this port always operate in access mode (that is, to not trunk).|C. (Необязательно) Используйте команду switchport mode access в режиме настройки интерфейса, чтобы этот порт всегда работал в режиме доступа (то есть не в магистральном режиме).
|
While the list might look a little daunting, the process on a single switch is actually pretty simple.|Хотя список может показаться немного устрашающим, процесс с одним переключателем на самом деле довольно прост.
For example, if you want to put the switch’s ports in three VLANs—11, 12, and Config Checklist 13—you first add three vlan commands: vlan 11, vlan 12, and vlan 13.|Например, если вы хотите поместить порты коммутатора в три VLAN - 11, 12 и контрольный список конфигурации 13 - вы сначала добавляете три команды vlan: vlan 11, vlan 12 и vlan 13.
Then, for each interface, add a switchport access vlan 11 (or 12 or 13) command to assign that interface to the proper VLAN.|Затем для каждого интерфейса добавьте команду switchport access vlan 11 (или 12, или 13), чтобы назначить этот интерфейс соответствующей VLAN.
|
NOTE The term default VLAN (as shown in the exam topics) refers to the default setting on the switchport access vlan vlan-id command, and that default is VLAN ID 1.|ПРИМЕЧАНИЕ Термин VLAN по умолчанию (как показано в темах экзамена) относится к настройке по умолчанию для команды switchport access vlan vlan-id, и этим значением по умолчанию является VLAN ID 1.
In other words, by default, each port is assigned to access VLAN 1.|Другими словами, по умолчанию каждый порт назначен для доступа к VLAN 1.
##### VLAN Configuration Example 1: Full VLAN Configuration
Пример конфигурации VLAN 1: Полная конфигурация VLAN   
__|__
--|--
|
Examples 8-1, 8-2, and 8-3 work through one scenario with VLAN configuration and verification.|Примеры 8-1, 8-2 и 8-3 работают через один сценарий с настройкой и проверкой VLAN.
|
To begin, Example 8-1 begins by showing the VLANs in switch SW1 in Figure 8-9, with all default settings related to VLANs.|Для начала Пример 8-1 начинается с отображения VLAN в коммутаторе SW1 на Рисунке 8-9 со всеми настройками по умолчанию, относящимися к VLAN.
|
Figure 8-9 Network with One Switch and Three VLANs Example 8-1 Configuring VLANs and Assigning VLANs to Interfaces Example end.|Рис. 8-9. Сеть с одним коммутатором и тремя VLAN. Пример 8-1. Настройка VLAN и назначение VLAN интерфейсам. Пример конец.
|
The example begins with the show vlan brief command, confirming the default settings of five nondeletable VLANs, with all interfaces assigned to VLAN 1.|Пример начинается с команды show vlan Short, подтверждающей настройки по умолчанию для пяти не удаляемых VLAN, при этом все интерфейсы назначены VLAN 1.
VLAN 1 cannot be deleted but can be used.|VLAN 1 нельзя удалить, но можно использовать.
VLANs 1002–1005 cannot be deleted and cannot be used as access VLANs today.|Сети VLAN 1002–1005 не могут быть удалены и не могут использоваться в качестве VLAN доступа сегодня.
In particular, note that this 2960 switch has 24 Fast Ethernet ports (Fa0/1–|В частности, обратите внимание, что этот коммутатор 2960 имеет 24 порта Fast Ethernet (Fa0 / 1–
|
Fa0/24) and two Gigabit Ethernet ports (Gi0/1 and Gi0/2), all of which are listed as being in VLAN 1 per that first command’s output, confirming that by default, Cisco switches assign all ports to VLAN 1.|Fa0 / 24) и два порта Gigabit Ethernet (Gi0 / 1 и Gi0 / 2), все из которых указаны как находящиеся в VLAN 1 в выходных данных первой команды, подтверждая, что по умолчанию коммутаторы Cisco назначают все порты VLAN 1.
|
Next, Example 8-2 shows steps that mirror the VLAN configuration checklist, namely the configuration of VLAN 2, plus the assignment of VLAN 2 as the access VLAN on two ports: Fa0/13 and Fa0/14.|Затем в примере 8-2 показаны шаги, которые отражают контрольный список конфигурации VLAN, а именно конфигурацию VLAN 2, а также назначение VLAN 2 в качестве VLAN доступа на двух портах: Fa0 / 13 и Fa0 / 14.
|
Example 8-2 Configuring VLANs and Assigning VLANs to Interfaces Example end.|Пример 8-2. Настройка VLAN и назначение VLAN интерфейсам. Пример конец.
|
Take a moment to compare the output of the show vlan brief commands in Example 8-2 (after adding the configuration) versus Example 8-1.|Найдите минутку, чтобы сравнить выходные данные команд show vlan short в примере 8-2 (после добавления конфигурации) с примером 8-1.
Example 8-2 shows new information about VLAN 2, with ports Fa0/13 and Fa0/14 no longer being listed with VLAN 1, but now listed as assigned to VLAN 2.|В примере 8-2 показана новая информация о VLAN 2, при этом порты Fa0 / 13 и Fa0 / 14 больше не отображаются в VLAN 1, но теперь указаны как назначенные для VLAN 2.
|
To complete this scenario, Example 8-3 shows a little more detail about the VLAN itself.|Чтобы завершить этот сценарий, в Примере 8-3 показано немного больше деталей о самой VLAN.
|
First, the show running-config command lists both the vlan 2 and switchport access vlan 2 commands as configured in Example 8-2.|Во-первых, команда show running-config перечисляет команды vlan 2 и switchport access vlan 2, как настроено в примере 8-2.
Also, note that earlier Example 8-2 uses the interface range command, with one instance of the switchport access vlan 2 interface subcommand.|Также обратите внимание, что в предыдущем примере 8-2 используется команда interface range с одним экземпляром подкоманды интерфейса switchport access vlan 2.
However, Example 8-3 shows how the switch actually applied that command to both Fa0/13 and Fa0/14.|Однако в примере 8-3 показано, как коммутатор фактически применил эту команду к Fa0 / 13 и Fa0 / 14.
Example 8-3 ends with the show vlan id 2 command, which confirms the operational status that ports Fa0/13 and Fa0/14 are assigned to VLAN 2.|Пример 8-3 заканчивается командой show vlan id 2, которая подтверждает рабочее состояние, при котором порты Fa0 / 13 и Fa0 / 14 назначены VLAN 2.
|
Example 8-3 Configuring VLANs and Assigning VLANs to Interfaces Example end.|Пример 8-3 Настройка VLAN и назначение VLAN интерфейсам Окончание примера.
|
The example surrounding Figure 8-9 uses six switch ports, all of which need to operate as access ports.|Пример на рис. 8-9 использует шесть портов коммутатора, каждый из которых должен работать как порты доступа.
That is, each port should not use trunking but instead should be assigned to a single VLAN, as assigned by the switchport access vlan vlan-id command.|То есть каждый порт не должен использовать транкинг, а должен быть назначен одной VLAN, как это назначается командой switchport access vlan vlan-id.
For ports that should always act as access ports, add the optional interface subcommand switchport mode access.|Для портов, которые всегда должны действовать как порты доступа, добавьте необязательную подкоманду interface switchport mode access.
This command tells the switch to always be an access interface and disables the protocol that negotiates trunking (Dynamic Trunking Protocol [DTP]) with the device on the other end of the link. (The upcoming section “VLAN Trunking Configuration” discusses more details about the commands that allow a port to negotiate whether it should use trunking.)|Эта команда указывает коммутатору, что он всегда должен быть интерфейсом доступа, и отключает протокол, который согласовывает транкинг (Dynamic Trunking Protocol [DTP]) с устройством на другом конце канала. (В следующем разделе «Конфигурация транкинга VLAN» обсуждаются более подробные сведения о командах, которые позволяют порту согласовывать, следует ли использовать транкинг.)
|
NOTE The book includes a video that works through a different VLAN configuration example as well.|ПРИМЕЧАНИЕ В книге есть видео, которое также работает с другим примером конфигурации VLAN.
You can find the video on the companion website.|Вы можете найти видео на сопутствующем веб-сайте.
##### VLAN Configuration Example 2: Shorter VLAN Configuration
Пример конфигурации VLAN 2: более короткая конфигурация VLAN   
__|__
--|--
|
Example 8-2 shows how to configure a VLAN and add two ports to the VLAN as access ports.|В примере 8-2 показано, как настроить VLAN и добавить два порта к VLAN в качестве портов доступа.
Example 8-4 does the same, this time with VLAN 3, and this time with a much briefer alternative configuration.|Пример 8-4 делает то же самое, на этот раз с VLAN 3, но на этот раз с гораздо более короткой альтернативной конфигурацией.
The configuration completes the configuration of the design shown in Figure 8-9, by adding two ports to VLAN 3.|Конфигурация завершает настройку схемы, показанной на рисунке 8-9, путем добавления двух портов к VLAN 3.
|
Example 8-4 Shorter VLAN Configuration Example (VLAN 3)|Пример 8-4 Пример конфигурации более короткой VLAN (VLAN 3)
|
Example end.|Пример конец.
|
Example 8-2 shows how a switch can dynamically create a VLAN—the equivalent of the vlan vlan-id global config command—when the switchport access vlan interface subcommand refers to a currently unconfigured VLAN. This example begins with SW1 not knowing about VLAN 3.|В примере 8-2 показано, как коммутатор может динамически создавать VLAN - эквивалент команды глобальной конфигурации vlan vlan-id - когда подкоманда интерфейса vlan для доступа к порту коммутатора относится к ненастроенной в настоящее время VLAN. Этот пример начинается с того, что SW1 не знает о VLAN 3.
With the addition of the switchport access vlan 3 interface subcommand, the switch realized that VLAN 3 did not exist, and as noted in the shaded message in the example, the switch created VLAN 3, using a default name (VLAN0003).|С добавлением подкоманды интерфейса switchport access vlan 3 коммутатор понял, что VLAN 3 не существует, и, как отмечено в затененном сообщении в примере, коммутатор создал VLAN 3, используя имя по умолчанию (VLAN0003).
The engineer did not need to type the vlan 3 global command to create VLAN 3; the switch did that automatically.|Инженеру не нужно было вводить глобальную команду vlan 3 для создания VLAN 3; переключатель сделал это автоматически.
|
No other steps are required to create the VLAN. At the end of the process, VLAN 3 exists in the switch, and interfaces Fa0/15 and Fa0/16 are in VLAN 3, as noted in the shaded part of the show vlan brief command output.|Никаких других шагов для создания VLAN не требуется. В конце процесса VLAN 3 существует в коммутаторе, а интерфейсы Fa0 / 15 и Fa0 / 16 находятся в VLAN 3, как отмечено в затененной части выходных данных команды show vlan Short.
#### VLAN Trunking Protocol
Протокол транкинга VLAN   
__|__
--|--
|
Before showing more configuration examples, you also need to know something about a Cisco protocol and tool called the VLAN Trunking Protocol (VTP). VTP is a Cisco proprietary tool on Cisco switches that advertises each VLAN configured in one switch (with the vlan number command) so that all the other switches in the campus learn about that VLAN.|Прежде чем показывать дополнительные примеры конфигурации, вам также необходимо кое-что узнать о протоколе Cisco и инструменте, который называется протоколом VLAN Trunking Protocol (VTP). VTP - это проприетарный инструмент Cisco на коммутаторах Cisco, который объявляет каждую VLAN, настроенную на одном коммутаторе (с помощью команды номера vlan), чтобы все остальные коммутаторы в кампусе узнали об этой VLAN.
|
This book does not discuss VTP as an end to itself for a few different reasons.|В этой книге VTP не рассматривается как самоцель по нескольким причинам.
First, the current CCNA 200-301 exam blueprint ignores VTP, as do the CCNP Enterprise Core and CCNP Enterprise Advanced Routing blueprints.|Во-первых, текущая схема экзамена CCNA 200-301 игнорирует VTP, как и схемы CCNP Enterprise Core и CCNP Enterprise Advanced Routing.
Additionally, many enterprises choose to disable VTP.|Кроме того, многие предприятия предпочитают отключать VTP.
|
Also, you can easily disable VTP so that it has no impact on your switches in the lab, which is exactly what I did when building all the examples in this book.|Кроме того, вы можете легко отключить VTP, чтобы он не повлиял на работу ваших коммутаторов в лаборатории, что я и сделал при создании всех примеров в этой книге.
|
However, VTP has some small impact on how every Cisco Catalyst switch works, even if you do not try to use VTP. This brief section introduces enough details of VTP so that you can see these small differences in VTP that cannot be avoided.|Однако VTP оказывает небольшое влияние на работу каждого коммутатора Cisco Catalyst, даже если вы не пытаетесь использовать VTP. В этом кратком разделе представлено достаточно подробностей о VTP, чтобы вы могли увидеть эти небольшие различия в VTP, которых невозможно избежать.
|
First, all examples in this book (and in Volume 2) use switches that disable VTP in some way.|Во-первых, во всех примерах в этой книге (и в томе 2) используются переключатели, которые каким-либо образом отключают VTP.
|
Interestingly, for much of VTP’s decades of existence, most switches did not allow VTP to be disabled completely; on those switches, to effectively disable VTP, the engineer would set the switch to use VTP transparent mode (with the vtp mode transparent global command).|Интересно, что на протяжении большей части десятилетий существования VTP большинство коммутаторов не позволяли полностью отключить VTP; на этих коммутаторах, чтобы эффективно отключить VTP, инженер установил бы коммутатор на использование прозрачного режима VTP (с помощью глобальной команды vtp mode transparent).
|
Some switches now have an option to disable VTP completely with the vtp mode off global command.|Некоторые коммутаторы теперь имеют возможность полностью отключить VTP с помощью глобальной команды vtp mode off.
For the purposes of this book, configuring a switch with either transparent mode or off mode disables VTP.|Для целей этой книги настройка коммутатора либо в прозрачном, либо в выключенном режиме отключает VTP.
|
Note that both transparent and off modes prevent VTP from learning and advertising about VLAN configuration.|Обратите внимание, что как прозрачный, так и выключенный режимы не позволяют VTP узнавать и рекламировать конфигурацию VLAN.
Those modes allow a switch to configure all VLANs, including standard-|Эти режимы позволяют коммутатору настраивать все VLAN, включая стандартные -
|
and extended-range VLANs. Additionally, switches using transparent or off modes list the vlan configuration commands in the running-config file.|и сети VLAN с расширенным диапазоном. Кроме того, коммутаторы, использующие прозрачный или выключенный режимы, перечисляют команды конфигурации vlan в файле рабочей конфигурации.
|
Finally, on a practical note, if you happen to do lab exercises with real switches or with simulators, and you see unusual results with VLANs, check the VTP status with the show vtp status command.|Наконец, практическое замечание: если вы выполняете лабораторные упражнения с настоящими коммутаторами или симуляторами и видите необычные результаты с VLAN, проверьте статус VTP с помощью команды show vtp status.
If your switch uses VTP server or client mode, you will find|Если ваш коммутатор использует режим VTP-сервера или клиента, вы найдете
###### The server switches can configure VLANs in the standard range only (1–1005).
Серверные коммутаторы могут настраивать VLAN только в стандартном диапазоне (1–1005).   
###### The client switches cannot configure VLANs.
Клиентские коммутаторы не могут настраивать VLAN.   
###### Both servers and clients may be learning new VLANs from other switches and seeing
И серверы, и клиенты могут изучать новые VLAN от других коммутаторов и видеть   
__|__
--|--
|
their VLANs deleted by other switches because of VTP.|их VLAN удалены другими коммутаторами из-за VTP.
###### The show running-config command does not list any vlan commands; you must use
Команда show running-config не отображает никаких команд vlan; ты должен использовать   
__|__
--|--
|
other show commands to find out about the configured VLANs.|другие команды show, чтобы узнать о настроенных VLAN.
|
If possible in the lab, switch to disable VTP and ignore VTP for your switch configuration practice until you decide to learn more about VTP for other purposes.|Если это возможно в лабораторных условиях, отключите VTP и игнорируйте VTP при настройке коммутатора, пока вы не решите больше узнать о VTP для других целей.
|
NOTE Do not change VTP settings on any switch that also connects to the production network until you know how VTP works and you talk with experienced colleagues.|ПРИМЕЧАНИЕ. Не изменяйте настройки VTP на любом коммутаторе, который также подключается к производственной сети, пока вы не узнаете, как работает VTP, и не поговорите с опытными коллегами.
Doing so can cause real harm to your LAN. For example, if the switch you configure connects to other switches, which in turn connect to switches used in the production LAN, you could accidentally change the VLAN configuration in other switches with serious impact to the operation of the network.|Это может нанести серьезный вред вашей локальной сети. Например, если настраиваемый коммутатор подключается к другим коммутаторам, которые, в свою очередь, подключаются к коммутаторам, используемым в производственной локальной сети, вы можете случайно изменить конфигурацию VLAN в других коммутаторах, что серьезно повлияет на работу сети.
You could delete VLANs and cause outages.|Вы можете удалить сети VLAN и вызвать сбои в работе.
Be careful and never experiment with VTP settings on a switch unless it and the other switches connected to it have absolutely no physical links connected to the production LAN.|Будьте осторожны и никогда не экспериментируйте с настройками VTP на коммутаторе, если он и другие подключенные к нему коммутаторы не имеют абсолютно никаких физических каналов, подключенных к производственной локальной сети.
#### VLAN Trunking Configuration
Конфигурация транкинга VLAN   
__|__
--|--
|
Trunking configuration between two Cisco switches can be very simple if you just statically configure trunking.|Конфигурация транкинга между двумя коммутаторами Cisco может быть очень простой, если вы просто статически настроите транкинг.
For example, most Cisco Catalyst switches today support only 802.1Q and not ISL. You could literally add one interface subcommand for the switch interface on each side of the link (switchport mode trunk), and you would create a VLAN trunk that supported all the VLANs known to each switch.|Например, большинство коммутаторов Cisco Catalyst сегодня поддерживают только 802.1Q, но не ISL. Вы можете буквально добавить одну подкоманду интерфейса для интерфейса коммутатора на каждой стороне канала (магистраль режима порта коммутатора) и создать магистраль VLAN, которая поддерживает все сети VLAN, известные каждому коммутатору.
|
However, trunking configuration on Cisco switches includes many more options, including several options for dynamically negotiating various trunking settings.|Однако конфигурация транкинга на коммутаторах Cisco включает гораздо больше опций, в том числе несколько опций для динамического согласования различных настроек транкинга.
The configuration can either predefine different settings or tell the switch to negotiate the settings, as follows:|Конфигурация может либо предопределять различные настройки, либо указывать коммутатору на согласование настроек следующим образом:
###### The type of trunking: IEEE 802.1Q, ISL, or negotiate which one to use, on switches that
Тип транкинга: IEEE 802.1Q, ISL или согласовать, какой из них использовать, на коммутаторах, которые   
__|__
--|--
|
support both types of trunking.|поддерживают оба типа транкинга.
###### The administrative mode: Whether to always trunk, always not trunk, or negotiate
Административный режим: всегда ли транк, всегда не транк, или согласовывать   
__|__
--|--
|
whether to trunk or not.|в багажник или нет.
|
First, consider the type of trunking.|Сначала рассмотрим тип транкинга.
Cisco switches that support ISL and 802.1Q can negotiate which type to use, using the Dynamic Trunking Protocol (DTP). If both switches support both protocols, they use ISL; otherwise, they use the protocol that both support.|Коммутаторы Cisco, поддерживающие ISL и 802.1Q, могут согласовывать, какой тип использовать, с помощью протокола динамического транкинга (DTP). Если оба коммутатора поддерживают оба протокола, они используют ISL; в противном случае они используют протокол, который поддерживают оба.
Today, many Cisco switches do not support the older ISL trunking protocol.|Сегодня многие коммутаторы Cisco не поддерживают старый протокол транкинга ISL.
Switches that support both types of trunking use the switchport trunk encapsulation {dot1q | isl | negotiate} interface subcommand to either configure the type or allow DTP to negotiate the type.|Коммутаторы, поддерживающие оба типа транкинга, используют инкапсуляцию транка порта коммутатора {dot1q | isl | gotiate}, чтобы настроить тип или разрешить DTP согласовывать тип.
|
DTP can also negotiate whether the two devices on the link agree to trunk at all, as guided by the local switch port’s administrative mode.|DTP может также согласовывать, согласны ли два устройства в канале на транк вообще, в соответствии с административным режимом порта локального коммутатора.
The administrative mode refers to the configuration setting for whether trunking should be used.|Под административным режимом понимается настройка конфигурации, указывающая, следует ли использовать транкинг.
Each interface also has an operational mode, which refers to what is currently happening on the interface and might have been chosen by DTP’s negotiation with the other device.|У каждого интерфейса также есть рабочий режим, который относится к тому, что в данный момент происходит на интерфейсе, и мог быть выбран при согласовании DTP с другим устройством.
Cisco switches use the switchport mode interface subcommand to define the administrative trunking mode, as listed in Table 8-2.|Коммутаторы Cisco используют подкоманду интерфейса switchport mode для определения административного режима транкинга, как указано в Таблице 8-2.
|
Table 8-2 Trunking Administrative Mode Options with the switchport mode Command Table end.|Таблица 8-2 Параметры административного режима транкинга с таблицей команд режима switchport end.
|
For example, consider the two switches shown in Figure 8-10.|Например, рассмотрим два переключателя, показанных на рисунке 8-10.
This figure expands the design shown earlier in Figure 8-9, with a trunk to a new switch (SW2) and with parts of VLANs 1 and 3 on ports attached to SW2. The two switches use a Gigabit Ethernet link for the trunk.|Этот рисунок расширяет схему, показанную ранее на Рисунке 8-9, с магистралью к новому коммутатору (SW2) и частями VLAN 1 и 3 на портах, подключенных к SW2. Два коммутатора используют канал Gigabit Ethernet для магистрали.
|
In this case, the trunk does not dynamically form by default because both (2960) switches default to an administrative mode of dynamic auto, meaning that neither switch initiates the trunk negotiation process.|В этом случае магистраль не формируется динамически по умолчанию, потому что оба переключателя (2960) по умолчанию переходят в административный режим динамического автоматического режима, что означает, что ни один из коммутаторов не инициирует процесс согласования магистрали.
When one switch is changed to use dynamic desirable mode, which does initiate the negotiation, the switches negotiate to use trunking, specifically 802.1Q because the 2960s support only 802.1Q.|Когда один коммутатор переключается на использование динамического желательного режима, который инициирует согласование, коммутаторы согласовывают использование транкинга, в частности 802.1Q, поскольку 2960 поддерживают только 802.1Q.
|
Figure 8-10 Network with Two Switches and Three VLANs Example 8-5 begins with SW1 configured as shown in Examples 8-2 and 8-4—that is, SW1 has two ports each assigned to VLANs 1, 2, and 3.|Рис. 8-10 Сеть с двумя коммутаторами и тремя VLAN. Пример 8-5 начинается с SW1, настроенного, как показано в примерах 8-2 и 8-4, то есть SW1 имеет два порта, каждый из которых назначен для VLAN 1, 2 и 3.
However, both SW1 and SW2 currently have all default settings on the interfaces that connect the two switches.|Однако и SW1, и SW2 в настоящее время имеют все настройки по умолчанию на интерфейсах, которые соединяют два переключателя.
With the default setting of switchport mode dynamic auto, the two switches do not trunk.|При настройке по умолчанию динамического автоматического режима порта коммутатора два коммутатора не соединяются.
|
Example 8-5 Initial Default State: Not Trunking Between SW1 and SW2 Example end.|Пример 8-5 Исходное состояние по умолчанию: не транкинг между SW1 и SW2 Пример конец.
|
First, focus on the highlighted items from the output of the show interfaces switchport command at the beginning of Example 8-3.|Во-первых, сфокусируйтесь на выделенных элементах из выходных данных команды show interfaces switchport в начале примера 8-3.
The output lists the default administrative mode setting of dynamic auto.|В выходных данных перечислены настройки административного режима по умолчанию - динамический автоматический.
Because SW2 also defaults to dynamic auto, the command lists SW1’s operational status as “access,” meaning that it is not trunking. (“Dynamic auto” tells both switches to sit there and wait on the other switch to start the negotiations.) The third shaded line points out the only supported type of trunking (802.1Q). (On a switch that supports both ISL and 802.1Q, this value would by default list “negotiate,” to mean that the type of encapsulation is negotiated.) Finally, the operational trunking type is listed as “native,”|Поскольку SW2 также по умолчанию использует динамический автоматический режим, команда указывает рабочее состояние SW1 как «доступ», что означает, что он не является транкинговым. («Динамический автоматический» указывает обоим коммутаторам сидеть и ждать на другом коммутаторе, чтобы начать переговоры.) Третья заштрихованная линия указывает на единственный поддерживаемый тип транкинга (802.1Q). (На коммутаторе, который поддерживает как ISL, так и 802.1Q, для этого значения по умолчанию будет указано «согласование», что означает, что тип инкапсуляции согласован.) И наконец, рабочий тип транкинга указан как «собственный»,
|
which is a reference to the 802.1Q native VLAN.|который является ссылкой на собственную сеть VLAN 802.1Q.
|
The end of the example shows the output of the show interfaces trunk command, but with no output.|В конце примера показан вывод команды show interfaces trunk, но без вывода.
This command lists information about all interfaces that currently operationally trunk; that is, it lists interfaces that currently use VLAN trunking.|Эта команда выводит информацию обо всех интерфейсах, которые в настоящее время работают через транкинг; то есть в нем перечислены интерфейсы, которые в настоящее время используют транкинг VLAN.
With no interfaces listed, this command also confirms that the link between switches is not trunking.|При отсутствии в списке интерфейсов эта команда также подтверждает, что канал между коммутаторами не является транкинговым.
|
Next, consider Example 8-6, which shows the new configuration that enables trunking.|Затем рассмотрим пример 8-6, в котором показана новая конфигурация, разрешающая транкинг.
In this case, SW1 is configured with the switchport mode dynamic desirable command, which asks the switch to both negotiate as well as to begin the negotiation process, rather than waiting on the other device.|В этом случае SW1 сконфигурирован с помощью команды switchport mode dynamic желательно, которая просит коммутатор как согласовать, так и начать процесс согласования, а не ждать на другом устройстве.
The example shows that as soon as the command is issued, log messages appear showing that the interface goes down and then back up again, which happens when the interface transitions from access mode to trunk mode.|В примере показано, что как только команда выдается, появляются сообщения журнала, показывающие, что интерфейс отключается, а затем снова включается, что происходит, когда интерфейс переходит из режима доступа в режим магистрали.
|
Example 8-6 SW1 Changes from Dynamic Auto to Dynamic Desirable Example end.|Пример 8-6 SW1 переключается с динамического автоматического на динамический. Желаемый конец примера.
|
Example 8-6 repeats the show interfaces gi0/1 switchport command seen in Example 8-5, but after configuring VLAN trunking, so this time the output shows that SW1’s G0/1 interface now operates as a trunk.|В примере 8-6 повторяется команда show interfaces gi0 / 1 switchport, показанная в примере 8-5, но после настройки транкинга VLAN, поэтому на этот раз выходные данные показывают, что интерфейс G0 / 1 SW1 теперь работает как транк.
Note that the command still lists the administrative settings, which denote the configured values along with the operational settings, which list what the switch is currently doing.|Обратите внимание, что в команде по-прежнему перечислены административные параметры, которые обозначают настроенные значения, а также рабочие параметры, в которых перечислены текущие действия коммутатора.
SW1 now claims to be in an operational mode of trunk, with an operational trunking encapsulation of dot1Q.|SW1 теперь утверждает, что находится в рабочем режиме магистрали с инкапсуляцией точки1Q в оперативную магистраль.
|
Example 8-7 now repeats the same show interfaces trunk command that showed no output at all back in Example 8-5.|В примере 8-7 теперь повторяется та же команда show interfaces trunk, которая в примере 8-5 не показывала никаких выходных данных.
Now that SW1 trunks on its G0/1 port, the output in Example 8-7 lists G0/1, confirming that G0/1 is now operationally trunking.|Теперь, когда SW1 соединяется со своим портом G0 / 1, в выходных данных примера 8-7 отображается G0 / 1, подтверждающий, что G0 / 1 теперь работает в режиме транкинга.
The next section discusses the meaning of the output of this command.|В следующем разделе обсуждается значение вывода этой команды.
Also, note that the end of the example repeats the show vlan id 2 command; of note, it includes the trunk port G0/1 in the output because the trunk port can forward traffic in VLAN 2.|Также обратите внимание, что в конце примера повторяется команда show vlan id 2; Следует отметить, что он включает в себя магистральный порт G0 / 1 в выходных данных, поскольку магистральный порт может пересылать трафик в VLAN 2.
|
Example 8-7 A Closer Look at SW1’s G0/1 Trunk Port Example end.|Пример 8-7. Более пристальный взгляд на конец примера магистрального порта G0 / 1 коммутатора SW1.
|
For the exams, you should be ready to interpret the output of the show interfaces switchport command, realize the administrative mode implied by the output, and know whether the link should operationally trunk based on those settings.|К экзаменам вы должны быть готовы интерпретировать выходные данные команды show interfaces switchport, осознавать административный режим, подразумеваемый выходными данными, и знать, должна ли линия связи в оперативном режиме соединяться с этими параметрами.
Table 8-3 lists the combinations of the trunking administrative modes and the expected operational mode (trunk or access) resulting from the configured settings.|В Таблице 8-3 перечислены сочетания административных режимов транкинга и ожидаемого рабочего режима (соединительный канал или доступ) в результате заданных параметров.
The table lists the administrative mode used on one end of the link on the left, and the administrative mode on the switch on the other end of the link across the top of the table.|В таблице перечислены административный режим, используемый на одном конце ссылки слева, и административный режим на переключателе на другом конце ссылки в верхней части таблицы.
|
Table 8-3 Expected Trunking Operational Mode Based on the Configured Administrative Table end.|Таблица 8-3 Ожидаемый рабочий режим транкинга на основе сконфигурированной административной таблицы.
|
1 When two switches configure a mode of “access” on one end and “trunk” on the other, problems occur.|1 Когда два коммутатора настраивают режим «доступа» на одном конце и «магистрали» на другом, возникают проблемы.
|
Avoid this combination.|Избегайте этой комбинации.
|
Finally, before leaving the discussion of configuring trunks, Cisco recommends disabling trunk negotiation on most ports for better security.|Наконец, прежде чем прекратить обсуждение настройки соединительных линий, Cisco рекомендует отключить согласование соединительных линий на большинстве портов для повышения безопасности.
The majority of switch ports on most switches will be used to connect to users and configured with the command switchport mode access—which also disables DTP. For ports without the switchport mode access command—for instance, ports statically configured to trunk with the switchport mode trunk command—DTP still operates, but you can disable DTP negotiations altogether using the switchport nonegotiate interface subcommand.|Большинство портов коммутаторов на большинстве коммутаторов будут использоваться для подключения к пользователям и настроены с помощью команды switchport mode access, которая также отключает DTP. Для портов без команды доступа к режиму switchport - например, порты, статически настроенные для транкинга с помощью команды switchport mode trunk - DTP по-прежнему работает, но вы можете полностью отключить согласование DTP с помощью подкоманды интерфейса switchport nonegotiate.
#### Implementing Interfaces Connected to Phones
Реализация интерфейсов, подключенных к телефонам   
__|__
--|--
|
This next topic is strange, at least in the context of access links and trunk links.|Следующая тема выглядит странно, по крайней мере, в контексте ссылок доступа и магистральных ссылок.
In the world of IP telephony, telephones use Ethernet ports to connect to an Ethernet network so they can use IP to send and receive voice traffic sent via IP packets.|В мире IP-телефонии телефоны используют порты Ethernet для подключения к сети Ethernet, поэтому они могут использовать IP для отправки и получения голосового трафика, отправляемого через IP-пакеты.
To make that work, the switch’s Ethernet port acts like an access port, but at the same time, the port acts like a trunk in some ways.|Чтобы это работало, порт Ethernet коммутатора действует как порт доступа, но в то же время порт в некотором смысле действует как магистраль.
This last topic of the chapter works through those main concepts.|В последней теме главы рассматриваются эти основные концепции.
##### Data and Voice VLAN Concepts
Концепции VLAN для передачи данных и голоса   
__|__
--|--
|
Before IP telephony, a PC could sit on the same desk as a phone.|До появления IP-телефонии ПК мог стоять на одном столе с телефоном.
The phone happened to use UTP cabling, with that phone connected to some voice device (often called a voice switch or a private branch exchange [PBX]).|В телефоне использовался кабель UTP, при этом телефон был подключен к какому-либо голосовому устройству (часто называемому коммутатором голоса или частной телефонной станцией [PBX]).
The PC, of course, connected using an unshielded twisted-pair (UTP) cable to the usual LAN switch that sat in the wiring closet—sometimes in the same wiring closet as the voice switch.|Компьютер, конечно же, был подключен с помощью неэкранированной витой пары (UTP) к обычному коммутатору LAN, который находился в коммутационном шкафу - иногда в том же коммутационном шкафу, что и голосовой переключатель.
Figure 8-11 shows the idea.|На рис. 8-11 показана идея.
|
Figure 8-11 Before IP Telephony: PC and Phone, One Cable Each, Connect to Two Different Devices The term IP telephony refers to the branch of networking in which the telephones use IP packets to send and receive voice as represented by the bits in the data portion of the IP packet.|Рисунок 8-11 Перед IP-телефонией: ПК и телефон, каждый по одному кабелю, подключение к двум разным устройствам Термин IP-телефония относится к той ветви сети, в которой телефоны используют IP-пакеты для отправки и получения голоса, что представлено битами в часть данных IP-пакета.
The phones connect to the network like most other end-user devices, using either Ethernet or Wi-Fi. These new IP phones did not connect via cable directly to a voice switch, instead connecting to the IP network using an Ethernet cable and an Ethernet port built in to the phone.|Телефоны подключаются к сети, как и большинство других устройств конечных пользователей, через Ethernet или Wi-Fi. Эти новые IP-телефоны не подключались с помощью кабеля напрямую к коммутатору голосовой связи, а подключались к IP-сети с помощью кабеля Ethernet и порта Ethernet, встроенного в телефон.
The phones then communicated over the IP network with software that replaced the call setup and other functions of the PBX. (The current products from Cisco that perform this IP telephony control function are called Cisco Unified Communication Manager.)|Затем телефоны обменивались данными по IP-сети с помощью программного обеспечения, которое заменило настройку вызова и другие функции УАТС. (Текущие продукты Cisco, которые выполняют эту функцию управления IP-телефонией, называются Cisco Unified Communication Manager.)
|
The migration from using the already-installed telephone cabling to these new IP phones that needed UTP cables that supported Ethernet caused some problems in some offices.|Переход от использования уже установленных телефонных кабелей к этим новым IP-телефонам, для которых требовались кабели UTP с поддержкой Ethernet, вызвал некоторые проблемы в некоторых офисах.
In particular:|Особенно:
###### The older non-IP phones used a category of UTP cabling that often did not support 100-
В старых не IP-телефонах использовалась категория кабелей UTP, которые часто не поддерживали 100-   
__|__
--|--
|
Mbps or 1000-Mbps Ethernet.|Ethernet или 1000 Мбит / с.
###### Most offices had a single UTP cable running from the wiring closet to each desk, but now
В большинстве офисов был один кабель UTP, идущий от коммутационного шкафа к каждому столу, но теперь   
__|__
--|--
|
two devices (the PC and the new IP phone) both needed a cable from the desktop to the wiring closet.|для двух устройств (ПК и нового IP-телефона) требовался кабель от рабочего стола к коммутационному шкафу.
###### Installing a new cable to every desk would be expensive, plus you would need more
Установка нового кабеля на каждый стол обойдется дорого, к тому же вам понадобится больше   
__|__
--|--
|
switch ports.|переключать порты.
|
To solve this problem, Cisco embedded small three-port switches into each phone.|Чтобы решить эту проблему, Cisco встроила в каждый телефон небольшие трехпортовые коммутаторы.
|
IP telephones have included a small LAN switch, on the underside of the phone, since the earliest IP telephone products.|IP-телефоны включают в себя небольшой переключатель LAN на нижней стороне телефона, начиная с самых ранних IP-телефонов.
Figure 8-12 shows the basic cabling, with the wiring closet cable connecting to one physical port on the embedded switch, the PC connecting with a short patch cable to the other physical port, and the phone’s internal CPU connecting to an internal switch port.|На Рис. 8-12 показаны основные кабели: кабель коммутационного шкафа подключается к одному физическому порту встроенного коммутатора, ПК подключается с помощью короткого соединительного кабеля к другому физическому порту, а внутренний ЦП телефона подключается к внутреннему порту коммутатора.
|
Figure 8-12 Cabling with an IP Phone, a Single Cable, and an Integrated Switch Sites that use IP telephony, which includes almost every company today, now have two devices off each access port.|Рис. 8-12. Кабельная проводка с IP-телефоном, одним кабелем и интегрированным коммутатором. На сайтах, использующих IP-телефонию, к которым сегодня относятся почти все компании, теперь есть два устройства на каждом порту доступа.
In addition, Cisco best practices for IP telephony design tell us to put the phones in one VLAN and the PCs in a different VLAN. To make that happen, the switch port acts a little like an access link (for the PC’s traffic), and a little like a trunk (for the phone’s traffic).|Кроме того, лучшие практики Cisco в области проектирования IP-телефонии говорят нам размещать телефоны в одной VLAN, а ПК - в другой VLAN. Для этого порт коммутатора действует как канал доступа (для трафика ПК) и как транк (для трафика телефона).
The configuration defines two VLANs on that port, as follows:|Конфигурация определяет две сети VLAN на этом порту следующим образом:
|
Data VLAN: Same idea and configuration as the access VLAN on an access port but defined as the VLAN on that link for forwarding the traffic for the device connected to the phone on the desk (typically the user’s PC).|Data VLAN: та же идея и конфигурация, что и VLAN доступа на порту доступа, но определяется как VLAN на этом канале для перенаправления трафика для устройства, подключенного к телефону на столе (обычно это ПК пользователя).
|
Voice VLAN: The VLAN defined on the link for forwarding the phone’s traffic.|Голосовая VLAN: VLAN, определенная в ссылке для пересылки телефонного трафика.
Traffic in this VLAN is typically tagged with an 802.1Q header.|Трафик в этой VLAN обычно помечается заголовком 802.1Q.
|
Figure 8-13 illustrates this design with two VLANs on access ports that support IP telephones.|На рис. 8-13 показана эта конструкция с двумя виртуальными локальными сетями на портах доступа, которые поддерживают IP-телефоны.
|
VLAN 11 VLAN 10 IP IP IP IP Voice VLAN Data VLAN figure 8-13 A LAN Design, with Data in VLAN 10 and Phones in VLAN 11|VLAN 11 VLAN 10 IP IP IP Голосовой IP VLAN Данные VLAN рисунок 8-13 Схема локальной сети с данными в VLAN 10 и телефонами в VLAN 11
##### Data and Voice VLAN Configuration and Verification
Конфигурация и проверка VLAN для передачи данных и голоса   
__|__
--|--
|
Configuring a switch port to support IP phones, once you know the planned voice and data VLAN IDs, requires just a few easy commands.|Для настройки порта коммутатора для поддержки IP-телефонов после того, как вы узнаете запланированные идентификаторы VLAN для передачи голоса и данных, потребуется всего несколько простых команд.
Making sense of the show commands once it is configured, however, can be a challenge.|Однако понимание команд show после их настройки может быть проблемой.
The port acts like an access port in many ways.|Порт во многом действует как порт доступа.
|
However, with most configuration options, the voice frames flow with an 802.1Q header, so that the link supports frames in both VLANs on the link.|Однако в большинстве вариантов конфигурации голосовые кадры передаются с заголовком 802.1Q, поэтому канал поддерживает кадры в обеих виртуальных локальных сетях канала.
But that makes for some different show command output.|Но это делает вывод команды show по-другому.
|
Example 8-8 shows an example configuration.|В примере 8-8 показан пример конфигурации.
In this case, all four switch ports F0/1–F0/4 begin with default configuration.|В этом случае все четыре порта коммутатора F0 / 1 – F0 / 4 начинаются с конфигурации по умолчанию.
The configuration adds the new data and voice VLANs.|Конфигурация добавляет новые сети VLAN для передачи данных и голоса.
|
The example then configures all four ports as access ports and defines the access VLAN, which is also called the data VLAN when discussing IP telephony.|Затем в примере настраиваются все четыре порта как порты доступа и определяется VLAN доступа, которая также называется VLAN данных при обсуждении IP-телефонии.
Finally, the configuration includes the switchport voice vlan 11 command, which defines the voice VLAN used on the port.|Наконец, конфигурация включает команду switchport voice vlan 11, которая определяет голосовую VLAN, используемую на порту.
The example matches Figure 8-13, using ports F0/1–F0/4.|Пример соответствует рисунку 8-13 с использованием портов F0 / 1 – F0 / 4.
|
Example 8-8 Configuring the Voice and Data VLAN on Ports Connected to Phones Example end.|Пример 8-8 Настройка VLAN для передачи голоса и данных на портах, подключенных к телефонам. Пример конец.
|
Chapter 9, “Device Management Protocols,” must be enabled on an interface for a voice access port to work with Cisco IP phones.|Глава 9 «Протоколы управления устройством» должна быть включена на интерфейсе, чтобы порт голосового доступа работал с IP-телефонами Cisco.
Cisco switches and routers enable CDP by default, so its configuration is not shown here.|Коммутаторы и маршрутизаторы Cisco включают CDP по умолчанию, поэтому его конфигурация здесь не показана.
|
The following list details the configuration steps for easier review and study:|В следующем списке подробно описаны шаги настройки для облегчения просмотра и изучения:
|
Step 1.|Шаг 1.
Use the vlan vlan-id command in global configuration mode to create the data and voice VLANs if they do not already exist on the switch.|Используйте команду vlan vlan-id в режиме глобальной конфигурации для создания сетей VLAN для передачи данных и голоса, если они еще не существуют на коммутаторе.
|
Step 2.|Шаг 2.
Configure the data VLAN like an access VLAN, as usual:|Настройте VLAN данных как VLAN доступа, как обычно:
|
A. Use the interface type number command global configuration mode to move into interface configuration mode.|A. Используйте режим глобальной конфигурации команды номера типа интерфейса, чтобы перейти в режим конфигурации интерфейса.
|
B. Use the switchport access vlan id-number command in interface configuration mode to define the data VLAN.|B. Используйте команду switchport access vlan id-number в режиме настройки интерфейса, чтобы определить VLAN данных.
|
C. Use the switchport mode access command in interface configuration mode to make this port always operate in access mode (that is, to not trunk).|C. Используйте команду switchport mode access в режиме настройки интерфейса, чтобы этот порт всегда работал в режиме доступа (то есть не в магистральном режиме).
|
Step 3.|Шаг 3.
Use the switchport voice vlan id-number command in interface configuration mode to set the voice VLAN ID.|Используйте команду switchport voice vlan id-number в режиме настройки интерфейса, чтобы установить идентификатор голосовой VLAN.
|
Config Checklist Verifying the status of a switch port configured like Example 8-8 shows some different output compared to the pure access port and pure trunk port configurations seen earlier in this chapter.|Контрольный список конфигурации При проверке состояния порта коммутатора, настроенного, как в примере 8-8, выходные данные несколько отличаются по сравнению с конфигурациями чистого порта доступа и чистого транкового порта, рассмотренными ранее в этой главе.
For example, the show interfaces switchport command shows details about the operation of an interface, including many details about access ports.|Например, команда show interfaces switchport показывает подробные сведения о работе интерфейса, включая многие сведения о портах доступа.
Example 8-9 shows those details for port F0/4 after the configuration in Example 8-8 was added.|В примере 8-9 показаны эти подробности для порта F0 / 4 после добавления конфигурации из примера 8-8.
|
Example 8-9 Verifying the Data VLAN (Access VLAN) and Voice VLAN Example end.|Пример 8-9 Проверка VLAN данных (VLAN доступа) и голосовой VLAN Пример конец.
|
Working through the first three highlighted lines in the output, all those details should look familiar for any access port.|Проработав первые три выделенные строки в выходных данных, все эти детали должны быть знакомы для любого порта доступа.
The switchport mode access configuration command statically configures the administrative mode to be an access port, so the port of course operates as an access port.|Команда настройки доступа в режиме switchport статически настраивает административный режим как порт доступа, поэтому порт, конечно же, работает как порт доступа.
Also, as shown in the third highlighted line, the switchport access vlan 10 configuration command defined the access mode VLAN as highlighted here.|Кроме того, как показано в третьей выделенной строке, команда конфигурации switchport access vlan 10 определила VLAN режима доступа, как показано здесь.
|
The fourth highlighted line shows the one small new piece of information: the voice VLAN ID, as set with the switchport voice vlan 11 command in this case.|Четвертая выделенная строка показывает одну небольшую новую информацию: идентификатор голосовой VLAN, установленный в этом случае с помощью команды switchport voice vlan 11.
This small line of output is the only piece of information in the output that differs from the earlier access port examples in this chapter.|Эта небольшая строка вывода - единственная часть информации в выводе, которая отличается от предыдущих примеров порта доступа в этой главе.
|
These ports act more like access ports than trunk ports.|Эти порты больше похожи на порты доступа, чем на магистральные порты.
In fact, the show interfaces type number switchport command boldly proclaims, “Operational Mode: static access.”|Фактически, команда show interfaces type number switchport смело заявляет: «Рабочий режим: статический доступ».
|
However, one other show command reveals just a little more about the underlying operation with 802.1Q tagging for the voice frames.|Однако еще одна команда show раскрывает немного больше о базовой операции с тегированием 802.1Q для голосовых кадров.
|
As mentioned earlier, the show interfaces trunk command—that is, the command that does not include a specific interface in the middle of the command—lists the operational trunks on a switch.|Как упоминалось ранее, команда show interfaces trunk, то есть команда, которая не включает конкретный интерфейс в середине команды, перечисляет рабочие соединительные линии на коммутаторе.
With IP telephony ports, the ports do not show up in the list of trunks either—|При использовании портов IP-телефонии эти порты также не отображаются в списке соединительных линий -
|
providing evidence that these links are not treated as trunks.|предоставление доказательств того, что эти ссылки не рассматриваются как транки.
Example 8-10 shows just such an example.|Пример 8-10 показывает именно такой пример.
|
However, the show interfaces trunk command with the interface listed in the middle of the command, as is also shown in Example 8-10, does list some additional information.|Однако команда show interfaces trunk с интерфейсом, указанным в середине команды, как также показано в примере 8-10, действительно перечисляет некоторую дополнительную информацию.
Note that in this case, the show interfaces F0/4 trunk command lists the status as not-trunking, but with VLANs 10 and 11 allowed on the trunk. (Normally, on an access port, only the access VLAN is listed in the “VLANs allowed on the trunk” list in the output of this command.)|Обратите внимание, что в этом случае команда show interfaces F0 / 4 trunk указывает статус как «не транкинг», но с разрешенными на магистрали VLAN 10 и 11. (Обычно для порта доступа только VLAN доступа указывается в списке «VLAN, разрешенные на магистрали» в выходных данных этой команды.)
|
Example 8-10 Allowed VLAN List and the List of Active VLANs Example end.|Пример 8-10. Список разрешенных VLAN и список активных VLAN. Пример конец.
##### Summary: IP Telephony Ports on Switches
Обзор: порты IP-телефонии на коммутаторах   
__|__
--|--
|
It might seem as though this short topic about IP telephony and switch configuration includes a lot of small twists and turns and trivia, and it does.|Может показаться, что этот краткий раздел об IP-телефонии и настройке коммутатора включает в себя множество мелких ухищрений и мелочей, и это действительно так.
The most important items to remember are as follows:|Наиболее важные моменты, о которых следует помнить, следующие:
###### Configure these ports like a normal access port to begin: Configure it as a static access
Для начала настройте эти порты как обычный порт доступа: Настройте их как статический доступ   
__|__
--|--
|
port and assign it an access VLAN.|порт и назначьте ему доступ к VLAN.
###### Add one more command to define the voice VLAN (switchport voice vlan vlan-id).
Добавьте еще одну команду для определения голосовой VLAN (switchport voice vlan vlan-id).   
###### Look for the mention of the voice VLAN ID, but no other new facts, in the output of the
Ищите упоминание идентификатора голосовой VLAN ID, но никаких других новых фактов в выводе   
__|__
--|--
|
show interfaces type number switchport command.|команда show interfaces type number switchport.
###### Look for both the voice and data (access) VLAN IDs in the output of the show interfaces
Найдите идентификаторы VLAN для голоса и данных (доступа) в выходных данных show interfaces   
__|__
--|--
|
type number trunk command.|введите номер команды соединительной линии.
###### Do not expect to see the port listed in the list of operational trunks as listed by the show
Не ожидайте увидеть порт, указанный в списке рабочих магистралей, как указано на шоу.   
__|__
--|--
|
interfaces trunk command.|интерфейс магистральной команды.
### Troubleshooting VLANs and VLAN Trunks
Устранение неполадок в сетях VLAN и магистралях VLAN   
__|__
--|--
|
A switch’s data plane forwarding processes depend in part on VLANs and VLAN trunking.|Процессы пересылки уровня данных коммутатора частично зависят от сетей VLAN и транкинга VLAN.
|
This final section of the chapter focuses on issues related to VLANs and VLAN trunks that could prevent LAN switching from working properly, focusing on a few items not yet discussed in the chapter.|В этом последнем разделе главы основное внимание уделяется вопросам, связанным с сетями VLAN и магистралями VLAN, которые могут помешать правильной работе коммутации локальной сети, при этом особое внимание уделяется нескольким вопросам, которые еще не обсуждались в этой главе.
In particular, this section examines these steps an engineer can take to avoid issues:|В частности, в этом разделе рассматриваются следующие шаги, которые инженер может предпринять, чтобы избежать проблем:
|
Step 1.|Шаг 1.
Confirm that all VLANs are both defined and active.|Убедитесь, что все VLAN определены и активны.
|
Step 2.|Шаг 2.
Check the allowed VLAN lists on both ends of each trunk to ensure that all VLANs intended to be used are included.|Проверьте списки разрешенных VLAN на обоих концах каждой магистрали, чтобы убедиться, что включены все VLAN, предназначенные для использования.
|
Step 3.|Шаг 3.
Check for incorrect trunk configuration settings that result in one switch operating as a trunk, with the neighboring switch not operating as a trunk.|Проверьте неправильные настройки конфигурации магистрали, в результате которых один коммутатор работает как магистраль, а соседний коммутатор не работает как магистраль.
|
Step 4.|Шаг 4.
Check the native VLAN settings on both ends of the trunk to ensure the settings match.|Проверьте настройки собственной VLAN на обоих концах магистрали, чтобы убедиться, что настройки совпадают.
#### Access VLANs Undefined or Disabled
Доступ к VLAN не определен или отключен   
__|__
--|--
|
Switches do not forward frames for VLANs that are (a) not known because the VLAN is not configured or has not been learned with VTP or (b) the VLAN is known, but it is disabled (shut down).|Коммутаторы не пересылают кадры для VLAN, которые (а) неизвестны, потому что VLAN не настроена или не была изучена с помощью VTP, или (b) VLAN известна, но отключена (выключена).
This next topic summarizes the best ways to confirm that a switch knows that a particular VLAN exists, and if it exists, determines the shutdown state of the VLAN.|В следующем разделе кратко описаны лучшие способы подтверждения того, что коммутатор знает о существовании конкретной VLAN, и, если она существует, определяет состояние выключения этой VLAN.
|
First, on the issue of whether a VLAN exists on a switch, a VLAN can be defined to a switch in two ways: using the vlan number global configuration command, or it can be learned from another switch using VTP. As mentioned earlier in this chapter, the examples in this book assume that you are not using VTP. If you discover that a VLAN does not exist on a switch, simply configure the VLAN as discussed earlier in the section, “Creating VLANs and Assigning Access VLANs to an Interface.”|Во-первых, по вопросу о том, существует ли VLAN на коммутаторе, VLAN может быть определена для коммутатора двумя способами: с помощью команды глобальной конфигурации номера vlan или ее можно узнать от другого коммутатора с помощью VTP. Как упоминалось ранее в этой главе, примеры в этой книге предполагают, что вы не используете VTP. Если вы обнаружите, что VLAN не существует на коммутаторе, просто настройте VLAN, как описано ранее в разделе «Создание VLAN и назначение VLAN доступа интерфейсу».
|
In addition to checking the configuration, you can check for the status of the VLAN (as well as whether it is known to the switch) using the show vlan command.|Помимо проверки конфигурации, вы можете проверить состояние VLAN (а также то, известно ли оно коммутатору), используя команду show vlan.
No matter the VTP mode, this command will list all VLANs known to the switch, plus one of two VLAN state values, depending on the current state: either active or act/lshut.|Независимо от режима VTP, эта команда выведет список всех VLAN, известных коммутатору, плюс одно из двух значений состояния VLAN, в зависимости от текущего состояния: active или act / lshut.
The second of these states means that the VLAN is shut down.|Второе из этих состояний означает, что VLAN отключена.
Shutting down a VLAN disables the VLAN on that switch only, so the switch will not forward frames in that VLAN.|Выключение VLAN отключает VLAN только на этом коммутаторе, поэтому коммутатор не будет пересылать кадры в этой VLAN.
|
Switch IOS gives you two similar configuration methods with which to disable (shutdown)|Switch IOS предоставляет вам два аналогичных метода настройки для отключения (выключения)
|
and enable (no shutdown) a VLAN. Example 8-11 shows how, first by using the global command [no] shutdown vlan number and then using the VLAN mode subcommand [no]|и включить (без выключения) VLAN. В примере 8-11 показано, как сначала с помощью глобальной команды [no] выключить номер vlan, а затем с помощью подкоманды режима VLAN [no]
|
shutdown.|неисправность.
The example shows the global commands enabling and disabling VLANs 10 and 20, respectively, and using VLAN subcommands to enable and disable VLANs 30 and 40, respectively.|В примере показаны глобальные команды, включающие и выключающие VLAN 10 и 20 соответственно, и использующие подкоманды VLAN для включения и отключения VLAN 30 и 40 соответственно.
|
Example 8-11 Enabling and Disabling VLANs on a Switch Example end.|Пример 8-11 Включение и отключение VLAN на коммутаторе.
|
NOTE The output of the show vlan brief command also lists a state of “act/unsup” for the reserved VLAN IDs 1002–1005, with “unsup” meaning “unsupported.”|ПРИМЕЧАНИЕ. В выходных данных команды show vlan Short также указывается состояние «действие / отключение» для зарезервированных идентификаторов VLAN 1002–1005, где «отключено» означает «не поддерживается».
#### Mismatched Trunking Operational States
Несоответствующие рабочие состояния транкинга   
__|__
--|--
|
Trunking can be configured correctly so that both switches use trunking.|Транкинг можно правильно настроить, чтобы оба коммутатора использовали транкинг.
However, trunks can also be misconfigured, with a couple of different results: either both switches do not trunk, or one switch trunks and the other does not.|Однако соединительные линии также могут быть неправильно сконфигурированы, что может привести к нескольким различным результатам: либо оба коммутатора не являются соединительными линиями, либо один коммутатор соединяет соединительные линии, а другой - нет.
Both results cause problems.|Оба результата вызывают проблемы.
|
The most common incorrect configuration—which results in both switches not trunking—is a configuration that uses the switchport mode dynamic auto command on both switches on the link.|Наиболее распространенная неправильная конфигурация - в результате которой оба коммутатора не соединяются в транкинг - это конфигурация, в которой используется динамическая автоматическая команда режима switchport на обоих коммутаторах канала.
The word auto just makes us all want to think that the link would trunk automatically, but this command is both automatic and passive.|Слово auto просто заставляет всех нас думать, что ссылка будет транслироваться автоматически, но эта команда одновременно автоматическая и пассивная.
As a result, both switches passively wait on the other device on the link to begin negotiations.|В результате оба коммутатора пассивно ждут на другом устройстве в канале связи, чтобы начать переговоры.
Example 8-12 highlights those parts of the output from the show interfaces switchport command that confirm both the configured and operational states.|В примере 8-12 выделены те части выходных данных команды show interfaces switchport, которые подтверждают как настроенное, так и рабочее состояние.
Note that the output lists the operational mode as “static access” rather than “trunking.”|Обратите внимание, что в выходных данных рабочий режим указан как «статический доступ», а не «транкинг».
|
Example 8-12 Operational Trunking State Example end.|Пример 8-12 Рабочее состояние транкинга Пример конец.
|
A different incorrect trunking configuration has an even worse result: one switch trunks, sending tagged frames, while the neighboring switch does not trunk, so the neighboring switch discards any frames it receives that have a VLAN tag in the header.|Другая неправильная конфигурация транкинга дает еще худший результат: один коммутатор соединяет транкинг, отправляя тегированные кадры, в то время как соседний коммутатор не соединяется, поэтому соседний коммутатор отбрасывает все полученные им кадры, которые имеют тег VLAN в заголовке.
When this combination of events happens, the interface works in that the status on each end will be up/up or connected.|Когда происходит эта комбинация событий, интерфейс работает так, что состояние на каждом конце будет «включено» / «работает» или «подключен».
Traffic in the native VLAN will actually cross the link successfully because those frames have no VLAN tags (headers).|Трафик в собственной VLAN фактически будет успешно пересекать ссылку, потому что эти кадры не имеют тегов (заголовков) VLAN.
However, traffic in all the rest of the VLANs will not cross the link.|Однако трафик во всех остальных VLAN не будет пересекать ссылку.
|
Figure 8-14 shows the incorrect configuration along with which side trunks and which does not.|На Рис. 8-14 показана неправильная конфигурация с указанием того, какие боковые стволы, а какие нет.
The side that trunks (SW1 in this case) enables trunking using the command switchport mode trunk but also disables Dynamic Trunking Protocol (DTP) negotiations using the switchport nonegotiate command.|Сторона, которая выполняет транкинг (в данном случае SW1), включает транкинг с помощью команды switchport mode trunk, но также отключает согласование протокола динамического транкинга (DTP) с помощью команды switchport nonegotiate.
SW2’s configuration also helps create the problem, by using one of the two trunking options that relies on DTP. Because SW1 has disabled DTP, SW2’s DTP negotiations fail, and SW2 chooses to not trunk.|Конфигурация SW2 также помогает создать проблему, используя один из двух вариантов транкинга, основанный на DTP. Поскольку SW1 отключил DTP, согласование DTP SW2 не выполняется, и SW2 выбирает не транк.
|
Figure 8-14 Mismatched Trunking Operational States The figure shows what happens when using this incorrect configuration.|Рисунок 8-14 Несоответствующие рабочие состояния транкинга На рисунке показано, что происходит при использовании этой неправильной конфигурации.
At Step 1, SW1 could (for example) forward a frame in VLAN 10.|На шаге 1 SW1 может (например) переслать кадр в VLAN 10.
However, SW2 would view any frame that arrives with an 802.1Q header as illegal because the frame has an 802.1Q header, and SW2 treats its G0/2 port as an access port.|Однако SW2 будет рассматривать любой фрейм, который прибывает с заголовком 802.1Q, как недопустимый, поскольку у фрейма есть заголовок 802.1Q, а SW2 рассматривает свой порт G0 / 2 как порт доступа.
So, SW2 discards any 802.1Q frames received on that port.|Таким образом, SW2 отбрасывает все кадры 802.1Q, полученные на этом порту.
|
The trunking issues shown here can be easily avoided by checking the configuration and by checking the trunk’s operational state (mode) on both sides of the trunk.|Показанных здесь проблем с транкингом можно легко избежать, проверив конфигурацию и проверив рабочее состояние (режим) соединительной линии на обеих сторонах соединительной линии.
The best commands to check trunking-related facts are show interfaces trunk and show interfaces switchport.|Лучшие команды для проверки фактов, связанных с транкингом, - это show interfaces trunk и show interfaces switchport.
|
Just be aware that the switches do not prevent you from making these configuration mistakes.|Просто имейте в виду, что переключатели не мешают вам делать эти ошибки конфигурации.
#### The Supported VLAN List on Trunks
Список поддерживаемых VLAN на магистралях   
__|__
--|--
|
A Cisco switch can forward traffic for all defined and active VLANs. However, a particular VLAN trunk may not forward traffic for a defined and active VLAN for a variety of other reasons.|Коммутатор Cisco может пересылать трафик для всех определенных и активных сетей VLAN. Однако конкретная магистраль VLAN может не пересылать трафик для определенной и активной VLAN по ряду других причин.
You should learn how to identify which VLANs a particular trunk port currently supports and the reasons why the switch might not be forwarding frames for a VLAN on that trunk port.|Вы должны узнать, как определить, какие сети VLAN поддерживает конкретный магистральный порт в настоящее время, а также причины, по которым коммутатор может не пересылать кадры для VLAN на этом магистральном порту.
|
The first category in this step can be easily done using the show interfaces interface-id trunk command, which only lists information about currently operational trunks.|Первую категорию на этом шаге можно легко сделать с помощью команды show interfaces interface-id trunk, которая перечисляет только информацию о текущих действующих соединительных линиях.
The best place to begin with this command is the last section of output, which lists the VLANs whose traffic will be forwarded over the trunk.|Лучше всего начинать с этой команды с последнего раздела вывода, в котором перечислены сети VLAN, трафик которых будет пересылаться по магистрали.
Any VLANs that make it to this final list of VLANs in the command output meet the following criteria:|Любые сети VLAN, которые попадают в этот окончательный список VLAN в выходных данных команды, соответствуют следующим критериям:
###### The VLAN has not been removed from the allowed VLAN list on the trunk (as configured
VLAN не была удалена из списка разрешенных VLAN на магистрали (как настроено   
__|__
--|--
|
with the switchport trunk allowed vlan interface subcommand).|с транком switchport разрешена подкоманда интерфейса vlan).
###### The VLAN exists and is active on the local switch (as seen in the show vlan command).
VLAN существует и активна на локальном коммутаторе (как показано в команде show vlan).   
###### The VLAN has not been VTP-pruned from the trunk. (Because this book attempts to
VLAN не была удалена из магистрали VTP. (Поскольку эта книга пытается   
__|__
--|--
|
ignore VTP as much as possible, this section assumes that VTP is not used and this feature has no impact on any trunks.) The trunk is in an STP forwarding state in that VLAN (as also seen in the show spanning-tree vlan vlan-id command).|в максимально возможной степени игнорируйте VTP, в этом разделе предполагается, что VTP не используется, и эта функция не влияет на какие-либо магистрали.) Магистраль находится в состоянии пересылки STP в этой VLAN (как также показано в показе spanning-tree vlan vlan- id команда).
|
The switchport trunk allowed vlan interface subcommand gives the network engineer a method to administratively limit the VLANs whose traffic uses a trunk.|Подкоманда switchport trunk allowed vlan interface дает сетевому инженеру метод административного ограничения VLAN, трафик которых использует транк.
If the engineer wants all defined VLANs to be supported on a trunk, the engineer simply does not configure this command.|Если инженер хочет, чтобы все определенные VLAN поддерживались на магистрали, он просто не настраивает эту команду.
If the engineer would like to limit the trunk to support a subset of the VLANs known to the switch, however, the engineer can add one or more switchport trunk allowed vlan interface subcommands.|Однако, если инженер хочет ограничить магистраль для поддержки подмножества сетей VLAN, известных коммутатору, он может добавить одну или несколько подкоманд интерфейса vlan, разрешенных магистралью порта коммутатора.
|
For instance, in a switch that has configured VLANs 1 through 100, but no others, by default the switch would allow traffic in all 100 VLANs. However, the trunk interface command switchport trunk allowed vlan 1-60 would limit the trunk to forward traffic for VLANs 1 through 60, but not the rest of the VLANs. Example 8-13 shows a sample of the command output from the show interfaces trunk command, which confirms the first list of VLAN IDs now lists VLANs 1–60.|Например, в коммутаторе, который настроил сети VLAN с 1 по 100, но не другие, по умолчанию коммутатор будет разрешать трафик во всех 100 VLAN. Однако команда интерфейса транка switchport trunk allowed vlan 1-60 ограничит транк для пересылки трафика для VLAN с 1 по 60, но не для остальных VLAN. В примере 8-13 показан образец выходных данных команды show interfaces trunk, подтверждающий, что в первом списке идентификаторов VLAN теперь перечислены VLAN 1–60.
Without the switchport trunk allowed vlan command, the first list would have included VLANs 1–4094.|Без команды switchport trunk allowed vlan первый список включал бы VLAN 1–4094.
|
Example 8-13 Allowed VLAN List and List of Active VLANs Example end.|Пример 8-13 Список разрешенных VLAN и список активных VLAN Пример конец.
|
The output of the show interfaces trunk command creates three separate lists of VLANs, each under a separate heading.|Выходные данные команды show interfaces trunk создают три отдельных списка VLAN, каждый под отдельным заголовком.
These three lists show a progression of reasons why a VLAN is not forwarded over a trunk.|Эти три списка показывают последовательность причин, по которым VLAN не пересылается по магистрали.
Table 8-4 summarizes the headings that precede each list and the reasons why a switch chooses to include or not include a VLAN in each list.|В таблице 8-4 приведены заголовки, предшествующие каждому списку, и причины, по которым коммутатор решает включать или не включать VLAN в каждый список.
For instance, in Example 8-13, VLAN 60 has been shut down, and VLAN 59 happens to be in an STP blocking state. (Chapter 9, “Spanning Tree Protocol Concepts,” has more information about STP.)|Например, в Примере 8-13 VLAN 60 отключена, а VLAN 59 находится в состоянии блокировки STP. (Глава 9, «Основные понятия протокола связующего дерева», содержит дополнительную информацию о STP.)
|
Table 8-4 VLAN Lists in the show interfaces trunk Command Table end.|Таблица 8-4 Списки VLAN в конце таблицы команд show interfaces trunk.
|
NOTE The companion website includes a video from the CCNA Exam Prep LiveLessons product, named “Troubleshooting VLANs Allowed on a Trunk #1,” which works through the three lists of VLANs in the output of the show interfaces interface-id trunk command in more detail.|ПРИМЕЧАНИЕ. На сопутствующем веб-сайте есть видео из продукта CCNA Exam Prep LiveLessons под названием «Устранение неполадок виртуальных локальных сетей, разрешенных на магистрали №1», которое более подробно работает с тремя списками виртуальных локальных сетей в выходных данных команды show interfaces interface-id trunk. .
#### Mismatched Native VLAN on a Trunk
Несоответствие собственной VLAN на магистрали   
__|__
--|--
|
Unfortunately, it is possible to set the native VLAN ID to different VLANs on either end of the trunk, using the switchport trunk native vlan vlan-id command.|К сожалению, можно установить собственный VLAN ID для разных VLAN на любом конце магистрали, используя команду switchport trunk native vlan vlan-id.
If the native VLANs differ according to the two neighboring switches, the switches will cause frames sent in the native VLAN to jump from one VLAN to the other.|Если собственные VLAN различаются в зависимости от двух соседних коммутаторов, коммутаторы заставят кадры, отправленные в собственной VLAN, переходить из одной VLAN в другую.
|
For example, if switch SW1 sends a frame using native VLAN 1 on an 802.1Q trunk, SW1 does not add a VLAN header, as is normal for the native VLAN. When switch SW2 receives the frame, noticing that no 802.1Q header exists, SW2 assumes that the frame is part of SW2’s configured native VLAN. If SW2 has been configured to think VLAN 2 is the native VLAN on that trunk, SW2 will try to forward the received frame into VLAN 2. (This effect of a frame being sent in one VLAN but then being believed to be in a different VLAN is called VLAN hopping.)|Например, если коммутатор SW1 отправляет кадр с использованием собственной VLAN 1 по магистрали 802.1Q, SW1 не добавляет заголовок VLAN, как это обычно бывает для собственной VLAN. Когда коммутатор SW2 принимает кадр, замечая, что заголовок 802.1Q не существует, SW2 предполагает, что кадр является частью настроенной собственной VLAN SW2. Если SW2 настроен так, чтобы считать, что VLAN 2 является собственной VLAN на этом магистральном канале, SW2 попытается переслать полученный кадр в VLAN 2. (Это эффект отправки кадра в одну VLAN, но затем считается, что он находится в другой VLAN. называется перескоком VLAN.)
### Chapter Review
Обзор главы   
__|__
--|--
|
Review this chapter’s material using either the tools in the book or the interactive tools for the same material found on the book’s companion website.|Просмотрите материал этой главы, используя инструменты в книге или интерактивные инструменты для того же материала, которые можно найти на сопутствующем веб-сайте книги.
Table 8-5 outlines the key review elements and where you can find them.|В Таблице 8-5 перечислены ключевые элементы обзора и указаны места, где их можно найти.
To better track your study progress, record when you completed these activities in the second column.|Чтобы лучше отслеживать свои успехи в учебе, отметьте, когда вы выполнили эти задания, во втором столбце.
|
Table 8-5 Chapter Review Tracking Table end.|Таблица 8-5 Окончание таблицы отслеживания обзора главы.
|
Review All the Key Topics Key Terms You Should Know 802.1Q, trunk, trunking administrative mode, trunking operational mode, VLAN, VTP, VTP transparent mode, Layer 3 switch, access interface, trunk interface, data VLAN, voice VLAN, native VLAN, default VLAN, static access interface Do Labs The Sim Lite software is a version of Pearson’s full simulator learning product with a subset of the labs, included free with this book.|Ознакомьтесь со всеми ключевыми темами Ключевые термины, которые вы должны знать 802.1Q, магистраль, административный режим транкинга, рабочий режим транкинга, VLAN, VTP, прозрачный режим VTP, коммутатор уровня 3, интерфейс доступа, интерфейс магистрали, VLAN для передачи данных, голосовая VLAN, собственная VLAN, VLAN по умолчанию, интерфейс статического доступа. Лаборатории. Программное обеспечение Sim Lite - это версия полного учебного продукта Pearson на симуляторах с подмножеством лабораторных работ, бесплатно включенных в эту книгу.
The Sim Lite with this book includes a couple of labs about VLANs. Also, check the author’s blog site pages for configuration exercises (Config Labs) at https://blog.certskills.com.|Sim Lite с этой книгой включает в себя несколько лабораторных работ по VLAN. Также проверьте страницы блога автора на предмет упражнений по настройке (Лаборатория конфигурации) по адресу https://blog.certskills.com.
|
Command References Tables 8-7 and 8-8 list configuration and verification commands used in this chapter, respectively.|Ссылки на команды В таблицах 8-7 и 8-8 перечислены команды настройки и проверки, используемые в этой главе, соответственно.
|
As an easy review exercise, cover the left column in a table, read the right column, and try to recall the command without looking.|В качестве простого упражнения на повторение закройте левый столбец таблицы, прочтите правый столбец и попытайтесь вспомнить команду, не глядя.
Then repeat the exercise, covering the right column, and try to recall what the command does.|Затем повторите упражнение, охватывая правый столбец, и попытайтесь вспомнить, что делает команда.
|
Table 8-7 Chapter 8 Configuration Command Reference Table end.|Таблица 8-7 Глава 8 Справочник команд конфигурации Конец таблицы.
|
Table 8-8 Chapter 8 EXEC Command Reference Table end.|Таблица 8-8 Глава 8 Справочник команд EXEC Конец таблицы.
## Chapter 9 Spanning Tree Protocol Concepts
Глава 9 Концепции протокола связующего дерева   
__|__
--|--
|
This chapter covers the following exam topics:|В этой главе рассматриваются следующие экзаменационные темы:
###### 2.0 Network Access
2.0 Доступ к сети   
###### 2.4 Configure and verify (Layer 2/Layer 3) EtherChannel (LACP)
2.4 Настройка и проверка (уровень 2 / уровень 3) EtherChannel (LACP)   
###### 2.5 Describe the need for and basic operations of Rapid PVST+ Spanning Tree Protocol
2.5. Опишите необходимость и основные операции Rapid PVST + Spanning Tree Protocol.   
__|__
--|--
|
and identify basic operations|и определить основные операции
###### 2.5.a Root port, root bridge (primary/secondary), and other port names
2.5.a Корневой порт, корневой мост (первичный / вторичный) и другие имена портов.   
###### 2.5.b Port states (forwarding/blocking)
2.5.b Состояния портов (пересылка / блокировка)   
###### 2.5.c PortFast benefits
2.5.c Преимущества PortFast   
__|__
--|--
|
Spanning Tree Protocol (STP) allows Ethernet LANs to have the added benefits of installing redundant links in a LAN, while overcoming the known problems that occur when adding those extra links.|Протокол Spanning Tree Protocol (STP) позволяет локальным сетям Ethernet иметь дополнительные преимущества, заключающиеся в установке резервных каналов в локальной сети, при одновременном преодолении известных проблем, возникающих при добавлении этих дополнительных каналов.
Using redundant links in a LAN design allows the LAN to keep working even when some links fail or even when some entire switches fail.|Использование избыточных ссылок в конструкции локальной сети позволяет локальной сети продолжать работать даже при выходе из строя некоторых каналов или даже при выходе из строя некоторых коммутаторов целиком.
Proper LAN design should add enough redundancy so that no single point of failure crashes the LAN; STP allows the design to use redundancy without causing some other problems.|Правильный дизайн ЛВС должен добавить достаточную избыточность, чтобы ни одна единственная точка отказа не разрушила ЛВС; STP позволяет проекту использовать избыточность, не вызывая других проблем.
|
Historically, the IEEE first standardized STP as part of the IEEE 802.1D standard back in 1990, with pre-standard versions working even before that time.|Исторически сложилось так, что IEEE впервые стандартизировал протокол STP как часть стандарта IEEE 802.1D еще в 1990 году, а предварительные версии стандарта работали еще раньше.
Over time, the industry and IEEE improved STP, with the eventual replacement of STP with an improved protocol: Rapid Spanning Tree Protocol (RSTP). The IEEE first released RSTP as amendment 802.1w and, in 2004, integrated RSTP into the 802.1D standard.|Со временем отрасль и IEEE улучшили STP с возможной заменой STP на улучшенный протокол: Rapid Spanning Tree Protocol (RSTP). IEEE сначала выпустил RSTP как поправку к 802.1w, а в 2004 году интегрировал RSTP в стандарт 802.1D.
|
An argument could be made to ignore STP today and instead focus solely on RSTP. Most modern networks use RSTP instead of STP. The most recent models and IOS versions of Cisco switches default to use RSTP instead of STP. Plus, the CCNA 200-301 exam topics mention RSTP by name, but not STP. However, STP and RSTP share many of the same mechanisms, and RSTP’s improvements can be best understood in comparison to STP. For that reason, this chapter presents some details that apply only to STP, as a learning tool to help you understand RSTP.|Можно привести аргумент, чтобы сегодня игнорировать STP и вместо этого сосредоточиться исключительно на RSTP. Большинство современных сетей используют RSTP вместо STP. Самые последние модели и версии IOS коммутаторов Cisco по умолчанию используют RSTP вместо STP. Кроме того, в темах экзамена CCNA 200-301 по имени упоминается RSTP, но не STP. Тем не менее, STP и RSTP используют одни и те же механизмы, и улучшения RSTP можно лучше понять по сравнению с STP. По этой причине в этой главе представлены некоторые подробности, которые относятся только к STP, как к учебному пособию, которое поможет вам понять RSTP.
|
This chapter organizes the material into three sections.|В этой главе материал разбит на три раздела.
The first section presents some core concepts about how both STP and RSTP discover a tree made of nodes (switches) and links so that no loops exist in a network.|В первом разделе представлены некоторые основные концепции о том, как STP и RSTP обнаруживают дерево, состоящее из узлов (коммутаторов) и каналов, так что в сети не существует петель.
The second section then takes a brief look at the area for which STP differs the most from RSTP: in how STP reacts to changes in the network.|Во втором разделе кратко рассматривается область, в которой протокол STP больше всего отличается от RSTP: то, как протокол STP реагирует на изменения в сети.
This chapter ends with a third major section that details RSTP, including how RSTP works much better that STP when reacting to changes.|Эта глава заканчивается третьим основным разделом, в котором подробно описывается RSTP, в том числе то, как RSTP работает намного лучше, чем STP при реагировании на изменения.
### “Do I Know This Already?” Quiz
«Знаю ли я это уже?» Викторина   
__|__
--|--
|
Take the quiz (either here or use the PTP software) if you want to use the score to help you decide how much time to spend on this chapter.|Пройдите тест (здесь или воспользуйтесь программой PTP), если вы хотите использовать оценку, чтобы решить, сколько времени потратить на эту главу.
The letter answers are listed at the bottom CHAPTER 9 of the page following the quiz.|Ответы на письма перечислены в нижней ГЛАВЕ 9 страницы после викторины.
Appendix C, found both at the end of the book as well as on the companion website, includes both the answers and explanations.|Приложение C, которое можно найти как в конце книги, так и на сопутствующем веб-сайте, включает как ответы, так и пояснения.
You can also find both answers and explanations in the PTP testing software.|Вы также можете найти ответы и пояснения в программе тестирования PTP.
|
Table 9-1 “Do I Know This Already?” Foundation Topics Section-to-Question Mapping|Таблица 9-1 «Знаю ли я это уже?» Сопоставление разделов с вопросами по основным темам
### Foundation Topics
Основные темы   
### STP and RSTP Basics
Основы STP и RSTP   
__|__
--|--
|
Details Specific to STP (and Not RSTP) 3–4 Rapid STP Concepts 5–7 1.|Подробности, относящиеся к STP (а не RSTP) 3–4 Основные понятия Rapid STP 5–7 1.
Which of the following port states are stable states used when STP has completed convergence?|Какие из следующих состояний порта используются в стабильных состояниях после завершения конвергенции STP?
|
(Choose two answers.)|(Выберите два ответа.)
|
a. Blocking b.|а. Блокировка b.
Forwarding c.|Пересылка c.
Listening d.|Прослушивание d.
Learning e.|Обучение e.
Discarding 2.|Отбрасывая 2.
Which of the following bridge IDs wins election as root, assuming that the switches with these bridge IDs are in the same network?|Какой из следующих идентификаторов моста выигрывает выборы в качестве root, если предполагается, что коммутаторы с этими идентификаторами моста находятся в одной сети?
|
a. 32769:0200.1111.1111 b. 32769:0200.2222.2222 c. 4097:0200.1111.1111 d. 4097:0200.2222.2222 e. 40961:0200.1111.1111 3.|а. 32769: 0200.1111.1111 б. 32769: 0200.2222.2222 с. 4097: 0200.1111.1111 г. 4097: 0200.2222.2222 e. 40961: 0200.1111.1111 3.
Which of the following are transitory port states used only during the process of STP convergence? (Choose two answers.)|Какие из следующих состояний порта используются только в процессе конвергенции STP? (Выберите два ответа.)
|
a. Blocking b.|а. Блокировка b.
Forwarding c.|Пересылка c.
Listening d.|Прослушивание d.
Learning e.|Обучение e.
Discarding 4.|Отбрасывание 4.
Which of the following facts determines how often a nonroot bridge or switch sends an STP Hello BPDU message?|Какой из следующих фактов определяет, как часто некорневой мост или коммутатор отправляет сообщение STP Hello BPDU?
|
a. The Hello timer as configured on that switch.|а. Таймер Hello, настроенный на этом переключателе.
|
b. The Hello timer as configured on the root switch.|б. Таймер Hello, настроенный на корневом коммутаторе.
|
c. It is always every 2 seconds.|c. Это всегда каждые 2 секунды.
|
d. The switch reacts to BPDUs received from the root switch by sending another BPDU 2 seconds after receiving the root BPDU.|d. Коммутатор реагирует на BPDU, полученные от корневого коммутатора, отправляя другой BPDU через 2 секунды после получения корневого BPDU.
|
5. Which of the following RSTP port states have the same name and purpose as a port state in traditional STP? (Choose two answers.)|5. Какие из следующих состояний порта RSTP имеют то же имя и назначение, что и состояние порта в традиционном STP? (Выберите два ответа.)
|
a. Blocking b.|а. Блокировка b.
Forwarding c.|Пересылка c.
Listening d.|Прослушивание d.
Learning e.|Обучение e.
Discarding 6.|Отбрасывание 6.
RSTP adds features beyond STP that enable ports to be used for a role if another port on the same switch fails.|RSTP добавляет функции помимо STP, которые позволяют использовать порты для роли в случае отказа другого порта на том же коммутаторе.
Which of the following statements correctly describe a port role that is waiting to take over for another port role? (Choose two answers.)|Какое из следующих утверждений правильно описывает роль порта, которая ожидает перехода на другую роль порта? (Выберите два ответа.)
|
a. An alternate port waits to become a root port.|а. Альтернативный порт ожидает, чтобы стать корневым портом.
|
b. A backup port waits to become a root port.|б. Резервный порт ожидает, чтобы стать корневым портом.
|
c. An alternate port waits to become a designated port.|c. Альтернативный порт ожидает, чтобы стать назначенным портом.
|
d. A backup port waits to become a designated port.|d. Резервный порт ожидает, чтобы стать назначенным портом.
|
7. What STP feature causes an interface to be placed in the forwarding state as soon as the interface is physically active?|7. Какая функция STP переводит интерфейс в состояние пересылки, как только интерфейс становится физически активным?
|
a. STP b.|а. СТП б.
EtherChannel c.|EtherChannel c.
Root Guard d.|Корневая защита d.
PortFast Foundation Topics STP and RSTP Basics Without some mechanism like Spanning Tree Protocol (STP) or Rapid STP (RSTP), a LAN with redundant links would cause Ethernet frames to loop for an indefinite period of time.|Основные темы PortFast Основы STP и RSTP Без какого-либо механизма, такого как протокол Spanning Tree Protocol (STP) или Rapid STP (RSTP), в локальной сети с резервными каналами связи кадры Ethernet будут зацикливаться на неопределенный период времени.
|
With STP or RSTP enabled, some switches block ports so that these ports do not forward frames.|При включенном STP или RSTP некоторые коммутаторы блокируют порты, чтобы эти порты не пересылали кадры.
STP and RSTP intelligently choose which ports block, with two goals in mind:|STP и RSTP разумно выбирают, какие порты блокируются, имея в виду две цели:
###### All devices in a VLAN can send frames to all other devices. In other words, STP or RSTP
Все устройства в VLAN могут отправлять кадры всем остальным устройствам. Другими словами, STP или RSTP   
__|__
--|--
|
does not block too many ports, cutting off some parts of the LAN from other parts.|не блокирует слишком много портов, отрезая одни части ЛВС от других.
###### Frames have a short life and do not loop around the network indefinitely.
У фреймов короткий срок службы, и они не могут бесконечно перемещаться по сети.   
__|__
--|--
|
STP and RSTP strike a balance, allowing frames to be delivered to each device, without causing the problems that occur when frames loop through the network over and over again.|Протоколы STP и RSTP обеспечивают баланс, позволяя доставлять кадры на каждое устройство, не вызывая проблем, которые возникают, когда кадры проходят через сеть снова и снова.
|
NOTE This first major section of the chapter explains details of both STP and RSTP, so this section uses the term STP/RSTP to refer to these protocols together.|ПРИМЕЧАНИЕ В этом первом основном разделе главы подробно описываются как STP, так и RSTP, поэтому в этом разделе используется термин STP / RSTP для обозначения этих протоколов вместе.
Note that this term is just a convenient shorthand.|Обратите внимание, что этот термин - всего лишь удобное сокращение.
Later in the chapter, the text will point out differences between STP and RSTP and begin using the terms STP and RSTP separately, referring to only the specific protocol.|Позже в этой главе текст будет указывать на различия между STP и RSTP и начинать использовать термины STP и RSTP отдельно, имея в виду только конкретный протокол.
|
STP/RSTP prevents looping frames by adding an additional check on each interface before a switch uses it to send or receive user traffic.|STP / RSTP предотвращает зацикливание кадров, добавляя дополнительную проверку на каждый интерфейс перед тем, как коммутатор использует его для отправки или получения пользовательского трафика.
That check: If the port is in STP/RSTP forwarding state in that VLAN, use it as normal; if it is in STP/RSTP blocking state, however, block all user traffic and do not send or receive user traffic on that interface in that VLAN.|Эта проверка: если порт находится в состоянии пересылки STP / RSTP в этой VLAN, используйте его как обычно; однако если он находится в состоянии блокировки STP / RSTP, блокируйте весь пользовательский трафик и не отправляйте и не принимайте пользовательский трафик на этом интерфейсе в этой VLAN.
|
Note that these STP/RSTP states do not change the other information you already know about switch interfaces.|Обратите внимание, что эти состояния STP / RSTP не изменяют другую информацию, которую вы уже знаете об интерфейсах коммутатора.
The interface’s state of connected/notconnect does not change.|Состояние интерфейса connected / notconnect не меняется.
The interface’s operational state as either an access or trunk port does not change.|Рабочее состояние интерфейса как порта доступа или магистрального порта не изменяется.
STP/RSTP adds this additional state, with the blocking state basically disabling the interface.|STP / RSTP добавляет это дополнительное состояние, при этом состояние блокировки в основном отключает интерфейс.
|
In many ways, those last two paragraphs sum up what STP/RSTP does.|Во многих отношениях последние два абзаца подводят итог тому, что делает STP / RSTP.
However, the details of how STP/RSTP does its work can take a fair amount of study and practice.|Однако подробности того, как STP / RSTP выполняет свою работу, могут потребовать значительного количества изучения и практики.
This first major section of the chapter begins by explaining the need for STP/RSTP and the basic ideas of what STP/RSTP does to solve the problem of looping frames.|Этот первый основной раздел главы начинается с объяснения необходимости STP / RSTP и основных идей того, что STP / RSTP делает для решения проблемы зацикливания кадров.
The majority of this section then looks at how STP/RSTP goes about choosing which switch ports to block to accomplish its goals.|В большей части этого раздела рассматривается, как протокол STP / RSTP выбирает, какие порты коммутатора блокировать для достижения своих целей.
#### The Need for Spanning Tree
Необходимость связующего дерева   
__|__
--|--
|
STP/RSTP prevents three common problems in Ethernet LANs. All three problems occur as a side effect of one fact: without STP/RSTP, some Ethernet frames would loop around the network for a long time (hours, days, literally forever if the LAN devices and links never failed).|STP / RSTP предотвращает три распространенные проблемы в локальных сетях Ethernet. Все три проблемы возникают как побочный эффект одного факта: без STP / RSTP некоторые кадры Ethernet будут петлять по сети в течение длительного времени (часы, дни, буквально навсегда, если устройства и каналы LAN никогда не выходили из строя).
|
Just one looping frame causes what is called a broadcast storm.|Всего один зацикленный кадр вызывает так называемый широковещательный шторм.
Broadcast storms happen when any kind of Ethernet frames—broadcast frames, multicast frames, or unknown-destination unicast frames—loop around a LAN indefinitely.|Широковещательные штормы случаются, когда любые кадры Ethernet - широковещательные кадры, многоадресные кадры или одноадресные кадры неизвестного назначения - бесконечно циркулируют по локальной сети.
Broadcast storms can saturate all the links with copies of that one single frame, crowding out good frames, as well as significantly impacting end-user device performance by making the PCs process too many broadcast frames.|Широковещательные штормы могут насыщать все ссылки копиями этого единственного кадра, вытесняя хорошие кадры, а также значительно влияя на производительность устройства конечного пользователя, заставляя ПК обрабатывать слишком много широковещательных кадров.
|
To help you understand how this occurs, Figure 9-1 shows a sample network in which Bob sends a broadcast frame.|Чтобы помочь вам понять, как это происходит, на рис. 9-1 показан пример сети, в которой Боб отправляет широковещательный кадр.
The dashed lines show how the switches forward the frame when STP/RSTP does not exist.|Пунктирными линиями показано, как коммутаторы пересылают кадр, когда протокол STP / RSTP не существует.
|
Figure 9-1 Broadcast Storm NOTE Bob’s original broadcast would also be forwarded around the other direction, with SW3 sending a copy of the original frame out its Gi0/1 port.|Рис. 9-1 Broadcast Storm ПРИМЕЧАНИЕ Исходная широковещательная передача Боба также будет пересылаться в другом направлении, при этом SW3 отправляет копию исходного кадра через свой порт Gi0 / 1.
To reduce clutter, Figure 9-1 does not show that frame.|Чтобы уменьшить беспорядок, на рис. 9-1 этот кадр не показан.
|
Remember that LAN switch?|Помните тот переключатель LAN?
That logic tells switches to flood broadcasts out all interfaces in the same VLAN except the interface in which the frame arrived.|Эта логика сообщает коммутаторам, что следует рассылать широковещательную рассылку по всем интерфейсам в одной и той же VLAN, за исключением интерфейса, в который прибыл кадр.
In Figure 9-1, that means SW3 forwards Bob’s frame to SW2, SW2 forwards the frame to SW1, SW1 forwards the frame back to SW3, and SW3 forwards it back to SW2 again.|На рисунке 9-1 это означает, что SW3 пересылает кадр Боба SW2, SW2 пересылает кадр SW1, SW1 пересылает кадр обратно к SW3, а SW3 снова пересылает его обратно к SW2.
|
When broadcast storms happen, frames like the one in Figure 9-1 keep looping until something changes—someone shuts down an interface, reloads a switch, or does something else to break the loop.|Когда случаются широковещательные штормы, кадры, подобные показанному на рис. 9-1, продолжают зацикливаться, пока что-то не изменится - кто-то отключит интерфейс, перезагрузит коммутатор или сделает что-то еще, чтобы разорвать цикл.
Also note that the same event happens in the opposite direction.|Также обратите внимание, что такое же событие происходит в обратном направлении.
When Bob sends the original frame, SW3 also forwards a copy to SW1, SW1 forwards it to SW2, and so on.|Когда Боб отправляет исходный кадр, SW3 также пересылает копию на SW1, SW1 пересылает ее на SW2 и так далее.
|
The storm also causes a much more subtle problem called MAC table instability.|Шторм также вызывает гораздо более тонкую проблему, называемую нестабильностью таблицы MAC.
MAC table instability means that the switches’ MAC address tables keep changing because frames with the same source MAC arrive on different ports.|Нестабильность таблицы MAC-адресов означает, что таблицы MAC-адресов коммутаторов продолжают меняться, поскольку кадры с одним и тем же исходным MAC-адресом поступают на разные порты.
To see why, follow this example, in which SW3 begins Figure 9-1 with a MAC table entry for Bob, at the bottom of the figure, associated with port Fa0/13:|Чтобы понять, почему, следуйте этому примеру, в котором SW3 начинается на рисунке 9-1 с записи таблицы MAC для Боба в нижней части рисунка, связанной с портом Fa0 / 13:
|
0200.3333.3333 Fa0/13 VLAN 1 However, now think about the switch-learning process that occurs when the looping frame goes to SW2, then SW1, and then back into SW3’s Gi0/1 interface.|0200.3333.3333 Fa0 / 13 VLAN 1 Однако теперь подумайте о процессе обучения переключателя, который происходит, когда цикл цикла переходит к SW2, затем SW1, а затем обратно в интерфейс Gi0 / 1 SW3.
SW3 thinks, “Hmm…the source MAC address is 0200.3333.3333, and it came in my Gi0/1 interface.|SW3 думает: «Хм… MAC-адрес источника - 0200.3333.3333, и он пришел в мой интерфейс Gi0 / 1.
Update my MAC table!” This results in the following entry on SW3, with interface Gi0/1 instead of Fa0/13:|Обновите мою таблицу MAC-адресов! » Это приводит к следующей записи на SW3 с интерфейсом Gi0 / 1 вместо Fa0 / 13:
|
0200.3333.3333 Gi0/1 VLAN 1 At this point, SW3 itself cannot correctly deliver frames to Bob’s MAC address.|0200.3333.3333 Gi0 / 1 VLAN 1 На этом этапе сам SW3 не может правильно доставлять кадры на MAC-адрес Боба.
At that instant, if a frame arrives at SW3 destined for Bob—a different frame than the looping frame that causes the problems—SW3 incorrectly forwards the frame out Gi0/1 to SW1, creating even more congestion.|В этот момент, если в SW3 поступает кадр, предназначенный для Боба - другой кадр, чем циклический кадр, вызывающий проблемы, - SW3 неправильно пересылает кадр из Gi0 / 1 в SW1, создавая еще большую перегрузку.
|
The looping frames in a broadcast storm also cause a third problem: multiple copies of the frame arrive at the destination.|Зацикливание кадров в широковещательном шторме также вызывает третью проблему: несколько копий кадра прибывают в место назначения.
Consider a case in which Bob sends a frame to Larry but none of the switches know Larry’s MAC address.|Рассмотрим случай, когда Боб отправляет кадр Ларри, но ни один из коммутаторов не знает MAC-адрес Ларри.
Switches flood frames sent to unknown destination unicast MAC addresses.|Переключает кадры лавинной рассылки, отправляемые на одноадресные MAC-адреса неизвестного назначения.
When Bob sends the frame destined for Larry’s MAC address, SW3 sends a copy to both SW1 and SW2. SW1 and SW2 also flood the frame, causing copies of the frame to loop.|Когда Боб отправляет кадр, предназначенный для MAC-адреса Ларри, SW3 отправляет копию как SW1, так и SW2. SW1 и SW2 также переполняют кадр, вызывая зацикливание копий кадра.
SW1 also sends a copy of each frame out Fa0/11 to Larry.|SW1 также отправляет копию каждого кадра Fa0 / 11 Ларри.
As a result, Larry gets multiple copies of the frame, which may result in an application failure, if not more pervasive networking problems.|В результате Ларри получает несколько копий кадра, что может привести к сбою приложения, если не к более распространенным сетевым проблемам.
|
Table 9-2 summarizes the main three classes of problems that occur when STP/RSTP is not used in a LAN that has redundancy.|В таблице 9-2 приведены три основных класса проблем, которые возникают, когда протокол STP / RSTP не используется в локальной сети с резервированием.
|
Answers to the “Do I Know This Already?” quiz:|Ответы на вопрос «Знаю ли я это уже?» викторина:
|
1 A, B 2 C 3 C, D 4 B 5 B, D 6 A, D 7 D Table 9-2 Three Classes of Problems Caused by Not Using STP in Redundant LANs Table end.|1 A, B 2 C 3 C, D 4 B 5 B, D 6 A, D 7 D Таблица 9-2 Три класса проблем, вызванных неиспользованием STP в резервных локальных сетях Конец таблицы.
#### What Spanning Tree Does
Что делает Spanning Tree   
__|__
--|--
|
STP/RSTP prevents loops by placing each switch port in either a forwarding state or a blocking state.|STP / RSTP предотвращает образование петель, переводя каждый порт коммутатора в состояние пересылки или в состояние блокировки.
Interfaces in the forwarding state act as normal, forwarding and receiving frames.|Интерфейсы в состоянии пересылки работают как обычно, пересылая и получая кадры.
|
However, interfaces in a blocking state do not process any frames except STP/RSTP messages (and some other overhead messages).|Однако интерфейсы в состоянии блокировки не обрабатывают никакие кадры, кроме сообщений STP / RSTP (и некоторых других служебных сообщений).
Interfaces that block do not forward user frames, do not learn MAC addresses of received frames, and do not process received user frames.|Блокирующие интерфейсы не пересылают пользовательские кадры, не узнают MAC-адреса полученных кадров и не обрабатывают полученные пользовательские кадры.
|
Figure 9-2 shows a simple STP/RSTP tree that solves the problem shown in Figure 9-1 by placing one port on SW3 in the blocking state.|На рисунке 9-2 показано простое дерево STP / RSTP, которое решает проблему, показанную на рисунке 9-1, путем перевода одного порта на SW3 в состояние блокировки.
|
Figure 9-2 What STP/RSTP Does: Blocks a Port to Break the Loop Now when Bob sends a broadcast frame, the frame does not loop.|Рисунок 9-2. Что делает протокол STP / RSTP: блокирует порт для разрыва петли. Теперь, когда Боб отправляет широковещательный кадр, этот кадр не зацикливается.
As shown in the steps in the figure:|Как показано в шагах на рисунке:
|
Step 1.|Шаг 1.
Bob sends the frame to SW3.|Боб отправляет фрейм в SW3.
|
Step 2.|Шаг 2.
SW3 forwards the frame only to SW1, but not out Gi0/2 to SW2, because SW3’s Gi0/2 interface is in a blocking state.|SW3 пересылает кадр только SW1, но не передает Gi0 / 2 в SW2, потому что интерфейс Gi0 / 2 SW3 находится в состоянии блокировки.
|
Step 3.|Шаг 3.
SW1 floods the frame out both Fa0/11 and Gi0/1.|SW1 заливает кадр как Fa0 / 11, так и Gi0 / 1.
|
Step 4.|Шаг 4.
SW2 floods the frame out Fa0/12 and Gi0/1.|SW2 выгружает кадр из Fa0 / 12 и Gi0 / 1.
|
Step 5.|Шаг 5.
SW3 physically receives the frame, but it ignores the frame received from SW2 because SW3’s Gi0/2 interface is in a blocking state.|SW3 физически принимает кадр, но игнорирует кадр, полученный от SW2, поскольку интерфейс Gi0 / 2 SW3 находится в состоянии блокировки.
|
With the STP/RSTP topology in Figure 9-2, the switches simply do not use the link between SW2 and SW3 for traffic in this VLAN, which is the minor negative side effect of STP.|С топологией STP / RSTP, показанной на рис. 9-2, коммутаторы просто не используют канал между SW2 и SW3 для трафика в этой VLAN, что является незначительным отрицательным побочным эффектом STP.
|
However, if either of the other two links fails, STP/RSTP converges so that SW3 forwards instead of blocks on its Gi0/2 interface.|Однако, если какой-либо из двух других каналов выходит из строя, STP / RSTP сходится, так что SW3 пересылает вместо блоков на своем интерфейсе Gi0 / 2.
|
NOTE The term STP convergence refers to the process by which the switches collectively realize that something has changed in the LAN topology and determine whether they need to change which ports block and which ports forward.|ПРИМЕЧАНИЕ. Термин «конвергенция STP» относится к процессу, с помощью которого коммутаторы коллективно осознают, что что-то изменилось в топологии LAN, и определяют, нужно ли им изменить, какие порты блокируются, а какие пересылаются.
|
That completes the description of what STP/RSTP does, placing each port into either a forwarding or blocking state.|Это завершает описание того, что делает STP / RSTP, переводя каждый порт в состояние пересылки или блокировки.
The more interesting question, and the one that takes a lot more work to understand, is how and why STP/RSTP makes its choices.|Более интересный вопрос, который требует гораздо больше усилий, чтобы понять, как и почему STP / RSTP делает свой выбор.
How does STP/RSTP manage to make switches block or forward on each interface?|Как протоколу STP / RSTP удается блокировать или пересылать коммутаторы на каждом интерфейсе?
And how does it converge to change state from blocking to forwarding to take advantage of redundant links in response to network outages?|И как он сводится к изменению состояния с блокировки на пересылку, чтобы воспользоваться преимуществами избыточных каналов в ответ на сбои в сети?
The following pages answer these questions.|Следующие страницы отвечают на эти вопросы.
#### How Spanning Tree Works
Как работает связующее дерево   
__|__
--|--
|
The STP/RSTP algorithm creates a spanning tree of interfaces that forward frames.|Алгоритм STP / RSTP создает связующее дерево интерфейсов, которые пересылают кадры.
The tree structure of forwarding interfaces creates a single path to and from each Ethernet link, just like you can trace a single path in a living, growing tree from the base of the tree to each leaf.|Древовидная структура перенаправляющих интерфейсов создает единый путь к каждому каналу Ethernet и от него, точно так же, как вы можете проследить единственный путь в живом растущем дереве от основания дерева до каждого листа.
|
NOTE STP was created before LAN switches even existed, using LAN bridges to connect LANs. Today, switches play the same role as bridges, implementing STP/RSTP. However, many STP/RSTP terms still refer to bridge.|ПРИМЕЧАНИЕ STP был создан до того, как появились коммутаторы LAN, с использованием мостов LAN для подключения к LAN. Сегодня коммутаторы играют ту же роль, что и мосты, реализующие STP / RSTP. Однако многие термины STP / RSTP по-прежнему относятся к мосту.
For the purposes of STP/RSTP and this chapter, consider the terms bridge and switch synonymous.|Для целей STP / RSTP и данной главы термины «мост» и «коммутатор» являются синонимами.
|
The process used by STP, sometimes called the spanning-tree algorithm (STA), chooses the interfaces that should be placed into a forwarding state.|Процесс, используемый STP, иногда называемый алгоритмом связующего дерева (STA), выбирает интерфейсы, которые должны быть переведены в состояние пересылки.
For any interfaces not chosen to be in a forwarding state, STP/RSTP places the interfaces in blocking state.|Для любых интерфейсов, не выбранных для пересылки, STP / RSTP переводит интерфейсы в состояние блокировки.
In other words, STP/RSTP simply picks which interfaces should forward, and any interfaces left over go to a blocking state.|Другими словами, STP / RSTP просто выбирает, какие интерфейсы следует пересылать, и любые оставшиеся интерфейсы переходят в состояние блокировки.
|
STP/RSTP uses three criteria to choose whether to put an interface in forwarding state:|STP / RSTP использует три критерия для выбора, переводить ли интерфейс в состояние пересылки:
###### STP/RSTP elects a root switch. STP puts all working interfaces on the root switch in forwarding
STP / RSTP выбирает корневой коммутатор. STP переводит все рабочие интерфейсы корневого коммутатора в режим пересылки.   
__|__
--|--
|
state.|штат.
###### Each nonroot switch considers one of its ports to have the least administrative cost
Каждый некорневой коммутатор считает, что один из его портов имеет наименьшие административные затраты.   
__|__
--|--
|
between itself and the root switch.|между собой и корневым коммутатором.
The cost is called that switch’s root cost.|Стоимость называется корневой стоимостью этого переключателя.
STP/RSTP places its port that is part of the least root cost path, called that switch’s root port (RP), in forwarding state.|STP / RSTP переводит свой порт, который является частью пути с наименьшей стоимостью корня, называемого корневым портом (RP) этого коммутатора, в состояние пересылки.
###### Many switches can attach to the same Ethernet segment, but due to the fact that links
Многие коммутаторы могут подключаться к одному и тому же сегменту Ethernet, но из-за того, что ссылки   
__|__
--|--
|
connect two devices, a link would have at most two switches.|подключите два устройства, канал будет иметь не более двух переключателей.
With two switches on a link, the switch with the lowest root cost, as compared with the other switches attached to the same link, is placed in forwarding state.|При двух коммутаторах на канале коммутатор с наименьшими корневыми затратами по сравнению с другими коммутаторами, подключенными к тому же каналу, переводится в состояние пересылки.
That switch is the designated switch, and that switch’s interface, attached to that segment, is called the designated port (DP).|Этот коммутатор является назначенным коммутатором, а интерфейс этого коммутатора, подключенный к этому сегменту, называется назначенным портом (DP).
|
NOTE The real reason the root switches place all working interfaces in a forwarding state (at step 1 in the list) is that all its interfaces on the root switch will become DPs. However, it is easier to just remember that all the root switches’ working interfaces will forward frames.|ПРИМЕЧАНИЕ. Настоящая причина, по которой корневые коммутаторы переводят все рабочие интерфейсы в состояние пересылки (на шаге 1 в списке), заключается в том, что все его интерфейсы на корневом коммутаторе станут DP. Однако проще помнить, что все рабочие интерфейсы корневых коммутаторов будут пересылать кадры.
|
All other interfaces are placed in blocking state.|Все остальные интерфейсы переводятся в состояние блокировки.
Table 9-3 summarizes the reasons STP/RSTP places a port in forwarding or blocking state.|Таблица 9-3 суммирует причины, по которым протокол STP / RSTP переводит порт в состояние пересылки или блокировки.
|
Table 9-3 STP/RSTP: Reasons for Forwarding or Blocking Table end.|Таблица 9-3 STP / RSTP: Причины завершения таблицы пересылки или блокировки.
|
NOTE STP/RSTP only considers working interfaces (those in a connected state).|ПРИМЕЧАНИЕ STP / RSTP учитывает только рабочие интерфейсы (те, которые находятся в подключенном состоянии).
Failed interfaces (for example, interfaces with no cable installed) or administratively shutdown interfaces are instead placed into an STP/RSTP disabled state.|Отказавшие интерфейсы (например, интерфейсы без установленного кабеля) или интерфейсы, отключенные административно, вместо этого переводятся в состояние отключения STP / RSTP.
So, this section uses the term working ports to refer to interfaces that could forward frames if STP/RSTP placed the interface into a forwarding state.|Таким образом, в этом разделе термин рабочие порты используется для обозначения интерфейсов, которые могут пересылать кадры, если STP / RSTP переводит интерфейс в состояние пересылки.
|
NOTE STP and RSTP do differ slightly in the use of the names of some states like blocking and disabled, with RSTP using the status term discarding.|ПРИМЕЧАНИЕ STP и RSTP немного отличаются в использовании названий некоторых состояний, таких как блокировка и отключение, при этом RSTP использует термин «отбрасывание состояния».
However, those minor differences do not change the meaning of the discussions in this first section of the chapter.|Однако эти незначительные различия не меняют смысла обсуждений в этом первом разделе главы.
The upcoming section titled “Comparing STP and RSTP” discusses these differences, both important and minor.|В следующем разделе под названием «Сравнение STP и RSTP» обсуждаются эти различия, как важные, так и незначительные.
##### The STP Bridge ID and Hello BPDU
Идентификатор моста STP и Hello BPDU   
__|__
--|--
|
The STA begins with an election of one switch to be the root switch.|STA начинает с выбора одного коммутатора в качестве корневого коммутатора.
To better understand this election process, you need to understand the STP/RSTP messages sent between switches as well as the concept and format of the identifier used to uniquely identify each switch.|Чтобы лучше понять этот процесс выбора, вам необходимо понять сообщения STP / RSTP, отправляемые между коммутаторами, а также концепцию и формат идентификатора, используемого для уникальной идентификации каждого коммутатора.
|
The STP/RSTP bridge ID (BID) is an 8-byte value unique to each switch.|Идентификатор моста STP / RSTP (BID) - это 8-байтовое значение, уникальное для каждого коммутатора.
The bridge ID consists of a 2-byte priority field and a 6-byte system ID, with the system ID being based on a universal (burned-in) MAC address in each switch.|Идентификатор моста состоит из 2-байтового поля приоритета и 6-байтового идентификатора системы, причем идентификатор системы основан на универсальном (встроенном) MAC-адресе в каждом коммутаторе.
Using a burned-in MAC address ensures that each switch’s bridge ID will be unique.|Использование встроенного MAC-адреса гарантирует, что идентификатор моста каждого коммутатора будет уникальным.
|
STP/RSTP defines messages called bridge protocol data units (BPDU), also called configuration BPDUs, which switches use to exchange information with each other.|STP / RSTP определяет сообщения, называемые блоками данных протокола моста (BPDU), также называемыми конфигурационными блоками BPDU, которые коммутаторы используют для обмена информацией друг с другом.
The most common BPDU, called a Hello BPDU, lists many details, including the sending switch’s BID. By listing its own unique BID, switches can tell which switch sent which Hello BPDU. Table 9-4 lists some of the key information in the Hello BPDU.|Самый распространенный BPDU, называемый Hello BPDU, содержит множество деталей, включая BID отправляющего коммутатора. Перечисляя свой собственный уникальный BID, коммутаторы могут определить, какой коммутатор какой Hello BPDU отправил. Таблица 9-4 перечисляет некоторую ключевую информацию в Hello BPDU.
|
Table 9-4 Fields in the STP Hello BPDU Table end.|Таблица 9-4 Поля в конце таблицы STP Hello BPDU.
|
For the time being, just keep the first three items from Table 9-4 in mind as the following sections work through the three steps in how STP/RSTP chooses the interfaces to place into a forwarding state.|На данный момент просто помните о первых трех элементах из Таблицы 9-4, поскольку в следующих разделах рассматриваются три шага в том, как STP / RSTP выбирает интерфейсы для перевода в состояние пересылки.
Next, the text examines the three main steps in the STP/RSTP process.|Далее в тексте рассматриваются три основных этапа процесса STP / RSTP.
##### Electing the Root Switch
Выбор корневого переключателя   
__|__
--|--
|
Switches elect a root switch based on the BIDs in the BPDUs. The root switch is the switch with the lowest numeric value for the BID. Because the two-part BID starts with the priority value, essentially the switch with the lowest priority becomes the root.|Коммутаторы выбирают корневой коммутатор на основе идентификаторов BID в BPDU. Корневой переключатель - это переключатель с наименьшим числовым значением BID. Поскольку двухчастный BID начинается со значения приоритета, по сути, коммутатор с самым низким приоритетом становится корневым.
For example, if one switch has priority 4096, and another switch has priority 8192, the switch with priority 4096 wins, regardless of what MAC address was used to create the BID for each switch.|Например, если один коммутатор имеет приоритет 4096, а другой коммутатор имеет приоритет 8192, победит коммутатор с приоритетом 4096, независимо от того, какой MAC-адрес использовался для создания BID для каждого коммутатора.
|
If a tie occurs based on the priority portion of the BID, the switch with the lowest MAC address portion of the BID is the root.|Если связь возникает на основе приоритетной части BID, коммутатор с наименьшей частью MAC-адреса BID является корневым.
No other tiebreaker should be needed because switches use one of their own universal (burned-in) MAC addresses as the second part of their BIDs. So if the priorities tie, and one switch uses a MAC address of 0200.0000.0000 as part of the BID and the other uses 0811.1111.1111, the first switch (MAC 0200.0000.0000)|Никакого другого разрешения конфликтов не требуется, поскольку коммутаторы используют один из своих собственных универсальных (встроенных) MAC-адресов в качестве второй части своих BID. Итак, если приоритеты совпадают, и один коммутатор использует MAC-адрес 0200.0000.0000 как часть BID, а другой использует 0811.1111.1111, первый коммутатор (MAC 0200.0000.0000)
|
becomes the root switch.|становится корневым коммутатором.
|
STP/RSTP elects a root switch in a manner not unlike a political election.|Протокол STP / RSTP выбирает корневой коммутатор аналогично политическим выборам.
The process begins with all switches claiming to be the root by sending Hello BPDUs listing their own BID as the root BID. If a switch hears a Hello that lists a better (lower) BID, that switch stops advertising itself as root and starts forwarding the superior Hello.|Процесс начинается с того, что все коммутаторы заявляют, что они являются корневыми, отправляя Hello BPDU, перечисляя их собственный BID в качестве корневого BID. Если коммутатор слышит Hello, в котором указан лучший (более низкий) BID, этот коммутатор прекращает рекламировать себя как root и начинает пересылать старшее Hello.
The Hello sent by the better switch lists the better switch’s BID as the root.|В сообщении Hello, отправленном лучшим коммутатором, в качестве корневого указывается BID лучшего коммутатора.
It works like a political race in which a less-popular candidate gives up and leaves the race, throwing his support behind the more popular candidate.|Это работает как политическая гонка, в которой менее популярный кандидат сдается и покидает гонку, оказывая поддержку более популярному кандидату.
Eventually, everyone agrees which switch has the best (lowest) BID, and everyone supports the elected switch—which is where the political race analogy falls apart.|В конце концов, все соглашаются, у какого коммутатора самая лучшая (самая низкая) ставка BID, и все поддерживают выбранный коммутатор - здесь аналогия с политической гонкой разваливается.
|
NOTE A better Hello, meaning that the listed root’s BID is better (numerically lower), is called a superior Hello; a worse Hello, meaning that the listed root’s BID is not as good (numerically higher), is called an inferior Hello.|ПРИМЕЧАНИЕ Лучшее приветствие, означающее, что указанный в списке корневой идентификатор BID лучше (численно ниже), называется старшим приветствием; худшее Hello, означающее, что BID указанного корневого каталога не так хорош (численно выше), называется второстепенным Hello.
|
Figure 9-3 shows the beginning of the root election process.|На рис. 9-3 показано начало процесса корневого выбора.
In this case, SW1 has advertised itself as root, as have SW2 and SW3. However, SW2 now believes that SW1 is a better root, so SW2 is now forwarding the Hello originating at SW1. So, at this point, the figure shows SW1 is saying Hello, claiming to be root; SW2 agrees and is forwarding SW1’s Hello that lists SW1 as root; but SW3 is still claiming to be best, sending its own Hello BPDUs, listing SW3’s BID as the root.|В этом случае SW1 объявил себя root, как и SW2 и SW3. Однако теперь SW2 считает, что SW1 - лучший корень, поэтому SW2 теперь пересылает Hello, исходящее от SW1. Итак, в этот момент рисунок показывает, что SW1 говорит Hello, утверждая, что он root; SW2 соглашается и пересылает SW1 Hello, в котором SW1 указан как root; но SW3 по-прежнему претендует на звание лучшего, отправляя свои собственные Hello BPDU, перечисляя BID SW3 в качестве корневого.
|
Figure 9-3 Beginnings of the Root Election Process Two candidates still exist in Figure 9-3: SW1 and SW3. So, who wins?|Рис. 9-3. Начало процесса корневых выборов. На рис. 9-3 все еще существуют два кандидата: SW1 и SW3. Итак, кто победит?
Well, from the BID, the lower-priority switch wins; if a tie occurs, the lower MAC address wins.|Что ж, от BID выигрывает переключатель с более низким приоритетом; в случае ничьей выигрывает более низкий MAC-адрес.
As shown in the figure, SW1 has a lower BID (32769:0200.0001.0001) than SW3 (32769:0200.0003.0003), so SW1 wins, and SW3 now also believes that SW1 is the better switch.|Как показано на рисунке, SW1 имеет более низкий BID (32769: 0200.0001.0001), чем SW3 (32769: 0200.0003.0003), поэтому SW1 выигрывает, а SW3 теперь также считает, что SW1 - лучший переключатель.
Figure 9-4 shows the resulting Hello messages sent by the switches.|На рис. 9-4 показаны результирующие сообщения Hello, отправленные коммутаторами.
|
Summarizing, the root election happens through each switch claiming to be root, with the best switch being elected based on the numerically lowest BID. Breaking down the BID into its components, the comparisons can be made as|Подводя итог, можно сказать, что выбор root происходит через каждый коммутатор, претендующий на роль root, причем лучший коммутатор выбирается на основе численно самого низкого BID. Разбив BID на составляющие, сравнения можно провести следующим образом:
###### The lowest priority
Самый низкий приоритет   
###### If that ties, the lowest switch MAC address.
Если это так, то самый низкий MAC-адрес коммутатора.   
__|__
--|--
|
Figure 9-4 SW1 Wins the Election|Рисунок 9-4 SW1 побеждает на выборах
##### Choosing Each Switch’s Root Port
Выбор корневого порта каждого коммутатора   
__|__
--|--
|
The second part of the STP/RSTP process occurs when each nonroot switch chooses its one and only root port.|Вторая часть процесса STP / RSTP происходит, когда каждый некорневой коммутатор выбирает свой единственный корневой порт.
A switch’s RP is its interface through which it has the least STP/RSTP cost to reach the root switch (least root cost).|RP коммутатора - это его интерфейс, через который у него наименьшая стоимость STP / RSTP для достижения корневого коммутатора (наименьшая стоимость корневого коммутатора).
|
The idea of a switch’s cost to reach the root switch can be easily seen for humans.|Людям легко понять, насколько дорого обходится коммутатор до корневого коммутатора.
Just look at a network diagram that shows the root switch, lists the STP/RSTP cost associated with each switch port, and identifies the nonroot switch in question.|Просто посмотрите на сетевую диаграмму, которая показывает корневой коммутатор, перечисляет стоимость STP / RSTP, связанную с каждым портом коммутатора, и идентифицирует рассматриваемый некорневой коммутатор.
Switches use a different process than looking at a network diagram, of course, but using a diagram can make it easier to learn the idea.|Коммутаторы, конечно, используют другой процесс, чем просмотр сетевой диаграммы, но использование диаграммы может облегчить понимание идеи.
|
Figure 9-5 shows just such a figure, with the same three switches shown in the last several figures.|На рис. 9-5 показан именно такой рисунок с теми же тремя переключателями, что и на последних нескольких рисунках.
SW1 has already won the election as root, and the figure considers the cost from SW3’s perspective. (Note that the figure uses some nondefault cost settings.)|SW1 уже выиграл выборы как root, и на рисунке показаны затраты с точки зрения SW3. (Обратите внимание, что на рисунке используются некоторые настройки стоимости не по умолчанию.)
|
SW3 has two possible physical paths to send frames to the root switch: the direct path to the left and the indirect path to the right through switch SW2. The cost is the sum of the costs of all the switch ports the frame would exit if it flowed over that path. (The calculation ignores the inbound ports.) As you can see, the cost over the direct path out SW3’s G0/1 port has a total cost of 5, and the other path has a total cost of 8.|SW3 имеет два возможных физических пути для отправки кадров на корневой коммутатор: прямой путь влево и косвенный путь вправо через коммутатор SW2. Стоимость - это сумма затрат на все порты коммутатора, из которых фрейм вышел бы, если бы он прошел по этому пути. (При расчете игнорируются входящие порты.) Как видите, стоимость прямого пути к порту G0 / 1 SW3 составляет 5, а для другого пути - 8.
SW3 picks its G0/1 port as root port because it is the port that is part of the least-cost path to send frames to the root switch.|SW3 выбирает свой порт G0 / 1 в качестве корневого порта, потому что это порт, который является частью пути с наименьшей стоимостью для отправки кадров на корневой коммутатор.
|
Figure 9-5 How a Human Might Calculate STP/RSTP Cost from SW3 to the Root (SW1)|Рисунок 9-5. Как человек может рассчитать стоимость STP / RSTP от SW3 до корня (SW1)
|
Switches come to the same conclusion but using a different process.|Коммутаторы приходят к такому же выводу, но с использованием другого процесса.
Instead, they add their local interface STP/RSTP cost to the root cost listed in each received Hello BPDU. The STP/RSTP port cost is simply an integer value assigned to each interface, per VLAN, for the purpose of providing an objective measurement that allows STP/RSTP to choose which interfaces to add to the STP/RSTP topology.|Вместо этого они добавляют стоимость STP / RSTP своего локального интерфейса к стоимости корня, указанной в каждом полученном Hello BPDU. Стоимость порта STP / RSTP - это просто целое число, присвоенное каждому интерфейсу в каждой VLAN, с целью обеспечения объективного измерения, которое позволяет STP / RSTP выбирать, какие интерфейсы добавить в топологию STP / RSTP.
The switches also look at their neighbor’s root cost, as announced in Hello BPDUs received from each neighbor.|Коммутаторы также проверяют корневую стоимость своего соседа, как объявляется в Hello BPDU, полученных от каждого соседа.
|
Figure 9-6 shows an example of how switches calculate their best root cost and then choose their root port, using the same topology and STP/RSTP costs as shown in Figure 9-5.|На рис. 9-6 показан пример того, как коммутаторы рассчитывают наилучшую стоимость корневого доступа, а затем выбирают свой корневой порт, используя ту же топологию и стоимость STP / RSTP, как показано на рис. 9-5.
|
STP/RSTP on SW3 calculates its cost to reach the root over the two possible paths by adding the advertised cost (in Hello messages) to the interface costs listed in the figure.|STP / RSTP на SW3 вычисляет стоимость достижения корня по двум возможным путям, добавляя объявленную стоимость (в сообщениях Hello) к стоимости интерфейса, указанной на рисунке.
|
Figure 9-6 How STP/RSTP Actually Calculates the Cost from SW3 to the Root Focus on the process for a moment.|Рис. 9-6. Как STP / RSTP на самом деле вычисляет стоимость от SW3 до корня. На мгновение сфокусируйтесь на процессе.
The root switch sends Hellos, with a listed root cost of 0.|Корневой коммутатор отправляет приветствие с указанной корневой стоимостью 0.
The idea is that the root’s cost to reach itself is 0.|Идея состоит в том, что стоимость доступа корня к самому себе равна 0.
|
Next, look on the left of the figure.|Затем посмотрите на рисунок слева.
SW3 takes the received cost (0) from the Hello sent by SW1 and adds the interface cost (5) of the interface on which that Hello was received.|SW3 берет полученную стоимость (0) из Hello, отправленного SW1, и добавляет стоимость интерфейса (5) интерфейса, на котором было получено это Hello.
SW3 calculates that the cost to reach the root switch, out that port (G0/1), is 5.|SW3 рассчитывает, что стоимость доступа к корневому коммутатору за пределами этого порта (G0 / 1) составляет 5.
|
On the right side, SW2 has realized its best cost to reach the root is cost 4.|С правой стороны, SW2 понял, что его лучшая цена для достижения корня - 4.
So, when SW2 forwards the Hello toward SW3, SW2 lists a root cost 4.|Итак, когда SW2 пересылает Hello к SW3, SW2 перечисляет корневую стоимость 4.
SW3’s STP/RSTP port cost on port G0/2 is 4, so SW3 determines a total cost to reach root out its G0/2 port of 8.|Стоимость порта STP / RSTP SW3 на порте G0 / 2 равна 4, поэтому SW3 определяет общую стоимость выхода из порта G0 / 2, равную 8.
|
As a result of the process depicted in Figure 9-6, SW3 chooses Gi0/1 as its RP because the cost to reach the root switch through that port (5) is lower than the other alternative (Gi0/2, cost 8).|В результате процесса, изображенного на рис. 9-6, SW3 выбирает Gi0 / 1 в качестве своего RP, поскольку стоимость доступа к корневому коммутатору через этот порт (5) ниже, чем у другого альтернативного варианта (Gi0 / 2, стоимость 8).
Similarly, SW2 chooses Gi0/2 as its RP, with a cost of 4 (SW1’s advertised cost of 0 plus SW2’s Gi0/2 interface cost of 4).|Точно так же SW2 выбирает Gi0 / 2 в качестве RP со стоимостью 4 (объявленная стоимость SW1 равна 0 плюс стоимость интерфейса Gi0 / 2 SW2 равна 4).
Each switch places its root port into a forwarding state.|Каждый коммутатор переводит свой корневой порт в состояние пересылки.
|
Switches need a tiebreaker to use in case the best root cost ties for two or more paths.|Коммутаторам необходимо использовать средство разрешения конфликтов в случае, если лучшая стоимость корня связана для двух или более путей.
If a tie occurs, the switch applies these three tiebreakers to the paths that tie, in order, as follows:|Если происходит ничья, коммутатор применяет эти три разрешения конфликтов к связующим путям в следующем порядке:
|
1. Choose based on the lowest neighbor bridge ID.|1. Выберите на основе наименьшего идентификатора соседнего моста.
|
2. Choose based on the lowest neighbor port priority.|2. Выберите на основе самого низкого приоритета соседнего порта.
|
3. Choose based on the lowest neighbor internal port number.|3. Выберите на основе наименьшего номера внутреннего порта соседа.
##### Choosing the Designated Port on Each LAN Segment
Выбор назначенного порта в каждом сегменте LAN   
__|__
--|--
|
STP/RSTP’s final step to choose the STP/RSTP topology is to choose the designated port on each LAN segment.|Последний шаг STP / RSTP при выборе топологии STP / RSTP - это выбор назначенного порта в каждом сегменте LAN.
The designated port (DP) on each LAN segment is the switch port that advertises the lowest-cost Hello onto a LAN segment.|Назначенный порт (DP) в каждом сегменте LAN - это порт коммутатора, который объявляет самое дешевое приветствие в сегменте LAN.
When a nonroot switch forwards a Hello, the nonroot switch sets the root cost field in the Hello to that switch’s cost to reach the root.|Когда некорневой коммутатор пересылает Hello, некорневой коммутатор устанавливает в поле стоимости корня в Hello значение стоимости того коммутатора для достижения корня.
In effect, the switch with the lower cost to reach the root, among all switches connected to a segment, becomes the DP on that segment.|По сути, коммутатор с более низкой стоимостью достижения корня среди всех коммутаторов, подключенных к сегменту, становится DP в этом сегменте.
|
For example, earlier Figure 9-4 shows in bold text the parts of the Hello messages from both SW2 and SW3 that determine the choice of DP on that segment.|Например, ранее на рис. 9-4 жирным шрифтом показаны части сообщений Hello и от SW2, и от SW3, которые определяют выбор DP в этом сегменте.
Note that both SW2 and SW3 list their respective cost to reach the root switch (cost 4 on SW2 and cost 5 on SW3).|Обратите внимание, что и SW2, и SW3 указывают свою соответствующую стоимость для достижения корневого коммутатора (стоимость 4 для SW2 и стоимость 5 для SW3).
|
SW2 lists the lower cost, so SW2’s Gi0/1 port is the designated port on that LAN segment.|SW2 указывает более низкую стоимость, поэтому порт Gi0 / 1 SW2 является назначенным портом в этом сегменте LAN.
|
All DPs are placed into a forwarding state; so in this case, SW2’s Gi0/1 interface will be in a forwarding state.|Все DP переводятся в состояние пересылки; поэтому в этом случае интерфейс Gi0 / 1 SW2 будет в состоянии пересылки.
|
If the advertised costs tie, the switches break the tie by choosing the switch with the lower BID. In this case, SW2 would also have won, with a BID of 32769:0200.0002.0002 versus SW3’s 32769:0200.0003.0003.|Если объявленные затраты совпадают, коммутаторы прерывают связь, выбирая коммутатор с более низким BID. В этом случае SW2 также выиграла бы с BID 32769: 0200.0002.0002 по сравнению с 32769: 0200.0003.0003 SW3.
|
NOTE Two additional tiebreakers are needed in some cases, although these would be unlikely today.|ПРИМЕЧАНИЕ. В некоторых случаях необходимы два дополнительных тай-брейка, хотя сегодня это маловероятно.
A single switch can connect two or more interfaces to the same collision domain by connecting to a hub.|Один коммутатор может подключить два или более интерфейса к одному домену конфликтов, подключившись к концентратору.
In that case, the one switch hears its own BPDUs. So, if a switch ties with itself, two additional tiebreakers are used: the lowest interface STP/RSTP priority and, if that ties, the lowest internal interface number.|В этом случае один коммутатор слышит свои собственные BPDU. Таким образом, если коммутатор связан сам с собой, используются два дополнительных средства разрешения конфликтов: самый низкий приоритет интерфейса STP / RSTP и, если это связано, самый низкий внутренний номер интерфейса.
|
The only interface that does not have a reason to be in a forwarding state on the three switches in the examples shown in Figures 9-3 through 9-6 is SW3’s Gi0/2 port.|Единственный интерфейс, который не имеет причины находиться в состоянии пересылки на трех коммутаторах в примерах, показанных на рисунках с 9-3 по 9-6, - это порт Gi0 / 2 SW3.
So, the STP/RSTP process is now complete.|Итак, процесс STP / RSTP завершен.
Table 9-5 outlines the state of each port and shows why it is in that state.|Таблица 9-5 описывает состояние каждого порта и показывает, почему он находится в этом состоянии.
|
Table 9-5 State of Each Interface Table end.|Таблица 9-5. Состояние каждого конца таблицы интерфейсов.
|
Note that the examples in this section focus on the links between the switches, but switch ports connected to endpoint devices should become DPs and settle into a forwarding state.|Обратите внимание, что примеры в этом разделе сосредоточены на каналах связи между коммутаторами, но порты коммутатора, подключенные к оконечным устройствам, должны стать DP и перейти в состояние пересылки.
|
Working through the logic, each switch will forward BPDUs on each port as part of the process to determine the DP on that LAN. Endpoints should ignore those messages because they do not run STP/RSTP, so the switch will win and become DP on every access port.|Работая по логике, каждый коммутатор пересылает BPDU на каждый порт как часть процесса для определения DP в этой локальной сети. Конечные точки должны игнорировать эти сообщения, потому что они не запускают STP / RSTP, поэтому коммутатор выиграет и станет DP на каждом порте доступа.
#### Configuring to Influence the STP Topology
Настройка влияния на топологию STP   
__|__
--|--
|
STP/RSTP works by default on Cisco switches, so all the settings needed by a switch have a useful default.|STP / RSTP по умолчанию работает на коммутаторах Cisco, поэтому все настройки, необходимые коммутатору, имеют полезные значения по умолчанию.
Switches have a default BID, based on a default priority value and adding a universal MAC address that comes with the switch hardware.|Коммутаторы имеют BID по умолчанию, основанный на значении приоритета по умолчанию и добавлении универсального MAC-адреса, который поставляется с оборудованием коммутатора.
Additionally, switch interfaces have default STP/RSTP costs based on the current operating speed of the switch interfaces.|Кроме того, интерфейсы коммутатора имеют стоимость STP / RSTP по умолчанию в зависимости от текущей скорости работы интерфейсов коммутатора.
|
Network engineers often want to change the STP/RSTP settings to then change the choices STP/RSTP makes in a given LAN. Two main tools available to the engineer are to configure the bridge ID and to change STP/RSTP port costs.|Сетевые инженеры часто хотят изменить настройки STP / RSTP, чтобы затем изменить выбор, который STP / RSTP делает в данной локальной сети. Инженеру доступны два основных инструмента: настройка идентификатора моста и изменение стоимости портов STP / RSTP.
|
First, to change the BID, the engineer can set the priority used by the switch, while continuing to use the universal MAC address as the final 48 bits of the BID. For instance, giving a switch the lowest priority value among all switches will cause that switch to win the root election.|Во-первых, чтобы изменить BID, инженер может установить приоритет, используемый коммутатором, продолжая использовать универсальный MAC-адрес в качестве последних 48 бит BID. Например, присвоение коммутатору самого низкого значения приоритета среди всех коммутаторов приведет к тому, что этот коммутатор победит на корневых выборах.
|
Port costs also have default values, per port, per VLAN. You can configure these port costs, which will in turn impact many switch’s calculations of the root cost.|Стоимость портов также имеет значения по умолчанию для каждого порта и VLAN. Вы можете настроить эти затраты на порты, что, в свою очередь, повлияет на расчеты корневой стоимости многими коммутаторами.
For instance, to favor one link, give the ports on that link a lower cost, or to avoid a link, give the ports a higher cost.|Например, чтобы отдать предпочтение одному каналу, назначьте портам на этом канале более низкую стоимость или, чтобы избежать соединения, назначьте портам более высокую стоимость.
|
Of course, it helps to know the default cost values so you can then choose alternative values as needed.|Конечно, полезно знать значения стоимости по умолчанию, чтобы затем при необходимости выбирать альтернативные значения.
Table 9-6 lists the default port costs suggested by IEEE. IOS on Cisco switches has long used the default settings as defined as far back as the 1998 version of the IEEE 802.1D standard.|Таблица 9-6 перечисляет стоимость портов по умолчанию, предложенную IEEE. В IOS на коммутаторах Cisco уже давно используются настройки по умолчанию, определенные еще в версии 1998 года стандарта IEEE 802.1D.
The latest IEEE standard to suggest RSTP default costs (as of the publication of this book), the 2018 publication of the 802.1Q standard, suggests values that are more useful when using links faster than 10 Gbps.|Последний стандарт IEEE, предлагающий стоимость RSTP по умолчанию (на момент публикации этой книги), публикация стандарта 802.1Q 2018 года, предлагает значения, которые более полезны при использовании каналов со скоростью, превышающей 10 Гбит / с.
|
Table 9-6 Default Port Costs According to IEEE Table end.|Таблица 9-6 Стоимость портов по умолчанию в соответствии с концом таблицы IEEE.
|
Of note in regards to these defaults, the cost defaults based on the operating speed of the link, not the maximum speed.|В отношении этих значений по умолчанию следует отметить, что значения по умолчанию основаны на рабочей скорости соединения, а не на максимальной скорости.
That is, if a 10/100/1000 port runs at 10 Mbps for some reason, its default STP cost on a Cisco switch is 100, the default cost for an interface running at 10 Mbps.|То есть, если порт 10/100/1000 по какой-то причине работает на скорости 10 Мбит / с, его стоимость STP по умолчанию на коммутаторе Cisco составляет 100, стоимость по умолчанию для интерфейса, работающего на скорости 10 Мбит / с.
Also, if you prefer the defaults in the right-side column of Table 9-6, note that Cisco Catalyst switches can be configured to use those values as defaults with a single global configuration command on each switch (spanning-tree pathcost method long).|Кроме того, если вы предпочитаете значения по умолчанию в правом столбце Таблицы 9-6, обратите внимание, что коммутаторы Cisco Catalyst могут быть настроены на использование этих значений по умолчанию с помощью одной команды глобальной конфигурации на каждом коммутаторе (метод определения стоимости связующего дерева длинный) .
### Details Specific to STP (and Not RSTP)
Подробности, относящиеся к STP (а не RSTP)   
__|__
--|--
|
As promised in the introduction to this chapter, the first section showed features that apply to both STP and RSTP. This next heading acts as the turning point, with the next several pages being about STP only.|Как и было обещано во введении к этой главе, в первом разделе показаны функции, применимые как к протоколу STP, так и к RSTP. Этот следующий заголовок действует как поворотный момент, так как следующие несколько страниц посвящены только STP.
The upcoming section titled “Rapid STP Concepts” then shows details specific to RSTP, in contrast to STP.|В следующем разделе, озаглавленном «Основные понятия быстрого STP», будут показаны детали, относящиеся к RSTP, в отличие от STP.
|
Once the engineer has finished all STP configuration, the STP topology should settle into a stable state and not change, at least until the network topology changes.|После того как инженер завершит всю настройку STP, топология STP должна перейти в стабильное состояние и не меняться, по крайней мере, до тех пор, пока топология сети не изменится.
This section examines the ongoing operation of STP while the network is stable, and then it covers how STP converges to a new topology when something changes.|В этом разделе исследуется текущая работа STP в стабильной сети, а затем рассматривается, как STP сходится к новой топологии, когда что-то меняется.
|
Note that almost all the differences between STP and RSTP revolve around the activities of waiting for and reacting to changes in the topology.|Обратите внимание, что почти все различия между STP и RSTP связаны с действиями по ожиданию изменений топологии и реагированию на них.
STP performed well for the era and circumstances in which it was created.|STP хорошо зарекомендовал себя для той эпохи и обстоятельств, в которых он был создан.
The “rapid” in RSTP refers to the improvements to how fast RSTP could react when changes occur—so understanding how STP reacts will be useful to understand why RSTP reacts faster.|«Быстрый» в RSTP относится к усовершенствованию того, насколько быстро RSTP может реагировать на изменения, поэтому понимание того, как реагирует STP, будет полезно для понимания того, почему RSTP реагирует быстрее.
These next few pages show the specifics of STP (and not RSTP) and how STP reacts to and manages convergence when changes happen in an Ethernet LAN.|На следующих нескольких страницах показаны особенности STP (а не RSTP) и то, как STP реагирует и управляет конвергенцией, когда в локальной сети Ethernet происходят изменения.
#### STP Activity When the Network Remains Stable
Активность STP, когда сеть остается стабильной   
__|__
--|--
|
An STP root switch sends a new Hello BPDU every 2 seconds by default.|По умолчанию корневой коммутатор STP отправляет новый Hello BPDU каждые 2 секунды.
Each nonroot switch forwards the Hello on all DPs, but only after changing items listed in the Hello. (As a result, the Hello flows once over every working link in the LAN.)|Каждый некорневой коммутатор пересылает Hello на все DP, но только после изменения элементов, перечисленных в Hello. (В результате Hello проходит по каждому рабочему каналу в локальной сети.)
|
When forwarding the Hello BPDU, each switch sets the root cost to that local switch’s calculated root cost.|При пересылке Hello BPDU каждый коммутатор устанавливает корневую стоимость равной вычисленной корневой стоимости этого локального коммутатора.
The switch also sets the “sender’s bridge ID” field to its own bridge ID. (The root’s bridge ID field is not changed.)|Коммутатор также устанавливает в поле «идентификатор моста отправителя» свой собственный идентификатор моста. (Поле идентификатора корневого моста не изменяется.)
|
Assuming a default Hello timer of 2 seconds on the root switch, each switch will forward the received (and changed) Hellos out all DPs so that all switches continue to receive Hellos every 2 seconds.|Предполагая, что таймер приветствия по умолчанию на корневом коммутаторе равен 2 секундам, каждый коммутатор будет пересылать полученные (и измененные) сообщения приветствия всем DP, чтобы все коммутаторы продолжали получать приветствия каждые 2 секунды.
The following steps summarize the steady-state operation when nothing is currently changing in the STP topology:|Следующие шаги резюмируют работу в установившемся режиме, когда в топологии STP в данный момент ничего не меняется:
|
Step 1.|Шаг 1.
The root creates and sends a Hello BPDU, with a root cost of 0, out all its working interfaces (those in a forwarding state).|Корень создает и отправляет Hello BPDU со стоимостью корня 0 на все свои рабочие интерфейсы (те, которые находятся в состоянии пересылки).
|
Step 2.|Шаг 2.
The nonroot switches receive the Hello on their root ports.|Некорневые коммутаторы получают сообщение Hello на свои корневые порты.
After changing the Hello to list their own BID as the sender’s BID and listing that switch’s root cost, the switch forwards the Hello out all designated ports.|После изменения Hello, чтобы указать свой собственный BID в качестве BID отправителя и перечислить корневую стоимость этого коммутатора, коммутатор пересылает Hello на все назначенные порты.
|
Step 3.|Шаг 3.
Steps 1 and 2 repeat until something changes.|Шаги 1 и 2 повторяются, пока что-то не изменится.
|
When a switch fails to receive a Hello, it knows a problem might be occurring in the network.|Когда коммутатор не получает сообщение Hello, он знает, что проблема может возникнуть в сети.
|
Each switch relies on these periodically received Hellos from the root as a way to know that its path to the root is still working.|Каждый коммутатор полагается на эти периодически получаемые от корня приветствия как способ узнать, что его путь к корню все еще работает.
When a switch ceases to receive the Hellos, or receives a Hello that lists different details, something has failed, so the switch reacts and starts the process of changing the spanning-tree topology.|Когда коммутатор перестает получать приветственные сообщения или получает приветственное сообщение, в котором перечислены различные детали, происходит сбой, поэтому коммутатор реагирует и запускает процесс изменения топологии связующего дерева.
#### STP Timers That Manage STP Convergence
Таймеры STP, управляющие конвергенцией STP   
__|__
--|--
|
For various reasons, the STP convergence process requires the use of three timers, listed in Table 9-7.|По разным причинам процесс конвергенции STP требует использования трех таймеров, перечисленных в таблице 9-7.
Note that all switches use the timers as dictated by the root switch, which the root lists in its periodic Hello BPDU messages.|Обратите внимание, что все коммутаторы используют таймеры в соответствии с указаниями корневого коммутатора, который корень перечисляет в своих периодических сообщениях Hello BPDU.
|
Table 9-7 STP Timers Table end.|Таблица 9-7 Таймеры STP Конец таблицы.
|
If a switch does not get an expected Hello BPDU within the Hello time, the switch continues as normal.|Если коммутатор не получает ожидаемого Hello BPDU в течение времени Hello, коммутатор продолжает работу в обычном режиме.
However, if the Hellos do not show up again within MaxAge time, the switch reacts by taking steps to change the STP topology.|Однако, если сообщения приветствия не появляются снова в течение времени MaxAge, коммутатор реагирует, предпринимая шаги по изменению топологии STP.
With default settings, MaxAge is 20 seconds (10 times the default Hello timer of 2 seconds).|При настройках по умолчанию MaxAge составляет 20 секунд (в 10 раз больше таймера приветствия по умолчанию, равного 2 секундам).
So, a switch would go 20 seconds without hearing a Hello before reacting.|Таким образом, переключение прошло бы 20 секунд, не услышав Hello, прежде чем среагировать.
|
After MaxAge expires, the switch essentially makes all its STP choices again, based on any Hellos it receives from other switches.|По истечении срока действия MaxAge коммутатор, по сути, снова делает все свои варианты STP на основе любых сообщений Hello, которые он получает от других коммутаторов.
It reevaluates which switch should be the root switch.|Он повторно оценивает, какой коммутатор должен быть корневым.
|
If the local switch is not the root, it chooses its RP. And it determines whether it is DP on each of its other links.|Если локальный коммутатор не является корневым, он выбирает свой RP. И он определяет, является ли это DP на каждой из своих других ссылок.
|
The best way to describe STP convergence is to show an example using the same familiar topology.|Лучший способ описать сходимость STP - показать пример, использующий ту же знакомую топологию.
Figure 9-7 shows the same familiar figure, with SW3’s Gi0/2 in a blocking state, but SW1’s Gi0/2 interface has just failed.|На рис. 9-7 показан тот же знакомый рисунок, где Gi0 / 2 SW3 находится в состоянии блокировки, но интерфейс Gi0 / 2 SW1 только что вышел из строя.
|
Figure 9-7 Initial STP State Before SW1-SW3 Link Fails In the scenario shown in the figure, SW3 reacts to the change because SW3 fails to receive its expected Hellos on its Gi0/1 interface.|Рисунок 9-7 Начальное состояние STP перед отказом канала связи SW1-SW3 В сценарии, показанном на рисунке, SW3 реагирует на изменение, потому что SW3 не может получить ожидаемые сообщения Hello на своем интерфейсе Gi0 / 1.
However, SW2 does not need to react because SW2 continues to receive its periodic Hellos in its Gi0/2 interface.|Однако SW2 не должен реагировать, потому что SW2 продолжает получать свои периодические приветствия в своем интерфейсе Gi0 / 2.
In this case, SW3 reacts either when MaxAge time passes without hearing the Hellos, or as soon as SW3 notices that interface Gi0/1 has failed. (If the interface fails, the switch can assume that the Hellos will not be arriving in that interface anymore.)|В этом случае SW3 реагирует либо тогда, когда время MaxAge проходит, не слыша приветствия, либо как только SW3 замечает, что интерфейс Gi0 / 1 вышел из строя. (Если интерфейс выходит из строя, коммутатор может предположить, что сообщения Hellos больше не будут поступать через этот интерфейс.)
|
Now that SW3 can act, it begins by reevaluating the choice of root switch.|Теперь, когда SW3 может действовать, он начинает с переоценки выбора корневого коммутатора.
SW3 still receives the Hellos from SW2, as forwarded from the root (SW1).|SW3 по-прежнему получает приветствия от SW2, перенаправленные от корня (SW1).
SW1 still has a lower BID than SW3; otherwise, SW1 would not have already been the root.|SW1 по-прежнему имеет более низкий BID, чем SW3; в противном случае SW1 еще не был бы корнем.
So, SW3 decides that SW1 wins the root election and that SW3 is not the root.|Итак, SW3 решает, что SW1 побеждает на корневых выборах, а SW3 не является корневым.
|
Next, SW3 reevaluates its choice of RP. At this point, SW3 is receiving Hellos on only one interface: Gi0/2.|Затем SW3 пересматривает свой выбор RP. На данный момент SW3 получает приветствия только на одном интерфейсе: Gi0 / 2.
Whatever the calculated root cost, Gi0/2 becomes SW3’s new RP. (The cost would be 8, assuming the STP costs had no changes since Figures 9-5 and 9-6.)|Независимо от рассчитанной корневой стоимости Gi0 / 2 становится новым RP SW3. (Стоимость будет 8, если предположить, что стоимость STP не изменилась по сравнению с рисунками 9-5 и 9-6.)
|
SW3 then reevaluates its role as DP on any other interfaces.|Затем SW3 повторно оценивает свою роль DP на любых других интерфейсах.
In this example, no real work needs to be done.|В этом примере не требуется никакой реальной работы.
SW3 was already DP on interface Fa0/13, and it continues to be the DP because no other switches connect to that port.|SW3 уже был DP на интерфейсе Fa0 / 13, и он продолжает быть DP, потому что другие коммутаторы не подключаются к этому порту.
#### Changing Interface States with STP
Изменение состояний интерфейса с помощью STP   
__|__
--|--
|
STP uses the idea of roles and states.|STP использует идею ролей и состояний.
Roles, like root port and designated port, relate to how STP analyzes the LAN topology.|Роли, такие как корневой порт и назначенный порт, связаны с тем, как STP анализирует топологию LAN.
States, like forwarding and blocking, tell a switch whether to send or receive frames.|Такие состояния, как пересылка и блокировка, указывают коммутатору, следует ли отправлять или получать кадры.
When STP converges, a switch chooses new port roles, and the port roles determine the state (forwarding or blocking).|Когда STP сходится, коммутатор выбирает новые роли порта, а роли порта определяют состояние (пересылка или блокировка).
|
Switches using STP can simply move immediately from forwarding to blocking state, but they must take extra time to transition from blocking state to forwarding state.|Коммутаторы, использующие STP, могут просто немедленно перейти из состояния пересылки в состояние блокировки, но им потребуется дополнительное время для перехода из состояния блокировки в состояние пересылки.
For instance, when switch SW3 in Figure 9-7 formerly used port G0/1 as its RP (a role), that port was in a forwarding state.|Например, когда коммутатор SW3 на рисунке 9-7 ранее использовал порт G0 / 1 в качестве RP (роли), этот порт находился в состоянии пересылки.
After convergence, G0/1 might be neither an RP nor DP; the switch can immediately move that port to a blocking state.|После сходимости G0 / 1 может быть ни RP, ни DP; коммутатор может немедленно перевести этот порт в состояние блокировки.
|
However, when a port that formerly blocked needs to transition to forwarding, the switch first puts the port through two intermediate interface states.|Однако, когда порт, который ранее был заблокирован, должен перейти в режим пересылки, коммутатор сначала переводит порт через два промежуточных состояния интерфейса.
These temporary STP states help prevent temporary loops:|Эти временные состояния STP помогают предотвратить временные петли:
###### Listening: Like the blocking state, the interface does not forward frames. The switch
Прослушивание: как и в состоянии блокировки, интерфейс не пересылает кадры. Переключатель   
__|__
--|--
|
removes old stale (unused) MAC table entries for which no frames are received from each MAC address during this period.|удаляет старые устаревшие (неиспользуемые) записи в таблице MAC-адресов, для которых в течение этого периода не получены кадры с каждого MAC-адреса.
These stale MAC table entries could be the cause of the temporary loops.|Эти устаревшие записи таблицы MAC могут быть причиной временных циклов.
###### Learning: Interfaces in this state still do not forward frames, but the switch begins to
Обучение: интерфейсы в этом состоянии все еще не пересылают кадры, но коммутатор начинает   
__|__
--|--
|
learn the MAC addresses of frames received on the interface.|узнайте MAC-адреса кадров, полученных на интерфейсе.
|
STP moves an interface from blocking to listening, then to learning, and then to forwarding state.|STP переводит интерфейс из состояния блокировки в состояние прослушивания, затем в состояние обучения, а затем в состояние пересылки.
STP leaves the interface in each interim state for a time equal to the forward delay timer, which defaults to 15 seconds.|STP оставляет интерфейс в каждом промежуточном состоянии на время, равное таймеру задержки пересылки, которое по умолчанию составляет 15 секунд.
As a result, a convergence event that causes an interface to change from blocking to forwarding requires 30 seconds to transition from blocking to forwarding.|В результате событие конвергенции, которое вызывает переход интерфейса с блокировки на пересылку, требует 30 секунд для перехода от блокировки к пересылке.
In addition, a switch might have to wait MaxAge seconds (default 20 seconds)|Кроме того, коммутатору может потребоваться подождать MaxAge секунд (по умолчанию 20 секунд).
|
before even choosing to move an interface from blocking to forwarding state.|еще до того, как выбрать перевод интерфейса из состояния блокировки в состояние пересылки.
|
For example, follow what happens with an initial STP topology as shown in Figures 9-3 through 9-6, with the SW1-to-SW3 link failing as shown in Figure 9-7.|Например, проследите, что происходит с начальной топологией STP, как показано на рисунках с 9-3 по 9-6, с отказом канала SW1-SW3, как показано на рисунке 9-7.
If SW1 simply quit sending Hello messages to SW3, but the link between the two did not fail, SW3 would wait MaxAge seconds before reacting (20 seconds is the default).|Если SW1 просто прекратил отправлять сообщения Hello SW3, но связь между ними не прервалась, SW3 будет ждать MaxAge секунд, прежде чем реагировать (по умолчанию 20 секунд).
SW3 would actually quickly choose its ports’ STP roles, but then wait 15 seconds each in listening and learning states on interface Gi0/2, resulting in a 50-second convergence delay.|SW3 на самом деле быстро выбирает роли STP своих портов, но затем ждет по 15 секунд каждую в состояниях прослушивания и обучения на интерфейсе Gi0 / 2, что приводит к 50-секундной задержке сходимости.
|
Table 9-8 summarizes spanning tree’s various interface states for easier review.|В таблице 9-8 приведены различные состояния интерфейса связующего дерева для облегчения просмотра.
|
Table 9-8 IEEE STP (Not RSTP) States Table end.|Таблица 9-8 Состояния IEEE STP (не RSTP) Конец таблицы.
### Rapid STP Concepts
Концепции Rapid STP   
__|__
--|--
|
The original STP worked well given the assumptions about networks and networking devices in that era.|Исходный протокол STP хорошо работал с учетом предположений о сетях и сетевых устройствах того времени.
However, as with any computing or networking standard, as time passes, hardware and software capabilities improve, so new protocols emerge to take advantage of those new capabilities.|Однако, как и в случае с любыми вычислительными или сетевыми стандартами, со временем возможности оборудования и программного обеспечения улучшаются, поэтому появляются новые протоколы, использующие эти новые возможности.
For STP, one of the most significant improvements over time has been the introduction of Rapid Spanning Tree Protocol (RSTP), introduced as standard IEEE 802.1w.|Для STP одним из наиболее значительных улучшений со временем стало внедрение протокола Rapid Spanning Tree Protocol (RSTP), представленного как стандарт IEEE 802.1w.
|
NOTE Just to make sure you are clear about the terminology: Throughout the rest of the chapter, STP refers to the original STP standard only, and use of the term RSTP does not include STP.|ПРИМЕЧАНИЕ Просто чтобы убедиться, что вы понимаете терминологию: В остальной части главы STP относится только к исходному стандарту STP, а использование термина RSTP не включает STP.
|
Before getting into the details of RSTP, it helps to make sense of the standards numbers a bit.|Прежде чем вдаваться в подробности RSTP, стоит немного разобраться в стандартах.
|
802.1w was actually an amendment to the 802.1D standard.|802.1w на самом деле был поправкой к стандарту 802.1D.
The IEEE first published 802.1D in 1990, and anew in 1998.|IEEE впервые опубликовал 802.1D в 1990 году и снова в 1998 году.
After the 1998 version of 802.1D, the IEEE published the 802.1w amendment to 802.1D in 2001, which first standardized RSTP.|После версии 802.1D 1998 года, IEEE опубликовал поправку 802.1w к 802.1D в 2001 году, которая впервые стандартизировала RSTP.
|
Over the years, other meaningful changes happened in the standards as well, although those changes probably do not impact most networkers’ thinking when it comes to working with STP or RSTP. But to be complete, the IEEE replaced STP with RSTP in the revised 802.1D standard in 2004.|С годами в стандарты произошли и другие значимые изменения, хотя эти изменения, вероятно, не влияют на мышление большинства сетевых специалистов, когда дело доходит до работы с STP или RSTP. Но чтобы завершить, IEEE заменил STP на RSTP в пересмотренном стандарте 802.1D в 2004 году.
In another move, in 2011 the IEEE moved all the RSTP details into a revised 802.1Q standard.|Еще один шаг: в 2011 году IEEE переместил все детали RSTP в пересмотренный стандарт 802.1Q.
As it stands today, RSTP actually sits in the 802.1Q standards document.|В его нынешнем виде RSTP фактически включен в стандарт 802.1Q.
|
As a result, when reading about RSTP, you will see documents, books, videos, and the like that refer to RSTP and include various references to 802.1w, 802.1D, and 802.1Q—and they might all be correct based on timing and context.|В результате, читая о RSTP, вы увидите документы, книги, видео и тому подобное, которые относятся к RSTP и включают различные ссылки на 802.1w, 802.1D и 802.1Q - и все они могут быть правильными в зависимости от времени и контекст.
At the same time, many people refer to RSTP as 802.1w because that was the first IEEE document to define it.|В то же время многие люди называют RSTP 802.1w, потому что это был первый документ IEEE, в котором он был определен.
However, for the purposes of this book, focus instead on the RSTP acronym rather than the IEEE standards numbers used with RSTP over its history.|Однако для целей этой книги вместо этого сосредоточьтесь на аббревиатуре RSTP, а не на номерах стандартов IEEE, которые использовались с RSTP на протяжении его истории.
|
NOTE The IEEE sells its standards, but through the “Get IEEE 802” program, you can get free PDFs of the current 802 standards.|ПРИМЕЧАНИЕ IEEE продает свои стандарты, но с помощью программы «Get IEEE 802» вы можете бесплатно получить PDF-файлы текущих стандартов 802.
To read about RSTP today, you will need to download the 802.1Q standard, and then look for the sections about RSTP.|Чтобы прочитать о RSTP сегодня, вам нужно будет загрузить стандарт 802.1Q, а затем искать разделы о RSTP.
|
Now on to the details about RSTP in this chapter.|Теперь перейдем к подробностям о RSTP в этой главе.
As discussed throughout this chapter, RSTP and STP have many similarities, so this section next compares and contrasts the two.|Как уже говорилось в этой главе, RSTP и STP имеют много общего, поэтому в следующем разделе мы их сравниваем и сравниваем.
|
Following that, the rest of this section discusses the concepts unique to RSTP that are not found in STP—alternate root ports, different port states, backup ports, and the port roles used by RSTP.|После этого в оставшейся части этого раздела обсуждаются уникальные для RSTP концепции, которых нет в STP - альтернативные корневые порты, различные состояния портов, резервные порты и роли портов, используемые RSTP.
#### Comparing STP and RSTP
Сравнение STP и RSTP   
__|__
--|--
|
RSTP works just like STP in several ways, as discussed in the first major section of the chapter.|RSTP работает так же, как STP, несколькими способами, как обсуждалось в первом основном разделе этой главы.
|
To review:|Для обзора:
###### RSTP and STP elect the root switch using the same rules and tiebreakers.
RSTP и STP выбирают корневой коммутатор, используя одни и те же правила и разрешения конфликтов.   
###### RSTP and STP switches select their root ports with the same rules.
Коммутаторы RSTP и STP выбирают свои корневые порты по одинаковым правилам.   
###### RSTP and STP elect designated ports on each LAN segment with the same rules and
RSTP и STP выбирают назначенные порты в каждом сегменте LAN с одинаковыми правилами и   
__|__
--|--
|
tiebreakers.|тай-брейки.
###### RSTP and STP place each port in either forwarding or blocking state, although RSTP calls
RSTP и STP переводят каждый порт в состояние пересылки или блокировки, хотя RSTP вызывает   
__|__
--|--
|
the blocking state the discarding state.|состояние блокировки состояние отмены.
|
In fact, RSTP works so much like STP that they can both be used in the same network.|Фактически, RSTP работает так же, как STP, что оба могут использоваться в одной сети.
|
RSTP and STP switches can be deployed in the same network, with RSTP features working in switches that support it and traditional STP features working in the switches that support only STP.|Коммутаторы RSTP и STP могут быть развернуты в одной сети, при этом функции RSTP работают в коммутаторах, которые его поддерживают, а традиционные функции STP работают в коммутаторах, поддерживающих только STP.
|
With all these similarities, you might be wondering why the IEEE bothered to create RSTP in the first place.|При всем этом сходстве у вас может возникнуть вопрос, почему IEEE вообще потрудился создать RSTP.
The overriding reason is convergence.|Основная причина - конвергенция.
STP takes a relatively long time to converge (50 seconds with the default settings when all the wait times must be followed).|Для схождения STP требуется относительно много времени (50 секунд с настройками по умолчанию, когда необходимо соблюдать все времена ожидания).
|
RSTP improves network convergence when topology changes occur, usually converging within a few seconds (or in slow conditions, in about 10 seconds).|RSTP улучшает сходимость сети при изменении топологии, обычно сходимость в течение нескольких секунд (или в медленных условиях примерно за 10 секунд).
|
RSTP changes and adds to STP in ways that avoid waiting on STP timers, resulting in quick transitions from forwarding to discarding (blocking) state and vice versa.|RSTP изменяется и дополняет STP таким образом, чтобы избежать ожидания таймеров STP, что приводит к быстрому переходу от состояния пересылки к состоянию отмены (блокировки) и наоборот.
Specifically, RSTP, compared to STP, defines more cases in which the switch can avoid waiting for a timer to expire, such as the following:|В частности, RSTP, по сравнению с STP, определяет больше случаев, в которых коммутатор может избежать ожидания истечения таймера, например следующие:
###### RSTP adds a mechanism by which a switch can replace its root port, without any waiting
RSTP добавляет механизм, с помощью которого коммутатор может заменить свой корневой порт без ожидания.   
__|__
--|--
|
to reach a forwarding state (in some conditions).|для перехода в состояние пересылки (при некоторых условиях).
###### RSTP adds a new mechanism to replace a designated port, without any waiting to reach a
RSTP добавляет новый механизм для замены назначенного порта, не дожидаясь достижения   
__|__
--|--
|
forwarding state (in some conditions).|состояние пересылки (в некоторых условиях).
###### RSTP lowers waiting times for cases in which RSTP must wait for a timer.
RSTP снижает время ожидания для случаев, когда RSTP должен ждать таймера.   
__|__
--|--
|
For instance, imagine a failure case in which a link remains up, but for some reason, a nonroot switch stops hearing the Hello BPDUs it had been hearing in the past.|Например, представьте себе случай отказа, при котором соединение остается активным, но по какой-то причине некорневой коммутатор перестает слышать Hello BPDU, которое он слышал в прошлом.
STP requires a switch to wait for MaxAge seconds, which STP defines based on 10 times the Hello timer, or 20 seconds, by default.|STP требует, чтобы коммутатор ждал в течение MaxAge секунд, которые STP определяет на основе 10-кратного таймера Hello или 20 секунд по умолчанию.
RSTP shortens this timer, defining MaxAge as three times the Hello timer.|RSTP сокращает этот таймер, определяя MaxAge как трехкратный таймер Hello.
Additionally, RSTP can send messages to the neighboring switch to inquire whether a problem has occurred rather than wait for timers.|Кроме того, RSTP может отправлять сообщения на соседний коммутатор, чтобы узнать, возникла ли проблема, вместо того, чтобы ждать таймеров.
|
The best way to get a sense for these mechanisms is to see how the RSTP alternate port and the backup port both work.|Лучший способ разобраться в этих механизмах - посмотреть, как работают альтернативный порт RSTP и резервный порт.
RSTP uses the term alternate port to refer to a switch’s other ports that could be used as the root port if the root port ever fails.|RSTP использует термин альтернативный порт для обозначения других портов коммутатора, которые могут использоваться в качестве корневого порта в случае выхода из строя корневого порта.
The backup port concept provides a backup port on the local switch for a designated port. (Note that backup ports apply only to designs that use hubs, so they are unlikely to be useful today.) However, both are instructive about how RSTP works.|Концепция резервного порта обеспечивает резервный порт на локальном коммутаторе для назначенного порта. (Обратите внимание, что резервные порты применимы только к проектам, использующим концентраторы, поэтому они вряд ли будут полезны сегодня.) Однако оба поучительны в отношении того, как работает RSTP.
Table 9-9 lists these RSTP port roles.|В Таблице 9-9 перечислены эти роли портов RSTP.
|
Table 9-9 Port Roles in RSTP Table end.|Таблица 9-9 Роли портов в конце таблицы RSTP.
|
RSTP differs from STP in a few other ways as well.|RSTP отличается от STP и несколькими другими способами.
For instance, with STP, the root switch creates a Hello with all other switches, updating and forwarding the Hello.|Например, с STP корневой коммутатор создает Hello со всеми другими коммутаторами, обновляя и пересылая Hello.
With RSTP, each switch independently generates its own Hellos.|При использовании RSTP каждый коммутатор независимо генерирует свои собственные приветствия.
Additionally, RSTP allows for queries between neighbors, rather than waiting on timers to expire, as a means to avoid waiting to learn information.|Кроме того, RSTP позволяет отправлять запросы между соседями вместо ожидания истечения таймеров, чтобы избежать ожидания получения информации.
These types of protocol changes help RSTP-based switches isolate what has changed in a network and react quickly to choose a net RSTP topology.|Эти типы изменений протокола помогают коммутаторам на основе RSTP изолировать то, что изменилось в сети, и быстро реагировать на выбор сетевой топологии RSTP.
|
The next few pages work through some of those overt RSTP features that differ from STP.|На следующих нескольких страницах рассматриваются некоторые из тех явных функций RSTP, которые отличаются от STP.
#### RSTP and the Alternate (Root) Port Role
RSTP и роль альтернативного (корневого) порта   
__|__
--|--
|
With STP, each nonroot switch places one port in the STP root port (RP) role.|При использовании STP каждый некорневой коммутатор помещает один порт в роль корневого порта (RP) STP.
RSTP follows that same convention, with the same exact rules for choosing the RP. RSTP then takes another step beyond STP, naming other possible RPs, identifying them as alternate ports.|RSTP следует тому же соглашению с теми же точными правилами выбора RP. Затем RSTP делает еще один шаг за пределы STP, называя другие возможные RP, идентифицируя их как альтернативные порты.
|
To be an alternate port, both the RP and the alternate port must receive Hellos that identify the same root switch.|Чтобы быть альтернативным портом, и RP, и альтернативный порт должны получать сообщения приветствия, которые идентифицируют один и тот же корневой коммутатор.
For instance, in Figure 9-8, SW1 is the root.|Например, на рис. 9-8 SW1 - это корень.
SW3 will receive Hello BPDUs on two ports: G0/1 and G0/2.|SW3 будет получать Hello BPDU на двух портах: G0 / 1 и G0 / 2.
Both Hellos list SW1’s bridge ID (BID) as the root switch, so whichever port is not the root port meets the criteria to be an alternate port.|Оба Hellos указывают идентификатор моста SW1 (BID) в качестве корневого коммутатора, поэтому любой порт, не являющийся корневым, соответствует критериям альтернативного порта.
SW3 picks G0/1 as its root port in this case and then makes G0/2 an alternate port.|SW3 выбирает G0 / 1 в качестве корневого порта в этом случае, а затем делает G0 / 2 альтернативным портом.
|
An alternate port basically works like the second-best option for the root port.|Альтернативный порт в основном работает как второй лучший вариант для корневого порта.
The alternate port can take over for the former root port, often very rapidly, without requiring a wait in other interim RSTP states.|Альтернативный порт может занять место бывшего корневого порта, часто очень быстро, без необходимости ожидания в других промежуточных состояниях RSTP.
For instance, when the root port fails, or when Hellos stop arriving on the original root port, the switch changes the former root port’s role and state: (a) the role from root port to a disabled port, and (b) the state from forwarding to discarding (the equivalent of STP’s blocking state).|Например, когда корневой порт выходит из строя или когда приветы перестают поступать на исходный корневой порт, коммутатор изменяет роль и состояние бывшего корневого порта: (а) роль с корневого порта на отключенный порт и (б) состояние от пересылки до отбрасывания (эквивалент состояния блокировки STP).
Then, without waiting on any timers, the switch changes roles and state for the alternate port: its role changes to be the root port, with a forwarding state.|Затем, не дожидаясь таймеров, коммутатор меняет роли и состояние для альтернативного порта: его роль меняется на корневой порт с состоянием пересылки.
|
Notably, the new root port also does not need to spend time in other states, such as learning state, instead moving immediately to forwarding state.|Примечательно, что новому корневому порту также не нужно проводить время в других состояниях, таких как состояние обучения, вместо этого он немедленно переходит в состояние пересылки.
|
Figure 9-8 Example of SW3 Making G0/2 Become an Alternate Port Figure 9-9 shows an example of RSTP convergence.|Рисунок 9-8. Пример SW3, когда G0 / 2 становится альтернативным портом. Рисунок 9-9 показывает пример конвергенции RSTP.
SW3’s root port before the failure shown in this figure is SW3’s G0/1, the link connected directly to SW1 (the root switch).|Корневым портом SW3 до сбоя, показанного на этом рисунке, был G0 / 1 SW3, канал, подключенный напрямую к SW1 (корневому коммутатору).
Then SW3’s link to SW1 fails as shown in Step 1 of the figure.|Тогда связь SW3 с SW1 не работает, как показано на шаге 1 рисунка.
|
Figure 9-9 Convergence Events with SW3 G0/1 Failure Following the steps in Figure 9-9:|Рисунок 9-9 События сходимости при отказе SW3 G0 / 1 Выполните шаги, показанные на рисунке 9-9:
|
Step 1.|Шаг 1.
The link between SW1 and SW3 fails, so SW3’s current root port (Gi0/1) fails.|Связь между SW1 и SW3 не работает, поэтому текущий корневой порт SW3 (Gi0 / 1) не работает.
|
Step 2.|Шаг 2.
SW3 and SW2 exchange RSTP messages to confirm that SW3 will now transition its former alternate port (Gi0/2) to be the root port.|SW3 и SW2 обмениваются сообщениями RSTP, чтобы подтвердить, что SW3 теперь переведет свой прежний альтернативный порт (Gi0 / 2) в корневой порт.
This action causes SW2 to flush the required MAC table entries.|Это действие заставляет SW2 очищать требуемые записи таблицы MAC.
|
Step 3.|Шаг 3.
SW3 transitions Gi0/1 to the disabled role and Gi0/2 to the root port role.|SW3 переводит Gi0 / 1 в отключенную роль, а Gi0 / 2 в роль корневого порта.
|
Step 4.|Шаг 4.
SW3 transitions Gi0/2 to a forwarding state immediately, without using learning state, because this is one case in which RSTP knows the transition will not create a loop.|SW3 переводит Gi0 / 2 в состояние пересылки немедленно, без использования состояния обучения, потому что это один из случаев, когда RSTP знает, что переход не создаст петли.
|
As soon as SW3 realizes its Gi0/1 interface has failed, the process shown in the figure takes very little time.|Как только SW3 понимает, что его интерфейс Gi0 / 1 вышел из строя, процесс, показанный на рисунке, занимает очень мало времени.
None of the processes rely on timers, so as soon as the work can be done, the convergence completes. (This particular convergence example takes about 1 second in a lab.)|Ни один из процессов не полагается на таймеры, поэтому, как только работа может быть выполнена, конвергенция завершается. (Этот конкретный пример сходимости занимает в лаборатории около 1 секунды.)
#### RSTP States and Processes
Состояния и процессы RSTP   
__|__
--|--
|
The depth of the previous example does not point out all details of RSTP, of course; however, the example does show enough details to discuss RSTP states and internal processes.|Глубина предыдущего примера, конечно, не раскрывает всех деталей RSTP; тем не менее, пример показывает достаточно деталей, чтобы обсудить состояния и внутренние процессы RSTP.
|
Both STP and RSTP use port states, but with some differences.|И STP, и RSTP используют состояния портов, но с некоторыми отличиями.
First, RSTP keeps both the learning and forwarding states as compared with STP, for the same purposes.|Во-первых, RSTP сохраняет состояние обучения и пересылки по сравнению с STP для тех же целей.
However, RSTP does not even define a listening state, finding it unnecessary.|Однако RSTP даже не определяет состояние прослушивания, считая его ненужным.
Finally, RSTP renames the blocking state to the discarding state and redefines its use slightly.|Наконец, RSTP переименовывает состояние блокировки в состояние отмены и немного переопределяет его использование.
|
RSTP uses the discarding state for what STP defines as two states: disabled state and blocking state.|RSTP использует состояние отмены для того, что STP определяет как два состояния: отключенное состояние и состояние блокировки.
Blocking should be somewhat obvious by now: the interface can work physically, but STP/RSTP chooses to not forward traffic to avoid loops.|К настоящему времени блокировка должна быть очевидна: интерфейс может работать физически, но STP / RSTP предпочитает не пересылать трафик, чтобы избежать петель.
STP’s disabled state simply meant that the interface was administratively disabled.|Состояние отключения STP просто означает, что интерфейс отключен административно.
RSTP just combines those into a single discarding state.|RSTP просто объединяет их в одно состояние отбрасывания.
Table 9-10 shows the list of STP and RSTP states for comparison purposes.|Таблица 9-10 показывает список состояний STP и RSTP для сравнения.
|
Table 9-10 Port States Compared: STP and RSTP Table end.|Таблица 9-10 Сравнение состояний портов: конец таблицы STP и RSTP.
|
RSTP also changes some processes and message content (compared to STP) to speed convergence.|RSTP также изменяет некоторые процессы и содержимое сообщений (по сравнению с STP) для ускорения конвергенции.
|
For example, STP waits for a time (forward delay) in both listening and learning states.|Например, STP ожидает некоторое время (задержка пересылки) как в состоянии прослушивания, так и в состоянии обучения.
|
The reason for this delay in STP is that, at the same time, the switches have all been told to time out their MAC table entries.|Причина этой задержки в STP заключается в том, что в то же время всем коммутаторам было приказано истечь время ожидания своих записей в таблице MAC.
When the topology changes, the existing MAC table entries may actually cause a loop.|Когда топология изменяется, существующие записи таблицы MAC могут фактически вызвать петлю.
With STP, the switches all tell each other (with BPDU messages) that the topology has changed and to time out any MAC table entries using the forward delay timer.|С STP все коммутаторы сообщают друг другу (с сообщениями BPDU), что топология изменилась, и тайм-аут для любых записей таблицы MAC с помощью таймера задержки пересылки.
This removes the entries, which is good, but it causes the need to wait in both listening and learning state for forward delay time (default 15 seconds each).|Это удаляет записи, что хорошо, но вызывает необходимость ожидания времени задержки пересылки как в состоянии прослушивания, так и в состоянии обучения (по умолчанию 15 секунд каждая).
|
RSTP, to converge more quickly, avoids relying on timers.|RSTP, чтобы сойтись быстрее, избегает использования таймеров.
RSTP switches tell each other (using messages) that the topology has changed.|Коммутаторы RSTP сообщают друг другу (используя сообщения), что топология изменилась.
Those messages also direct neighboring switches to flush the contents of their MAC tables in a way that removes all the potentially loop-causing entries, without a wait.|Эти сообщения также предписывают соседним коммутаторам очистить содержимое своих таблиц MAC таким образом, чтобы без ожидания удалялись все потенциально вызывающие петли записи.
As a result, RSTP creates more scenarios in which a formerly discarding port can immediately transition to a forwarding state, without waiting, and without using the learning state, as shown in the example in Figure 9-9.|В результате RSTP создает больше сценариев, в которых ранее отвергающий порт может немедленно перейти в состояние пересылки, без ожидания и без использования состояния обучения, как показано в примере на рис. 9-9.
#### RSTP and the Backup (Designated) Port Role
RSTP и роль резервного (назначенного) порта   
__|__
--|--
|
The RSTP backup port role acts as yet another new RSTP port role as compared to STP. As a reminder, the RSTP alternate port role creates a way for RSTP to quickly replace a switch’s root port.|Роль резервного порта RSTP действует как еще одна новая роль порта RSTP по сравнению с STP. Напоминаем, что роль альтернативного порта RSTP позволяет RSTP быстро заменить корневой порт коммутатора.
Similarly, the RSTP backup port role creates a way for RSTP to quickly replace a switch’s designated port on some LAN.|Точно так же роль резервного порта RSTP позволяет RSTP быстро заменить назначенный порт коммутатора в некоторой локальной сети.
|
The need for a backup port can be a bit confusing at first because the need for the backup port role only happens in designs that are a little unlikely today.|Потребность в резервном порту может сначала сбивать с толку, потому что необходимость в роли резервного порта возникает только в проектах, которые сегодня маловероятны.
The reason is that a design must use hubs, which then allows the possibility that one switch connects more than one port to the same collision domain.|Причина в том, что в проекте должны использоваться концентраторы, что тогда допускает возможность того, что один коммутатор подключит более одного порта к одному домену конфликтов.
|
Figure 9-10 shows an example.|На рис. 9-10 показан пример.
SW3 and SW4 both connect to the same hub.|SW3 и SW4 оба подключены к одному концентратору.
SW4’s port F0/1 happens to win the election as designated port (DP). The other port on SW4 that connects to the same collision domain, F0/2, acts as a backup port.|Порт F0 / 1 SW4 выигрывает выборы в качестве назначенного порта (DP). Другой порт на SW4, который подключается к тому же домену конфликтов, F0 / 2, действует как резервный порт.
|
Figure 9-10 RSTP Backup Port Example With a backup port, if the current designated port fails, SW4 can start using the backup port with rapid convergence.|Рисунок 9-10 Пример резервного порта RSTP. Если текущий назначенный порт выходит из строя, при использовании резервного порта SW4 может начать использовать резервный порт с быстрой сходимостью.
For instance, if SW4’s F0/1 interface were to fail, SW4 could transition F0/2 to the designated port role, without any delay in moving from discarding state to a forwarding state.|Например, если интерфейс F0 / 1 SW4 откажет, SW4 может перевести F0 / 2 в назначенную роль порта без какой-либо задержки при переходе из состояния сброса в состояние пересылки.
#### RSTP Port Types
Типы портов RSTP   
__|__
--|--
|
The final RSTP concept included here relates to some terms RSTP uses to refer to different types of ports and the links that connect to those ports.|Заключительная концепция RSTP, включенная здесь, относится к некоторым терминам, которые RSTP использует для обозначения различных типов портов и ссылок, которые подключаются к этим портам.
|
To begin, consider the basic image in Figure 9-11.|Для начала рассмотрим базовое изображение на рис. 9-11.
It shows several links between two switches.|Он показывает несколько связей между двумя переключателями.
|
RSTP considers these links to be point-to-point links and the ports connected to them to be point-to-point ports because the link connects exactly two devices (points).|RSTP считает эти ссылки двухточечными, а подключенные к ним порты - двухточечными, поскольку канал соединяет ровно два устройства (точки).
|
RSTP further classifies point-to-point ports into two categories.|RSTP дополнительно классифицирует двухточечные порты на две категории.
Point-to-point ports that connect two switches are not at the edge of the network and are simply called point-topoint ports.|Порты точка-точка, которые соединяют два коммутатора, не находятся на границе сети и называются портами точка-точка.
Ports that instead connect to a single endpoint device at the edge of the network, like a PC or server, are called point-to-point edge ports, or simply edge ports.|Порты, которые вместо этого подключаются к одному оконечному устройству на границе сети, например ПК или серверу, называются граничными портами точка-точка или просто граничными портами.
In Figure 9-11, SW3’s switch port connected to a PC is an edge port.|На рисунке 9-11 порт коммутатора SW3, подключенный к ПК, является пограничным портом.
|
Figure 9-11 RSTP Link Types Finally, RSTP defines the term shared to describe ports connected to a hub.|Рис. 9-11. Типы каналов RSTP Наконец, RSTP определяет термин «общий» для описания портов, подключенных к концентратору.
The term shared comes from the fact that hubs create a shared Ethernet; hubs also force the attached switch port to use half-duplex logic.|Термин «разделяемый» происходит от того факта, что концентраторы создают общий Ethernet; концентраторы также заставляют подключенный порт коммутатора использовать полудуплексную логику.
RSTP assumes that all half-duplex ports may be connected to hubs, treating ports that use half duplex as shared ports.|RSTP предполагает, что все полудуплексные порты могут быть подключены к концентраторам, рассматривая порты, которые используют полудуплекс, как общие порты.
RSTP converges more slowly on shared ports as compared to all point-to-point ports.|RSTP сходится на общих портах медленнее, чем на всех двухточечных портах.
#### Optional STP Features
Дополнительные функции STP   
__|__
--|--
|
To close out the chapter, the last few topics introduce a few optional features that make STP work even better or be more secure: EtherChannel, PortFast, and BPDU Guard.|Завершая главу, в последних нескольких темах рассказывается о нескольких дополнительных функциях, которые делают работу STP еще лучше или более безопасной: EtherChannel, PortFast и BPDU Guard.
##### EtherChannel
EtherChannel   
__|__
--|--
|
One of the best ways to lower STP’s convergence time is to avoid convergence altogether.|Один из лучших способов сократить время сходимости STP - полностью избежать сходимости.
|
EtherChannel provides a way to prevent STP convergence from being needed when only a single port or cable failure occurs.|EtherChannel предоставляет способ предотвратить необходимость конвергенции STP, когда происходит сбой только одного порта или кабеля.
|
EtherChannel combines multiple parallel segments of equal speed (up to eight) between the same pair of switches, bundled into an EtherChannel.|EtherChannel объединяет несколько параллельных сегментов с одинаковой скоростью (до восьми) между одной и той же парой коммутаторов, объединенных в EtherChannel.
The switches treat the EtherChannel as a single interface with regard to STP. As a result, if one of the links fails, but at least one of the links is up, STP convergence does not have to occur.|Коммутаторы рассматривают EtherChannel как единый интерфейс по отношению к STP. В результате, если одна из ссылок выходит из строя, но хотя бы одна из них работает, сходимость STP не должна происходить.
For example, Figure 9-12 shows the familiar three-switch network, but now with two Gigabit Ethernet connections between each pair of switches.|Например, на рис. 9-12 показана знакомая сеть с тремя коммутаторами, но теперь с двумя подключениями Gigabit Ethernet между каждой парой коммутаторов.
|
With each pair of Ethernet links configured as an EtherChannel, STP treats each EtherChannel as a single link.|Когда каждая пара каналов Ethernet настроена как канал EtherChannel, STP рассматривает каждый канал EtherChannel как один канал.
In other words, both links to the same switch must fail for a switch to need to cause STP convergence.|Другими словами, обе ссылки на один и тот же коммутатор должны выйти из строя, чтобы коммутатор мог вызвать конвергенцию STP.
Without EtherChannel, if you have multiple parallel links between two switches, STP blocks all the links except one.|Без EtherChannel, если у вас есть несколько параллельных каналов между двумя коммутаторами, STP блокирует все каналы, кроме одного.
With EtherChannel, all the parallel links can be up and working at the same time, while reducing the number of times STP must converge, which in turn makes the network more available.|С EtherChannel все параллельные каналы могут быть включены и работать одновременно, уменьшая при этом количество раз, когда STP должен сходиться, что, в свою очередь, делает сеть более доступной.
|
Figure 9-12 Two-Segment EtherChannels Between Switches The current CCNA exam blueprint includes a topic for the configuration of both Layer 2 EtherChannels (as described here) as well as Layer 3 EtherChannels.|Рисунок 9-12. Двухсегментные каналы EtherChannels между коммутаторами Текущий план экзамена CCNA включает тему для конфигурации как EtherChannels уровня 2 (как описано здесь), так и EtherChannels уровня 3.
Chapter 10, “RSTP and EtherChannel Configuration,” shows how to configure Layer 2 EtherChannels, while Chapter 17, “IP Routing in the LAN,” shows how to configure Layer 3 EtherChannels.|В главе 10 «Конфигурация RSTP и EtherChannel» показано, как настроить каналы EtherChannels уровня 2, а в главе 17 «IP-маршрутизация в локальной сети» показано, как настроить каналы EtherChannel уровня 3.
Note that Layer 2 EtherChannels combine links that switches use as switch ports, with the switches using Layer 2 switching logic to forward and receive Ethernet frames over the EtherChannels.|Обратите внимание, что каналы EtherChannels уровня 2 объединяют ссылки, которые коммутаторы используют в качестве портов коммутатора, с коммутаторами, использующими логику коммутации уровня 2 для пересылки и приема кадров Ethernet по каналам EtherChannels.
|
Layer 3 EtherChannels also combine links, but the switches use Layer 3 routing logic to forward packets over the EtherChannels.|Каналы EtherChannels уровня 3 также объединяют ссылки, но коммутаторы используют логику маршрутизации уровня 3 для пересылки пакетов по каналам EtherChannels.
##### PortFast
PortFast   
__|__
--|--
|
PortFast allows a switch to immediately transition from blocking to forwarding, bypassing listening and learning states.|PortFast позволяет коммутатору немедленно перейти от блокировки к пересылке, минуя состояния прослушивания и обучения.
However, the only ports on which you can safely enable PortFast are ports on which you know that no bridges, switches, or other STP-speaking devices are connected.|Однако единственные порты, на которых вы можете безопасно включить PortFast, - это порты, к которым вы знаете, что никакие мосты, коммутаторы или другие устройства, говорящие на STP, не подключены.
Otherwise, using PortFast risks creating loops, the very thing that the listening and learning states are intended to avoid.|В противном случае использование PortFast может привести к возникновению петель, как раз того, чего предназначены состояния прослушивания и обучения.
|
PortFast is most appropriate for connections to end-user devices.|PortFast наиболее подходит для подключения к устройствам конечных пользователей.
If you turn on PortFast on ports connected to end-user devices, when an end-user PC boots, the switch port can move to an STP forwarding state and forward traffic as soon as the PC NIC is active.|Если вы включите PortFast на портах, подключенных к устройствам конечных пользователей, при загрузке ПК конечного пользователя порт коммутатора может перейти в состояние пересылки STP и пересылать трафик, как только сетевая карта ПК станет активной.
Without PortFast, each port must wait while the switch confirms that the port is a DP. With STP in particular (and not RSTP), the switch waits in the temporary listening and learning states before settling into the forwarding state.|Без PortFast каждый порт должен ждать, пока коммутатор подтвердит, что порт является DP. В частности, при использовании протокола STP (а не RSTP) коммутатор ожидает во временных состояниях прослушивания и обучения, прежде чем перейти в состояние пересылки.
|
As you might guess from the fact that PortFast speeds convergence, RSTP includes PortFast.|Как вы могли догадаться по тому факту, что PortFast ускоряет сходимость, RSTP включает PortFast.
|
You might recall the mention of RSTP port types, particularly point-to-point edge port types, around Figure 9-11.|Вы, возможно, помните упоминание о типах портов RSTP, особенно о типах граничных портов точка-точка, на рис. 9-11.
RSTP, by design of the protocol, converges quickly on these point-to-point edge type ports by bypassing the learning state, which is the same idea Cisco originally introduced with PortFast.|RSTP, по замыслу протокола, быстро сходится на этих двухточечных граничных портах, обходя состояние обучения, что является той же идеей, которую Cisco изначально представила с PortFast.
In practice, Cisco switches enable RSTP point-to-point edge ports by enabling PortFast on the port.|На практике коммутаторы Cisco включают граничные порты «точка-точка» RSTP путем включения PortFast на порту.
##### BPDU Guard
BPDU Guard   
__|__
--|--
|
STP and RSTP open up the LAN to several different types of possible security exposures.|STP и RSTP открывают LAN для нескольких различных типов возможных угроз безопасности.
|
For example:|Например:
###### An attacker could connect a switch to one of these ports, one with a low STP/RSTP priority
Злоумышленник может подключить коммутатор к одному из этих портов, один с низким приоритетом STP / RSTP.   
__|__
--|--
|
value, and become the root switch.|значение и стать корневым переключателем.
The new STP/RSTP topology could have worse performance than the desired topology.|Новая топология STP / RSTP может иметь худшую производительность, чем желаемая топология.
###### The attacker could plug into multiple ports, into multiple switches, become root, and
Злоумышленник может подключиться к нескольким портам, к нескольким коммутаторам, стать пользователем root и   
__|__
--|--
|
actually forward much of the traffic in the LAN. Without the networking staff realizing it, the attacker could use a LAN analyzer to copy large numbers of data frames sent through the LAN.|фактически пересылает большую часть трафика в LAN. Не осознавая этого сетевой персонал, злоумышленник может использовать анализатор локальной сети для копирования большого количества фреймов данных, отправляемых через локальную сеть.
###### Users could innocently harm the LAN when they buy and connect an inexpensive
Пользователи могут невиновно навредить ЛВС, купив и подключив недорогой   
__|__
--|--
|
consumer LAN switch (one that does not use STP/RSTP). Such a switch, without any STP/RSTP function, would not choose to block any ports and could cause a loop.|потребительский коммутатор LAN (тот, который не использует STP / RSTP). Такой коммутатор без какой-либо функции STP / RSTP не будет блокировать какие-либо порты и может вызвать петлю.
|
The Cisco BPDU Guard feature helps defeat these kinds of problems by disabling a port if any BPDUs are received on the port.|Функция Cisco BPDU Guard помогает справиться с подобными проблемами, отключая порт, если через порт получены какие-либо BPDU.
So, this feature is particularly useful on ports that should be used only as an access port and never connected to another switch.|Таким образом, эта функция особенно полезна для портов, которые следует использовать только как порт доступа и никогда не подключаться к другому коммутатору.
|
In addition, the BPDU Guard feature helps prevent problems with PortFast.|Кроме того, функция BPDU Guard помогает предотвратить проблемы с PortFast.
PortFast should be enabled only on access ports that connect to user devices, not to other LAN switches.|PortFast следует включать только на портах доступа, которые подключаются к пользовательским устройствам, но не к другим коммутаторам LAN.
|
Using BPDU Guard on these same ports makes sense because if another switch connects to such a port, the local switch can disable the port before a loop is created.|Использование BPDU Guard на тех же портах имеет смысл, потому что, если другой коммутатор подключается к такому порту, локальный коммутатор может отключить порт до создания петли.
### Chapter Review
Обзор главы   
__|__
--|--
|
One key to doing well on the exams is to perform repetitive spaced review sessions.|Один из ключей к успешной сдаче экзаменов - повторение повторных сессий с интервалом.
Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.|Просмотрите материал этой главы, используя инструменты из книги или интерактивные инструменты для тех же материалов, которые можно найти на сопутствующем веб-сайте книги.
Refer to the “Your Study Plan” element for more details.|Обратитесь к элементу «Ваш учебный план» для получения более подробной информации.
Table 9-11 outlines the key review elements and where you can find them.|В Таблице 9-11 представлены основные элементы обзора и их местонахождение.
To better track your study progress, record when you completed these activities in the second column.|Чтобы лучше отслеживать свои успехи в учебе, отметьте, когда вы выполнили эти задания, во втором столбце.
|
Table 9-11 Chapter Review Tracking Table end.|Таблица 9-11 Окончание таблицы отслеживания обзора главы.
|
Review All the Key Topics Key Topic Element Description Page Number Key Terms You Should Know blocking state, BPDU Guard, bridge ID, bridge protocol data unit (BPDU), designated port, EtherChannel, forward delay, forwarding state, Hello BPDU, learning state, listening state, MaxAge, PortFast, root port, root switch, root cost, Spanning Tree Protocol (STP), rapid STP (RSTP), alternate port, backup port, disabled port, discarding state|Просмотрите все ключевые темы Ключевая тема Элемент Описание Номер страницы Ключевые термины, которые вы должны знать состояние блокировки, BPDU Guard, идентификатор моста, блок данных протокола моста (BPDU), назначенный порт, EtherChannel, задержка пересылки, состояние пересылки, Hello BPDU, состояние обучения, состояние прослушивания, MaxAge, PortFast, корневой порт, корневой коммутатор, стоимость корня, протокол связующего дерева (STP), быстрый STP (RSTP), альтернативный порт, резервный порт, отключенный порт, состояние отбрасывания
## Chapter 10 RSTP and EtherChannel Configuration
Глава 10 Настройка RSTP и EtherChannel   
__|__
--|--
|
This chapter covers the following exam topics:|В этой главе рассматриваются следующие экзаменационные темы:
###### 2.0 Network Access
2.0 Доступ к сети   
###### 2.4 Configure and verify (Layer 2/Layer 3) EtherChannel (LACP)
2.4 Настройка и проверка (уровень 2 / уровень 3) EtherChannel (LACP)   
###### 2.5 Describe the need for and basic operations of Rapid PVST+ Spanning Tree Protocol
2.5. Опишите необходимость и основные операции Rapid PVST + Spanning Tree Protocol.   
__|__
--|--
|
and identify basic operations|и определить основные операции
###### 2.5.a Root port, root bridge (primary/secondary), and other port names
2.5.a Корневой порт, корневой мост (первичный / вторичный) и другие имена портов.   
###### 2.5.b Port states (forwarding/blocking)
2.5.b Состояния портов (пересылка / блокировка)   
###### 2.5.c PortFast benefits
2.5.c Преимущества PortFast   
__|__
--|--
|
This chapter shows how to configure Rapid Spanning Tree Protocol (RSTP) and Layer 2 EtherChannels.|В этой главе показано, как настроить протокол Rapid Spanning Tree Protocol (RSTP) и EtherChannels уровня 2.
The EtherChannel content, in the second major section of the chapter, follows a typical flow for most configuration/verification topics in a certification guide: it reviews concepts, shows configurations, and provides show commands that point out the configuration settings and operational state.|Содержимое EtherChannel во втором основном разделе главы следует типичной схеме для большинства тем по настройке / проверке в руководстве по сертификации: в нем рассматриваются концепции, отображаются конфигурации и предоставляются команды show, указывающие на параметры конфигурации и рабочее состояние.
The details include how to manually configure a channel, how to cause a switch to dynamically create a channel, and how EtherChannel load distribution works.|Подробности включают в себя, как вручную настроить канал, как заставить коммутатор динамически создавать канал и как работает распределение нагрузки EtherChannel.
|
The first section of the chapter explores RSTP implementation taking a different approach.|В первом разделе главы рассматривается реализация RSTP с использованием другого подхода.
|
Cisco mentions RSTP concepts, but not configuration/verification, in the CCNA exam topics.|Cisco упоминает концепции RSTP, но не упоминает конфигурацию / проверку в темах экзамена CCNA.
|
However, to get a real sense of RSTP concepts, especially some concepts specific to Cisco Catalyst switches, you need to work with RSTP configuration and verification.|Однако, чтобы получить реальное представление о концепциях RSTP, особенно некоторых концепциях, характерных для коммутаторов Cisco Catalyst, вам необходимо работать с настройкой и проверкой RSTP.
The first section of the chapter explores RSTP implementation, but as a means to the end of more fully understanding RSTP concepts.|В первом разделе главы рассматривается реализация RSTP, но как средство для более полного понимания концепций RSTP.
|
For those of you who, like me, probably would want to go ahead and practice configuring RSTP, do some show commands, and understand more fully, you do have some options:|Для тех из вас, кто, как и я, вероятно, захочет продолжить и попрактиковаться в настройке RSTP, выполнить несколько команд show и понять более полно, у вас есть несколько вариантов:
###### Read Appendix O, “Spanning Tree Protocol Implementation,” from this book’s companion
Прочтите Приложение O «Реализация протокола связующего дерева» из сопутствующего материала к этой книге.   
__|__
--|--
|
website.|Веб-сайт.
The appendix is a chapter from the previous edition of this book, with full details of configuration/verification of STP and RSTP.|Приложение представляет собой главу из предыдущего издания этой книги с полными сведениями о настройке / проверке STP и RSTP.
###### Use the STP/RSTP config labs on my blog site (as regularly listed in the Chapter Review
Используйте лабораторные работы по настройке STP / RSTP на моем сайте блога (как регулярно указывается в Обзоре главы   
__|__
--|--
|
section of each chapter).|раздел каждой главы).
### “Do I Know This Already?” Quiz
«Знаю ли я это уже?» Викторина   
__|__
--|--
|
Take the quiz (either here or use the PTP software) if you want to use the score to help you decide how much time to spend on this chapter.|Пройдите тест (здесь или воспользуйтесь программой PTP), если вы хотите использовать оценку, чтобы решить, сколько времени потратить на эту главу.
The letter answers are listed at the bottom of the page following the quiz.|Ответы на письма перечислены внизу страницы после викторины.
Appendix C, found both at the end of the book as well as on the companion website, includes both the answers and explanations.|Приложение C, которое можно найти как в конце книги, так и на сопутствующем веб-сайте, включает как ответы, так и пояснения.
You can also find both answers and explanations in the PTP testing software.|Вы также можете найти ответы и пояснения в программе тестирования PTP.
|
CHAPTER 10 Table 10-1 “Do I Know This Already?” Foundation Topics Section-to-Question Mapping|ГЛАВА 10 Таблица 10-1 «Знаю ли я это уже?» Сопоставление разделов с вопросами по основным темам
### Foundation Topics
Основные темы   
### Understanding RSTP Through Configuration
Понимание RSTP через конфигурацию   
__|__
--|--
|
Implementing EtherChannel 4–6 1.|Внедрение EtherChannel 4–6 1.
Which type value on the spanning-tree mode type global command enables the use of RSTP?|Какое значение типа в глобальной команде типа режима связующего дерева включает использование RSTP?
|
a. rapid-pvst b. pvst c. rstp d. rpvst 2.|а. Rapid-PVST b. pvst c. rstp d. рпвст 2.
Examine the following output from the show spanning-tree vlan 5 command, which describes a root switch in a LAN. Which answers accurately describe facts related to the root’s bridge ID?|Изучите следующие выходные данные команды show spanning-tree vlan 5, в которой описывается корневой коммутатор в локальной сети. Какие ответы точно описывают факты, связанные с идентификатором корневого моста?
|
SW1# show spanning-tree vlan 5 VLAN0005 Spanning tree enabled protocol rstp Root ID Priority 32773 Address 1833.9d7b.0e80 Cost 15 Port 25 (GigabitEthernet0/1)|SW1 # show spanning-tree vlan 5 VLAN0005 Протокол с включенным связующим деревом rstp Root ID Priority 32773 Address 1833.9d7b.0e80 Cost 15 Port 25 (GigabitEthernet0 / 1)
|
Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec a.|Время приветствия 2 секунды Максимальный возраст 20 секунд Задержка пересылки 15 секунд a.
The system ID extension value, in decimal, is 5.|Десятичное значение расширенного идентификатора системы - 5.
|
b. The root’s configured priority value is 32773.|б. Настроенное значение приоритета корня - 32773.
|
c. The root’s configured priority value is 32768.|c. Настроенное значение приоритета корневого каталога - 32768.
|
d. The system ID extension value, in hexadecimal, is 1833.9d7b.0e80.|d. Значение расширения системного идентификатора в шестнадцатеричном формате: 1833.9d7b.0e80.
|
3. With the Cisco RPVST+, which of the following action(s) does a switch take to identify which VLAN is described by a BPDU? (Choose three answers.)|3. Что касается Cisco RPVST +, какое из следующих действий выполняет коммутатор, чтобы определить, какая VLAN описывается BPDU? (Выберите три ответа.)
|
a. Adds a VLAN tag when forwarding a BPDU on trunks b.|а. Добавляет тег VLAN при пересылке BPDU по соединительным линиям b.
Adds the VLAN ID in an extra TLV in the BPDU c.|Добавляет идентификатор VLAN в дополнительный TLV в BPDU c.
Lists the VLAN ID as the middle 12 bits of the System ID field of the BPDU d.|Перечисляет идентификатор VLAN как средние 12 бит поля System ID в BPDU. D.
Lists the VLAN ID in the System ID Extension field of the BPDU 4.|Перечисляет идентификатор VLAN в поле System ID Extension блока BPDU 4.
An engineer configures a switch to put interfaces G0/1 and G0/2 into the same Layer 2 EtherChannel.|Инженер настраивает коммутатор для помещения интерфейсов G0 / 1 и G0 / 2 в один канал EtherChannel уровня 2.
Which of the following terms is used in the configuration commands?|Какие из следующих терминов используются в командах настройки?
|
a. EtherChannel b.|а. EtherChannel б.
PortChannel c.|PortChannel c.
Ethernet-Channel d.|Канал Ethernet d.
Channel-group 5.|Группа каналов 5.
Which combinations of keywords on the channel-group interface subcommand on two neighboring switches will cause the switches to use LACP and attempt to add the link to the EtherChannel? (Choose two answers.)|Какие комбинации ключевых слов в подкоманде интерфейса группы каналов на двух соседних коммутаторах заставят коммутаторы использовать LACP и попытаться добавить ссылку на EtherChannel? (Выберите два ответа.)
|
a. desirable and active b. passive and active c. active and auto d. active and active 6.|а. желанный и активный b. пассивный и активный c. активный и автоматический d. активный и активный 6.
A Cisco Catalyst switch needs to send frames over a Layer 2 EtherChannel.|Коммутатор Cisco Catalyst должен отправлять кадры по каналу EtherChannel уровня 2.
Which answer best describes how the switch balances the traffic over the four active links in the channel?|Какой ответ лучше всего описывает, как коммутатор балансирует трафик по четырем активным ссылкам в канале?
|
a. Breaks each frame into fragments of approximately one-fourth of the original frame, sending one fragment over each link b.|а. Разбивает каждый кадр на фрагменты примерно четвертой части исходного кадра, отправляя один фрагмент по каждой ссылке. B.
Sends the entire frame over one link, alternating links in sequence for each successive frame c.|Посылает весь кадр по одной ссылке, чередуя ссылки последовательно для каждого последующего кадра c.
Sends the entire frame over one link, choosing the link by applying some math to fields in each frame’s headers d.|Посылает весь фрейм по одной ссылке, выбирая ссылку, применяя математические вычисления к полям в заголовках каждого фрейма. D.
Sends the entire frame over one link, using the link with the lowest percent utilization as the next link to use Foundation Topics Understanding RSTP Through Configuration Cisco IOS switches today typically default to using RSTP rather than STP, with default settings so that RSTP works with no configuration.|Отправляет весь кадр по одной ссылке, используя ссылку с наименьшим процентом использования в качестве следующей ссылки для использования основных тем Понимание RSTP через конфигурацию Сегодня коммутаторы Cisco IOS обычно по умолчанию используют RSTP, а не STP, с настройками по умолчанию, так что RSTP работает без конфигурация.
You can buy some Cisco switches and connect them with Ethernet cables in a redundant topology, and RSTP will ensure that frames do not loop.|Вы можете купить несколько коммутаторов Cisco и подключить их с помощью кабелей Ethernet в топологии с резервированием, и RSTP гарантирует, что кадры не зацикливаются.
And even if some switches use RSTP and some use STP, the switches can interoperate and still build a working spanning tree—and you never even have to think about changing any settings!|И даже если некоторые коммутаторы используют RSTP, а некоторые - STP, коммутаторы могут взаимодействовать друг с другом и по-прежнему строить рабочее связующее дерево - и вам даже не придется думать об изменении каких-либо настроек!
|
Although RSTP works without any configuration, most medium-size to large-size campus LANs benefit from some STP configuration.|Хотя RSTP работает без какой-либо конфигурации, большинство кампусных локальных сетей среднего и большого размера выигрывают от некоторой конфигурации STP.
For instance, Figure 10-1 shows a typical LAN design model, with two distribution layer switches (D1 and D2).|Например, на рис. 10-1 показана типовая модель проекта LAN с двумя коммутаторами уровня распределения (D1 и D2).
The design may have dozens of access layer switches that connect to end users; the figure shows just three access switches (A1, A2, and A3).|В проекте могут быть десятки переключателей уровня доступа, которые подключаются к конечным пользователям; на рисунке показаны всего три переключателя доступа (A1, A2 и A3).
For a variety of reasons, most network engineers make the distribution layer switches be the root.|По ряду причин большинство сетевых инженеров делают коммутаторы уровня распределения корневыми.
|
Figure 10-1 Typical Configuration Choice: Making Distribution Switch Be Root NOTE Cisco uses the term access switch to refer to switches used to connect to endpoint devices.|Рисунок 10-1 Типичный выбор конфигурации: создание коммутатора распределения как корневого ПРИМЕЧАНИЕ Cisco использует термин коммутатор доступа для обозначения коммутаторов, используемых для подключения к оконечным устройствам.
The term distribution switch refers to switches that do not connect to endpoints but rather connect to each access switch, providing a means to distribute frames throughout the LAN. If you want to read more about LAN design concepts and terms, refer to this book’s companion website for Appendix K, “Analyzing Ethernet LAN Designs.”|Термин «коммутатор распределения» относится к коммутаторам, которые не подключаются к конечным точкам, а подключаются к каждому коммутатору доступа, обеспечивая средства для распределения кадров по локальной сети. Если вы хотите узнать больше о концепциях и терминах проектирования ЛВС, обратитесь к сопутствующему веб-сайту этой книги, где вы найдете Приложение K, «Анализ проектов ЛВС Ethernet».
|
As discussed in the introduction to this chapter, this first section of the chapter examines a variety of STP/RSTP configuration topics, but with a goal of revealing a few more details about how STP and RSTP operate.|Как обсуждалось во введении к этой главе, в этом первом разделе главы рассматриваются различные темы конфигурации STP / RSTP, но с целью раскрыть еще несколько деталей о том, как работают STP и RSTP.
Following this opening section about RSTP configuration, the next section examines how to configure Layer 2 EtherChannels, and how that impacts STP/RSTP.|После этого вводного раздела о конфигурации RSTP в следующем разделе рассматривается, как настроить каналы EtherChannels уровня 2 и как это влияет на STP / RSTP.
#### The Need for Multiple Spanning Trees
Потребность в нескольких связующих деревьях   
__|__
--|--
|
The IEEE first standardized STP as the IEEE 802.1D standard, first published back in 1990.|IEEE впервые стандартизировал STP как стандарт IEEE 802.1D, впервые опубликованный еще в 1990 году.
|
To put some perspective on that date, Cisco did not have a LAN switch product line at the time, and virtual LANs did not exist yet.|Чтобы заглянуть в ту дату, у Cisco в то время не было линейки коммутаторов LAN, а виртуальные LAN еще не существовали.
Instead of multiple VLANs in a physical Ethernet LAN, the physical Ethernet LAN existed as one single broadcast domain, with one instance of STP.|Вместо нескольких VLAN в физической локальной сети Ethernet физическая локальная сеть Ethernet существовала как один широковещательный домен с одним экземпляром STP.
|
By the mid 1990s, VLANs had appeared on the scene, along with LAN switches.|К середине 1990-х годов на сцене появились сети VLAN и коммутаторы LAN.
The emergence of VLANs posed a challenge for STP—the only type of STP available at the time—|Появление сетей VLAN стало проблемой для STP - единственного доступного в то время типа STP -
|
because STP defined a single common spanning tree (CST) topology for the entire LAN. The IEEE needed an option to create multiple spanning trees so that traffic could be balanced across the available links, as shown in Figure 10-2.|потому что STP определил единую топологию общего связующего дерева (CST) для всей локальной сети. IEEE требовалась возможность создания нескольких связующих деревьев, чтобы трафик мог быть сбалансирован по доступным каналам, как показано на рисунке 10-2.
With two different STP instances, SW3 could block on a different interface in each VLAN, as shown in the figure.|С двумя разными экземплярами STP SW3 может блокироваться на разных интерфейсах в каждой VLAN, как показано на рисунке.
|
Figure 10-2 Load Balancing with One Tree for VLAN 1 and Another for VLAN 2|Рисунок 10-2 Балансировка нагрузки с одним деревом для VLAN 1 и другим для VLAN 2
#### STP Modes and Standards
Режимы и стандарты STP   
__|__
--|--
|
Because of the sequence of events over the history of the various STP family of protocols, vendors like Cisco needed to create their own proprietary features to create the per-VLAN spanning tree concept shown in Figure 10-2.|Из-за последовательности событий в истории различных семейств протоколов STP, таким поставщикам, как Cisco, потребовалось создать свои собственные проприетарные функции для создания концепции связующего дерева для каждой VLAN, показанной на рисунке 10-2.
That sequence resulted in the following:|Эта последовательность привела к следующему:
###### When STP was the only STP standard back in the 1990s with 802.1D, Cisco created the
Когда в 1990-х годах STP был единственным стандартом STP с 802.1D, Cisco создала   
__|__
--|--
|
STP-based Per VLAN Spanning Tree Plus (PVST+) protocol, which creates one spanning tree instance per VLAN.|Протокол STP Per VLAN Spanning Tree Plus (PVST +), который создает один экземпляр связующего дерева для каждой VLAN.
###### When the IEEE introduced RSTP (in 802.1D amendment 802.1w, in the year 2001), Cisco
Когда IEEE представил RSTP (в поправке 802.1D 802.1w в 2001 году), Cisco   
__|__
--|--
|
also created the Rapid PVST+ (RPVST+) protocol.|также создал протокол Rapid PVST + (RPVST +).
RPVST+ provided more features than standardized RSTP, including one tree per VLAN.|RPVST + предоставляет больше функций, чем стандартизированный RSTP, включая одно дерево на каждую VLAN.
###### The IEEE did not adopt Cisco’s PVST+ or RPVST+ into their standards to create multiple
IEEE не включил Cisco PVST + или RPVST + в свои стандарты для создания нескольких   
__|__
--|--
|
spanning trees.|остовные деревья.
Instead, the IEEE created a different method: Multiple Spanning Tree Protocol (MSTP), originally defined in 802.1Q amendment 802.1s.|Вместо этого IEEE создал другой метод: протокол множественного связующего дерева (MSTP), первоначально определенный в поправке 802.1Q 802.1s.
|
Figure 10-3 shows the features as a timeline for perspective.|Рисунок 10-3 показывает особенности в виде временной шкалы для перспективы.
|
Figure 10-3 Timeline of Per-VLAN and Multiple STP Features Today, Cisco Catalyst switches give us three options to configure on the spanning-tree mode command, which tells the switch which type of STP to use.|Рис. 10-3. Временная шкала для каждой VLAN и нескольких функций STP Сегодня коммутаторы Cisco Catalyst предоставляют нам три варианта настройки в команде режима связующего дерева, которая сообщает коммутатору, какой тип STP использовать.
Note that the switches do not support STP or RSTP with the single tree (CST). They can use either the Ciscoproprietary and STP-based PVST+, Cisco-proprietary and RSTP-based RPVST+, or the IEEE standard MSTP. Table 10-2 summarizes some of the facts about these standards and options, Answers to the “Do I Know This Already?” quiz:|Обратите внимание, что коммутаторы не поддерживают STP или RSTP с одним деревом (CST). Они могут использовать собственный протокол Cisco PVST + на основе STP, собственный протокол Cisco и протокол RPVST + на основе RSTP или стандарт MSTP IEEE. В Таблице 10-2 приведены некоторые факты об этих стандартах и ??вариантах, ответы на вопрос «Знаю ли я это уже?» викторина:
|
1 A 2 A, C 3 A, B, D 4 D 5 B, D 6 C along with the keywords used on the spanning-tree mode global configuration command.|1 A 2 A, C 3 A, B, D 4 D 5 B, D 6 C вместе с ключевыми словами, используемыми в команде глобальной конфигурации режима связующего дерева.
|
Example 10-1, which follows, shows the command options in global configuration mode.|В следующем примере 10-1 показаны параметры команды в режиме глобальной конфигурации.
|
Table 10-2 STP Standards and Configuration Options Table end.|Таблица 10-2 Стандарты STP и варианты конфигурации Конец таблицы.
|
1 MSTP allows the definition of as many instances (multiple spanning tree instances, or MSTIs) as chosen by the network designer but does not require one per VLAN.|1 MSTP позволяет определять столько экземпляров (несколько экземпляров связующего дерева или MSTI), сколько выбрано разработчиком сети, но не требует по одному на каждую VLAN.
|
Example 10-1 STP Status with Default STP Parameters on SW1 and SW2 Example end.|Пример 10-1 Состояние STP с параметрами STP по умолчанию на переключателях SW1 и SW2 Конец примера.
#### The Bridge ID and System ID Extension
Идентификатор моста и расширение идентификатора системы   
__|__
--|--
|
To support the idea of multiple spanning trees, whether one per VLAN or simply multiple as created with MSTP, the protocols must consider the VLANs and VLAN trunking. (That’s one reason why RSTP and MSTP now exist as part of the 802.1Q standard, which defines VLANs and VLAN trunking.) To help make that work, the IEEE redefined the format of the original BID value to help make per-VLAN instances of STP/RSTP become a reality.|Для поддержки идеи нескольких покрывающих деревьев, будь то одно на каждую VLAN или просто несколько, созданных с помощью MSTP, протоколы должны учитывать VLAN и транкинг VLAN. (Это одна из причин, почему RSTP и MSTP теперь существуют как часть стандарта 802.1Q, который определяет сети VLAN и транкинг VLAN.) Чтобы помочь этой работе, IEEE переопределил формат исходного значения BID, чтобы помочь создать экземпляры для каждой VLAN STP / RSTP становятся реальностью.
|
Originally, a switch’s BID was formed by combining the switch’s 2-byte priority and its 6-byte MAC address.|Первоначально BID коммутатора был сформирован путем объединения 2-байтового приоритета коммутатора и его 6-байтового MAC-адреса.
The revised rules divide the original priority field into two separate fields, as shown in Figure 10-4: a 4-bit priority field and a 12-bit subfield called the system ID extension (which represents the VLAN ID).|В пересмотренных правилах исходное поле приоритета делится на два отдельных поля, как показано на рисунке 10-4: 4-битное поле приоритета и 12-битное подполе, называемое расширением идентификатора системы (которое представляет идентификатор VLAN).
|
Figure 10-4 STP System ID Extension Cisco switches let you configure the BID, but only the priority part.|Рисунок 10-4 Расширение идентификатора системы STP Коммутаторы Cisco позволяют настраивать BID, но только его приоритетную часть.
The switch fills in its universal (burned-in) MAC address as the system ID. It also plugs in the VLAN ID of a VLAN in the 12-bit system ID extension field; you cannot change that behavior either.|Коммутатор подставляет свой универсальный (записанный) MAC-адрес в качестве идентификатора системы. Он также вставляет идентификатор VLAN для VLAN в 12-битное поле расширения идентификатора системы; вы также не можете изменить это поведение.
The only part configurable by the network engineer is the 4-bit priority field.|Единственная часть, которую может настроить сетевой инженер, - это 4-битное поле приоритета.
|
However, configuring the number to put in the priority field may be one of the strangest things to configure on a Cisco router or switch.|Однако настройка числа для ввода в поле приоритета может быть одной из самых странных вещей для настройки на маршрутизаторе или коммутаторе Cisco.
As shown at the top of Figure 10-4, the priority field was originally a 16-bit number, which represented a decimal number from 0 to 65,535.|Как показано в верхней части рисунка 10-4, поле приоритета изначально было 16-битным числом, которое представляло десятичное число от 0 до 65 535.
Because of that history, the configuration command (spanning-tree vlan vlan-id priority x) requires a decimal number between 0 and 65,535.|Из-за этой истории команда настройки (связующее дерево vlan vlan-id приоритет x) требует десятичного числа от 0 до 65 535.
But not just any number in that range will suffice; it must be a multiple of 4096, as emphasized in the help text shown in Example 10-2.|Но не просто любое число в этом диапазоне будет достаточно; он должен быть кратным 4096, как подчеркивается в тексте справки, показанном в примере 10-2.
|
Example 10-2 Help Shows Requirements for Using Increments of 4096 for Priority Example end.|Пример 10-2 Справка показывает требования для использования приращения 4096 для конца примера приоритета.
|
Table 10-3 lists all the configurable values for the STP/RSTP priority.|В Табл. 10-3 перечислены все настраиваемые значения приоритета STP / RSTP.
However, do not worry about memorizing the values.|Однако не беспокойтесь о запоминании значений.
Instead, the table lists the values to emphasize two points about the binary values: the first 4 bits in each value differ, but the last 12 bits remain as 12 binary zeros.|Вместо этого в таблице перечислены значения, чтобы подчеркнуть два момента о двоичных значениях: первые 4 бита в каждом значении различаются, но последние 12 бит остаются как 12 двоичных нулей.
|
Table 10-3 STP/RSTP Configurable Priority Values Table end.|Таблица 10-3. Конфигурируемые значения приоритета STP / RSTP. Конец таблицы.
|
Note that while you can set the priority to any of the 16 decimal values in Table 10-3, Cisco provides a convenient means to create a primary and secondary root switch concept without configuring an actual number.|Обратите внимание, что, хотя вы можете установить приоритет на любое из 16 десятичных значений в Таблице 10-3, Cisco предоставляет удобные средства для создания концепции первичного и вторичного корневого коммутатора без настройки фактического числа.
In most LAN designs, only a small number of switches would be good candidates to ever be the root switch based on where the switches sit within the topology.|В большинстве проектов ЛВС только небольшое количество коммутаторов будет подходящими кандидатами на роль корневого коммутатора в зависимости от того, где коммутаторы находятся в топологии.
Think of the preferred switch as the primary switch and the next-best option as the secondary switch.|Считайте предпочтительный коммутатор первичным коммутатором, а следующий лучший вариант - вторичным коммутатором.
Then, to configure those two switches to be the two most likely switches to be the root switch, simply configure spanning-tree vlan x root primary (on the switch that should be primary)|Затем, чтобы настроить эти два коммутатора как два наиболее вероятных коммутатора в качестве корневого коммутатора, просто настройте связующее дерево vlan x root primary (на коммутаторе, который должен быть основным)
|
spanning-tree vlan x root secondary (on the switch that should be secondary)|Spanning-tree vlan x root вторичный (на коммутаторе, который должен быть вторичным)
|
These two commands cause the switch to make a choice of priority value but then store the chosen priority value in the spanning-tree vlan x priority value command.|Эти две команды заставляют коммутатор выбрать значение приоритета, но затем сохранить выбранное значение приоритета в команде spanning-tree vlan x priority value.
The command with root primary or root secondary does not appear in the configuration.|Команда с корневым первичным или корневым вторичным не отображается в конфигурации.
When configuring root primary, the switch looks at the priority of the current root switch and chooses either (a) 24,576 or (b) 4096 less than the current root’s priority (if the current root’s priority is 24,576 or less) to the configuration instead.|При настройке основного корневого коммутатора коммутатор смотрит на приоритет текущего корневого коммутатора и вместо этого выбирает для конфигурации (a) 24 576 или (b) на 4096 меньше, чем приоритет текущего корневого (если приоритет текущего корня равен 24 576 или меньше).
When configuring, root secondary always results in that switch using a priority of 28,672, with the assumption that the value will be less than other switches that use the default of 32,768, and higher than any switch configured as root primary.|При настройке корневой вторичный всегда приводит к тому, что этот коммутатор использует приоритет 28 672, с предположением, что это значение будет меньше, чем у других коммутаторов, которые используют значение по умолчанию 32 768, и выше, чем у любого коммутатора, настроенного как корневой первичный.
#### How Switches Use the Priority and System ID Extension
Как коммутаторы используют расширение Priority и System ID   
__|__
--|--
|
Cisco Catalyst switches configure the priority value using a number that represents a 16-bit value; however, the system ID extension exists as the low-order 12 bits of that same number.|Коммутаторы Cisco Catalyst настраивают значение приоритета с помощью числа, представляющего 16-битное значение; однако расширение системного идентификатора существует как младшие 12 бит того же номера.
|
This next topic works through connecting those ideas.|В следующей теме мы объединяем эти идеи.
|
When the switch builds its BID to use for RSTP in a VLAN, it must combine the configured priority with the VLAN ID of that VLAN. Interestingly, the configured priority results in a 16-bit priority that always ends with 12 binary 0s.|Когда коммутатор создает свой BID для использования для RSTP в VLAN, он должен объединить настроенный приоритет с идентификатором VLAN этой VLAN. Интересно, что сконфигурированный приоритет приводит к 16-битному приоритету, который всегда заканчивается 12 двоичными нулями.
That fact makes the process of combining values to create the BID a little simpler for the switch and possibly a little simpler for network engineers once you understand it all.|Этот факт делает процесс объединения значений для создания BID немного проще для коммутатора и, возможно, немного проще для сетевых инженеров, если вы все это понимаете.
|
First, consider the process shown in Figure 10-5.|Сначала рассмотрим процесс, показанный на рис. 10-5.
The top shows the configured priority value (decimal 32768), in 16-bit binary form, with a System ID Extension of 12 zeros.|Вверху показано настроенное значение приоритета (десятичное 32768) в 16-битной двоичной форме с расширением идентификатора системы из 12 нулей.
|
Moving down the figure, you see the binary version of a VLAN ID (decimal 9).|Двигаясь вниз по рисунку, вы видите двоичную версию идентификатора VLAN (десятичное число 9).
At the last step, the switch replaces those last 12 bits of the System ID Extension with the value that matches the VLAN ID and uses that value as the first 16 bits of the BID.|На последнем шаге коммутатор заменяет эти последние 12 бит расширения идентификатора системы значением, которое соответствует идентификатору VLAN, и использует это значение в качестве первых 16 бит идентификатора BID.
|
Figure 10-5 Configured Priority (16-Bit) and System ID Extension (12-Bit) Added As it turns out, the process shown in Figure 10-5 is just the sum of the two numbers—both in binary and decimal.|Рис. 10-5. Добавлен настроенный приоритет (16-разрядный) и расширение идентификатора системы (12-разрядное). Как оказалось, процесс, показанный на рис. 10-5, представляет собой просто сумму двух чисел - как в двоичном, так и в десятичном виде.
To see an example, refer to upcoming Example 10-3, which demonstrates the following details:|Чтобы увидеть пример, обратитесь к следующему примеру 10-3, который демонстрирует следующие детали:
###### The output shows details about VLAN 9.
Вывод показывает подробную информацию о VLAN 9.   
###### The root switch has been configured with the spanning-tree vlan 9 priority 24576
Корневой коммутатор был настроен с приоритетом связующего дерева vlan 9 24576   
__|__
--|--
|
command.|команда.
###### The local switch (the switch on which the command was gathered) has been configured
Локальный коммутатор (коммутатор, на котором была собрана команда) настроен   
__|__
--|--
|
with the spanning-tree vlan 9 priority 32768 command.|с помощью команды spanning-tree vlan 9 priority 32768.
###### Conveniently, the decimal equivalent of the two switches’ first 16 bits—the original
Для удобства десятичный эквивалент первых 16 бит двух переключателей - исходный   
__|__
--|--
|
16-bit priority field—can be easily calculated in decimal.|16-битное поле приоритета - легко вычисляется в десятичном виде.
In this example:|В этом примере:
###### Root Switch: 24,576 (priority) + 9 (VLAN ID) = 24585
Корневой коммутатор: 24 576 (приоритет) + 9 (идентификатор VLAN) = 24585   
###### Local Switch: 32,768 (priority) + 9 (VLAN ID) = 32777
Локальный коммутатор: 32768 (приоритет) + 9 (VLAN ID) = 32777   
__|__
--|--
|
The output in Example 10-3 matches this logic.|Вывод в Примере 10-3 соответствует этой логике.
The top highlight shows the priority of the root switch (24585), which is the sum of the root switch’s priority setting (configured as 24,576) plus 9 for the VLAN ID. The second highlight shows a value of 32,777, calculated as the local switch’s priority setting of 32,768 plus 9 for the VLAN ID.|Верхнее выделение показывает приоритет корневого коммутатора (24585), который представляет собой сумму настройки приоритета корневого коммутатора (настроенной как 24 576) плюс 9 для идентификатора VLAN. Второе выделение показывает значение 32 777, рассчитанное как значение приоритета локального коммутатора 32 768 плюс 9 для идентификатора VLAN.
|
Example 10-3 Examining the 16-bit Priority as Interpreted in Cisco show Commands Example end.|Пример 10-3. Проверка 16-битного приоритета, интерпретированного в командах Cisco show. Пример конец.
#### RSTP Methods to Support Multiple Spanning Trees
Методы RSTP для поддержки нескольких связующих деревьев   
__|__
--|--
|
Although the history and configuration might make the BID priority idea seem a bit convoluted, having an extra 12-bit field in the BID works well in practice because it can be used to identify the VLAN ID. VLAN IDs range from 1 to 4094, requiring 12 bits.|Хотя история и конфигурация могут сделать идею приоритета BID немного запутанной, наличие дополнительного 12-битного поля в BID на практике хорошо работает, поскольку его можно использовать для идентификации идентификатора VLAN. Идентификаторы VLAN варьируются от 1 до 4094, требуя 12 бит.
|
For the purposes of discussion, focus on the standard RSTP and its Cisco-proprietary cousin RPVST+. Both use the RSTP mechanisms as discussed in Chapter 9, “Spanning Tree Protocol Concepts,” but RPVST+ uses the mechanisms for every VLAN, while standard RSTP does not.|В целях обсуждения сосредоточьтесь на стандартном RSTP и его проприетарном родственнике Cisco RPVST +. Оба используют механизмы RSTP, как описано в главе 9 «Принципы протокола связующего дерева», но RPVST + использует механизмы для каждой VLAN, а стандартный RSTP - нет.
So how do their methods differ?|Так чем же отличаются их методы?
###### RSTP creates one tree—the Common Spanning Tree (CST)—while RPVST+ creates one
RSTP создает одно дерево - Common Spanning Tree (CST), а RPVST + создает одно   
__|__
--|--
|
tree for each and every VLAN.|дерево для каждой VLAN.
###### RSTP sends one set of RSTP messages (BPDUs) in the network, no matter the number of
RSTP отправляет один набор сообщений RSTP (BPDU) в сети, независимо от количества   
__|__
--|--
|
VLANs, while RPVST+ sends one set of messages per VLAN.|VLAN, а RPVST + отправляет один набор сообщений для каждой VLAN.
###### RSTP and RPVST+ use different destination MAC addresses: RSTP with multicast address
RSTP и RPVST + используют разные MAC-адреса назначения: RSTP с многоадресным адресом   
__|__
--|--
|
0180.C200.0000 (an address defined in the IEEE standard), and RPVST+ with multicast address 0100.0CCC.CCCD (an address chosen by Cisco).|0180.C200.0000 (адрес, определенный в стандарте IEEE) и RPVST + с многоадресным адресом 0100.0CCC.CCCD (адрес, выбранный Cisco).
###### When transmitting messages on VLAN trunks, RSTP sends the messages in the native
При передаче сообщений по магистральным каналам VLAN RSTP отправляет сообщения в собственном   
__|__
--|--
|
VLAN with no VLAN header/tag.|VLAN без заголовка / тега VLAN.
RPVST+ sends each VLAN’s messages inside that VLAN—for instance, BPDUs about VLAN 9 have an 802.1Q header that lists VLAN 9.|RPVST + отправляет сообщения каждой VLAN внутри этой VLAN - например, BPDU о VLAN 9 имеют заголовок 802.1Q, в котором перечислены VLAN 9.
###### RPVST+ adds an extra type-length value (TLV) to the BPDU that identifies the VLAN ID,
RPVST + добавляет дополнительное значение длины типа (TLV) к BPDU, которое идентифицирует идентификатор VLAN,   
__|__
--|--
|
while RSTP does not (because it does not need to, as RSTP ignores VLANs.)|в то время как RSTP этого не делает (потому что в этом нет необходимости, поскольку RSTP игнорирует VLAN).
###### Both view the 16-bit priority as having a 12-bit System ID Extension, with RSTP setting
Оба рассматривают 16-битный приоритет как имеющий 12-битное расширение идентификатора системы с настройкой RSTP.   
__|__
--|--
|
the value to 0000.0000.0000, meaning “no VLAN,” while RPVST+ uses the VLAN ID.|значение 0000.0000.0000, что означает «без VLAN», а RPVST + использует идентификатор VLAN.
|
In other words, standard RSTP behaves as if VLANs do not exist, while Cisco’s RPVST+ integrates VLAN information into the entire process.|Другими словами, стандартный RSTP ведет себя так, как будто виртуальных локальных сетей не существует, тогда как Cisco RPVST + интегрирует информацию о виртуальных локальных сетях во весь процесс.
|
NOTE Some documents refer to the feature of sending BPDUs over trunks with VLAN tags matching the same VLAN as BPDU tunneling.|ПРИМЕЧАНИЕ В некоторых документах упоминается функция отправки BPDU по магистралям с тегами VLAN, соответствующими той же VLAN, что и туннелирование BPDU.
#### Other RSTP Configuration Options
Другие параметры конфигурации RSTP   
__|__
--|--
|
This chapter does not attempt to work through all the configuration options available for RSTP. However, many of the configuration settings may be intuitive now that you know quite a bit about the protocol.|В этой главе не рассматриваются все варианты конфигурации, доступные для RSTP. Однако теперь, когда вы немного знаете о протоколе, многие параметры конфигурации могут быть интуитивно понятными.
This final topic in the first section of the chapter summarizes a few of the configuration concepts.|В этом заключительном разделе первого раздела главы кратко излагаются некоторые концепции конфигурации.
As a reminder, for those interested in continuing on to CCNP Enterprise, you might be interested in reading more about RSTP configuration in the companion website’s Appendix O, “Spanning Tree Protocol Implementation.”|Напоминаем, что для тех, кто хочет продолжить работу с CCNP Enterprise, вам может быть интересно узнать больше о конфигурации RSTP в Приложении O сопутствующего веб-сайта «Реализация протокола связующего дерева».
###### Switch Priority: The global command spanning-tree vlan x priority y lets an engineer
Switch Priority: глобальная команда spanning-tree vlan x priority y позволяет инженеру   
__|__
--|--
|
set the switch’s priority in that VLAN.|установить приоритет коммутатора в этой VLAN.
###### Primary and Secondary Root Switches: The global command spanning-tree vlan x root
Первичный и вторичный корневые коммутаторы: глобальная команда spanning-tree vlan x root   
__|__
--|--
|
primary | secondary also lets you set the priority, but the switch decides on a value to make that switch likely to be the primary root switch (the root) or the secondary root switch (the switch that becomes root if the primary fails).|первичный | вторичный также позволяет вам установить приоритет, но коммутатор выбирает значение, чтобы этот коммутатор мог быть первичным корневым коммутатором (корнем) или вторичным корневым коммутатором (коммутатор, который становится корневым в случае отказа основного).
###### Port Costs: The interface subcommand spanning-tree [vlan x] cost y lets an engineer
Стоимость порта: интерфейсная подкоманда spanning-tree [vlan x] cost y позволяет инженеру   
__|__
--|--
|
set the switch’s STP/RSTP cost on that port, either for all VLANs or for a specific VLAN on that port.|установить стоимость STP / RSTP коммутатора для этого порта либо для всех VLAN, либо для конкретной VLAN на этом порту.
Changing those costs then changes the root cost for some switches, which impacts the choice of root ports and designated ports.|При изменении этих затрат изменяется стоимость корня для некоторых коммутаторов, что влияет на выбор корневых портов и назначенных портов.
|
That concludes this chapter’s examination of RSTP configuration—now on to Layer 2 EtherChannel!|На этом мы завершаем рассмотрение конфигурации RSTP в этой главе - теперь перейдем к EtherChannel уровня 2!
### Configuring Layer 2 EtherChannel
Настройка EtherChannel уровня 2   
__|__
--|--
|
As introduced in Chapter 9, two neighboring switches can treat multiple parallel links between each other as a single logical link called an EtherChannel.|Как было сказано в главе 9, два соседних коммутатора могут рассматривать несколько параллельных каналов между собой как один логический канал, называемый EtherChannel.
Without EtherChannel, a switch treats each physical port as an independent port, applying MAC learning, forwarding, and STP logic per physical port.|Без EtherChannel коммутатор рассматривает каждый физический порт как независимый порт, применяя изучение MAC, пересылку и логику STP для каждого физического порта.
With EtherChannel, the switch applies all those same processes to a group of physical ports as one entity: the EtherChannel.|С EtherChannel коммутатор применяет все те же процессы к группе физических портов как к одному объекту: EtherChannel.
Without EtherChannel, with parallel links between two switches, STP/RSTP would block all links except one, but with EtherChannel, the switch can use all the links, load balancing the traffic over the links.|Без EtherChannel при параллельных каналах между двумя коммутаторами STP / RSTP блокировал бы все ссылки, кроме одного, но с EtherChannel коммутатор может использовать все каналы, балансируя нагрузку на трафик по каналам.
|
NOTE All references to EtherChannel in this chapter refer to Layer 2 EtherChannels, not to Layer 3 EtherChannels (as discussed in Chapter 17, “IP Routing in the LAN”).|ПРИМЕЧАНИЕ Все ссылки на EtherChannel в этой главе относятся к EtherChannel уровня 2, а не к EtherChannels уровня 3 (как описано в главе 17, «IP-маршрутизация в локальной сети»).
CCNA 200-301 exam topics include both Layer 2 and Layer 3 EtherChannels.|Темы экзамена CCNA 200-301 включают в себя каналы EtherChannels уровня 2 и уровня 3.
|
EtherChannel may be one of the most challenging switch features to make work.|EtherChannel может быть одной из самых сложных функций коммутатора для работы.
First, the configuration has several options, so you have to remember the details of which options work together.|Во-первых, у конфигурации есть несколько опций, поэтому вы должны запомнить детали, какие опции работают вместе.
Second, the switches also require a variety of other interface settings to match among all the links in the channel, so you have to know those settings as well.|Во-вторых, для переключателей также требуется множество других настроек интерфейса, чтобы соответствовать всем ссылкам в канале, поэтому вы также должны знать эти настройки.
|
This section shows how to configure a Layer 2 EtherChannel, first through manual (static)|В этом разделе показано, как настроить канал EtherChannel уровня 2, сначала вручную (статический).
|
configuration, and then by allowing dynamic protocols to create the channel.|конфигурации, а затем разрешив динамическим протоколам создать канал.
This section closes with some information about some common configuration issues that occur with Layer 2 EtherChannels.|В конце этого раздела приводится некоторая информация о некоторых типичных проблемах конфигурации, которые возникают с EtherChannels уровня 2.
#### Configuring a Manual Layer 2 EtherChannel
Настройка EtherChannel уровня 2 вручную   
__|__
--|--
|
To configure a Layer 2 EtherChannel so that all the ports always attempt to be part of the channel, simply add the correct channel-group configuration command to each physical interface, on each switch, all with the on keyword, and all with the same number.|Чтобы настроить канал EtherChannel уровня 2 таким образом, чтобы все порты всегда пытались быть частью канала, просто добавьте правильную команду настройки группы каналов к каждому физическому интерфейсу, на каждом коммутаторе, все с ключевым словом on и все с одинаковым номером. .
The on keyword tells the switches to place a physical interface into an EtherChannel, and the number identifies the PortChannel interface number that the interface should be a part of.|Ключевое слово on сообщает коммутаторам о необходимости размещения физического интерфейса в EtherChannel, а число определяет номер интерфейса PortChannel, частью которого должен быть интерфейс.
|
Before getting into the configuration and verification, however, you need to start using three terms as synonyms: EtherChannel, PortChannel, and Channel-group.|Однако перед тем, как приступить к настройке и проверке, вам необходимо начать использовать три термина как синонимы: EtherChannel, PortChannel и Channel-group.
Oddly, IOS uses the channel-group configuration command, but then to display its status, IOS uses the show etherchannel command.|Как ни странно, IOS использует команду настройки группы каналов, но затем для отображения своего статуса IOS использует команду show etherchannel.
Then the output of this show command refers to neither an “EtherChannel” nor a “Channel-group,” instead using the term “PortChannel.” So, pay close attention to these three terms in the example.|Тогда выходные данные этой команды show не относятся ни к «EtherChannel», ни к «группе каналов», вместо этого используется термин «PortChannel». Итак, обратите внимание на эти три термина в примере.
|
To configure an EtherChannel manually, follow these steps:|Чтобы настроить EtherChannel вручную, выполните следующие действия:
|
Step 1.|Шаг 1.
Add the channel-group number mode on command in interface configuration mode under each physical interface that should be in the channel to add it to the channel.|Добавьте режим номера группы каналов по команде в режиме конфигурации интерфейса для каждого физического интерфейса, который должен быть в канале, чтобы добавить его в канал.
|
Step 2.|Шаг 2.
Use the same number for all commands on the same switch, but the channelgroup number on the neighboring switch can differ.|Используйте один и тот же номер для всех команд на одном коммутаторе, но номер группы каналов на соседнем коммутаторе может отличаться.
|
Example 10-4 shows a simple example, with two links between switches SW1 and SW2, as shown in Figure 10-6.|В примере 10-4 показан простой пример с двумя связями между переключателями SW1 и SW2, как показано на рисунке 10-6.
The configuration shows SW1’s two interfaces placed into channelgroup 1, with two show commands to follow.|Конфигурация показывает два интерфейса SW1, помещенных в группу каналов 1, с двумя последующими командами show.
|
Figure 10-6 Sample LAN Used in EtherChannel Example Example 10-4 Configuring and Monitoring EtherChannel Example end.|Рисунок 10-6 Пример LAN, используемой в EtherChannel Пример Пример 10-4 Настройка и мониторинг EtherChannel Пример конец.
|
Take a few moments to look at the output in the two show commands in the example, as well.|Уделите несколько минут, чтобы взглянуть на результат двух команд show в примере.
First, the show spanning-tree command lists Po1, short for PortChannel1, as an interface.|Во-первых, команда show spanning-tree перечисляет Po1, сокращение от PortChannel1, в качестве интерфейса.
This interface exists because of the channel-group commands using the 1 parameter.|Этот интерфейс существует из-за команд группы каналов, использующих параметр 1.
STP no longer operates on physical interfaces Fa0/14 and Fa0/15, instead operating on the PortChannel1 interface, so only that interface is listed in the output.|STP больше не работает на физических интерфейсах Fa0 / 14 и Fa0 / 15, вместо этого работает на интерфейсе PortChannel1, поэтому в выходных данных отображается только этот интерфейс.
|
Next, note the output of the show etherchannel 1 summary command.|Затем обратите внимание на результат команды show etherchannel 1 summary.
It lists as a heading “Port-channel,” with Po1 below it.|В нем указан заголовок «Порт-канал» с Po1 под ним.
It also lists both Fa0/14 and Fa0/15 in the list of ports, with a (P) beside each.|Он также перечисляет Fa0 / 14 и Fa0 / 15 в списке портов с символом (P) рядом с каждым.
Per the legend, the P means that the ports are bundled in the port channel, which is a code that means these ports have passed all the configuration checks and are valid to be included in the channel.|Согласно легенде, P означает, что порты связаны в канал порта, что означает, что эти порты прошли все проверки конфигурации и могут быть включены в канал.
#### Configuring Dynamic EtherChannels
Настройка динамических каналов EtherChannels   
__|__
--|--
|
In addition to manual configuration, Cisco switches also support two different configuration options that then use a dynamic protocol to negotiate whether a particular link becomes part of an EtherChannel or not.|В дополнение к ручной настройке коммутаторы Cisco также поддерживают два разных варианта конфигурации, которые затем используют динамический протокол для согласования того, становится ли конкретный канал частью EtherChannel или нет.
Basically, the configuration enables a protocol for a particular channel-group number.|По сути, конфигурация включает протокол для определенного номера группы каналов.
At that point, the switch can use the protocol to send messages to/from the neighboring switch and discover whether their configuration settings pass all checks.|В этот момент коммутатор может использовать протокол для отправки сообщений на / от соседнего коммутатора и определять, прошли ли его параметры конфигурации все проверки.
If a given physical link passes, the link is added to the EtherChannel and used; if not, it is placed in a down state, and not used, until the configuration inconsistency can be resolved.|Если данное физическое соединение проходит, оно добавляется в EtherChannel и используется; в противном случае он переводится в неактивное состояние и не используется до тех пор, пока несогласованность конфигурации не будет устранена.
|
Most Cisco Catalyst switches support the Cisco-proprietary Port Aggregation Protocol (PAgP) and the IEEE standard Link Aggregation Control Protocol (LACP), based on IEEE standard 802.3ad.|Большинство коммутаторов Cisco Catalyst поддерживают проприетарный протокол агрегации портов (PAgP) Cisco и стандартный протокол управления агрегацией каналов (LACP) IEEE, основанный на стандарте IEEE 802.3ad.
Although differences exist between the two, to the depth discussed here, they both accomplish the same task: negotiate so that only links that pass the configuration checks are actually used in an EtherChannel.|Несмотря на то, что между ними существуют различия, но в той мере, в какой они обсуждаются здесь, они оба выполняют одну и ту же задачу: согласовывают так, чтобы в EtherChannel фактически использовались только ссылки, прошедшие проверку конфигурации.
|
One difference of note is that LACP does support more links in a channel—16—as compared to PaGP’s maximum of 8.|Следует отметить одно отличие: LACP поддерживает больше ссылок в канале - 16 - по сравнению с максимумом в 8 в PaGP.
With LACP, only 8 can be active at one time, with the others waiting to be used should any of the other links fail.|С LACP только 8 могут быть активными одновременно, а остальные ожидают использования в случае отказа любого из других каналов.
|
To configure either protocol, a switch uses the channel-group configuration commands on each switch, but with a keyword that either means “use this protocol and begin negotiations”|Для настройки любого протокола коммутатор использует команды настройки группы каналов на каждом коммутаторе, но с ключевым словом, которое либо означает «использовать этот протокол и начать переговоры».
|
or “use this protocol and wait for the other switch to begin negotiations.” As shown in Figure 10-7, the desirable and auto keywords enable PAgP, and the active and passive keywords enable LACP. With these options, at least one side has to begin the negotiations.|или «используйте этот протокол и дождитесь, пока другой коммутатор начнет переговоры». Как показано на рисунке 10-7, ключевые слова желаемые и автоматические включают PAgP, а активные и пассивные ключевые слова включают LACP. Имея эти варианты, по крайней мере, одна сторона должна начать переговоры.
|
In other words, with PAgP, at least one of the two sides must use desirable, and with LACP, at least one of the two sides must use active.|Другими словами, с PAgP по крайней мере одна из двух сторон должна использовать желаемое, а с LACP по крайней мере одна из двух сторон должна использовать active.
|
Figure 10-7 Correct EtherChannel Configuration Combinations NOTE Do not use the on parameter on one end, and either auto or desirable (or for LACP, active or passive) on the neighboring switch.|Рисунок 10-7 Правильные комбинации конфигурации EtherChannel ПРИМЕЧАНИЕ Не используйте параметр on на одном конце, а также автоматический или желательный (или для LACP, активного или пассивного) на соседнем коммутаторе.
The on option uses neither PAgP nor LACP, so a configuration that uses on, with PAgP or LACP options on the other end, would prevent the EtherChannel from working.|Опция on не использует ни PAgP, ни LACP, поэтому конфигурация, которая использует on с опциями PAgP или LACP на другом конце, помешает работе EtherChannel.
|
For example, in the design shown in Figure 10-7, imagine both physical interfaces on both switches were configured with the channel-group 2 mode desirable interface subcommand.|Например, в схеме, показанной на рисунке 10-7, представьте, что оба физических интерфейса на обоих коммутаторах были настроены с помощью подкоманды желаемого интерфейса для режима группы каналов 2.
|
As a result, the two switches would negotiate and create an EtherChannel.|В результате два коммутатора будут согласовывать и создавать EtherChannel.
Example 10-5 shows the verification of that configuration, with the command show etherchannel 1 port-channel.|В примере 10-5 показана проверка этой конфигурации с помощью команды show etherchannel 1 port-channel.
This command confirms the protocol in use (PAgP, because the desirable keyword was configured), and the list of interfaces in the channel.|Эта команда подтверждает используемый протокол (PAgP, поскольку было настроено желаемое ключевое слово) и список интерфейсов в канале.
|
Example 10-5 EtherChannel Verification: PAgP Desirable Mode Example end.|Пример 10-5 Проверка EtherChannel: желаемый режим PAgP Конец примера.
#### Physical Interface Configuration and EtherChannels
Конфигурация физического интерфейса и каналы EtherChannels   
__|__
--|--
|
Even when the channel-group commands have all been configured correctly, other configuration settings can prevent a switch from using a physical port in an EtherChannel—even physical ports manually configured to be part of the channel.|Даже если все команды группы каналов были настроены правильно, другие параметры конфигурации могут помешать коммутатору использовать физический порт в EtherChannel - даже физические порты, вручную настроенные как часть канала.
The next topic examines those reasons.|В следующей теме исследуются эти причины.
|
First, before using a physical port in an EtherChannel, the switch compares the new physical port’s configuration to the existing ports in the channel.|Во-первых, перед использованием физического порта в EtherChannel коммутатор сравнивает конфигурацию нового физического порта с существующими портами в канале.
That new physical interface’s settings must be the same as the existing ports’ settings; otherwise, the switch does not add the new link to the list of approved and working interfaces in the channel.|Настройки этого нового физического интерфейса должны быть такими же, как настройки существующих портов; в противном случае коммутатор не добавляет новую ссылку в список одобренных и работающих интерфейсов в канале.
That is, the physical interface remains configured as part of the PortChannel, but it is not used as part of the channel, often being placed into some nonworking state.|То есть физический интерфейс остается настроенным как часть PortChannel, но он не используется как часть канала, часто переводя его в нерабочее состояние.
|
The list of items the switch checks includes the following:|Список пунктов, которые проверяет коммутатор, включает следующее:
###### Speed
Скорость   
###### Duplex
Дуплекс   
###### Operational access or trunking state (all must be access, or all must be trunks)
Оперативный доступ или состояние транкинга (все должны иметь доступ или все должны быть транками)   
###### If an access port, the access VLAN
Если порт доступа, VLAN доступа   
###### If a trunk port, the allowed VLAN list (per the switchport trunk allowed command)
Если это магистральный порт, список разрешенных VLAN (для разрешенной команды switchport trunk)   
###### If a trunk port, the native VLAN
Если порт транка, собственная VLAN   
###### STP interface settings
Настройки интерфейса STP   
__|__
--|--
|
In addition, switches check the settings on the neighboring switch.|Кроме того, переключатели проверяют настройки на соседнем переключателе.
To do so, the switches either use PAgP or LACP (if already in use) or use Cisco Discovery Protocol (CDP) if using manual configuration.|Для этого коммутаторы либо используют PAgP или LACP (если он уже используется), либо используют протокол обнаружения Cisco (CDP) при ручной настройке.
When checking neighbors, all settings except the STP settings must match.|При проверке соседей должны совпадать все настройки, кроме настроек STP.
|
As an example, SW1 and SW2 again use two links in one EtherChannel from Figure 10-7.|Например, SW1 и SW2 снова используют два канала в одном EtherChannel, как показано на рисунке 10-7.
|
Before configuring the EtherChannel, SW1’s G0/2 was given a different RSTP port cost than G0/1.|Перед настройкой EtherChannel для G0 / 2 коммутатора SW1 была присвоена стоимость порта RSTP, отличная от G0 / 1.
Example 10-6 picks up the story just after configuring the correct channel-group commands, when the switch is deciding whether to use G0/1 and G0/2 in this.|Пример 10-6 раскрывает историю сразу после настройки правильных команд группы каналов, когда коммутатор решает, использовать ли в этом G0 / 1 и G0 / 2.
|
Example 10-6 Local Interfaces Fail in EtherChannel Because of Mismatched STP Cost Example end.|Пример 10-6 Отказ локальных интерфейсов в EtherChannel из-за несоответствия стоимости STP Конец примера.
|
The messages at the top of the example specifically state what the switch does when determining whether the interface settings match.|Сообщения в верхней части примера конкретно указывают, что делает переключатель при определении совпадения настроек интерфейса.
In this case, SW1 detects the different STP costs.|В этом случае SW1 обнаруживает различные затраты STP.
SW1 does not use G0/1, does not use G0/2, and even places them into an errdisabled state.|SW1 не использует G0 / 1, не использует G0 / 2 и даже переводит их в состояние errdisabled.
The switch also puts the PortChannel into err-disabled state.|Коммутатор также переводит PortChannel в состояние отключения из-за ошибки.
As a result, the PortChannel is not operational, and the physical interfaces are also not operational.|В результате PortChannel не работает, как и физические интерфейсы.
|
To solve this problem, you must reconfigure the physical interfaces to use the same STP settings.|Чтобы решить эту проблему, необходимо перенастроить физические интерфейсы для использования тех же параметров STP.
In addition, the PortChannel and physical interfaces must be shutdown, and then no shutdown, to recover from the err-disabled state. (Note that when a switch applies the shutdown and no shutdown commands to a PortChannel, it applies those same commands to the physical interfaces, as well; so, just do the shutdown/no shutdown on the PortChannel interface.)|Кроме того, PortChannel и физические интерфейсы должны быть выключены, а затем не выключены, чтобы выйти из состояния отключения из-за ошибки. (Обратите внимание, что когда коммутатор применяет команды shutdown и no shutdown к PortChannel, он применяет те же самые команды к физическим интерфейсам; поэтому просто выполните shutdown / no shutdown на интерфейсе PortChannel.)
#### EtherChannel Load Distribution
Распределение нагрузки EtherChannel   
__|__
--|--
|
When using Layer 2 EtherChannels, a switch’s MAC learning process associates MAC addresses with the PortChannel interfaces and not the underlying physical ports.|При использовании каналов EtherChannel уровня 2 процесс изучения MAC-адресов коммутатора связывает MAC-адреса с интерфейсами PortChannel, а не с соответствующими физическими портами.
Later, when a switch makes a forwarding decision to send a frame out a PortChannel interface, the switch must do more work: to decide out which specific physical port to use to forward the frame.|Позже, когда коммутатор принимает решение о пересылке кадра через интерфейс PortChannel, коммутатор должен выполнять больше работы: решать, какой конкретный физический порт использовать для пересылки кадра.
|
IOS documentation refers to those rules as EtherChannel load distribution or load balancing.|В документации IOS эти правила называются распределением нагрузки EtherChannel или балансировкой нагрузки.
|
Figure 10-8 shows the main idea.|На рис. 10-8 показана основная идея.
|
Figure 10-8 Correct EtherChannel Configuration Combinations|Рисунок 10-8 Правильные комбинации конфигурации EtherChannel
##### Configuration Options for EtherChannel Load Distribution
Варианты конфигурации для распределения нагрузки EtherChannel   
__|__
--|--
|
EtherChannel load distribution makes the choice for each frame based on various numeric values found in the Layer 2, 3, and 4 headers.|Распределение нагрузки EtherChannel делает выбор для каждого кадра на основе различных числовых значений, найденных в заголовках уровней 2, 3 и 4.
The process uses one configurable setting as input: the load distribution method as defined with the port-channel load-balance method global command.|В качестве входных данных процесс использует один настраиваемый параметр: метод распределения нагрузки, определенный с помощью глобальной команды метода балансировки нагрузки порта-канала.
The process then performs some match against the fields identified by the configured method.|Затем процесс выполняет некоторое сопоставление с полями, идентифицированными настроенным методом.
|
Table 10-4 lists the most common methods.|В Таблице 10-4 перечислены наиболее распространенные методы.
However, note that some switches may support only MAC-based methods, or only MAC- and IP-based methods, depending on the model and software version.|Однако обратите внимание, что некоторые коммутаторы могут поддерживать только методы на основе MAC или только методы на основе MAC и IP, в зависимости от модели и версии программного обеспечения.
|
Table 10-4 EtherChannel Load Distribution Methods Table end.|Таблица 10-4 Методы распределения нагрузки EtherChannel Конец таблицы.
|
To appreciate why you might want to use different methods, you need to consider the results of how switches make their choice. (The discussion here focuses on the result, and not the logic, because the logic remains internal to the switch, and Cisco does not document how each switch model or IOS version works internally.) However, the various load distribution algorithms do share some common goals:|Чтобы понять, почему вы можете захотеть использовать разные методы, вам нужно рассмотреть результаты того, как коммутаторы делают свой выбор. (Обсуждение здесь сосредоточено на результате, а не на логике, потому что логика остается внутренней по отношению к коммутатору, и Cisco не документирует, как каждая модель коммутатора или версия IOS работает внутри.) Однако различные алгоритмы распределения нагрузки имеют некоторые общие черты. цели:
###### To cause all messages in a single application flow to use the same link in the channel,
Чтобы все сообщения в одном потоке приложения использовали одну и ту же ссылку в канале,   
__|__
--|--
|
rather than being sent over different links.|а не по разным ссылкам.
Doing so means that the switch will not inadvertently reorder the messages sent in that application flow by sending one message over a busy link that has a queue of waiting messages, while immediately sending the next message out an unused link.|Это означает, что коммутатор не будет непреднамеренно изменять порядок сообщений, отправляемых в этом потоке приложений, отправляя одно сообщение по занятой ссылке, которая имеет очередь ожидающих сообщений, при немедленной отправке следующего сообщения по неиспользуемой ссылке.
###### To integrate the load distribution algorithm work into the hardware forwarding ASIC so
Чтобы интегрировать алгоритм распределения нагрузки в аппаратную пересылку ASIC,   
__|__
--|--
|
that load distribution works just as quickly as the work to forward any other frame.|это распределение нагрузки работает так же быстро, как и работа по пересылке любого другого кадра.
###### To use all the active links in the EtherChannel, adjusting to the addition and removal of
Чтобы использовать все активные ссылки в EtherChannel, настраиваясь на добавление и удаление   
__|__
--|--
|
active links over time.|активные ссылки с течением времени.
###### Within the constraints of the other goals, balance the traffic across those active links.
В рамках ограничений других целей сбалансируйте трафик по этим активным ссылкам.   
__|__
--|--
|
In short, the algorithms first intend to avoid message reordering, make use of the switch forwarding ASICs, and use all the active links.|Короче говоря, алгоритмы в первую очередь предназначены для предотвращения переупорядочения сообщений, использования ASIC для пересылки коммутатора и использования всех активных ссылок.
However, the algorithm does not attempt to send the exact same number of bits over each link over time.|Однако алгоритм не пытается посылать одно и то же количество бит по каждому каналу с течением времени.
The algorithm does try to balance the traffic, but always within the constraints of the other goals.|Алгоритм действительно пытается сбалансировать трафик, но всегда в пределах ограничений других целей.
|
Whatever load distribution method you choose, the method identifies fields in the message headers.|Какой бы метод распределения нагрузки вы ни выбрали, этот метод определяет поля в заголовках сообщений.
Any messages in the same application flow will then have the same values in the fields used by the load distribution algorithm and will always be forwarded over the same link.|Любые сообщения в одном потоке приложения будут иметь те же значения в полях, используемых алгоритмом распределения нагрузки, и всегда будут пересылаться по одной и той же ссылке.
For example, when a user connects to a website, that web server may return thousands of packets to the client.|Например, когда пользователь подключается к веб-сайту, этот веб-сервер может возвращать клиенту тысячи пакетов.
Those thousands of packets should flow over the same link in the EtherChannel.|Эти тысячи пакетов должны проходить по одному и тому же каналу в EtherChannel.
|
For instance, with the load distribution method of src-mac (meaning source MAC address), all frames with the same MAC address flow over one link.|Например, при использовании метода распределения нагрузки src-mac (что означает MAC-адрес источника) все кадры с одним и тем же MAC-адресом проходят по одному каналу.
Figure 10-9 shows the idea with pseudo MAC addresses, with the load distribution sending frames with source MAC 1 over link 1, source MAC 2 over link 2, and source MAC 3 over link 3.|На рисунке 10-9 показана идея с псевдо-MAC-адресами, при котором распределение нагрузки отправляет кадры с исходным MAC-адресом 1 по каналу 1, исходным MAC-адресом 2 по каналу 2 и исходным MAC-адресом 3 по каналу 3.
|
Figure 10-9 Distributing All Frames with Same Mac Out Same Interface Cisco provides a variety of load distribution options so that the engineer can examine the flows in the network with the idea of finding which fields have the most variety in their values:|Рис. 10-9. Распределение всех кадров с одним и тем же интерфейсом Mac на выходе Cisco предоставляет множество вариантов распределения нагрузки, чтобы инженер мог исследовать потоки в сети, чтобы определить, какие поля имеют наибольшее разнообразие значений:
|
source and destination MAC, or IP address, or transport layer port numbers.|MAC-адрес источника и назначения, IP-адрес или номера портов транспортного уровня.
The more variety in the values in the fields, the better the balancing effects, and the lower the chance of sending disproportionate amounts of traffic over one link.|Чем больше разнообразия значений в полях, тем лучше эффекты балансировки и тем меньше вероятность отправки непропорционального объема трафика по одной ссылке.
|
NOTE The algorithm focuses on the low-order bits in the fields in the headers because the low-order bits typically differ the most in real networks, while the high-order bits do not differ much.|ПРИМЕЧАНИЕ. Алгоритм фокусируется на младших битах в полях заголовков, потому что младшие биты обычно больше всего различаются в реальных сетях, тогда как старшие разряды не сильно отличаются.
By focusing on the lower-order bits, the algorithm achieves better balancing of traffic over the links.|За счет сосредоточения внимания на битах более низкого порядка алгоритм обеспечивает лучшую балансировку трафика по ссылкам.
##### The Effects of the EtherChannel Load Distribution Algorithm
Эффекты алгоритма распределения нагрузки EtherChannel   
__|__
--|--
|
Figure 10-10 details a new EtherChannel that will be used in two examples to show the effects of load distribution.|На рис. 10-10 показан новый канал EtherChannel, который будет использоваться в двух примерах, чтобы показать влияние распределения нагрузки.
The examples will focus on frames sent by switch SW1 in the figure, showing the use of the test etherchannel load-balance EXEC command.|Примеры будут сосредоточены на кадрах, отправленных переключателем SW1 на рисунке, показывающем использование команды EXEC test etherchannel load-balance.
That command asks the switch to consider some addresses or ports and answer the question: which link would you use when forwarding a message with those address/port values?.|Эта команда просит коммутатор рассмотреть некоторые адреса или порты и ответить на вопрос: какую ссылку вы бы использовали при пересылке сообщения с этими значениями адреса / порта?
|
Figure 10-10 Four-Link EtherChannel Example 10-7 shows how switch SW1 distributes traffic when using src-mac load distribution.|Рис. 10-10. Пример 10-7 для четырехканального EtherChannel показывает, как коммутатор SW1 распределяет трафик при использовании распределения нагрузки src-mac.
|
The example lists the output from three of the test etherchannel load-balance commands, but note that all three commands use the same source MAC address.|В примере перечислены выходные данные трех тестовых команд балансировки нагрузки etherchannel, но обратите внимание, что все три команды используют один и тот же исходный MAC-адрес.
As a result, the answer from each command references the same interface (G1/0/22 in this case).|В результате ответ каждой команды ссылается на один и тот же интерфейс (в данном случае G1 / 0/22).
|
Example 10-7 Testing with Identical Source MACs When Using src-mac Balancing Example end.|Пример 10-7. Тестирование с идентичными исходными MAC-адресами при использовании балансировки src-mac Конец примера.
|
Example 10-7 makes two important points:|В примере 10-7 отмечаются два важных момента:
###### All three tests list the same outgoing physical interface because (1) the method uses only
Все три теста перечисляют один и тот же исходящий физический интерфейс, потому что (1) метод использует только   
__|__
--|--
|
the source MAC address, and (2) all three tests use the same MAC addresses.|MAC-адрес источника и (2) все три теста используют одни и те же MAC-адреса.
###### All three tests use a different destination MAC address, with different low-order bits, but
Во всех трех тестах используется другой MAC-адрес назначения с разными младшими битами, но   
__|__
--|--
|
that had no impact on the choice because the method—src-mac—does not consider the destination MAC address.|это не повлияло на выбор, поскольку метод - src-mac - не учитывает MAC-адрес назначения.
|
In contrast on that first point, Example 10-8 repeats the test commands from Example 10-7.|В отличие от этого первого пункта пример 10-8 повторяет тестовые команды из примера 10-7.
|
The switch still uses the src-mac balancing method, but now with different source MAC addresses in each test.|Коммутатор по-прежнему использует метод балансировки src-mac, но теперь с разными исходными MAC-адресами в каждом тесте.
Notice that the source MAC addresses used in the tests differ by just a few bit values in the low-order bits, so as a result, each test shows a different interface choice by SW1.|Обратите внимание, что MAC-адреса источника, используемые в тестах, различаются всего на несколько битовых значений в младших битах, поэтому в результате каждый тест показывает другой выбор интерфейса SW1.
|
Example 10-8 Testing with Source MACs with Low-Order Bit Differences Example end.|Пример 10-8 Тестирование с исходными MAC-адресами с младшими разностями битов Пример конец.
|
Example 10-9 shows yet a third variation, this time changing the load distribution method to src-dst-mac, which means that the switch will consider both source and destination MAC.|В примере 10-9 показан еще один вариант, на этот раз с изменением метода распределения нагрузки на src-dst-mac, что означает, что коммутатор будет учитывать MAC-адрес источника и назначения.
|
The example repeats the exact same test etherchannel commands as Example 10-7, with the exact same MAC addresses: the source MAC addresses remain the same in all three tests, but the destination MAC addresses differ in the low-order bits.|В примере повторяются те же самые команды test etherchannel, что и в примере 10-7, с теми же MAC-адресами: исходные MAC-адреса остаются одинаковыми во всех трех тестах, но MAC-адреса назначения различаются младшими битами.
With the chosen destination MAC values differing slightly, switch SW1 happens to choose three different interfaces.|Поскольку выбранные значения MAC назначения немного отличаются, коммутатор SW1 выбирает три разных интерфейса.
|
Example 10-9 Evidence of Source and Destination MAC Load Distribution Example end.|Пример 10-9 Свидетельство распределения нагрузки MAC-адресов источника и назначения Конец примера.
### Chapter Review
Обзор главы   
__|__
--|--
|
One key to doing well on the exams is to perform repetitive spaced review sessions.|Один из ключей к успешной сдаче экзаменов - повторение повторных сессий с интервалом.
Review this chapter’s material using either the tools in the book or interactive tools for the same material found on the book’s companion website.|Просмотрите материал этой главы, используя инструменты из книги или интерактивные инструменты для тех же материалов, которые можно найти на сопутствующем веб-сайте книги.
Refer to the “Your Study Plan” element for more details.|Обратитесь к элементу «Ваш учебный план» для получения более подробной информации.
Table 10-5 outlines the key review elements and where you can find them.|В Таблице 10-5 представлены ключевые элементы обзора и их местонахождение.
To better track your study progress, record when you completed these activities in the second column.|Чтобы лучше отслеживать свои успехи в учебе, отметьте, когда вы выполнили эти задания, во втором столбце.
|
Table 10-5 Chapter Review Tracking Table end.|Таблица 10-5 Окончание таблицы отслеживания обзора главы.
|
Review All the Key Topics Key Terms You Should Know Rapid PVST+, PVST+, system ID extension, PAgP, LACP, PortChannel, Channel-group, EtherChannel, EtherChannel Load Distribution, primary root, secondary root Command References Tables 10-7 and 10-8 list configuration and verification commands used in this chapter.|Ознакомьтесь со всеми ключевыми темами. Ключевые термины, которые вы должны знать Rapid PVST +, PVST +, расширение системного идентификатора, PAgP, LACP, PortChannel, группа каналов, EtherChannel, распределение нагрузки EtherChannel, первичный корень, вторичный корень Ссылки на команды Таблицы 10-7 и 10-8 перечислить команды настройки и проверки, используемые в этой главе.
As an easy review exercise, cover the left column in a table, read the right column, and try to recall the command without looking.|В качестве простого упражнения на повторение закройте левый столбец таблицы, прочтите правый столбец и попытайтесь вспомнить команду, не глядя.
Then repeat the exercise, covering the right column, and try to recall what the command does.|Затем повторите упражнение, охватывая правый столбец, и попытайтесь вспомнить, что делает команда.
|
Table 10-7 Chapter 10 Configuration Command Reference Table end.|Таблица 10-7 Глава 10 Справочник команд конфигурации Конец таблицы.
|
Table 10-8 Chapter 10 EXEC Command Reference Table end.|Таблица 10-8 Глава 10 Справочник команд EXEC Конец таблицы.
|
Keep track of your part review progress with the checklist shown in Table P3-1.|Следите за ходом проверки деталей с помощью контрольного списка, приведенного в Таблице P3-1.
Details on each task follow the table.|Подробности по каждой задаче приведены в таблице.
|
Table P3-1 Part III Part Review Checklist Activity 1st Date Completed 2nd Date Completed Repeat All DIKTA Questions Answer Part Review Questions Review Key Topics Do Labs Review Appendices Videos Repeat All DIKTA Questions For this task, answer the “Do I Know This Already?” questions again for the chapters in this part of the book, using the PCPT software.|Таблица P3-1. Контрольный список проверки части III. Действие 1-я дата завершения 2-я дата завершения Повторить все вопросы DIKTA Ответить на вопросы проверки части Пересмотреть ключевые темы Проверяют ли лаборатории Приложения Видео Повторить все вопросы DIKTA Для этой задачи ответьте на вопрос «Знаю ли я это уже?» снова задайте вопросы к главам этой части книги, используя программное обеспечение PCPT.
|
Answer Part Review Questions For this task, answer the Part Review questions for this part of the book, using the PTP software.|Ответить на вопросы обзора части Для этой задачи ответьте на вопросы обзора части для этой части книги, используя программное обеспечение PTP.
|
Review Key Topics Review all key topics in all chapters in this part, either by browsing the chapters or by using the Key Topics application on the companion website.|Обзор ключевых тем. Просмотрите все ключевые темы во всех главах этой части, просматривая главы или используя приложение «Ключевые темы» на сопутствующем веб-сайте.
|
Labs Depending on your chosen lab tool, here are some suggestions for what to do in lab:|Лабораторные работы В зависимости от выбранного вами лабораторного инструмента, вот несколько советов о том, что делать в лаборатории:
|
Pearson Network Simulator: If you use the full Pearson ICND1 or CCNA simulator, focus more on the configuration scenario and troubleshooting scenario labs associated with the topics in this part of the book.|Симулятор сети Pearson: если вы используете полный симулятор Pearson ICND1 или CCNA, уделите больше внимания сценарию конфигурации и лабораторным работам по сценарию устранения неполадок, связанным с темами в этой части книги.
These types of labs include a larger set of topics and work well as Part Review activities. (See the Introduction for some details about how to find which labs are about topics in this part of the book.) Note that the Sim Lite that comes with this book also has a couple of labs about VLANs.|Эти типы лабораторных работ включают более широкий набор тем и хорошо подходят для работы с обзором деталей. (См. Введение для получения некоторых подробностей о том, как найти, какие лабораторные работы посвящены темам в этой части книги.) Обратите внимание, что Sim Lite, поставляемый с этой книгой, также имеет несколько лабораторных работ по VLAN.
|
Blog: Config Labs: The author’s blog includes a series of configuration-focused labs that you can do on paper, each in 10–15 minutes.|Блог: Config Labs: блог автора включает в себя серию лабораторных работ по настройке, которые вы можете выполнить на бумаге, каждая из которых занимает 10–15 минут.
Review and perform the labs for this part of the book, as found at http://blog.certskills.com.|Просмотрите и выполните лабораторные работы для этой части книги, которые можно найти на http://blog.certskills.com.
Then navigate to the Hands-on Config labs.|Затем перейдите к практическим занятиям по настройке.
## Part III Review
Часть III Обзор   
__|__
--|--
|
Other: If using other lab tools, as a few suggestions: Make sure and experiment heavily with VLAN configuration and VLAN trunking configuration.|Другое: при использовании других лабораторных инструментов, несколько предложений: Убедитесь и поэкспериментируйте с конфигурацией VLAN и конфигурацией транкинга VLAN.
|
Dig Deeper with Appendices on the Companion Website The chapters in Part III of the book recommended the following appendices for extra reading.|Копайте глубже с приложениями на сопутствующем веб-сайте В главах Части III книги рекомендуются следующие приложения для дополнительного чтения.
|
If you care to read further, consider:|Если вы хотите читать дальше, подумайте:
###### Appendix K, “Analyzing Ethernet LAN Designs”: A chapter from the previous
Приложение K, «Анализ схем локальной сети Ethernet»: глава из предыдущего   
__|__
--|--
|
edition that discusses design topologies and LAN design with two-tier and three-tier designs, including access and distribution switches.|издание, в котором обсуждаются топологии проектирования и проектирование ЛВС с двухуровневым и трехуровневым дизайном, включая коммутаторы доступа и распределения.
###### Appendix O, “Spanning Tree Protocol Implementation”: A chapter that works
Приложение O, «Реализация протокола связующего дерева»: глава, которая работает   
__|__
--|--
|
through the configuration and verification commands for STP and RSTP.|с помощью команд настройки и проверки для STP и RSTP.
###### Appendix P, “LAN Troubleshooting”: A chapter from the previous edition of the
Приложение P, «Устранение неполадок LAN»: глава из предыдущего издания   
__|__
--|--
|
ICND2 Cert Guide.|ICND2 Cert Guide.
This chapter includes topics about VLANs, trunks, and STP and how to troubleshoot each.|Эта глава включает темы о виртуальных локальных сетях, соединительных линиях и протоколе STP, а также способы устранения каждой из них.
|
Watch Videos Chapter 8 recommends two videos, one about VLANs and another about the VLAN allowed list on trunks.|Смотреть видео В главе 8 рекомендуется два видеоролика, один о VLAN, а другой о разрешенном списке VLAN на магистралях.
If you have not watched those videos yet, take a moment to scan back to Chapter 8 on the companion website and watch the videos.|Если вы еще не смотрели эти видео, найдите время, чтобы вернуться к главе 8 на сопутствующем веб-сайте и посмотреть видео.
|
The book makes a big transition at this point.|На этом этапе книга делает большой переход.
Part I gave you a broad introduction to networking, and Parts II and III went into some detail about the dominant LAN technology today: Ethernet.|Часть I дала вам общее представление о сетях, а в частях II и III были подробно описаны доминирующая сегодня технология LAN: Ethernet.
Part IV transitions from Ethernet to the network layer details that sit above Ethernet and WAN technology, specifically IP Version 4 (IPv4).|Часть IV переходит от Ethernet к деталям сетевого уровня, которые находятся над технологиями Ethernet и WAN, в частности IP версии 4 (IPv4).
|
Thinking about the network layer requires engineers to shift how they think about addressing.|Думая о сетевом уровне, инженеры должны изменить свой взгляд на адресацию.
|
Ethernet allows the luxury of using universal MAC addresses, assigned by the manufacturers, with no need to plan or configure addresses.|Ethernet позволяет использовать универсальные MAC-адреса, назначаемые производителями, без необходимости планировать или настраивать адреса.
Although the network engineer needs to understand MAC addresses, MAC already exists on each Ethernet NIC, and switches learn the Ethernet MAC addresses dynamically without even needing to be configured to do so.|Хотя сетевому инженеру необходимо понимать MAC-адреса, MAC-адреса уже существуют на каждой сетевой карте Ethernet, а коммутаторы динамически изучают MAC-адреса Ethernet без необходимости их настройки для этого.
As a result, most people operating the network can ignore the specific MAC address values for most tasks.|В результате большинство людей, управляющих сетью, могут игнорировать конкретные значения MAC-адресов для большинства задач.
|
Conversely, IP addressing gives us flexibility and allows choice, but those features require planning, along with a much deeper understanding of the internal structure of the addresses.|И наоборот, IP-адресация дает нам гибкость и позволяет выбирать, но эти функции требуют планирования, а также гораздо более глубокого понимания внутренней структуры адресов.
|
People operating the network must be more aware of the network layer addresses when doing many tasks.|Люди, управляющие сетью, должны больше знать адреса сетевого уровня при выполнении многих задач.
To better prepare you for these Layer 3 addressing details, this part breaks down the addressing details into four chapters, with an opportunity to learn more in preparation for the CCNP Enterprise certification.|Чтобы лучше подготовить вас к этим деталям адресации уровня 3, в этой части детали адресации разбиты на четыре главы, с возможностью узнать больше при подготовке к сертификации CCNP Enterprise.
|
Part IV examines most of the basic details of IPv4 addressing and subnetting, mostly from the perspective of operating an IP network.|В части IV исследуется большинство основных деталей адресации IPv4 и подсетей, в основном с точки зрения эксплуатации IP-сети.
Chapter 11 takes a grand tour of IPv4 addressing as implemented inside a typical enterprise network.|В главе 11 подробно рассказывается об адресации IPv4, реализованной в типичной корпоративной сети.
Chapters 12, 13, and 14 look at some of the specific questions people must ask themselves when operating an IPv4 network.|В главах 12, 13 и 14 рассматриваются некоторые конкретные вопросы, которые люди должны задать себе при работе в сети IPv4.
